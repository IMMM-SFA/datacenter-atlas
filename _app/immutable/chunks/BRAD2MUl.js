var ME=Object.defineProperty;var J2=i=>{throw TypeError(i)};var RE=(i,e,t)=>e in i?ME(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var de=(i,e,t)=>RE(i,typeof e!="symbol"?e+"":e,t),dg=(i,e,t)=>e.has(i)||J2("Cannot "+t);var vr=(i,e,t)=>(dg(i,e,"read from private field"),t?t.call(i):e.get(i)),no=(i,e,t)=>e.has(i)?J2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),pg=(i,e,t,r)=>(dg(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),gg=(i,e,t)=>(dg(i,e,"access private method"),t);import{b as e1,e as kE,t as Ms,a as pr,c as Vc,n as DE,d as Al}from"./8jHWtX8S.js";import{G as BE,O as Yd,h as Ys,J as dA,W as OE,P as Am,b as LE,m as Ue,a9 as ix,_ as FE,$ as t1,N as xA,c as Du,Q as NE,a0 as rx,a as nx,a1 as zE,U as sx,i as UE,ai as pA,ak as wA,aq as mg,D as dm,ar as jE,as as VE,at as WE,T as HE,au as $E,d as ZE,av as qE,aw as XE,L as ox,v as so,ax as GE,R as YE,M as QE,a3 as ax,g as lx,ay as KE,az as JE,aA as eC,aB as tC,ad as Bi,aC as c0,an as xr,aD as JA,t as Go,u as Vn,ap as fr,w as Yo,ac as pm,aE as iC,x as Hi,y as Vi,s as qo,z as Ti,n as uf,aF as rC,aG as nC,aH as _g,o as sC,al as oC,aI as jn}from"./CFRL906C.js";import{p as Yt,i as ms,b as cx,_ as aC,r as lC,l as cC}from"./CqQ69G7x.js";import{b as Mh}from"./Bcgaz8cr.js";import{i as uC,c as hC,d as ed,n as fC,a as AC,e as dC,s as zh}from"./BQNNfHf8.js";import{s as hf}from"./BIxl28Vq.js";import{a as Gu,o as h_,c as pC}from"./xIVuDLCG.js";import{i as ux}from"./BTH-pD58.js";function gC(i,e){if(e){const t=document.body;i.autofocus=!0,BE(()=>{document.activeElement===t&&i.focus()})}}function mC(i,e){return e}function _C(i,e,t,r){for(var o=[],c=e.length,f=0;f<c;f++)WE(e[f].e,o,!0);var a=c>0&&o.length===0&&t!==null;if(a){var w=t.parentNode;HE(w),w.append(t),r.clear(),Mc(i,e[0].prev,e[c-1].next)}$E(o,()=>{for(var P=0;P<c;P++){var k=e[P];a||(r.delete(k.k),Mc(i,k.prev,k.next)),ZE(k.e,!a)}})}function yC(i,e,t,r,o,c=null){var f=i,a={flags:e,items:new Map,first:null};{var w=i;f=Ys?Yd(dA(w)):w.appendChild(OE())}Ys&&Am();var P=null,k=!1,F=ix(()=>{var V=t();return UE(V)?V:V==null?[]:sx(V)});LE(()=>{var V=Ue(F),W=V.length;if(k&&W===0)return;k=W===0;let ee=!1;if(Ys){var he=f.data===FE;he!==(W===0)&&(f=t1(),Yd(f),xA(!1),ee=!0)}if(Ys){for(var Ie=null,Ee,Ne=0;Ne<W;Ne++){if(Du.nodeType===8&&Du.data===NE){f=Du,ee=!0,xA(!1);break}var Ce=V[Ne],De=r(Ce,Ne);Ee=hx(Du,a,Ie,null,Ce,De,Ne,o,e,t),a.items.set(De,Ee),Ie=Ee}W>0&&Yd(t1())}Ys||bC(V,a,f,o,e,r,t),c!==null&&(W===0?P?rx(P):P=nx(()=>c(f)):P!==null&&zE(P,()=>{P=null})),ee&&xA(!0),Ue(F)}),Ys&&(f=Du)}function bC(i,e,t,r,o,c,f){var a=i.length,w=e.items,P=e.first,k=P,F,V=null,W=[],ee=[],he,Ie,Ee,Ne;for(Ne=0;Ne<a;Ne+=1){if(he=i[Ne],Ie=c(he,Ne),Ee=w.get(Ie),Ee===void 0){var Ce=k?k.e.nodes_start:t;V=hx(Ce,e,V,V===null?e.first:V.next,he,Ie,Ne,r,o,f),w.set(Ie,V),W=[],ee=[],k=V.next;continue}if(vC(Ee,he,Ne),(Ee.e.f&mg)!==0&&rx(Ee.e),Ee!==k){if(F!==void 0&&F.has(Ee)){if(W.length<ee.length){var De=ee[0],Ye;V=De.prev;var Ke=W[0],kt=W[W.length-1];for(Ye=0;Ye<W.length;Ye+=1)i1(W[Ye],De,t);for(Ye=0;Ye<ee.length;Ye+=1)F.delete(ee[Ye]);Mc(e,Ke.prev,kt.next),Mc(e,V,Ke),Mc(e,kt,De),k=De,V=kt,Ne-=1,W=[],ee=[]}else F.delete(Ee),i1(Ee,k,t),Mc(e,Ee.prev,Ee.next),Mc(e,Ee,V===null?e.first:V.next),Mc(e,V,Ee),V=Ee;continue}for(W=[],ee=[];k!==null&&k.k!==Ie;)(k.e.f&mg)===0&&(F??(F=new Set)).add(k),ee.push(k),k=k.next;if(k===null)continue;Ee=k}W.push(Ee),V=Ee,k=Ee.next}if(k!==null||F!==void 0){for(var It=F===void 0?[]:sx(F);k!==null;)(k.e.f&mg)===0&&It.push(k),k=k.next;var jt=It.length;if(jt>0){var Lt=a===0?t:null;_C(e,It,Lt,w)}}dm.first=e.first&&e.first.e,dm.last=V&&V.e}function vC(i,e,t,r){VE(i.v,e),i.i=t}function hx(i,e,t,r,o,c,f,a,w,P){var k=(w&qE)!==0,F=(w&XE)===0,V=k?F?pA(o):wA(o):o,W=(w&jE)===0?f:wA(f),ee={i:W,v:V,k:c,a:null,e:null,prev:t,next:r};try{return ee.e=nx(()=>a(i,V,W,P),Ys),ee.e.prev=t&&t.e,ee.e.next=r&&r.e,t===null?e.first=ee:(t.next=ee,t.e.next=ee.e),r!==null&&(r.prev=ee,r.e.prev=ee.e),ee}finally{}}function i1(i,e,t){for(var r=i.next?i.next.e.nodes_start:t,o=e?e.e.nodes_start:t,c=i.e.nodes_start;c!==r;){var f=ox(c);o.before(c),c=f}}function Mc(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function xC(i,e,t=!1,r=!1,o=!1){var c=i,f="";so(()=>{var a=dm;if(f===(f=e()??"")){Ys&&Am();return}if(a.nodes_start!==null&&(GE(a.nodes_start,a.nodes_end),a.nodes_start=a.nodes_end=null),f!==""){if(Ys){Du.data;for(var w=Am(),P=w;w!==null&&(w.nodeType!==8||w.data!=="");)P=w,w=ox(w);if(w===null)throw YE(),QE;e1(Du,P),c=Yd(w);return}var k=f+"";t?k=`<svg>${k}</svg>`:r&&(k=`<math>${k}</math>`);var F=kE(k);if((t||r)&&(F=dA(F)),e1(dA(F),F.lastChild),t||r)for(;dA(F);)c.before(dA(F));else c.before(F)}})}function wC(i,e,t){ax(()=>{var r=lx(()=>e(i,t==null?void 0:t())||{});if(r!=null&&r.destroy)return()=>r.destroy()})}function fx(i){var e,t,r="";if(typeof i=="string"||typeof i=="number")r+=i;else if(typeof i=="object")if(Array.isArray(i)){var o=i.length;for(e=0;e<o;e++)i[e]&&(t=fx(i[e]))&&(r&&(r+=" "),r+=t)}else for(t in i)i[t]&&(r&&(r+=" "),r+=t);return r}function TC(){for(var i,e,t=0,r="",o=arguments.length;t<o;t++)(i=arguments[t])&&(e=fx(i))&&(r&&(r+=" "),r+=e);return r}function f_(i){return typeof i=="object"?TC(i):i??""}const r1=[...` 	
\r\fÂ \v\uFEFF`];function SC(i,e,t){var r=i==null?"":""+i;if(e&&(r=r?r+" "+e:e),t){for(var o in t)if(t[o])r=r?r+" "+o:o;else if(r.length)for(var c=o.length,f=0;(f=r.indexOf(o,f))>=0;){var a=f+c;(f===0||r1.includes(r[f-1]))&&(a===r.length||r1.includes(r[a]))?r=(f===0?"":r.substring(0,f))+r.substring(a+1):f=a}}return r===""?null:r}function n1(i,e=!1){var t=e?" !important;":";",r="";for(var o in i){var c=i[o];c!=null&&c!==""&&(r+=" "+o+": "+c+t)}return r}function yg(i){return i[0]!=="-"||i[1]!=="-"?i.toLowerCase():i}function EC(i,e){if(e){var t="",r,o;if(Array.isArray(e)?(r=e[0],o=e[1]):r=e,i){i=String(i).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var c=!1,f=0,a=!1,w=[];r&&w.push(...Object.keys(r).map(yg)),o&&w.push(...Object.keys(o).map(yg));var P=0,k=-1;const he=i.length;for(var F=0;F<he;F++){var V=i[F];if(a?V==="/"&&i[F-1]==="*"&&(a=!1):c?c===V&&(c=!1):V==="/"&&i[F+1]==="*"?a=!0:V==='"'||V==="'"?c=V:V==="("?f++:V===")"&&f--,!a&&c===!1&&f===0){if(V===":"&&k===-1)k=F;else if(V===";"||F===he-1){if(k!==-1){var W=yg(i.substring(P,k).trim());if(!w.includes(W)){V!==";"&&F++;var ee=i.substring(P,F).trim();t+=" "+ee+";"}}P=F+1,k=-1}}}}return r&&(t+=n1(r)),o&&(t+=n1(o,!0)),t=t.trim(),t===""?null:t}return i==null?null:String(i)}function Oc(i,e,t,r,o,c){var f=i.__className;if(Ys||f!==t||f===void 0){var a=SC(t,r,c);(!Ys||a!==i.getAttribute("class"))&&(a==null?i.removeAttribute("class"):e?i.className=a:i.setAttribute("class",a)),i.__className=t}else if(c&&o!==c)for(var w in c){var P=!!c[w];(o==null||P!==!!o[w])&&i.classList.toggle(w,P)}return c}function bg(i,e={},t,r){for(var o in t){var c=t[o];e[o]!==c&&(t[o]==null?i.style.removeProperty(o):i.style.setProperty(o,c,r))}}function A_(i,e,t,r){var o=i.__style;if(Ys||o!==e){var c=EC(e,r);(!Ys||c!==i.getAttribute("style"))&&(c==null?i.removeAttribute("style"):i.style.cssText=c),i.__style=e}else r&&(Array.isArray(r)?(bg(i,t==null?void 0:t[0],r[0]),bg(i,t==null?void 0:t[1],r[1],"important")):bg(i,t,r));return r}const tA=Symbol("class"),iA=Symbol("style"),Ax=Symbol("is custom element"),dx=Symbol("is html");function CC(i,e){e?i.hasAttribute("selected")||i.setAttribute("selected",""):i.removeAttribute("selected")}function LA(i,e,t,r){var o=px(i);Ys&&(o[e]=i.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&i.nodeName==="LINK")||o[e]!==(o[e]=t)&&(e==="loading"&&(i[KE]=t),t==null?i.removeAttribute(e):typeof t!="string"&&gx(i).includes(e)?i[e]=t:i.setAttribute(e,t))}function s1(i,e,t,r,o=!1){var c=px(i),f=c[Ax],a=!c[dx];let w=Ys&&f;w&&xA(!1);var P=e||{},k=i.tagName==="OPTION";for(var F in e)F in t||(t[F]=null);t.class?t.class=f_(t.class):t[tA]&&(t.class=null),t[iA]&&(t.style??(t.style=null));var V=gx(i);for(const Ce in t){let De=t[Ce];if(k&&Ce==="value"&&De==null){i.value=i.__value="",P[Ce]=De;continue}if(Ce==="class"){var W=i.namespaceURI==="http://www.w3.org/1999/xhtml";Oc(i,W,De,r,e==null?void 0:e[tA],t[tA]),P[Ce]=De,P[tA]=t[tA];continue}if(Ce==="style"){A_(i,De,e==null?void 0:e[iA],t[iA]),P[Ce]=De,P[iA]=t[iA];continue}var ee=P[Ce];if(De!==ee){P[Ce]=De;var he=Ce[0]+Ce[1];if(he!=="$$")if(he==="on"){const Ye={},Ke="$$"+Ce;let kt=Ce.slice(2);var Ie=AC(kt);if(uC(kt)&&(kt=kt.slice(0,-7),Ye.capture=!0),!Ie&&ee){if(De!=null)continue;i.removeEventListener(kt,P[Ke],Ye),P[Ke]=null}if(De!=null)if(Ie)i[`__${kt}`]=De,ed([kt]);else{let It=function(jt){P[Ce].call(this,jt)};P[Ke]=hC(kt,i,It,Ye)}else Ie&&(i[`__${kt}`]=void 0)}else if(Ce==="style")LA(i,Ce,De);else if(Ce==="autofocus")gC(i,!!De);else if(!f&&(Ce==="__value"||Ce==="value"&&De!=null))i.value=i.__value=De;else if(Ce==="selected"&&k)CC(i,De);else{var Ee=Ce;a||(Ee=fC(Ee));var Ne=Ee==="defaultValue"||Ee==="defaultChecked";if(De==null&&!f&&!Ne)if(c[Ce]=null,Ee==="value"||Ee==="checked"){let Ye=i;const Ke=e===void 0;if(Ee==="value"){let kt=Ye.defaultValue;Ye.removeAttribute(Ee),Ye.defaultValue=kt,Ye.value=Ye.__value=Ke?kt:null}else{let kt=Ye.defaultChecked;Ye.removeAttribute(Ee),Ye.defaultChecked=kt,Ye.checked=Ke?kt:!1}}else i.removeAttribute(Ce);else Ne||V.includes(Ee)&&(f||typeof De!="string")?i[Ee]=De:typeof De!="function"&&LA(i,Ee,De)}}}return w&&xA(!0),P}function px(i){return i.__attributes??(i.__attributes={[Ax]:i.nodeName.includes("-"),[dx]:i.namespaceURI===JE})}var o1=new Map;function gx(i){var e=o1.get(i.nodeName);if(e)return e;o1.set(i.nodeName,e=[]);for(var t,r=i,o=Element.prototype;o!==r;){t=tC(r);for(var c in t)t[c].set&&e.push(c);r=eC(r)}return e}var Dc,Kh,qA,Hp,mx;const $p=class $p{constructor(e){no(this,Hp);no(this,Dc,new WeakMap);no(this,Kh);no(this,qA);pg(this,qA,e)}observe(e,t){var r=vr(this,Dc).get(e)||new Set;return r.add(t),vr(this,Dc).set(e,r),gg(this,Hp,mx).call(this).observe(e,vr(this,qA)),()=>{var o=vr(this,Dc).get(e);o.delete(t),o.size===0&&(vr(this,Dc).delete(e),vr(this,Kh).unobserve(e))}}};Dc=new WeakMap,Kh=new WeakMap,qA=new WeakMap,Hp=new WeakSet,mx=function(){return vr(this,Kh)??pg(this,Kh,new ResizeObserver(e=>{for(var t of e){$p.entries.set(t.target,t);for(var r of vr(this,Dc).get(t.target)||[])r(t)}}))},de($p,"entries",new WeakMap);let gm=$p;var IC=new gm({box:"border-box"});function PC(i,e,t){var r=IC.observe(i,()=>t(i[e]));ax(()=>(lx(()=>t(i[e])),r))}function vg(i){Bi(i,i.v+1)}function MC(i){return Object.fromEntries(Object.entries(i).filter(([e,t])=>t!=null))}var RC=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],kC=["difference","intersection","symmetricDifference","union"],a1=!1,Jh,ka,Bc,Zp,_x;const qp=class qp extends Set{constructor(t){super();no(this,Zp);no(this,Jh,new Map);no(this,ka,wA(0));no(this,Bc,wA(0));if(t){for(var r of t)super.add(r);vr(this,Bc).v=super.size}a1||gg(this,Zp,_x).call(this)}has(t){var r=super.has(t),o=vr(this,Jh),c=o.get(t);if(c===void 0){if(!r)return Ue(vr(this,ka)),!1;c=wA(!0),o.set(t,c)}return Ue(c),r}add(t){return super.has(t)||(super.add(t),Bi(vr(this,Bc),super.size),vg(vr(this,ka))),this}delete(t){var r=super.delete(t),o=vr(this,Jh),c=o.get(t);return c!==void 0&&(o.delete(t),Bi(c,!1)),r&&(Bi(vr(this,Bc),super.size),vg(vr(this,ka))),r}clear(){if(super.size!==0){super.clear();var t=vr(this,Jh);for(var r of t.values())Bi(r,!1);t.clear(),Bi(vr(this,Bc),0),vg(vr(this,ka))}}keys(){return this.values()}values(){return Ue(vr(this,ka)),super.values()}entries(){return Ue(vr(this,ka)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return Ue(vr(this,Bc))}};Jh=new WeakMap,ka=new WeakMap,Bc=new WeakMap,Zp=new WeakSet,_x=function(){a1=!0;var t=qp.prototype,r=Set.prototype;for(const o of RC)t[o]=function(...c){return Ue(vr(this,ka)),r[o].apply(this,c)};for(const o of kC)t[o]=function(...c){Ue(vr(this,ka));var f=r[o].apply(this,c);return new qp(f)}};let mm=qp,DC=Date.now();function BC(i){return`${i}-${DC++}`}var XA;class fp{constructor(e){no(this,XA,xr());this.value=e}get value(){return Ue(vr(this,XA))}set value(e){Bi(vr(this,XA),e,!0)}}XA=new WeakMap;var GA,YA,QA,KA;class OC{constructor(){no(this,GA,xr());no(this,YA,xr(!1));de(this,"loadedImages",new mm);no(this,QA,xr(0));no(this,KA,xr(24));de(this,"layerInfo",new Map);de(this,"eventTracker",new WeakMap);de(this,"eventTopMost");de(this,"markerClickManager",new ZC);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return Ue(vr(this,GA))}set map(e){Bi(vr(this,GA),e,!0)}get loaded(){return Ue(vr(this,YA))}set loaded(e){Bi(vr(this,YA),e,!0)}get minzoom(){return Ue(vr(this,QA))}set minzoom(e){Bi(vr(this,QA),e,!0)}get maxzoom(){return Ue(vr(this,KA))}set maxzoom(e){Bi(vr(this,KA),e,!0)}_eventTopMost(e){var c;let t=this.eventTracker.get(e.originalEvent);if(t!==void 0)return t;let o=(c=e.target.queryRenderedFeatures(e.point).find(f=>{var a;return(a=this.layerInfo.get(f.layer.id))==null?void 0:a.interactive}))==null?void 0:c.layer.id;return this.eventTracker.set(e.originalEvent,o),o}}GA=new WeakMap,YA=new WeakMap,QA=new WeakMap,KA=new WeakMap;function LC(i){c0(xx,i)}function FC(){return JA(xx)}function NC(i){c0(vx,i)}function zC(){return JA(vx)}function UC(){return JA(wx)}function yx(i){c0(wx,i)}function jC(){return JA(VC)}const bx=Symbol.for("svelte-maplibre"),vx=Symbol.for("svelte-maplibre.popup-target"),xx=Symbol.for("svelte-maplibre.layer"),wx=Symbol.for("svelte-maplibre.layer-event"),VC=Symbol.for("svelte-maplibre.lng-lat");function ff(){return JA(bx)}function WC(){return c0(bx,new OC)}function HC(){const i=new fp(void 0),e=new fp(void 0);return LC(i),yx(e),{layer:i,layerEvent:e}}function $C(i){return"layerType"in i&&i.layerType==="deckgl"}class ZC{constructor(){de(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function qC(i){let e=i.getCenter(),t=Math.round(i.getZoom()*100)/100,r=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),c=Math.round(e.lat*o)/o,f=Math.round(e.lng*o)/o,a=`${t}/${c}/${f}`,w=i.getBearing(),P=i.getPitch();return(w||P)&&(a+=`/${Math.round(w*10)/10}`),P&&(a+=`/${Math.round(P)}`),`#${a}`}function XC(i){return i.replace("#","").split("/").map(parseFloat)}function Tx(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Qd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.5.0/LICENSE.txt
 */var GC=Qd.exports,l1;function YC(){return l1||(l1=1,function(i,e){(function(t,r){i.exports=r()})(GC,function(){var t={},r={};function o(f,a,w){if(r[f]=w,f==="index"){var P="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",k={};return r.shared(k),r.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),t}}o("shared",["exports"],function(f){function a(h,s,u,m){return new(u||(u=Promise))(function(b,E){function C(U){try{L(m.next(U))}catch(H){E(H)}}function D(U){try{L(m.throw(U))}catch(H){E(H)}}function L(U){var H;U.done?b(U.value):(H=U.value,H instanceof u?H:new u(function(q){q(H)})).then(C,D)}L((m=m.apply(h,s||[])).next())})}function w(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var P,k;function F(){if(k)return P;function h(s,u){this.x=s,this.y=u}return k=1,P=h,h.prototype={clone:function(){return new h(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,u){return this.clone()._rotateAround(s,u)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var u=s.x-this.x,m=s.y-this.y;return u*u+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,u){return Math.atan2(this.x*u-this.y*s,this.x*s+this.y*u)},_matMult:function(s){var u=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=u,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var u=Math.cos(s),m=Math.sin(s),b=m*this.x+u*this.y;return this.x=u*this.x-m*this.y,this.y=b,this},_rotateAround:function(s,u){var m=Math.cos(s),b=Math.sin(s),E=u.y+b*(this.x-u.x)+m*(this.y-u.y);return this.x=u.x+m*(this.x-u.x)-b*(this.y-u.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(s){return s instanceof h?s:Array.isArray(s)?new h(s[0],s[1]):s},P}typeof SuppressedError=="function"&&SuppressedError;var V,W,ee=w(F()),he=function(){if(W)return V;function h(s,u,m,b){this.cx=3*s,this.bx=3*(m-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(b-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=u,this.p2x=m,this.p2y=b}return W=1,V=h,h.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,u){if(u===void 0&&(u=1e-6),s<0)return 0;if(s>1)return 1;for(var m=s,b=0;b<8;b++){var E=this.sampleCurveX(m)-s;if(Math.abs(E)<u)return m;var C=this.sampleCurveDerivativeX(m);if(Math.abs(C)<1e-6)break;m-=E/C}var D=0,L=1;for(m=s,b=0;b<20&&(E=this.sampleCurveX(m),!(Math.abs(E-s)<u));b++)s>E?D=m:L=m,m=.5*(L-D)+D;return m},solve:function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))}},V}(),Ie=w(he);let Ee,Ne;function Ce(){return Ee==null&&(Ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ee}function De(){if(Ne==null&&(Ne=!1,Ce())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let m=0;m<5*5;m++){const b=4*m;s.fillStyle=`rgb(${b},${b+1},${b+2})`,s.fillRect(m%5,Math.floor(m/5),1,1)}const u=s.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&u[m]!==m){Ne=!0;break}}}return Ne||!1}var Ye=1e-6,Ke=typeof Float32Array<"u"?Float32Array:Array;function kt(){var h=new Ke(9);return Ke!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function It(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function jt(){var h=new Ke(3);return Ke!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function Lt(h){return Math.hypot(h[0],h[1],h[2])}function Mt(h,s,u){var m=new Ke(3);return m[0]=h,m[1]=s,m[2]=u,m}Math.hypot||(Math.hypot=function(){for(var h=0,s=arguments.length;s--;)h+=arguments[s]*arguments[s];return Math.sqrt(h)});var vi,Xt=Lt;function Jt(h,s,u){var m=s[0],b=s[1],E=s[2],C=s[3];return h[0]=u[0]*m+u[4]*b+u[8]*E+u[12]*C,h[1]=u[1]*m+u[5]*b+u[9]*E+u[13]*C,h[2]=u[2]*m+u[6]*b+u[10]*E+u[14]*C,h[3]=u[3]*m+u[7]*b+u[11]*E+u[15]*C,h}function zi(){var h=new Ke(4);return Ke!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function Fe(){var h=new Ke(2);return Ke!=Float32Array&&(h[0]=0,h[1]=0),h}function tt(h,s){var u=new Ke(2);return u[0]=h,u[1]=s,u}jt(),vi=new Ke(4),Ke!=Float32Array&&(vi[0]=0,vi[1]=0,vi[2]=0,vi[3]=0),jt(),Mt(1,0,0),Mt(0,1,0),zi(),zi(),kt(),Fe();const Me=8192;function dt(h,s,u){return s*(Me/(h.tileSize*Math.pow(2,u-h.tileID.overscaledZ)))}function vt(h,s){return(h%s+s)%s}function Pt(h,s,u){return h*(1-u)+s*u}function Ct(h){if(h<=0)return 0;if(h>=1)return 1;const s=h*h,u=s*h;return 4*(h<.5?u:3*(h-s)+u-.75)}function ei(h,s,u,m){const b=new Ie(h,s,u,m);return E=>b.solve(E)}const Ai=ei(.25,.1,.25,1);function oi(h,s,u){return Math.min(u,Math.max(s,h))}function Zi(h,s,u){const m=u-s,b=((h-s)%m+m)%m+s;return b===s?u:b}function Oi(h,...s){for(const u of s)for(const m in u)h[m]=u[m];return h}let Li=1;function Ar(h,s,u){const m={};for(const b in h)m[b]=s.call(this,h[b],b,h);return m}function Yi(h,s,u){const m={};for(const b in h)s.call(this,h[b],b,h)&&(m[b]=h[b]);return m}function Fi(h){return Array.isArray(h)?h.map(Fi):typeof h=="object"&&h?Ar(h,Fi):h}const wr={};function sr(h){wr[h]||(typeof console<"u"&&console.warn(h),wr[h]=!0)}function ur(h,s,u){return(u.y-h.y)*(s.x-h.x)>(s.y-h.y)*(u.x-h.x)}function qi(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let Vt=null;function zt(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Pi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function dr(h,s,u,m,b){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(h,{timestamp:0});try{const C=E==null?void 0:E.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const D=C.startsWith("BGR"),L=new Uint8ClampedArray(m*b*4);if(yield E.copyTo(L,function(U,H,q,Q,J){const te=4*Math.max(1,0),oe=(Math.max(0,q)-q)*Q*4+te,pe=4*Q,Se=Math.max(0,H),He=Math.max(0,q);return{rect:{x:Se,y:He,width:Math.min(U.width,H+Q)-Se,height:Math.min(U.height,q+J)-He},layout:[{offset:oe,stride:pe}]}}(h,s,u,m,b)),D)for(let U=0;U<L.length;U+=4){const H=L[U];L[U]=L[U+2],L[U+2]=H}return L}finally{E.close()}})}let tr,or;function Tn(h,s,u,m){return h.addEventListener(s,u,m),{unsubscribe:()=>{h.removeEventListener(s,u,m)}}}function rs(h){return h*Math.PI/180}function Sn(h){return h/Math.PI*180}const js={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ao={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Io="AbortError";function Qs(){return new Error(Io)}const lo={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Po(h){return lo.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const Na="global-dispatcher";class ks extends Error{constructor(s,u,m,b){super(`AJAXError: ${u} (${s}): ${m}`),this.status=s,this.statusText=u,this.url=m,this.body=b}}const ns=()=>qi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ks=function(h,s){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const m=Po(h.url);if(m)return m(h,s);if(qi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:Na},s)}if(!(/^file:/.test(u=h.url)||/^file:/.test(ns())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return a(this,void 0,void 0,function*(){const E=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:ns(),signal:b.signal});let C,D;m.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{C=yield fetch(E)}catch(U){throw new ks(0,U.message,m.url,new Blob)}if(!C.ok){const U=yield C.blob();throw new ks(C.status,C.statusText,m.url,U)}D=m.type==="arrayBuffer"||m.type==="image"?C.arrayBuffer():m.type==="json"?C.json():C.text();const L=yield D;if(b.signal.aborted)throw Qs();return{data:L,cacheControl:C.headers.get("Cache-Control"),expires:C.headers.get("Expires")}})}(h,s);if(qi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:Na},s)}var u;return function(m,b){return new Promise((E,C)=>{var D;const L=new XMLHttpRequest;L.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(L.responseType="arraybuffer");for(const U in m.headers)L.setRequestHeader(U,m.headers[U]);m.type==="json"&&(L.responseType="text",!((D=m.headers)===null||D===void 0)&&D.Accept||L.setRequestHeader("Accept","application/json")),L.withCredentials=m.credentials==="include",L.onerror=()=>{C(new Error(L.statusText))},L.onload=()=>{if(!b.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let U=L.response;if(m.type==="json")try{U=JSON.parse(L.response)}catch(H){return void C(H)}E({data:U,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const U=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});C(new ks(L.status,L.statusText,m.url,U))}},b.signal.addEventListener("abort",()=>{L.abort(),C(Qs())}),L.send(m.body)})}(h,s)};function rt(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const s=new URL(h),u=window.location;return s.protocol===u.protocol&&s.host===u.host}function ae(h,s,u){u[h]&&u[h].indexOf(s)!==-1||(u[h]=u[h]||[],u[h].push(s))}function le(h,s,u){if(u&&u[h]){const m=u[h].indexOf(s);m!==-1&&u[h].splice(m,1)}}class me{constructor(s,u={}){Oi(this,u),this.type=s}}class ue extends me{constructor(s,u={}){super("error",Oi({error:s},u))}}class $e{on(s,u){return this._listeners=this._listeners||{},ae(s,u,this._listeners),{unsubscribe:()=>{this.off(s,u)}}}off(s,u){return le(s,u,this._listeners),le(s,u,this._oneTimeListeners),this}once(s,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},ae(s,u,this._oneTimeListeners),this):new Promise(m=>this.once(s,m))}fire(s,u){typeof s=="string"&&(s=new me(s,u||{}));const m=s.type;if(this.listens(m)){s.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const D of b)D.call(this,s);const E=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const D of E)le(m,D,this._oneTimeListeners),D.call(this,s);const C=this._eventedParent;C&&(Oi(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(s))}else s instanceof ue&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ge(h,s){const u={};for(const m in h)m!=="ref"&&(u[m]=h[m]);return ut.forEach(m=>{m in s&&(u[m]=s[m])}),u}function ot(h,s){if(Array.isArray(h)){if(!Array.isArray(s)||h.length!==s.length)return!1;for(let u=0;u<h.length;u++)if(!ot(h[u],s[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&s!==null){if(typeof s!="object"||Object.keys(h).length!==Object.keys(s).length)return!1;for(const u in h)if(!ot(h[u],s[u]))return!1;return!0}return h===s}function pt(h,s){h.push(s)}function nt(h,s,u){pt(u,{command:"addSource",args:[h,s[h]]})}function Rt(h,s,u){pt(s,{command:"removeSource",args:[h]}),u[h]=!0}function Qt(h,s,u,m){Rt(h,u,m),nt(h,s,u)}function ii(h,s,u){let m;for(m in h[u])if(Object.prototype.hasOwnProperty.call(h[u],m)&&m!=="data"&&!ot(h[u][m],s[u][m]))return!1;for(m in s[u])if(Object.prototype.hasOwnProperty.call(s[u],m)&&m!=="data"&&!ot(h[u][m],s[u][m]))return!1;return!0}function gi(h,s,u,m,b,E){h=h||{},s=s||{};for(const C in h)Object.prototype.hasOwnProperty.call(h,C)&&(ot(h[C],s[C])||u.push({command:E,args:[m,C,s[C],b]}));for(const C in s)Object.prototype.hasOwnProperty.call(s,C)&&!Object.prototype.hasOwnProperty.call(h,C)&&(ot(h[C],s[C])||u.push({command:E,args:[m,C,s[C],b]}))}function Qe(h){return h.id}function ht(h,s){return h[s.id]=s,h}class We{constructor(s,u,m,b){this.message=(s?`${s}: `:"")+m,b&&(this.identifier=b),u!=null&&u.__line__&&(this.line=u.__line__)}}function Tt(h,...s){for(const u of s)for(const m in u)h[m]=u[m];return h}class A extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class ie{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[m,b]of u)this.bindings[m]=b}concat(s){return new ie(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const ri={kind:"null"},_t={kind:"number"},ui={kind:"string"},ni={kind:"boolean"},Ei={kind:"color"},Tr={kind:"projectionDefinition"},Xi={kind:"object"},si={kind:"value"},En={kind:"collator"},Mo={kind:"formatted"},Ko={kind:"padding"},Jo={kind:"colorArray"},nn={kind:"numberArray"},Ds={kind:"resolvedImage"},Sr={kind:"variableAnchorOffsetCollection"};function Hn(h,s){return{kind:"array",itemType:h,N:s}}function Br(h){if(h.kind==="array"){const s=Br(h.itemType);return typeof h.N=="number"?`array<${s}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${s}>`}return h.kind}const ys=[ri,_t,ui,ni,Ei,Tr,Mo,Xi,Hn(si),Ko,nn,Jo,Ds,Sr];function Di(h,s){if(s.kind==="error")return null;if(h.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Di(h.itemType,s.itemType))&&(typeof h.N!="number"||h.N===s.N))return null}else{if(h.kind===s.kind)return null;if(h.kind==="value"){for(const u of ys)if(!Di(u,s))return null}}return`Expected ${Br(h)} but found ${Br(s)} instead.`}function fe(h,s){return s.some(u=>u.kind===h.kind)}function Mi(h,s){return s.some(u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h)}function Js(h,s){return h.kind==="array"&&s.kind==="array"?h.itemType.kind===s.itemType.kind&&typeof h.N=="number":h.kind===s.kind}const Ku=.96422,Hc=.82521,Ju=4/29,za=6/29,se=3*za*za,vf=za*za*za,xf=Math.PI/180,wf=180/Math.PI;function eh(h){return(h%=360)<0&&(h+=360),h}function $c([h,s,u,m]){let b,E;const C=Xl((.2225045*(h=ea(h))+.7168786*(s=ea(s))+.0606169*(u=ea(u)))/1);h===s&&s===u?b=E=C:(b=Xl((.4360747*h+.3850649*s+.1430804*u)/Ku),E=Xl((.0139322*h+.0971045*s+.7141733*u)/Hc));const D=116*C-16;return[D<0?0:D,500*(b-C),200*(C-E),m]}function ea(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function Xl(h){return h>vf?Math.pow(h,1/3):h/se+Ju}function Zc([h,s,u,m]){let b=(h+16)/116,E=isNaN(s)?b:b+s/500,C=isNaN(u)?b:b-u/200;return b=1*Vs(b),E=Ku*Vs(E),C=Hc*Vs(C),[Ro(3.1338561*E-1.6168667*b-.4906146*C),Ro(-.9787684*E+1.9161415*b+.033454*C),Ro(.0719453*E-.2289914*b+1.4052427*C),m]}function Ro(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function Vs(h){return h>za?h*h*h:se*(h-Ju)}const hn=Object.hasOwn||function(h,s){return Object.prototype.hasOwnProperty.call(h,s)};function ta(h,s){return hn(h,s)?h[s]:void 0}function pl(h){return parseInt(h.padEnd(2,h),16)/255}function qc(h,s){return kn(s?h/100:h,0,1)}function kn(h,s,u){return Math.min(Math.max(s,h),u)}function lr(h){return!h.some(Number.isNaN)}const Ua={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function $n(h,s,u){return h+u*(s-h)}function gr(h,s,u){return h.map((m,b)=>$n(m,s[b],u))}class ir{constructor(s,u,m,b=1,E=!0){this.r=s,this.g=u,this.b=m,this.a=b,E||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[s,u,m,b]))}static parse(s){if(s instanceof ir)return s;if(typeof s!="string")return;const u=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=ta(Ua,m);if(b){const[C,D,L]=b;return[C/255,D/255,L/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const C=m.length<6?1:2;let D=1;return[pl(m.slice(D,D+=C)),pl(m.slice(D,D+=C)),pl(m.slice(D,D+=C)),pl(m.slice(D,D+C)||"ff")]}if(m.startsWith("rgb")){const C=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){const[D,L,U,H,q,Q,J,te,oe,pe,Se,He]=C,ke=[H||" ",J||" ",pe].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const K=[U,Q,oe].join(""),Ae=K==="%%%"?100:K===""?255:0;if(Ae){const Be=[kn(+L/Ae,0,1),kn(+q/Ae,0,1),kn(+te/Ae,0,1),Se?qc(+Se,He):1];if(lr(Be))return Be}}return}}const E=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[C,D,L,U,H,q,Q,J,te]=E,oe=[L||" ",H||" ",Q].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const pe=[+D,kn(+U,0,100),kn(+q,0,100),J?qc(+J,te):1];if(lr(pe))return function([Se,He,ke,K]){function Ae(Be){const ft=(Be+Se/30)%12,Dt=He*Math.min(ke,1-ke);return ke-Dt*Math.max(-1,Math.min(ft-3,9-ft,1))}return Se=eh(Se),He/=100,ke/=100,[Ae(0),Ae(8),Ae(4),K]}(pe)}}}(s);return u?new ir(...u,!1):void 0}get rgb(){const{r:s,g:u,b:m,a:b}=this,E=b||1/0;return this.overwriteGetter("rgb",[s/E,u/E,m/E,b])}get hcl(){return this.overwriteGetter("hcl",function(s){const[u,m,b,E]=$c(s),C=Math.sqrt(m*m+b*b);return[Math.round(1e4*C)?eh(Math.atan2(b,m)*wf):NaN,C,u,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",$c(this.rgb))}overwriteGetter(s,u){return Object.defineProperty(this,s,{value:u}),u}toString(){const[s,u,m,b]=this.rgb;return`rgba(${[s,u,m].map(E=>Math.round(255*E)).join(",")},${b})`}static interpolate(s,u,m,b="rgb"){switch(b){case"rgb":{const[E,C,D,L]=gr(s.rgb,u.rgb,m);return new ir(E,C,D,L,!1)}case"hcl":{const[E,C,D,L]=s.hcl,[U,H,q,Q]=u.hcl;let J,te;if(isNaN(E)||isNaN(U))isNaN(E)?isNaN(U)?J=NaN:(J=U,D!==1&&D!==0||(te=H)):(J=E,q!==1&&q!==0||(te=C));else{let ke=U-E;U>E&&ke>180?ke-=360:U<E&&E-U>180&&(ke+=360),J=E+m*ke}const[oe,pe,Se,He]=function([ke,K,Ae,Be]){return ke=isNaN(ke)?0:ke*xf,Zc([Ae,Math.cos(ke)*K,Math.sin(ke)*K,Be])}([J,te??$n(C,H,m),$n(D,q,m),$n(L,Q,m)]);return new ir(oe,pe,Se,He,!1)}case"lab":{const[E,C,D,L]=Zc(gr(s.lab,u.lab,m));return new ir(E,C,D,L,!1)}}}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1);class ja{constructor(s,u,m){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const gl=["bottom","center","top"];class Va{constructor(s,u,m,b,E,C){this.text=s,this.image=u,this.scale=m,this.fontStack=b,this.textColor=E,this.verticalAlign=C}}class ss{constructor(s){this.sections=s}static fromString(s){return new ss([new Va(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof ss?s:ss.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class fn{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof fn)return s;if(typeof s=="number")return new fn([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const u of s)if(typeof u!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new fn(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,u,m){return new fn(gr(s.values,u.values,m))}}class jr{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof jr)return s;if(typeof s=="number")return new jr([s]);if(Array.isArray(s)){for(const u of s)if(typeof u!="number")return;return new jr(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,u,m){return new jr(gr(s.values,u.values,m))}}class an{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof an)return s;if(typeof s=="string"){const m=ir.parse(s);return m?new an([m]):void 0}if(!Array.isArray(s))return;const u=[];for(const m of s){if(typeof m!="string")return;const b=ir.parse(m);if(!b)return;u.push(b)}return new an(u)}toString(){return JSON.stringify(this.values)}static interpolate(s,u,m,b="rgb"){const E=[];if(s.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let C=0;C<s.values.length;C++)E.push(ir.interpolate(s.values[C],u.values[C],m,b));return new an(E)}}class Mr extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}}const Wa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Zn{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Zn)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let u=0;u<s.length;u+=2){const m=s[u],b=s[u+1];if(typeof m!="string"||!Wa.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new Zn(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,u,m){const b=s.values,E=u.values;if(b.length!==E.length)throw new Mr(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${u.toString()}`);const C=[];for(let D=0;D<b.length;D+=2){if(b[D]!==E[D])throw new Mr(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${b[D]}, to[${D}]: ${E[D]}`);C.push(b[D]);const[L,U]=b[D+1],[H,q]=E[D+1];C.push([$n(L,H,m),$n(U,q,m)])}return new Zn(C)}}class os{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new os({name:s,available:!1}):null}}class as{constructor(s,u,m){this.from=s,this.to=u,this.transition=m}static interpolate(s,u,m){return new as(s,u,m)}static parse(s){return s instanceof as?s:Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"?new as(s[0],s[1],s[2]):typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number"?new as(s.from,s.to,s.transition):typeof s=="string"?new as(s,s,1):void 0}}function ia(h,s,u,m){return typeof h=="number"&&h>=0&&h<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[h,s,u,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[h,s,u,m]:[h,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mr(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof as||h instanceof ir||h instanceof ja||h instanceof ss||h instanceof fn||h instanceof jr||h instanceof an||h instanceof Zn||h instanceof os)return!0;if(Array.isArray(h)){for(const s of h)if(!mr(s))return!1;return!0}if(typeof h=="object"){for(const s in h)if(!mr(h[s]))return!1;return!0}return!1}function Vr(h){if(h===null)return ri;if(typeof h=="string")return ui;if(typeof h=="boolean")return ni;if(typeof h=="number")return _t;if(h instanceof ir)return Ei;if(h instanceof as)return Tr;if(h instanceof ja)return En;if(h instanceof ss)return Mo;if(h instanceof fn)return Ko;if(h instanceof jr)return nn;if(h instanceof an)return Jo;if(h instanceof Zn)return Sr;if(h instanceof os)return Ds;if(Array.isArray(h)){const s=h.length;let u;for(const m of h){const b=Vr(m);if(u){if(u===b)continue;u=si;break}u=b}return Hn(u||si,s)}return Xi}function nr(h){const s=typeof h;return h===null?"":s==="string"||s==="number"||s==="boolean"?String(h):h instanceof ir||h instanceof as||h instanceof ss||h instanceof fn||h instanceof jr||h instanceof an||h instanceof Zn||h instanceof os?h.toString():JSON.stringify(h)}class Ui{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!mr(s[1]))return u.error("invalid value");const m=s[1];let b=Vr(m);const E=u.expectedType;return b.kind!=="array"||b.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(b=E),new Ui(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ra={string:ui,number:_t,boolean:ni,object:Xi};class Gi{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let m,b=1;const E=s[0];if(E==="array"){let D,L;if(s.length>2){const U=s[1];if(typeof U!="string"||!(U in ra)||U==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);D=ra[U],b++}else D=si;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);L=s[2],b++}m=Hn(D,L)}else{if(!ra[E])throw new Error(`Types doesn't contain name = ${E}`);m=ra[E]}const C=[];for(;b<s.length;b++){const D=u.parse(s[b],b,si);if(!D)return null;C.push(D)}return new Gi(m,C)}evaluate(s){for(let u=0;u<this.args.length;u++){const m=this.args[u].evaluate(s);if(!Di(this.type,Vr(m)))return m;if(u===this.args.length-1)throw new Mr(`Expected value to be of type ${Br(this.type)}, but found ${Br(Vr(m))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Gl={"to-boolean":ni,"to-color":Ei,"to-number":_t,"to-string":ui};class Dn{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const m=s[0];if(!Gl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&s.length!==2)return u.error("Expected one argument.");const b=Gl[m],E=[];for(let C=1;C<s.length;C++){const D=u.parse(s[C],C,si);if(!D)return null;E.push(D)}return new Dn(b,E)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let u,m;for(const b of this.args){if(u=b.evaluate(s),m=null,u instanceof ir)return u;if(typeof u=="string"){const E=s.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(m=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:ia(u[0],u[1],u[2],u[3]),!m))return new ir(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Mr(m||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const m of this.args){u=m.evaluate(s);const b=fn.parse(u);if(b)return b}throw new Mr(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(const m of this.args){u=m.evaluate(s);const b=jr.parse(u);if(b)return b}throw new Mr(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(const m of this.args){u=m.evaluate(s);const b=an.parse(u);if(b)return b}throw new Mr(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const m of this.args){u=m.evaluate(s);const b=Zn.parse(u);if(b)return b}throw new Mr(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const m of this.args){if(u=m.evaluate(s),u===null)return 0;const b=Number(u);if(!isNaN(b))return b}throw new Mr(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return ss.fromString(nr(this.args[0].evaluate(s)));case"resolvedImage":return os.fromString(nr(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return nr(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Xc=["Unknown","Point","LineString","Polygon"];class An{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Xc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let u=this._parseColorCache.get(s);return u||(u=ir.parse(s),this._parseColorCache.set(s,u)),u}}class Ws{constructor(s,u,m=[],b,E=new ie,C=[]){this.registry=s,this.path=m,this.key=m.map(D=>`[${D}]`).join(""),this.scope=E,this.errors=C,this.expectedType=b,this._isConstant=u}parse(s,u,m,b,E={}){return u?this.concat(u,m,b)._parse(s,E):this._parse(s,E)}_parse(s,u){function m(b,E,C){return C==="assert"?new Gi(E,[b]):C==="coerce"?new Dn(E,[b]):b}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=s[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[b];if(E){let C=E.parse(s,this);if(!C)return null;if(this.expectedType){const D=this.expectedType,L=C.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||L.kind!=="value"){if(D.kind==="projectionDefinition"&&["string","array"].includes(L.kind)||["color","formatted","resolvedImage"].includes(D.kind)&&["value","string"].includes(L.kind)||["padding","numberArray"].includes(D.kind)&&["value","number","array"].includes(L.kind)||D.kind==="colorArray"&&["value","string","array"].includes(L.kind)||D.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(L.kind))C=m(C,D,u.typeAnnotation||"coerce");else if(this.checkSubtype(D,L))return null}else C=m(C,D,u.typeAnnotation||"assert")}if(!(C instanceof Ui)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){const D=new An;try{C=new Ui(C.type,C.evaluate(D))}catch(L){return this.error(L.message),null}}return C}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,m){const b=typeof s=="number"?this.path.concat(s):this.path,E=m?this.scope.concat(m):this.scope;return new Ws(this.registry,this._isConstant,b,u||null,E,this.errors)}error(s,...u){const m=`${this.key}${u.map(b=>`[${b}]`).join("")}`;this.errors.push(new A(m,s))}checkSubtype(s,u){const m=Di(s,u);return m&&this.error(m),m}}class sn{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const m=[];for(let E=1;E<s.length-1;E+=2){const C=s[E];if(typeof C!="string")return u.error(`Expected string, but found ${typeof C} instead.`,E);if(/[^a-zA-Z0-9_]/.test(C))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const D=u.parse(s[E+1],E+1);if(!D)return null;m.push([C,D])}const b=u.parse(s[s.length-1],s.length-1,u.expectedType,m);return b?new sn(m,b):null}outputDefined(){return this.result.outputDefined()}}class na{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const m=s[1];return u.scope.has(m)?new na(m,u.scope.get(m)):u.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Yl{constructor(s,u,m){this.type=s,this.index=u,this.input=m}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=u.parse(s[1],1,_t),b=u.parse(s[2],2,Hn(u.expectedType||si));return m&&b?new Yl(b.type.itemType,m,b):null}evaluate(s){const u=this.index.evaluate(s),m=this.input.evaluate(s);if(u<0)throw new Mr(`Array index out of bounds: ${u} < 0.`);if(u>=m.length)throw new Mr(`Array index out of bounds: ${u} > ${m.length-1}.`);if(u!==Math.floor(u))throw new Mr(`Array index must be an integer, but found ${u} instead.`);return m[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class sa{constructor(s,u){this.type=ni,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=u.parse(s[1],1,si),b=u.parse(s[2],2,si);return m&&b?fe(m.type,[ni,ui,_t,ri,si])?new sa(m,b):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Br(m.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!m)return!1;if(!Mi(u,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${Br(Vr(u))} instead.`);if(!Mi(m,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${Br(Vr(m))} instead.`);return m.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class ml{constructor(s,u,m){this.type=_t,this.needle=s,this.haystack=u,this.fromIndex=m}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=u.parse(s[1],1,si),b=u.parse(s[2],2,si);if(!m||!b)return null;if(!fe(m.type,[ni,ui,_t,ri,si]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Br(m.type)} instead`);if(s.length===4){const E=u.parse(s[3],3,_t);return E?new ml(m,b,E):null}return new ml(m,b)}evaluate(s){const u=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!Mi(u,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${Br(Vr(u))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(s)),Mi(m,["string"])){const E=m.indexOf(u,b);return E===-1?-1:[...m.slice(0,E)].length}if(Mi(m,["array"]))return m.indexOf(u,b);throw new Mr(`Expected second argument to be of type array or string, but found ${Br(Vr(m))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class oa{constructor(s,u,m,b,E,C){this.inputType=s,this.type=u,this.input=m,this.cases=b,this.outputs=E,this.otherwise=C}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let m,b;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);const E={},C=[];for(let U=2;U<s.length-1;U+=2){let H=s[U];const q=s[U+1];Array.isArray(H)||(H=[H]);const Q=u.concat(U);if(H.length===0)return Q.error("Expected at least one branch label.");for(const te of H){if(typeof te!="number"&&typeof te!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return Q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return Q.error("Numeric branch labels must be integer values.");if(m){if(Q.checkSubtype(m,Vr(te)))return null}else m=Vr(te);if(E[String(te)]!==void 0)return Q.error("Branch labels must be unique.");E[String(te)]=C.length}const J=u.parse(q,U,b);if(!J)return null;b=b||J.type,C.push(J)}const D=u.parse(s[1],1,si);if(!D)return null;const L=u.parse(s[s.length-1],s.length-1,b);return L?D.type.kind!=="value"&&u.concat(1).checkSubtype(m,D.type)?null:new oa(m,b,D,E,C,L):null}evaluate(s){const u=this.input.evaluate(s);return(Vr(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class dn{constructor(s,u,m){this.type=s,this.branches=u,this.otherwise=m}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);const b=[];for(let C=1;C<s.length-1;C+=2){const D=u.parse(s[C],C,ni);if(!D)return null;const L=u.parse(s[C+1],C+1,m);if(!L)return null;b.push([D,L]),m=m||L.type}const E=u.parse(s[s.length-1],s.length-1,m);if(!E)return null;if(!m)throw new Error("Can't infer output type");return new dn(m,b,E)}evaluate(s){for(const[u,m]of this.branches)if(u.evaluate(s))return m.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,m]of this.branches)s(u),s(m);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class ko{constructor(s,u,m,b){this.type=s,this.input=u,this.beginIndex=m,this.endIndex=b}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=u.parse(s[1],1,si),b=u.parse(s[2],2,_t);if(!m||!b)return null;if(!fe(m.type,[Hn(si),ui,si]))return u.error(`Expected first argument to be of type array or string, but found ${Br(m.type)} instead`);if(s.length===4){const E=u.parse(s[3],3,_t);return E?new ko(m.type,m,b,E):null}return new ko(m.type,m,b)}evaluate(s){const u=this.input.evaluate(s),m=this.beginIndex.evaluate(s);let b;if(this.endIndex&&(b=this.endIndex.evaluate(s)),Mi(u,["string"]))return[...u].slice(m,b).join("");if(Mi(u,["array"]))return u.slice(m,b);throw new Mr(`Expected first argument to be of type array or string, but found ${Br(Vr(u))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Do(h,s){const u=h.length-1;let m,b,E=0,C=u,D=0;for(;E<=C;)if(D=Math.floor((E+C)/2),m=h[D],b=h[D+1],m<=s){if(D===u||s<b)return D;E=D+1}else{if(!(m>s))throw new Mr("Input is not a number.");C=D-1}return 0}class ls{constructor(s,u,m){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[b,E]of m)this.labels.push(b),this.outputs.push(E)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const m=u.parse(s[1],1,_t);if(!m)return null;const b=[];let E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(let C=1;C<s.length;C+=2){const D=C===1?-1/0:s[C],L=s[C+1],U=C,H=C+1;if(typeof D!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(b.length&&b[b.length-1][0]>=D)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const q=u.parse(L,H,E);if(!q)return null;E=E||q.type,b.push([D,q])}return new ls(E,m,b)}evaluate(s){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(s);const b=this.input.evaluate(s);if(b<=u[0])return m[0].evaluate(s);const E=u.length;return b>=u[E-1]?m[E-1].evaluate(s):m[Do(u,b)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function ln(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var _l,aa,Bo=function(){if(aa)return _l;function h(s,u,m,b){this.cx=3*s,this.bx=3*(m-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(b-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=u,this.p2x=m,this.p2y=b}return aa=1,_l=h,h.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,u){if(u===void 0&&(u=1e-6),s<0)return 0;if(s>1)return 1;for(var m=s,b=0;b<8;b++){var E=this.sampleCurveX(m)-s;if(Math.abs(E)<u)return m;var C=this.sampleCurveDerivativeX(m);if(Math.abs(C)<1e-6)break;m-=E/C}var D=0,L=1;for(m=s,b=0;b<20&&(E=this.sampleCurveX(m),!(Math.abs(E-s)<u));b++)s>E?D=m:L=m,m=.5*(L-D)+D;return m},solve:function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))}},_l}(),Oo=ln(Bo);class Cn{constructor(s,u,m,b,E){this.type=s,this.operator=u,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[C,D]of E)this.labels.push(C),this.outputs.push(D)}static interpolationFactor(s,u,m,b){let E=0;if(s.name==="exponential")E=Ha(u,s.base,m,b);else if(s.name==="linear")E=Ha(u,1,m,b);else if(s.name==="cubic-bezier"){const C=s.controlPoints;E=new Oo(C[0],C[1],C[2],C[3]).solve(Ha(u,1,m,b))}return E}static parse(s,u){let[m,b,E,...C]=s;if(!Array.isArray(b)||b.length===0)return u.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const U=b[1];if(typeof U!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:U}}else{if(b[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const U=b.slice(1);if(U.length!==4||U.some(H=>typeof H!="number"||H<0||H>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:U}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,_t),!E)return null;const D=[];let L=null;m!=="interpolate-hcl"&&m!=="interpolate-lab"||u.expectedType==Jo?u.expectedType&&u.expectedType.kind!=="value"&&(L=u.expectedType):L=Ei;for(let U=0;U<C.length;U+=2){const H=C[U],q=C[U+1],Q=U+3,J=U+4;if(typeof H!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(D.length&&D[D.length-1][0]>=H)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Q);const te=u.parse(q,J,L);if(!te)return null;L=L||te.type,D.push([H,te])}return Js(L,_t)||Js(L,Tr)||Js(L,Ei)||Js(L,Ko)||Js(L,nn)||Js(L,Jo)||Js(L,Sr)||Js(L,Hn(_t))?new Cn(L,m,b,E,D):u.error(`Type ${Br(L)} is not interpolatable.`)}evaluate(s){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(s);const b=this.input.evaluate(s);if(b<=u[0])return m[0].evaluate(s);const E=u.length;if(b>=u[E-1])return m[E-1].evaluate(s);const C=Do(u,b),D=Cn.interpolationFactor(this.interpolation,b,u[C],u[C+1]),L=m[C].evaluate(s),U=m[C+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return $n(L,U,D);case"color":return ir.interpolate(L,U,D);case"padding":return fn.interpolate(L,U,D);case"colorArray":return an.interpolate(L,U,D);case"numberArray":return jr.interpolate(L,U,D);case"variableAnchorOffsetCollection":return Zn.interpolate(L,U,D);case"array":return gr(L,U,D);case"projectionDefinition":return as.interpolate(L,U,D)}case"interpolate-hcl":switch(this.type.kind){case"color":return ir.interpolate(L,U,D,"hcl");case"colorArray":return an.interpolate(L,U,D,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ir.interpolate(L,U,D,"lab");case"colorArray":return an.interpolate(L,U,D,"lab")}}}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Ha(h,s,u,m){const b=m-u,E=h-u;return b===0?0:s===1?E/b:(Math.pow(s,E)-1)/(Math.pow(s,b)-1)}const Bs={color:ir.interpolate,number:$n,padding:fn.interpolate,numberArray:jr.interpolate,colorArray:an.interpolate,variableAnchorOffsetCollection:Zn.interpolate,array:gr};class la{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let m=null;const b=u.expectedType;b&&b.kind!=="value"&&(m=b);const E=[];for(const D of s.slice(1)){const L=u.parse(D,1+E.length,m,void 0,{typeAnnotation:"omit"});if(!L)return null;m=m||L.type,E.push(L)}if(!m)throw new Error("No output type");const C=b&&E.some(D=>Di(b,D.type));return new la(C?si:m,E)}evaluate(s){let u,m=null,b=0;for(const E of this.args)if(b++,m=E.evaluate(s),m&&m instanceof os&&!m.available&&(u||(u=m.name),m=null,b===this.args.length&&(m=u)),m!==null)break;return m}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}function yl(h,s){return h==="=="||h==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function bs(h,s,u,m){return m.compare(s,u)===0}function ca(h,s,u){const m=h!=="=="&&h!=="!=";return class Sx{constructor(E,C,D){this.type=ni,this.lhs=E,this.rhs=C,this.collator=D,this.hasUntypedArgument=E.type.kind==="value"||C.type.kind==="value"}static parse(E,C){if(E.length!==3&&E.length!==4)return C.error("Expected two or three arguments.");const D=E[0];let L=C.parse(E[1],1,si);if(!L)return null;if(!yl(D,L.type))return C.concat(1).error(`"${D}" comparisons are not supported for type '${Br(L.type)}'.`);let U=C.parse(E[2],2,si);if(!U)return null;if(!yl(D,U.type))return C.concat(2).error(`"${D}" comparisons are not supported for type '${Br(U.type)}'.`);if(L.type.kind!==U.type.kind&&L.type.kind!=="value"&&U.type.kind!=="value")return C.error(`Cannot compare types '${Br(L.type)}' and '${Br(U.type)}'.`);m&&(L.type.kind==="value"&&U.type.kind!=="value"?L=new Gi(U.type,[L]):L.type.kind!=="value"&&U.type.kind==="value"&&(U=new Gi(L.type,[U])));let H=null;if(E.length===4){if(L.type.kind!=="string"&&U.type.kind!=="string"&&L.type.kind!=="value"&&U.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(H=C.parse(E[3],3,En),!H)return null}return new Sx(L,U,H)}evaluate(E){const C=this.lhs.evaluate(E),D=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){const L=Vr(C),U=Vr(D);if(L.kind!==U.kind||L.kind!=="string"&&L.kind!=="number")throw new Mr(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${L.kind}, ${U.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const L=Vr(C),U=Vr(D);if(L.kind!=="string"||U.kind!=="string")return s(E,C,D)}return this.collator?u(E,C,D,this.collator.evaluate(E)):s(E,C,D)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const Ql=ca("==",function(h,s,u){return s===u},bs),Tf=ca("!=",function(h,s,u){return s!==u},function(h,s,u,m){return!bs(0,s,u,m)}),Gc=ca("<",function(h,s,u){return s<u},function(h,s,u,m){return m.compare(s,u)<0}),Sf=ca(">",function(h,s,u){return s>u},function(h,s,u,m){return m.compare(s,u)>0}),Ef=ca("<=",function(h,s,u){return s<=u},function(h,s,u,m){return m.compare(s,u)<=0}),Cf=ca(">=",function(h,s,u){return s>=u},function(h,s,u,m){return m.compare(s,u)>=0});class Kl{constructor(s,u,m){this.type=En,this.locale=m,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const m=s[1];if(typeof m!="object"||Array.isArray(m))return u.error("Collator options argument must be an object.");const b=u.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,ni);if(!b)return null;const E=u.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,ni);if(!E)return null;let C=null;return m.locale&&(C=u.parse(m.locale,1,ui),!C)?null:new Kl(b,E,C)}evaluate(s){return new ja(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class co{constructor(s,u,m,b,E){this.type=ui,this.number=s,this.locale=u,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=E}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const m=u.parse(s[1],1,_t);if(!m)return null;const b=s[2];if(typeof b!="object"||Array.isArray(b))return u.error("NumberFormat options argument must be an object.");let E=null;if(b.locale&&(E=u.parse(b.locale,1,ui),!E))return null;let C=null;if(b.currency&&(C=u.parse(b.currency,1,ui),!C))return null;let D=null;if(b["min-fraction-digits"]&&(D=u.parse(b["min-fraction-digits"],1,_t),!D))return null;let L=null;return b["max-fraction-digits"]&&(L=u.parse(b["max-fraction-digits"],1,_t),!L)?null:new co(m,E,C,D,L)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Jl{constructor(s){this.type=Mo,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const m=s[1];if(!Array.isArray(m)&&typeof m=="object")return u.error("First argument must be an image or text section.");const b=[];let E=!1;for(let C=1;C<=s.length-1;++C){const D=s[C];if(E&&typeof D=="object"&&!Array.isArray(D)){E=!1;let L=null;if(D["font-scale"]&&(L=u.parse(D["font-scale"],1,_t),!L))return null;let U=null;if(D["text-font"]&&(U=u.parse(D["text-font"],1,Hn(ui)),!U))return null;let H=null;if(D["text-color"]&&(H=u.parse(D["text-color"],1,Ei),!H))return null;let q=null;if(D["vertical-align"]){if(typeof D["vertical-align"]=="string"&&!gl.includes(D["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${D["vertical-align"]}' instead.`);if(q=u.parse(D["vertical-align"],1,ui),!q)return null}const Q=b[b.length-1];Q.scale=L,Q.font=U,Q.textColor=H,Q.verticalAlign=q}else{const L=u.parse(s[C],1,si);if(!L)return null;const U=L.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,b.push({content:L,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Jl(b)}evaluate(s){return new ss(this.sections.map(u=>{const m=u.content.evaluate(s);return Vr(m)===Ds?new Va("",m,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(s):null):new Va(nr(m),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null,u.verticalAlign?u.verticalAlign.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor),u.verticalAlign&&s(u.verticalAlign)}outputDefined(){return!1}}class ec{constructor(s){this.type=Ds,this.input=s}static parse(s,u){if(s.length!==2)return u.error("Expected two arguments.");const m=u.parse(s[1],1,ui);return m?new ec(m):u.error("No image name provided.")}evaluate(s){const u=this.input.evaluate(s),m=os.fromString(u);return m&&s.availableImages&&(m.available=s.availableImages.indexOf(u)>-1),m}eachChild(s){s(this.input)}outputDefined(){return!1}}class tc{constructor(s){this.type=_t,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=u.parse(s[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Br(m.type)} instead.`):new tc(m):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new Mr(`Expected value to be of type string or array, but found ${Br(Vr(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const cs=8192;function th(h,s){const u=(180+h[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,b=Math.pow(2,s.z);return[Math.round(u*b*cs),Math.round(m*b*cs)]}function bl(h,s){const u=Math.pow(2,s.z);return[(b=(h[0]/cs+s.x)/u,360*b-180),(m=(h[1]/cs+s.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,b}function $a(h,s){h[0]=Math.min(h[0],s[0]),h[1]=Math.min(h[1],s[1]),h[2]=Math.max(h[2],s[0]),h[3]=Math.max(h[3],s[1])}function eo(h,s){return!(h[0]<=s[0]||h[2]>=s[2]||h[1]<=s[1]||h[3]>=s[3])}function If(h,s,u){const m=h[0]-s[0],b=h[1]-s[1],E=h[0]-u[0],C=h[1]-u[1];return m*C-E*b==0&&m*E<=0&&b*C<=0}function Za(h,s,u,m){return(b=[m[0]-u[0],m[1]-u[1]])[0]*(E=[s[0]-h[0],s[1]-h[1]])[1]-b[1]*E[0]!=0&&!(!rc(h,s,u,m)||!rc(u,m,h,s));var b,E}function Yc(h,s,u){for(const m of u)for(let b=0;b<m.length-1;++b)if(Za(h,s,m[b],m[b+1]))return!0;return!1}function ua(h,s,u=!1){let m=!1;for(const D of s)for(let L=0;L<D.length-1;L++){if(If(h,D[L],D[L+1]))return u;(E=D[L])[1]>(b=h)[1]!=(C=D[L+1])[1]>b[1]&&b[0]<(C[0]-E[0])*(b[1]-E[1])/(C[1]-E[1])+E[0]&&(m=!m)}var b,E,C;return m}function Qc(h,s){for(const u of s)if(ua(h,u))return!0;return!1}function ic(h,s){for(const u of h)if(!ua(u,s))return!1;for(let u=0;u<h.length-1;++u)if(Yc(h[u],h[u+1],s))return!1;return!0}function Kc(h,s){for(const u of s)if(ic(h,u))return!0;return!1}function rc(h,s,u,m){const b=m[0]-u[0],E=m[1]-u[1],C=(h[0]-u[0])*E-b*(h[1]-u[1]),D=(s[0]-u[0])*E-b*(s[1]-u[1]);return C>0&&D<0||C<0&&D>0}function uo(h,s,u){const m=[];for(let b=0;b<h.length;b++){const E=[];for(let C=0;C<h[b].length;C++){const D=th(h[b][C],u);$a(s,D),E.push(D)}m.push(E)}return m}function Ir(h,s,u){const m=[];for(let b=0;b<h.length;b++){const E=uo(h[b],s,u);m.push(E)}return m}function ih(h,s,u,m){if(h[0]<u[0]||h[0]>u[2]){const b=.5*m;let E=h[0]-u[0]>b?-m:u[0]-h[0]>b?m:0;E===0&&(E=h[0]-u[2]>b?-m:u[2]-h[0]>b?m:0),h[0]+=E}$a(s,h)}function Jc(h,s,u,m){const b=Math.pow(2,m.z)*cs,E=[m.x*cs,m.y*cs],C=[];for(const D of h)for(const L of D){const U=[L.x+E[0],L.y+E[1]];ih(U,s,u,b),C.push(U)}return C}function nc(h,s,u,m){const b=Math.pow(2,m.z)*cs,E=[m.x*cs,m.y*cs],C=[];for(const L of h){const U=[];for(const H of L){const q=[H.x+E[0],H.y+E[1]];$a(s,q),U.push(q)}C.push(U)}if(s[2]-s[0]<=b/2){(D=s)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const L of C)for(const U of L)ih(U,s,u,b)}var D;return C}class Lo{constructor(s,u){this.type=ni,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(mr(s[1])){const m=s[1];if(m.type==="FeatureCollection"){const b=[];for(const E of m.features){const{type:C,coordinates:D}=E.geometry;C==="Polygon"&&b.push(D),C==="MultiPolygon"&&b.push(...D)}if(b.length)return new Lo(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Lo(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Lo(m,m)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,m){const b=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],C=u.canonicalID();if(m.type==="Polygon"){const D=uo(m.coordinates,E,C),L=Jc(u.geometry(),b,E,C);if(!eo(b,E))return!1;for(const U of L)if(!ua(U,D))return!1}if(m.type==="MultiPolygon"){const D=Ir(m.coordinates,E,C),L=Jc(u.geometry(),b,E,C);if(!eo(b,E))return!1;for(const U of L)if(!Qc(U,D))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,m){const b=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],C=u.canonicalID();if(m.type==="Polygon"){const D=uo(m.coordinates,E,C),L=nc(u.geometry(),b,E,C);if(!eo(b,E))return!1;for(const U of L)if(!ic(U,D))return!1}if(m.type==="MultiPolygon"){const D=Ir(m.coordinates,E,C),L=nc(u.geometry(),b,E,C);if(!eo(b,E))return!1;for(const U of L)if(!Kc(U,D))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rh=class{constructor(h=[],s=(u,m)=>u<m?-1:u>m?1:0){if(this.data=h,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:s,compare:u}=this,m=s[h];for(;h>0;){const b=h-1>>1,E=s[b];if(u(m,E)>=0)break;s[h]=E,h=b}s[h]=m}_down(h){const{data:s,compare:u}=this,m=this.length>>1,b=s[h];for(;h<m;){let E=1+(h<<1);const C=E+1;if(C<this.length&&u(s[C],s[E])<0&&(E=C),u(s[E],b)>=0)break;s[h]=s[E],h=E}s[h]=b}};function nh(h,s,u=0,m=h.length-1,b=qn){for(;m>u;){if(m-u>600){const L=m-u+1,U=s-u+1,H=Math.log(L),q=.5*Math.exp(2*H/3),Q=.5*Math.sqrt(H*q*(L-q)/L)*(U-L/2<0?-1:1);nh(h,s,Math.max(u,Math.floor(s-U*q/L+Q)),Math.min(m,Math.floor(s+(L-U)*q/L+Q)),b)}const E=h[s];let C=u,D=m;for(qa(h,u,s),b(h[m],E)>0&&qa(h,u,m);C<D;){for(qa(h,C,D),C++,D--;b(h[C],E)<0;)C++;for(;b(h[D],E)>0;)D--}b(h[u],E)===0?qa(h,u,D):(D++,qa(h,D,m)),D<=s&&(u=D+1),s<=D&&(m=D-1)}}function qa(h,s,u){const m=h[s];h[s]=h[u],h[u]=m}function qn(h,s){return h<s?-1:h>s?1:0}function Xa(h,s){if(h.length<=1)return[h];const u=[];let m,b;for(const E of h){const C=Pf(E);C!==0&&(E.area=Math.abs(C),b===void 0&&(b=C<0),b===C<0?(m&&u.push(m),m=[E]):m.push(E))}if(m&&u.push(m),s>1)for(let E=0;E<u.length;E++)u[E].length<=s||(nh(u[E],s,1,u[E].length-1,ha),u[E]=u[E].slice(0,s));return u}function ha(h,s){return s.area-h.area}function Pf(h){let s=0;for(let u,m,b=0,E=h.length,C=E-1;b<E;C=b++)u=h[b],m=h[C],s+=(m.x-u.x)*(u.y+m.y);return s}const vl=1/298.257223563,sh=vl*(2-vl),vs=Math.PI/180;class xl{constructor(s){const u=6378.137*vs*1e3,m=Math.cos(s*vs),b=1/(1-sh*(1-m*m)),E=Math.sqrt(b);this.kx=u*E*m,this.ky=u*E*b*(1-sh)}distance(s,u){const m=this.wrap(s[0]-u[0])*this.kx,b=(s[1]-u[1])*this.ky;return Math.sqrt(m*m+b*b)}pointOnLine(s,u){let m,b,E,C,D=1/0;for(let L=0;L<s.length-1;L++){let U=s[L][0],H=s[L][1],q=this.wrap(s[L+1][0]-U)*this.kx,Q=(s[L+1][1]-H)*this.ky,J=0;q===0&&Q===0||(J=(this.wrap(u[0]-U)*this.kx*q+(u[1]-H)*this.ky*Q)/(q*q+Q*Q),J>1?(U=s[L+1][0],H=s[L+1][1]):J>0&&(U+=q/this.kx*J,H+=Q/this.ky*J)),q=this.wrap(u[0]-U)*this.kx,Q=(u[1]-H)*this.ky;const te=q*q+Q*Q;te<D&&(D=te,m=U,b=H,E=L,C=J)}return{point:[m,b],index:E,t:Math.max(0,Math.min(1,C))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function sc(h,s){return s[0]-h[0]}function rr(h){return h[1]-h[0]+1}function Xn(h,s){return h[1]>=h[0]&&h[1]<s}function Fo(h,s){if(h[0]>h[1])return[null,null];const u=rr(h);if(s){if(u===2)return[h,null];const b=Math.floor(u/2);return[[h[0],h[0]+b],[h[0]+b,h[1]]]}if(u===1)return[h,null];const m=Math.floor(u/2)-1;return[[h[0],h[0]+m],[h[0]+m+1,h[1]]]}function eu(h,s){if(!Xn(s,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let m=s[0];m<=s[1];++m)$a(u,h[m]);return u}function oc(h){const s=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const m of u)$a(s,m);return s}function oh(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function wl(h,s,u){if(!oh(h)||!oh(s))return NaN;let m=0,b=0;return h[2]<s[0]&&(m=s[0]-h[2]),h[0]>s[2]&&(m=h[0]-s[2]),h[1]>s[3]&&(b=h[1]-s[3]),h[3]<s[1]&&(b=s[1]-h[3]),u.distance([0,0],[m,b])}function fa(h,s,u){const m=u.pointOnLine(s,h);return u.distance(h,m.point)}function tu(h,s,u,m,b){const E=Math.min(fa(h,[u,m],b),fa(s,[u,m],b)),C=Math.min(fa(u,[h,s],b),fa(m,[h,s],b));return Math.min(E,C)}function iu(h,s,u,m,b){if(!Xn(s,h.length)||!Xn(m,u.length))return 1/0;let E=1/0;for(let C=s[0];C<s[1];++C){const D=h[C],L=h[C+1];for(let U=m[0];U<m[1];++U){const H=u[U],q=u[U+1];if(Za(D,L,H,q))return 0;E=Math.min(E,tu(D,L,H,q,b))}}return E}function ah(h,s,u,m,b){if(!Xn(s,h.length)||!Xn(m,u.length))return NaN;let E=1/0;for(let C=s[0];C<=s[1];++C)for(let D=m[0];D<=m[1];++D)if(E=Math.min(E,b.distance(h[C],u[D])),E===0)return E;return E}function ru(h,s,u){if(ua(h,s,!0))return 0;let m=1/0;for(const b of s){const E=b[0],C=b[b.length-1];if(E!==C&&(m=Math.min(m,fa(h,[C,E],u)),m===0))return m;const D=u.pointOnLine(b,h);if(m=Math.min(m,u.distance(h,D.point)),m===0)return m}return m}function Tl(h,s,u,m){if(!Xn(s,h.length))return NaN;for(let E=s[0];E<=s[1];++E)if(ua(h[E],u,!0))return 0;let b=1/0;for(let E=s[0];E<s[1];++E){const C=h[E],D=h[E+1];for(const L of u)for(let U=0,H=L.length,q=H-1;U<H;q=U++){const Q=L[q],J=L[U];if(Za(C,D,Q,J))return 0;b=Math.min(b,tu(C,D,Q,J,m))}}return b}function Aa(h,s){for(const u of h)for(const m of u)if(ua(m,s,!0))return!0;return!1}function xs(h,s,u,m=1/0){const b=oc(h),E=oc(s);if(m!==1/0&&wl(b,E,u)>=m)return m;if(eo(b,E)){if(Aa(h,s))return 0}else if(Aa(s,h))return 0;let C=1/0;for(const D of h)for(let L=0,U=D.length,H=U-1;L<U;H=L++){const q=D[H],Q=D[L];for(const J of s)for(let te=0,oe=J.length,pe=oe-1;te<oe;pe=te++){const Se=J[pe],He=J[te];if(Za(q,Q,Se,He))return 0;C=Math.min(C,tu(q,Q,Se,He,u))}}return C}function lh(h,s,u,m,b,E){if(!E)return;const C=wl(eu(m,E),b,u);C<s&&h.push([C,E,[0,0]])}function No(h,s,u,m,b,E,C){if(!E||!C)return;const D=wl(eu(m,E),eu(b,C),u);D<s&&h.push([D,E,C])}function ac(h,s,u,m,b=1/0){let E=Math.min(m.distance(h[0],u[0][0]),b);if(E===0)return E;const C=new rh([[0,[0,h.length-1],[0,0]]],sc),D=oc(u);for(;C.length>0;){const L=C.pop();if(L[0]>=E)continue;const U=L[1],H=s?50:100;if(rr(U)<=H){if(!Xn(U,h.length))return NaN;if(s){const q=Tl(h,U,u,m);if(isNaN(q)||q===0)return q;E=Math.min(E,q)}else for(let q=U[0];q<=U[1];++q){const Q=ru(h[q],u,m);if(E=Math.min(E,Q),E===0)return 0}}else{const q=Fo(U,s);lh(C,E,m,h,D,q[0]),lh(C,E,m,h,D,q[1])}}return E}function lc(h,s,u,m,b,E=1/0){let C=Math.min(E,b.distance(h[0],u[0]));if(C===0)return C;const D=new rh([[0,[0,h.length-1],[0,u.length-1]]],sc);for(;D.length>0;){const L=D.pop();if(L[0]>=C)continue;const U=L[1],H=L[2],q=s?50:100,Q=m?50:100;if(rr(U)<=q&&rr(H)<=Q){if(!Xn(U,h.length)&&Xn(H,u.length))return NaN;let J;if(s&&m)J=iu(h,U,u,H,b),C=Math.min(C,J);else if(s&&!m){const te=h.slice(U[0],U[1]+1);for(let oe=H[0];oe<=H[1];++oe)if(J=fa(u[oe],te,b),C=Math.min(C,J),C===0)return C}else if(!s&&m){const te=u.slice(H[0],H[1]+1);for(let oe=U[0];oe<=U[1];++oe)if(J=fa(h[oe],te,b),C=Math.min(C,J),C===0)return C}else J=ah(h,U,u,H,b),C=Math.min(C,J)}else{const J=Fo(U,s),te=Fo(H,m);No(D,C,b,h,u,J[0],te[0]),No(D,C,b,h,u,J[0],te[1]),No(D,C,b,h,u,J[1],te[0]),No(D,C,b,h,u,J[1],te[1])}}return C}function nu(h){return h.type==="MultiPolygon"?h.coordinates.map(s=>({type:"Polygon",coordinates:s})):h.type==="MultiLineString"?h.coordinates.map(s=>({type:"LineString",coordinates:s})):h.type==="MultiPoint"?h.coordinates.map(s=>({type:"Point",coordinates:s})):[h]}class zo{constructor(s,u){this.type=_t,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(mr(s[1])){const m=s[1];if(m.type==="FeatureCollection")return new zo(m,m.features.map(b=>nu(b.geometry)).flat());if(m.type==="Feature")return new zo(m,nu(m.geometry));if("type"in m&&"coordinates"in m)return new zo(m,nu(m))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,m){const b=u.geometry(),E=b.flat().map(L=>bl([L.x,L.y],u.canonical));if(b.length===0)return NaN;const C=new xl(E[0][1]);let D=1/0;for(const L of m){switch(L.type){case"Point":D=Math.min(D,lc(E,!1,[L.coordinates],!1,C,D));break;case"LineString":D=Math.min(D,lc(E,!1,L.coordinates,!0,C,D));break;case"Polygon":D=Math.min(D,ac(E,!1,L.coordinates,C,D))}if(D===0)return D}return D}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,m){const b=u.geometry(),E=b.flat().map(L=>bl([L.x,L.y],u.canonical));if(b.length===0)return NaN;const C=new xl(E[0][1]);let D=1/0;for(const L of m){switch(L.type){case"Point":D=Math.min(D,lc(E,!0,[L.coordinates],!1,C,D));break;case"LineString":D=Math.min(D,lc(E,!0,L.coordinates,!0,C,D));break;case"Polygon":D=Math.min(D,ac(E,!0,L.coordinates,C,D))}if(D===0)return D}return D}(s,this.geometries);if(s.geometryType()==="Polygon")return function(u,m){const b=u.geometry();if(b.length===0||b[0].length===0)return NaN;const E=Xa(b,0).map(L=>L.map(U=>U.map(H=>bl([H.x,H.y],u.canonical)))),C=new xl(E[0][0][0][1]);let D=1/0;for(const L of m)for(const U of E){switch(L.type){case"Point":D=Math.min(D,ac([L.coordinates],!1,U,C,D));break;case"LineString":D=Math.min(D,ac(L.coordinates,!0,U,C,D));break;case"Polygon":D=Math.min(D,xs(U,L.coordinates,C,D))}if(D===0)return D}return D}(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class cc{constructor(s){this.type=si,this.key=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=s[1];return m==null?u.error("Global state property must be defined."):typeof m!="string"?u.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new cc(m)}evaluate(s){var u;const m=(u=s.globals)===null||u===void 0?void 0:u.globalState;return m&&Object.keys(m).length!==0?ta(m,this.key):null}eachChild(){}outputDefined(){return!1}}const Ga={"==":Ql,"!=":Tf,">":Sf,"<":Gc,">=":Cf,"<=":Ef,array:Gi,at:Yl,boolean:Gi,case:dn,coalesce:la,collator:Kl,format:Jl,image:ec,in:sa,"index-of":ml,interpolate:Cn,"interpolate-hcl":Cn,"interpolate-lab":Cn,length:tc,let:sn,literal:Ui,match:oa,number:Gi,"number-format":co,object:Gi,slice:ko,step:ls,string:Gi,"to-boolean":Dn,"to-color":Dn,"to-number":Dn,"to-string":Dn,var:na,within:Lo,distance:zo,"global-state":cc};class Os{constructor(s,u,m,b){this.name=s,this.type=u,this._evaluate=m,this.args=b}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,u){const m=s[0],b=Os.definitions[m];if(!b)return u.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(b)?b[0]:b.type,C=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,D=C.filter(([U])=>!Array.isArray(U)||U.length===s.length-1);let L=null;for(const[U,H]of D){L=new Ws(u.registry,hc,u.path,null,u.scope);const q=[];let Q=!1;for(let J=1;J<s.length;J++){const te=s[J],oe=Array.isArray(U)?U[J-1]:U.type,pe=L.parse(te,1+q.length,oe);if(!pe){Q=!0;break}q.push(pe)}if(!Q)if(Array.isArray(U)&&U.length!==q.length)L.error(`Expected ${U.length} arguments, but found ${q.length} instead.`);else{for(let J=0;J<q.length;J++){const te=Array.isArray(U)?U[J]:U.type,oe=q[J];L.concat(J+1).checkSubtype(te,oe.type)}if(L.errors.length===0)return new Os(m,E,H,q)}}if(D.length===1)u.errors.push(...L.errors);else{const U=(D.length?D:C).map(([q])=>{return Q=q,Array.isArray(Q)?`(${Q.map(Br).join(", ")})`:`(${Br(Q.type)}...)`;var Q}).join(" | "),H=[];for(let q=1;q<s.length;q++){const Q=u.parse(s[q],1+H.length);if(!Q)return null;H.push(Br(Q.type))}u.error(`Expected arguments of type ${U}, but found (${H.join(", ")}) instead.`)}return null}static register(s,u){Os.definitions=u;for(const m in u)s[m]=Os}}function uc(h,[s,u,m,b]){s=s.evaluate(h),u=u.evaluate(h),m=m.evaluate(h);const E=b?b.evaluate(h):1,C=ia(s,u,m,E);if(C)throw new Mr(C);return new ir(s/255,u/255,m/255,E,!1)}function su(h,s){return h in s}function Sl(h,s){const u=s[h];return u===void 0?null:u}function da(h){return{type:h}}function hc(h){if(h instanceof na)return hc(h.boundExpression);if(h instanceof Os&&h.name==="error"||h instanceof Kl||h instanceof Lo||h instanceof zo||h instanceof cc)return!1;const s=h instanceof Dn||h instanceof Gi;let u=!0;return h.eachChild(m=>{u=s?u&&hc(m):u&&m instanceof Ui}),!!u&&fc(h)&&Ac(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fc(h){if(h instanceof Os&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Lo||h instanceof zo)return!1;let s=!0;return h.eachChild(u=>{s&&!fc(u)&&(s=!1)}),s}function El(h){if(h instanceof Os&&h.name==="feature-state")return!1;let s=!0;return h.eachChild(u=>{s&&!El(u)&&(s=!1)}),s}function Ac(h,s){if(h instanceof Os&&s.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild(m=>{u&&!Ac(m,s)&&(u=!1)}),u}function dc(h){return{result:"success",value:h}}function Ya(h){return{result:"error",value:h}}function pa(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function ch(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Cl(h){return!!h.expression&&h.expression.interpolated}function ji(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Il(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&Vr(h)===Xi}function pc(h){return h}function ou(h,s){const u=h.stops&&typeof h.stops[0][0]=="object",m=u||!(u||h.property!==void 0),b=h.type||(Cl(s)?"exponential":"interval"),E=function(H){switch(H.type){case"color":return ir.parse;case"padding":return fn.parse;case"numberArray":return jr.parse;case"colorArray":return an.parse;default:return null}}(s);if(E&&((h=Tt({},h)).stops&&(h.stops=h.stops.map(H=>[H[0],E(H[1])])),h.default=E(h.default?h.default:s.default)),h.colorSpace&&(C=h.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var C;const D=function(H){switch(H){case"exponential":return ho;case"interval":return Rf;case"categorical":return Mf;case"identity":return au;default:throw new Error(`Unknown function type "${H}"`)}}(b);let L,U;if(b==="categorical"){L=Object.create(null);for(const H of h.stops)L[H[0]]=H[1];U=typeof h.stops[0][0]}if(u){const H={},q=[];for(let te=0;te<h.stops.length;te++){const oe=h.stops[te],pe=oe[0].zoom;H[pe]===void 0&&(H[pe]={zoom:pe,type:h.type,property:h.property,default:h.default,stops:[]},q.push(pe)),H[pe].stops.push([oe[0].value,oe[1]])}const Q=[];for(const te of q)Q.push([H[te].zoom,ou(H[te],s)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:Cn.interpolationFactor.bind(void 0,J),zoomStops:Q.map(te=>te[0]),evaluate:({zoom:te},oe)=>ho({stops:Q,base:h.base},s,te).evaluate(te,oe)}}if(m){const H=b==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:Cn.interpolationFactor.bind(void 0,H),zoomStops:h.stops.map(q=>q[0]),evaluate:({zoom:q})=>D(h,s,q,L,U)}}return{kind:"source",evaluate(H,q){const Q=q&&q.properties?q.properties[h.property]:void 0;return Q===void 0?Pl(h.default,s.default):D(h,s,Q,L,U)}}}function Pl(h,s,u){return h!==void 0?h:s!==void 0?s:u!==void 0?u:void 0}function Mf(h,s,u,m,b){return Pl(typeof u===b?m[u]:void 0,h.default,s.default)}function Rf(h,s,u){if(ji(u)!=="number")return Pl(h.default,s.default);const m=h.stops.length;if(m===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[m-1][0])return h.stops[m-1][1];const b=Do(h.stops.map(E=>E[0]),u);return h.stops[b][1]}function ho(h,s,u){const m=h.base!==void 0?h.base:1;if(ji(u)!=="number")return Pl(h.default,s.default);const b=h.stops.length;if(b===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[b-1][0])return h.stops[b-1][1];const E=Do(h.stops.map(H=>H[0]),u),C=function(H,q,Q,J){const te=J-Q,oe=H-Q;return te===0?0:q===1?oe/te:(Math.pow(q,oe)-1)/(Math.pow(q,te)-1)}(u,m,h.stops[E][0],h.stops[E+1][0]),D=h.stops[E][1],L=h.stops[E+1][1],U=Bs[s.type]||pc;return typeof D.evaluate=="function"?{evaluate(...H){const q=D.evaluate.apply(void 0,H),Q=L.evaluate.apply(void 0,H);if(q!==void 0&&Q!==void 0)return U(q,Q,C,h.colorSpace)}}:U(D,L,C,h.colorSpace)}function au(h,s,u){switch(s.type){case"color":u=ir.parse(u);break;case"formatted":u=ss.fromString(u.toString());break;case"resolvedImage":u=os.fromString(u.toString());break;case"padding":u=fn.parse(u);break;case"colorArray":u=an.parse(u);break;case"numberArray":u=jr.parse(u);break;default:ji(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0)}return Pl(u,h.default,s.default)}Os.register(Ga,{error:[{kind:"error"},[ui],(h,[s])=>{throw new Mr(s.evaluate(h))}],typeof:[ui,[si],(h,[s])=>Br(Vr(s.evaluate(h)))],"to-rgba":[Hn(_t,4),[Ei],(h,[s])=>{const[u,m,b,E]=s.evaluate(h).rgb;return[255*u,255*m,255*b,E]}],rgb:[Ei,[_t,_t,_t],uc],rgba:[Ei,[_t,_t,_t,_t],uc],has:{type:ni,overloads:[[[ui],(h,[s])=>su(s.evaluate(h),h.properties())],[[ui,Xi],(h,[s,u])=>su(s.evaluate(h),u.evaluate(h))]]},get:{type:si,overloads:[[[ui],(h,[s])=>Sl(s.evaluate(h),h.properties())],[[ui,Xi],(h,[s,u])=>Sl(s.evaluate(h),u.evaluate(h))]]},"feature-state":[si,[ui],(h,[s])=>Sl(s.evaluate(h),h.featureState||{})],properties:[Xi,[],h=>h.properties()],"geometry-type":[ui,[],h=>h.geometryType()],id:[si,[],h=>h.id()],zoom:[_t,[],h=>h.globals.zoom],"heatmap-density":[_t,[],h=>h.globals.heatmapDensity||0],"line-progress":[_t,[],h=>h.globals.lineProgress||0],accumulated:[si,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[_t,da(_t),(h,s)=>{let u=0;for(const m of s)u+=m.evaluate(h);return u}],"*":[_t,da(_t),(h,s)=>{let u=1;for(const m of s)u*=m.evaluate(h);return u}],"-":{type:_t,overloads:[[[_t,_t],(h,[s,u])=>s.evaluate(h)-u.evaluate(h)],[[_t],(h,[s])=>-s.evaluate(h)]]},"/":[_t,[_t,_t],(h,[s,u])=>s.evaluate(h)/u.evaluate(h)],"%":[_t,[_t,_t],(h,[s,u])=>s.evaluate(h)%u.evaluate(h)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(h,[s,u])=>Math.pow(s.evaluate(h),u.evaluate(h))],sqrt:[_t,[_t],(h,[s])=>Math.sqrt(s.evaluate(h))],log10:[_t,[_t],(h,[s])=>Math.log(s.evaluate(h))/Math.LN10],ln:[_t,[_t],(h,[s])=>Math.log(s.evaluate(h))],log2:[_t,[_t],(h,[s])=>Math.log(s.evaluate(h))/Math.LN2],sin:[_t,[_t],(h,[s])=>Math.sin(s.evaluate(h))],cos:[_t,[_t],(h,[s])=>Math.cos(s.evaluate(h))],tan:[_t,[_t],(h,[s])=>Math.tan(s.evaluate(h))],asin:[_t,[_t],(h,[s])=>Math.asin(s.evaluate(h))],acos:[_t,[_t],(h,[s])=>Math.acos(s.evaluate(h))],atan:[_t,[_t],(h,[s])=>Math.atan(s.evaluate(h))],min:[_t,da(_t),(h,s)=>Math.min(...s.map(u=>u.evaluate(h)))],max:[_t,da(_t),(h,s)=>Math.max(...s.map(u=>u.evaluate(h)))],abs:[_t,[_t],(h,[s])=>Math.abs(s.evaluate(h))],round:[_t,[_t],(h,[s])=>{const u=s.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[_t,[_t],(h,[s])=>Math.floor(s.evaluate(h))],ceil:[_t,[_t],(h,[s])=>Math.ceil(s.evaluate(h))],"filter-==":[ni,[ui,si],(h,[s,u])=>h.properties()[s.value]===u.value],"filter-id-==":[ni,[si],(h,[s])=>h.id()===s.value],"filter-type-==":[ni,[ui],(h,[s])=>h.geometryType()===s.value],"filter-<":[ni,[ui,si],(h,[s,u])=>{const m=h.properties()[s.value],b=u.value;return typeof m==typeof b&&m<b}],"filter-id-<":[ni,[si],(h,[s])=>{const u=h.id(),m=s.value;return typeof u==typeof m&&u<m}],"filter->":[ni,[ui,si],(h,[s,u])=>{const m=h.properties()[s.value],b=u.value;return typeof m==typeof b&&m>b}],"filter-id->":[ni,[si],(h,[s])=>{const u=h.id(),m=s.value;return typeof u==typeof m&&u>m}],"filter-<=":[ni,[ui,si],(h,[s,u])=>{const m=h.properties()[s.value],b=u.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[ni,[si],(h,[s])=>{const u=h.id(),m=s.value;return typeof u==typeof m&&u<=m}],"filter->=":[ni,[ui,si],(h,[s,u])=>{const m=h.properties()[s.value],b=u.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[ni,[si],(h,[s])=>{const u=h.id(),m=s.value;return typeof u==typeof m&&u>=m}],"filter-has":[ni,[si],(h,[s])=>s.value in h.properties()],"filter-has-id":[ni,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[ni,[Hn(ui)],(h,[s])=>s.value.indexOf(h.geometryType())>=0],"filter-id-in":[ni,[Hn(si)],(h,[s])=>s.value.indexOf(h.id())>=0],"filter-in-small":[ni,[ui,Hn(si)],(h,[s,u])=>u.value.indexOf(h.properties()[s.value])>=0],"filter-in-large":[ni,[ui,Hn(si)],(h,[s,u])=>function(m,b,E,C){for(;E<=C;){const D=E+C>>1;if(b[D]===m)return!0;b[D]>m?C=D-1:E=D+1}return!1}(h.properties()[s.value],u.value,0,u.value.length-1)],all:{type:ni,overloads:[[[ni,ni],(h,[s,u])=>s.evaluate(h)&&u.evaluate(h)],[da(ni),(h,s)=>{for(const u of s)if(!u.evaluate(h))return!1;return!0}]]},any:{type:ni,overloads:[[[ni,ni],(h,[s,u])=>s.evaluate(h)||u.evaluate(h)],[da(ni),(h,s)=>{for(const u of s)if(u.evaluate(h))return!0;return!1}]]},"!":[ni,[ni],(h,[s])=>!s.evaluate(h)],"is-supported-script":[ni,[ui],(h,[s])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(s.evaluate(h))}],upcase:[ui,[ui],(h,[s])=>s.evaluate(h).toUpperCase()],downcase:[ui,[ui],(h,[s])=>s.evaluate(h).toLowerCase()],concat:[ui,da(si),(h,s)=>s.map(u=>nr(u.evaluate(h))).join("")],"resolved-locale":[ui,[En],(h,[s])=>s.evaluate(h).resolvedLocale()]});class gc{constructor(s,u){this.expression=s,this._warningHistory={},this._evaluator=new An,this._defaultValue=u?function(m){if(m.type==="color"&&Il(m.default))return new ir(0,0,0,0);switch(m.type){case"color":return ir.parse(m.default)||null;case"padding":return fn.parse(m.default)||null;case"numberArray":return jr.parse(m.default)||null;case"colorArray":return an.parse(m.default)||null;case"variableAnchorOffsetCollection":return Zn.parse(m.default)||null;case"projectionDefinition":return as.parse(m.default)||null;default:return m.default===void 0?null:m.default}}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(s,u,m,b,E,C){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(s,u,m,b,E,C){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=C||null;try{const D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Mr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function Uo(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Ga}function Ml(h,s){const u=new Ws(Ga,hc,[],s?function(b){const E={color:Ei,string:ui,number:_t,enum:ui,boolean:ni,formatted:Mo,padding:Ko,numberArray:nn,colorArray:Jo,projectionDefinition:Tr,resolvedImage:Ds,variableAnchorOffsetCollection:Sr};return b.type==="array"?Hn(E[b.value]||si,b.length):E[b.type]}(s):void 0),m=u.parse(h,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?dc(new gc(m,s)):Ya(u.errors)}class lu{constructor(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!El(u.expression)}evaluateWithoutErrorHandling(s,u,m,b,E,C){return this._styleExpression.evaluateWithoutErrorHandling(s,u,m,b,E,C)}evaluate(s,u,m,b,E,C){return this._styleExpression.evaluate(s,u,m,b,E,C)}}class mc{constructor(s,u,m,b){this.kind=s,this.zoomStops=m,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!El(u.expression),this.interpolationType=b}evaluateWithoutErrorHandling(s,u,m,b,E,C){return this._styleExpression.evaluateWithoutErrorHandling(s,u,m,b,E,C)}evaluate(s,u,m,b,E,C){return this._styleExpression.evaluate(s,u,m,b,E,C)}interpolationFactor(s,u,m){return this.interpolationType?Cn.interpolationFactor(this.interpolationType,s,u,m):0}}function ga(h,s){const u=Ml(h,s);if(u.result==="error")return u;const m=u.value.expression,b=fc(m);if(!b&&!pa(s))return Ya([new A("","data expressions not supported")]);const E=Ac(m,["zoom"]);if(!E&&!ch(s))return Ya([new A("","zoom expressions not supported")]);const C=fo(m);return C||E?C instanceof A?Ya([C]):C instanceof Cn&&!Cl(s)?Ya([new A("",'"interpolate" expressions cannot be used with this property')]):dc(C?new mc(b?"camera":"composite",u.value,C.labels,C instanceof Cn?C.interpolation:void 0):new lu(b?"constant":"source",u.value)):Ya([new A("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qa{constructor(s,u){this._parameters=s,this._specification=u,Tt(this,ou(this._parameters,this._specification))}static deserialize(s){return new Qa(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function fo(h){let s=null;if(h instanceof sn)s=fo(h.result);else if(h instanceof la){for(const u of h.args)if(s=fo(u),s)break}else(h instanceof ls||h instanceof Cn)&&h.input instanceof Os&&h.input.name==="zoom"&&(s=h);return s instanceof A||h.eachChild(u=>{const m=fo(u);m instanceof A?s=m:!s&&m?s=new A("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&m&&s!==m&&(s=new A("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ma(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const s of h.slice(1))if(!ma(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Rl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ka(h){if(h==null)return{filter:()=>!0,needGeometry:!1};ma(h)||(h=_c(h));const s=Ml(h,Rl);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,m,b)=>s.value.evaluate(u,m,{},b),needGeometry:cu(h)}}function _a(h,s){return h<s?-1:h>s?1:0}function cu(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let s=1;s<h.length;s++)if(cu(h[s]))return!0;return!1}function _c(h){if(!h)return!0;const s=h[0];return h.length<=1?s!=="any":s==="=="?uu(h[1],h[2],"=="):s==="!="?yc(uu(h[1],h[2],"==")):s==="<"||s===">"||s==="<="||s===">="?uu(h[1],h[2],s):s==="any"?(u=h.slice(1),["any"].concat(u.map(_c))):s==="all"?["all"].concat(h.slice(1).map(_c)):s==="none"?["all"].concat(h.slice(1).map(_c).map(yc)):s==="in"?uh(h[1],h.slice(2)):s==="!in"?yc(uh(h[1],h.slice(2))):s==="has"?hh(h[1]):s!=="!has"||yc(hh(h[1]));var u}function uu(h,s,u){switch(h){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,h,s]}}function uh(h,s){if(s.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",h,["literal",s.sort(_a)]]:["filter-in-small",h,["literal",s]]}}function hh(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function yc(h){return["!",h]}function bc(h){const s=typeof h;if(s==="number"||s==="boolean"||s==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let b="[";for(const E of h)b+=`${bc(E)},`;return`${b}]`}const u=Object.keys(h).sort();let m="{";for(let b=0;b<u.length;b++)m+=`${JSON.stringify(u[b])}:${bc(h[u[b]])},`;return`${m}}`}function fh(h){let s="";for(const u of ut)s+=`/${bc(h[u])}`;return s}function kl(h){const s=h.value;return s?[new We(h.key,s,"constants have been deprecated as of v8")]:[]}function $r(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Ao(h){if(Array.isArray(h))return h.map(Ao);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const s={};for(const u in h)s[u]=Ao(h[u]);return s}return $r(h)}function us(h){const s=h.key,u=h.value,m=h.valueSpec||{},b=h.objectElementValidators||{},E=h.style,C=h.styleSpec,D=h.validateSpec;let L=[];const U=ji(u);if(U!=="object")return[new We(s,u,`object expected, ${U} found`)];for(const H in u){const q=H.split(".")[0],Q=ta(m,q)||m["*"];let J;if(ta(b,q))J=b[q];else if(ta(m,q))J=D;else if(b["*"])J=b["*"];else{if(!m["*"]){L.push(new We(s,u[H],`unknown property "${H}"`));continue}J=D}L=L.concat(J({key:(s&&`${s}.`)+H,value:u[H],valueSpec:Q,style:E,styleSpec:C,object:u,objectKey:H,validateSpec:D},u))}for(const H in m)b[H]||m[H].required&&m[H].default===void 0&&u[H]===void 0&&L.push(new We(s,u,`missing required property "${H}"`));return L}function Zr(h){const s=h.value,u=h.valueSpec,m=h.style,b=h.styleSpec,E=h.key,C=h.arrayElementValidator||h.validateSpec;if(ji(s)!=="array")return[new We(E,s,`array expected, ${ji(s)} found`)];if(u.length&&s.length!==u.length)return[new We(E,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new We(E,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let D={type:u.value,values:u.values};b.$version<7&&(D.function=u.function),ji(u.value)==="object"&&(D=u.value);let L=[];for(let U=0;U<s.length;U++)L=L.concat(C({array:s,arrayIndex:U,value:s[U],valueSpec:D,validateSpec:h.validateSpec,style:m,styleSpec:b,key:`${E}[${U}]`}));return L}function Dl(h){const s=h.key,u=h.value,m=h.valueSpec;let b=ji(u);return b==="number"&&u!=u&&(b="NaN"),b!=="number"?[new We(s,u,`number expected, ${b} found`)]:"minimum"in m&&u<m.minimum?[new We(s,u,`${u} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&u>m.maximum?[new We(s,u,`${u} is greater than the maximum value ${m.maximum}`)]:[]}function hu(h){const s=h.valueSpec,u=$r(h.value.type);let m,b,E,C={};const D=u!=="categorical"&&h.value.property===void 0,L=!D,U=ji(h.value.stops)==="array"&&ji(h.value.stops[0])==="array"&&ji(h.value.stops[0][0])==="object",H=us({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(J){if(u==="identity")return[new We(J.key,J.value,'identity function may not have a "stops" property')];let te=[];const oe=J.value;return te=te.concat(Zr({key:J.key,value:oe,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:q})),ji(oe)==="array"&&oe.length===0&&te.push(new We(J.key,oe,"array must have at least one stop")),te},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:s,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return u==="identity"&&D&&H.push(new We(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||H.push(new We(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Cl(h.valueSpec)&&H.push(new We(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(L&&!pa(h.valueSpec)?H.push(new We(h.key,h.value,"property functions not supported")):D&&!ch(h.valueSpec)&&H.push(new We(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!U||h.value.property!==void 0||H.push(new We(h.key,h.value,'"property" property is required')),H;function q(J){let te=[];const oe=J.value,pe=J.key;if(ji(oe)!=="array")return[new We(pe,oe,`array expected, ${ji(oe)} found`)];if(oe.length!==2)return[new We(pe,oe,`array length 2 expected, length ${oe.length} found`)];if(U){if(ji(oe[0])!=="object")return[new We(pe,oe,`object expected, ${ji(oe[0])} found`)];if(oe[0].zoom===void 0)return[new We(pe,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new We(pe,oe,"object stop key must have value")];if(E&&E>$r(oe[0].zoom))return[new We(pe,oe[0].zoom,"stop zoom values must appear in ascending order")];$r(oe[0].zoom)!==E&&(E=$r(oe[0].zoom),b=void 0,C={}),te=te.concat(us({key:`${pe}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:Dl,value:Q}}))}else te=te.concat(Q({key:`${pe}[0]`,value:oe[0],validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},oe));return Uo(Ao(oe[1]))?te.concat([new We(`${pe}[1]`,oe[1],"expressions are not allowed in function stops.")]):te.concat(J.validateSpec({key:`${pe}[1]`,value:oe[1],valueSpec:s,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function Q(J,te){const oe=ji(J.value),pe=$r(J.value),Se=J.value!==null?J.value:te;if(m){if(oe!==m)return[new We(J.key,Se,`${oe} stop domain type must match previous stop domain type ${m}`)]}else m=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new We(J.key,Se,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&u!=="categorical"){let He=`number expected, ${oe} found`;return pa(s)&&u===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(J.key,Se,He)]}return u!=="categorical"||oe!=="number"||isFinite(pe)&&Math.floor(pe)===pe?u!=="categorical"&&oe==="number"&&b!==void 0&&pe<b?[new We(J.key,Se,"stop domain values must appear in ascending order")]:(b=pe,u==="categorical"&&pe in C?[new We(J.key,Se,"stop domain values must be unique")]:(C[pe]=!0,[])):[new We(J.key,Se,`integer expected, found ${pe}`)]}}function hs(h){const s=(h.expressionContext==="property"?ga:Ml)(Ao(h.value),h.valueSpec);if(s.result==="error")return s.value.map(m=>new We(`${h.key}${m.key}`,h.value,m.message));const u=s.value.expression||s.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new We(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!El(u))return[new We(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!El(u))return[new We(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Ac(u,["zoom","feature-state"]))return[new We(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!fc(u))return[new We(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fs(h){const s=h.key,u=h.value,m=ji(u);return m!=="string"?[new We(s,u,`color expected, ${m} found`)]:ir.parse(String(u))?[]:[new We(s,u,`color expected, "${u}" found`)]}function Bl(h){const s=h.key,u=h.value,m=h.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf($r(u))===-1&&b.push(new We(s,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(m.values).indexOf($r(u))===-1&&b.push(new We(s,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),b}function fu(h){return ma(Ao(h.value))?hs(Tt({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ah(h)}function Ah(h){const s=h.value,u=h.key;if(ji(s)!=="array")return[new We(u,s,`array expected, ${ji(s)} found`)];const m=h.styleSpec;let b,E=[];if(s.length<1)return[new We(u,s,"filter array must have at least 1 element")];switch(E=E.concat(Bl({key:`${u}[0]`,value:s[0],valueSpec:m.filter_operator,style:h.style,styleSpec:h.styleSpec})),$r(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&$r(s[1])==="$type"&&E.push(new We(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&E.push(new We(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(b=ji(s[1]),b!=="string"&&E.push(new We(`${u}[1]`,s[1],`string expected, ${b} found`)));for(let C=2;C<s.length;C++)b=ji(s[C]),$r(s[1])==="$type"?E=E.concat(Bl({key:`${u}[${C}]`,value:s[C],valueSpec:m.geometry_type,style:h.style,styleSpec:h.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&E.push(new We(`${u}[${C}]`,s[C],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)E=E.concat(Ah({key:`${u}[${C}]`,value:s[C],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":b=ji(s[1]),s.length!==2?E.push(new We(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):b!=="string"&&E.push(new We(`${u}[1]`,s[1],`string expected, ${b} found`))}return E}function Au(h,s){const u=h.key,m=h.validateSpec,b=h.style,E=h.styleSpec,C=h.value,D=h.objectKey,L=E[`${s}_${h.layerType}`];if(!L)return[];const U=D.match(/^(.*)-transition$/);if(s==="paint"&&U&&L[U[1]]&&L[U[1]].transition)return m({key:u,value:C,valueSpec:E.transition,style:b,styleSpec:E});const H=h.valueSpec||L[D];if(!H)return[new We(u,C,`unknown property "${D}"`)];let q;if(ji(C)==="string"&&pa(H)&&!H.tokens&&(q=/^{([^}]+)}$/.exec(C)))return[new We(u,C,`"${D}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(q[1])} }\`.`)];const Q=[];return h.layerType==="symbol"&&(D==="text-field"&&b&&!b.glyphs&&Q.push(new We(u,C,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&Il(Ao(C))&&$r(C.type)==="identity"&&Q.push(new We(u,C,'"text-font" does not support identity functions'))),Q.concat(m({key:h.key,value:C,valueSpec:H,style:b,styleSpec:E,expressionContext:"property",propertyType:s,propertyKey:D}))}function du(h){return Au(h,"paint")}function ya(h){return Au(h,"layout")}function ba(h){let s=[];const u=h.value,m=h.key,b=h.style,E=h.styleSpec;if(ji(u)!=="object")return[new We(m,u,`object expected, ${ji(u)} found`)];u.type||u.ref||s.push(new We(m,u,'either "type" or "ref" is required'));let C=$r(u.type);const D=$r(u.ref);if(u.id){const L=$r(u.id);for(let U=0;U<h.arrayIndex;U++){const H=b.layers[U];$r(H.id)===L&&s.push(new We(m,u.id,`duplicate layer id "${u.id}", previously used at line ${H.id.__line__}`))}}if("ref"in u){let L;["type","source","source-layer","filter","layout"].forEach(U=>{U in u&&s.push(new We(m,u[U],`"${U}" is prohibited for ref layers`))}),b.layers.forEach(U=>{$r(U.id)===D&&(L=U)}),L?L.ref?s.push(new We(m,u.ref,"ref cannot reference another ref layer")):C=$r(L.type):s.push(new We(m,u.ref,`ref layer "${D}" not found`))}else if(C!=="background")if(u.source){const L=b.sources&&b.sources[u.source],U=L&&$r(L.type);L?U==="vector"&&C==="raster"?s.push(new We(m,u.source,`layer "${u.id}" requires a raster source`)):U!=="raster-dem"&&C==="hillshade"?s.push(new We(m,u.source,`layer "${u.id}" requires a raster-dem source`)):U==="raster"&&C!=="raster"?s.push(new We(m,u.source,`layer "${u.id}" requires a vector source`)):U!=="vector"||u["source-layer"]?U==="raster-dem"&&C!=="hillshade"?s.push(new We(m,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!u.paint||!u.paint["line-gradient"]||U==="geojson"&&L.lineMetrics||s.push(new We(m,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new We(m,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new We(m,u.source,`source "${u.source}" not found`))}else s.push(new We(m,u,'missing required property "source"'));return s=s.concat(us({key:m,value:u,valueSpec:E.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${m}.type`,value:u.type,valueSpec:E.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:fu,layout:L=>us({layer:u,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":U=>ya(Tt({layerType:C},U))}}),paint:L=>us({layer:u,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":U=>du(Tt({layerType:C},U))}})}})),s}function cn(h){const s=h.value,u=h.key,m=ji(s);return m!=="string"?[new We(u,s,`string expected, ${m} found`)]:[]}const Ja={promoteId:function({key:h,value:s}){if(ji(s)==="string")return cn({key:h,value:s});{const u=[];for(const m in s)u.push(...cn({key:`${h}.${m}`,value:s[m]}));return u}}};function pu(h){const s=h.value,u=h.key,m=h.styleSpec,b=h.style,E=h.validateSpec;if(!s.type)return[new We(u,s,'"type" is required')];const C=$r(s.type);let D;switch(C){case"vector":case"raster":return D=us({key:u,value:s,valueSpec:m[`source_${C.replace("-","_")}`],style:h.style,styleSpec:m,objectElementValidators:Ja,validateSpec:E}),D;case"raster-dem":return D=function(L){var U;const H=(U=L.sourceName)!==null&&U!==void 0?U:"",q=L.value,Q=L.styleSpec,J=Q.source_raster_dem,te=L.style;let oe=[];const pe=ji(q);if(q===void 0)return oe;if(pe!=="object")return oe.push(new We("source_raster_dem",q,`object expected, ${pe} found`)),oe;const Se=$r(q.encoding)==="custom",He=["redFactor","greenFactor","blueFactor","baseShift"],ke=L.value.encoding?`"${L.value.encoding}"`:"Default";for(const K in q)!Se&&He.includes(K)?oe.push(new We(K,q[K],`In "${H}": "${K}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):J[K]?oe=oe.concat(L.validateSpec({key:K,value:q[K],valueSpec:J[K],validateSpec:L.validateSpec,style:te,styleSpec:Q})):oe.push(new We(K,q[K],`unknown property "${K}"`));return oe}({sourceName:u,value:s,style:h.style,styleSpec:m,validateSpec:E}),D;case"geojson":if(D=us({key:u,value:s,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:E,objectElementValidators:Ja}),s.cluster)for(const L in s.clusterProperties){const[U,H]=s.clusterProperties[L],q=typeof U=="string"?[U,["accumulated"],["get",L]]:U;D.push(...hs({key:`${u}.${L}.map`,value:H,expressionContext:"cluster-map"})),D.push(...hs({key:`${u}.${L}.reduce`,value:q,expressionContext:"cluster-reduce"}))}return D;case"video":return us({key:u,value:s,valueSpec:m.source_video,style:b,validateSpec:E,styleSpec:m});case"image":return us({key:u,value:s,valueSpec:m.source_image,style:b,validateSpec:E,styleSpec:m});case"canvas":return[new We(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Bl({key:`${u}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function dh(h){const s=h.value,u=h.styleSpec,m=u.light,b=h.style;let E=[];const C=ji(s);if(s===void 0)return E;if(C!=="object")return E=E.concat([new We("light",s,`object expected, ${C} found`)]),E;for(const D in s){const L=D.match(/^(.*)-transition$/);E=E.concat(L&&m[L[1]]&&m[L[1]].transition?h.validateSpec({key:D,value:s[D],valueSpec:u.transition,validateSpec:h.validateSpec,style:b,styleSpec:u}):m[D]?h.validateSpec({key:D,value:s[D],valueSpec:m[D],validateSpec:h.validateSpec,style:b,styleSpec:u}):[new We(D,s[D],`unknown property "${D}"`)])}return E}function po(h){const s=h.value,u=h.styleSpec,m=u.sky,b=h.style,E=ji(s);if(s===void 0)return[];if(E!=="object")return[new We("sky",s,`object expected, ${E} found`)];let C=[];for(const D in s)C=C.concat(m[D]?h.validateSpec({key:D,value:s[D],valueSpec:m[D],style:b,styleSpec:u}):[new We(D,s[D],`unknown property "${D}"`)]);return C}function Gn(h){const s=h.value,u=h.styleSpec,m=u.terrain,b=h.style;let E=[];const C=ji(s);if(s===void 0)return E;if(C!=="object")return E=E.concat([new We("terrain",s,`object expected, ${C} found`)]),E;for(const D in s)E=E.concat(m[D]?h.validateSpec({key:D,value:s[D],valueSpec:m[D],validateSpec:h.validateSpec,style:b,styleSpec:u}):[new We(D,s[D],`unknown property "${D}"`)]);return E}function ki(h){let s=[];const u=h.value,m=h.key;if(Array.isArray(u)){const b=[],E=[];for(const C in u)u[C].id&&b.includes(u[C].id)&&s.push(new We(m,u,`all the sprites' ids must be unique, but ${u[C].id} is duplicated`)),b.push(u[C].id),u[C].url&&E.includes(u[C].url)&&s.push(new We(m,u,`all the sprites' URLs must be unique, but ${u[C].url} is duplicated`)),E.push(u[C].url),s=s.concat(us({key:`${m}[${C}]`,value:u[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return s}return cn({key:m,value:u})}function Yn(h){return s=h.value,s&&s.constructor===Object?[]:[new We(h.key,h.value,`object expected, ${ji(h.value)} found`)];var s}const Ci={"*":()=>[],array:Zr,boolean:function(h){const s=h.value,u=h.key,m=ji(s);return m!=="boolean"?[new We(u,s,`boolean expected, ${m} found`)]:[]},number:Dl,color:fs,constants:kl,enum:Bl,filter:fu,function:hu,layer:ba,object:us,source:pu,light:dh,sky:po,terrain:Gn,projection:function(h){const s=h.value,u=h.styleSpec,m=u.projection,b=h.style,E=ji(s);if(s===void 0)return[];if(E!=="object")return[new We("projection",s,`object expected, ${E} found`)];let C=[];for(const D in s)C=C.concat(m[D]?h.validateSpec({key:D,value:s[D],valueSpec:m[D],style:b,styleSpec:u}):[new We(D,s[D],`unknown property "${D}"`)]);return C},projectionDefinition:function(h){const s=h.key;let u=h.value;u=u instanceof String?u.valueOf():u;const m=ji(u);return m!=="array"||function(b){return Array.isArray(b)&&b.length===3&&typeof b[0]=="string"&&typeof b[1]=="string"&&typeof b[2]=="number"}(u)||function(b){return!!["interpolate","step","literal"].includes(b[0])}(u)?["array","string"].includes(m)?[]:[new We(s,u,`projection expected, invalid type "${m}" found`)]:[new We(s,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:cn,formatted:function(h){return cn(h).length===0?[]:hs(h)},resolvedImage:function(h){return cn(h).length===0?[]:hs(h)},padding:function(h){const s=h.key,u=h.value;if(ji(u)==="array"){if(u.length<1||u.length>4)return[new We(s,u,`padding requires 1 to 4 values; ${u.length} values found`)];const m={type:"number"};let b=[];for(let E=0;E<u.length;E++)b=b.concat(h.validateSpec({key:`${s}[${E}]`,value:u[E],validateSpec:h.validateSpec,valueSpec:m}));return b}return Dl({key:s,value:u,valueSpec:{}})},numberArray:function(h){const s=h.key,u=h.value;if(ji(u)==="array"){const m={type:"number"};if(u.length<1)return[new We(s,u,"array length at least 1 expected, length 0 found")];let b=[];for(let E=0;E<u.length;E++)b=b.concat(h.validateSpec({key:`${s}[${E}]`,value:u[E],validateSpec:h.validateSpec,valueSpec:m}));return b}return Dl({key:s,value:u,valueSpec:{}})},colorArray:function(h){const s=h.key,u=h.value;if(ji(u)==="array"){if(u.length<1)return[new We(s,u,"array length at least 1 expected, length 0 found")];let m=[];for(let b=0;b<u.length;b++)m=m.concat(fs({key:`${s}[${b}]`,value:u[b]}));return m}return fs({key:s,value:u})},variableAnchorOffsetCollection:function(h){const s=h.key,u=h.value,m=ji(u),b=h.styleSpec;if(m!=="array"||u.length<1||u.length%2!=0)return[new We(s,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let C=0;C<u.length;C+=2)E=E.concat(Bl({key:`${s}[${C}]`,value:u[C],valueSpec:b.layout_symbol["text-anchor"]})),E=E.concat(Zr({key:`${s}[${C+1}]`,value:u[C+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:b}));return E},sprite:ki,state:Yn};function qr(h){const s=h.value,u=h.valueSpec,m=h.styleSpec;return h.validateSpec=qr,u.expression&&Il($r(s))?hu(h):u.expression&&Uo(Ao(s))?hs(h):u.type&&Ci[u.type]?Ci[u.type](h):us(Tt({},h,{valueSpec:u.type?m[u.type]:u}))}function gu(h){const s=h.value,u=h.key,m=cn(h);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new We(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new We(u,s,'"glyphs" url must include a "{range}" token'))),m}function pn(h,s=ge){let u=[];return u=u.concat(qr({key:"",value:h,valueSpec:s.$root,styleSpec:s,style:h,validateSpec:qr,objectElementValidators:{glyphs:gu,"*":()=>[]}})),h.constants&&(u=u.concat(kl({key:"constants",value:h.constants}))),el(u)}function gn(h){return function(s){return h({...s,validateSpec:qr})}}function el(h){return[].concat(h).sort((s,u)=>s.line-u.line)}function Rr(h){return function(...s){return el(h.apply(this,s))}}pn.source=Rr(gn(pu)),pn.sprite=Rr(gn(ki)),pn.glyphs=Rr(gn(gu)),pn.light=Rr(gn(dh)),pn.sky=Rr(gn(po)),pn.terrain=Rr(gn(Gn)),pn.state=Rr(gn(Yn)),pn.layer=Rr(gn(ba)),pn.filter=Rr(gn(fu)),pn.paintProperty=Rr(gn(du)),pn.layoutProperty=Rr(gn(ya));const Hs=pn,go=Hs.light,ph=Hs.sky,Ut=Hs.paintProperty,qt=Hs.layoutProperty;function vc(h,s){let u=!1;if(s&&s.length)for(const m of s)h.fire(new ue(new Error(m.message))),u=!0;return u}class va{constructor(s,u,m){const b=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const C=new Int32Array(this.arrayBuffer);s=C[0],this.d=(u=C[1])+2*(m=C[2]);for(let L=0;L<this.d*this.d;L++){const U=C[3+L],H=C[3+L+1];b.push(U===H?null:C.subarray(U,H))}const D=C[3+b.length+1];this.keys=C.subarray(C[3+b.length],D),this.bboxes=C.subarray(D),this.insert=this._insertReadonly}else{this.d=u+2*m;for(let C=0;C<this.d*this.d;C++)b.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=m,this.scale=u/s,this.uid=0;const E=m/u*s;this.min=-E,this.max=s+E}insert(s,u,m,b,E){this._forEachCell(u,m,b,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,u,m,b,E,C){this.cells[E].push(C)}query(s,u,m,b,E){const C=this.min,D=this.max;if(s<=C&&u<=C&&D<=m&&D<=b&&!E)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(s,u,m,b,this._queryCell,L,{},E),L}}_queryCell(s,u,m,b,E,C,D,L){const U=this.cells[E];if(U!==null){const H=this.keys,q=this.bboxes;for(let Q=0;Q<U.length;Q++){const J=U[Q];if(D[J]===void 0){const te=4*J;(L?L(q[te+0],q[te+1],q[te+2],q[te+3]):s<=q[te+2]&&u<=q[te+3]&&m>=q[te+0]&&b>=q[te+1])?(D[J]=!0,C.push(H[J])):D[J]=!1}}}}_forEachCell(s,u,m,b,E,C,D,L){const U=this._convertToCellCoord(s),H=this._convertToCellCoord(u),q=this._convertToCellCoord(m),Q=this._convertToCellCoord(b);for(let J=U;J<=q;J++)for(let te=H;te<=Q;te++){const oe=this.d*te+J;if((!L||L(this._convertFromCellCoord(J),this._convertFromCellCoord(te),this._convertFromCellCoord(J+1),this._convertFromCellCoord(te+1)))&&E.call(this,s,u,m,b,oe,C,D,L))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,u=3+this.cells.length+1+1;let m=0;for(let C=0;C<this.cells.length;C++)m+=this.cells[C].length;const b=new Int32Array(u+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let E=u;for(let C=0;C<s.length;C++){const D=s[C];b[3+C]=E,b.set(D,E),E+=D.length}return b[3+s.length]=E,b.set(this.keys,E),E+=this.keys.length,b[3+s.length+1]=E,b.set(this.bboxes,E),E+=this.bboxes.length,b.buffer}static serialize(s,u){const m=s.toArrayBuffer();return u&&u.push(m),{buffer:m}}static deserialize(s){return new va(s.buffer)}}const ws={};function li(h,s,u={}){if(ws[h])throw new Error(`${h} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:h,writeable:!1}),ws[h]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}li("Object",Object),li("TransferableGridIndex",va),li("Color",ir),li("Error",Error),li("AJAXError",ks),li("ResolvedImage",os),li("StylePropertyFunction",Qa),li("StyleExpression",gc,{omit:["_evaluator"]}),li("ZoomDependentExpression",mc),li("ZoomConstantExpression",lu),li("CompoundExpression",Os,{omit:["_evaluate"]});for(const h in Ga)Ga[h]._classRegistryKey||li(`Expression_${h}`,Ga[h]);function mo(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function to(h){return h.$name||h.constructor._classRegistryKey}function mu(h){return!function(s){if(s===null||typeof s!="object")return!1;const u=to(s);return!(!u||u==="Object")}(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||mo(h)||zt(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function Ts(h,s){if(mu(h))return(mo(h)||zt(h))&&s&&s.push(h),ArrayBuffer.isView(h)&&s&&s.push(h.buffer),h instanceof ImageData&&s&&s.push(h.data.buffer),h;if(Array.isArray(h)){const E=[];for(const C of h)E.push(Ts(C,s));return E}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=to(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!ws[u])throw new Error(`${u} is not registered.`);const{klass:m}=ws[u],b=m.serialize?m.serialize(h,s):{};if(m.serialize){if(s&&b===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in h){if(!h.hasOwnProperty(E)||ws[u].omit.indexOf(E)>=0)continue;const C=h[E];b[E]=ws[u].shallow.indexOf(E)>=0?C:Ts(C,s)}h instanceof Error&&(b.message=h.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(b.$name=u),b}function d(h){if(mu(h))return h;if(Array.isArray(h))return h.map(d);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const s=to(h)||"Object";if(!ws[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:u}=ws[s];if(!u)throw new Error(`can't deserialize unregistered class ${s}`);if(u.deserialize)return u.deserialize(h);const m=Object.create(u.prototype);for(const b of Object.keys(h)){if(b==="$name")continue;const E=h[b];m[b]=ws[s].shallow.indexOf(b)>=0?E:d(E)}return m}class p{constructor(){this.first=!0}update(s,u){const m=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=m,!0))}}const g={"Latin-1 Supplement":h=>h>=128&&h<=255,"Hangul Jamo":h=>h>=4352&&h<=4607,Khmer:h=>h>=6016&&h<=6143,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Kanbun:h=>h>=12688&&h<=12703,"CJK Strokes":h=>h>=12736&&h<=12783,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Hangul Syllables":h=>h>=44032&&h<=55215,"Private Use Area":h=>h>=57344&&h<=63743,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function v(h){for(const s of h)if($(s.charCodeAt(0)))return!0;return!1}function x(h){for(const s of h)if(!B(s.charCodeAt(0)))return!1;return!0}function I(h){const s=h.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(s.join("|"),"u")}const R=I(["Arab","Dupl","Mong","Ougr","Syrc"]);function B(h){return!R.test(String.fromCodePoint(h))}const z=I(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function $(h){return!(h!==746&&h!==747&&(h<4352||!(g["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||g["CJK Compatibility"](h)||g["CJK Strokes"](h)||!(!g["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||g["Enclosed CJK Letters and Months"](h)||g["Ideographic Description Characters"](h)||g.Kanbun(h)||g.Katakana(h)&&h!==12540||!(!g["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!g["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||g["Vertical Forms"](h)||g["Yijing Hexagram Symbols"](h)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(h))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(h))||z.test(String.fromCodePoint(h)))))}function X(h){return!($(h)||function(s){return!!(g["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||g["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||g["Letterlike Symbols"](s)||g["Number Forms"](s)||g["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||g["Control Pictures"](s)&&s!==9251||g["Optical Character Recognition"](s)||g["Enclosed Alphanumerics"](s)||g["Geometric Shapes"](s)||g["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||g["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||g["CJK Symbols and Punctuation"](s)||g.Katakana(s)||g["Private Use Area"](s)||g["CJK Compatibility Forms"](s)||g["Small Form Variants"](s)||g["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(h))}const ce=I(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Te(h){return ce.test(String.fromCodePoint(h))}function xe(h,s){return!(!s&&Te(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||g.Khmer(h))}function we(h){for(const s of h)if(Te(s.charCodeAt(0)))return!0;return!1}const je=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(je.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,s){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;const u=h.pluginURL,m=new Promise(E=>{this.loadScriptResolve=E});s(u);const b=new Promise(E=>setTimeout(()=>E(),this.TIMEOUT));if(yield Promise.race([m,b]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:u};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)})}};class Ze{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new p,this.transition={})}isSupportedScript(s){return function(u,m){for(const b of u)if(!xe(b.charCodeAt(0),m))return!1;return!0}(s,je.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,u=s-Math.floor(s),m=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*u}}}class gt{constructor(s,u){this.property=s,this.value=u,this.expression=function(m,b){if(Il(m))return new Qa(m,b);if(Uo(m)){const E=ga(m,b);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=m;return b.type==="color"&&typeof m=="string"?E=ir.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type!=="numberArray"||typeof m!="number"&&!Array.isArray(m)?b.type!=="colorArray"||typeof m!="string"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)?E=Zn.parse(m):b.type==="projectionDefinition"&&typeof m=="string"&&(E=as.parse(m)):E=an.parse(m):E=jr.parse(m):E=fn.parse(m),{kind:"constant",evaluate:()=>E}}}(u===void 0?s.specification.default:u,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,m){return this.property.possiblyEvaluate(this,s,u,m)}}class at{constructor(s){this.property=s,this.value=new gt(s,void 0)}transitioned(s,u){return new qe(this.property,this.value,u,Oi({},s.transition,this.transition),s.now)}untransitioned(){return new qe(this.property,this.value,null,{},0)}}class st{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Fi(this._values[s].value.value)}setValue(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new at(this._values[s].property)),this._values[s].value=new gt(this._values[s].property,u===null?void 0:Fi(u))}getTransition(s){return Fi(this._values[s].transition)}setTransition(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new at(this._values[s].property)),this._values[s].transition=Fi(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(s[u]=m);const b=this.getTransition(u);b!==void 0&&(s[`${u}-transition`]=b)}return s}transitioned(s,u){const m=new Zt(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(s,u._values[b]);return m}untransitioned(){const s=new Zt(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}}class qe{constructor(s,u,m,b,E){this.property=s,this.value=u,this.begin=E+b.delay||0,this.end=this.begin+b.duration||0,s.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(s,u,m){const b=s.now||0,E=this.value.possiblyEvaluate(s,u,m),C=this.prior;if(C){if(b>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(b<this.begin)return C.possiblyEvaluate(s,u,m);{const D=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(s,u,m),E,Ct(D))}}return E}}class Zt{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,m){const b=new Ni(this._properties);for(const E of Object.keys(this._values))b._values[E]=this._values[E].possiblyEvaluate(s,u,m);return b}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class yi{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Fi(this._values[s].value)}setValue(s,u){this._values[s]=new gt(this._values[s].property,u===null?void 0:Fi(u))}serialize(){const s={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(s[u]=m)}return s}possiblyEvaluate(s,u,m){const b=new Ni(this._properties);for(const E of Object.keys(this._values))b._values[E]=this._values[E].possiblyEvaluate(s,u,m);return b}}class ai{constructor(s,u,m){this.property=s,this.value=u,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,m,b){return this.property.evaluate(this.value,this.parameters,s,u,m,b)}}class Ni{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class Ft{constructor(s){this.specification=s}possiblyEvaluate(s,u){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(u)}interpolate(s,u,m){const b=Bs[this.specification.type];return b?b(s,u,m):s}}class Gt{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,m,b){return new ai(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},m,b)}:s.expression,u)}interpolate(s,u,m){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new ai(this,{kind:"constant",value:void 0},s.parameters);const b=Bs[this.specification.type];if(b){const E=b(s.value.value,u.value.value,m);return new ai(this,{kind:"constant",value:E},s.parameters)}return s}evaluate(s,u,m,b,E,C){return s.kind==="constant"?s.value:s.evaluate(u,m,b,E,C)}}class Ri extends Gt{possiblyEvaluate(s,u,m,b){if(s.value===void 0)return new ai(this,{kind:"constant",value:void 0},u);if(s.expression.kind==="constant"){const E=s.expression.evaluate(u,null,{},m,b),C=s.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,D=this._calculate(C,C,C,u);return new ai(this,{kind:"constant",value:D},u)}if(s.expression.kind==="camera"){const E=this._calculate(s.expression.evaluate({zoom:u.zoom-1}),s.expression.evaluate({zoom:u.zoom}),s.expression.evaluate({zoom:u.zoom+1}),u);return new ai(this,{kind:"constant",value:E},u)}return new ai(this,s.expression,u)}evaluate(s,u,m,b,E,C){if(s.kind==="source"){const D=s.evaluate(u,m,b,E,C);return this._calculate(D,D,D,u)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(u.zoom)-1},m,b),s.evaluate({zoom:Math.floor(u.zoom)},m,b),s.evaluate({zoom:Math.floor(u.zoom)+1},m,b),u):s.value}_calculate(s,u,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:m,to:u}}interpolate(s){return s}}class mi{constructor(s){this.specification=s}possiblyEvaluate(s,u,m,b){if(s.value!==void 0){if(s.expression.kind==="constant"){const E=s.expression.evaluate(u,null,{},m,b);return this._calculate(E,E,E,u)}return this._calculate(s.expression.evaluate(new Ze(Math.floor(u.zoom-1),u)),s.expression.evaluate(new Ze(Math.floor(u.zoom),u)),s.expression.evaluate(new Ze(Math.floor(u.zoom+1),u)),u)}}_calculate(s,u,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:m,to:u}}interpolate(s){return s}}class Ht{constructor(s){this.specification=s}possiblyEvaluate(s,u,m,b){return!!s.expression.evaluate(u,null,{},m,b)}interpolate(){return!1}}class bi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in s){const m=s[u];m.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new gt(m,void 0),E=this.defaultTransitionablePropertyValues[u]=new at(m);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate({})}}}li("DataDrivenProperty",Gt),li("DataConstantProperty",Ft),li("CrossFadedDataDrivenProperty",Ri),li("CrossFadedProperty",mi),li("ColorRampProperty",Ht);const _r="-transition";class Ii extends $e{constructor(s,u){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),u.layout&&(this._unevaluatedLayout=new yi(u.layout)),u.paint)){this._transitionablePaint=new st(u.paint);for(const m in s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(const m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ni(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u,m={}){u!=null&&this._validate(qt,`layers.${this.id}.layout.${s}`,s,u,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,u):this.visibility=u)}getPaintProperty(s){return s.endsWith(_r)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,u,m={}){if(u!=null&&this._validate(Ut,`layers.${this.id}.paint.${s}`,s,u,m))return!1;if(s.endsWith(_r))return this._transitionablePaint.setTransition(s.slice(0,-11),u||void 0),!1;{const b=this._transitionablePaint._values[s],E=b.property.specification["property-type"]==="cross-faded-data-driven",C=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(s,u),this._handleSpecialPaintPropertyUpdate(s);const L=this._transitionablePaint._values[s].value;return L.isDataDriven()||C||E||this._handleOverridablePaintPropertyUpdate(s,D,L)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,u,m){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Yi(s,(u,m)=>!(u===void 0||m==="layout"&&!Object.keys(u).length||m==="paint"&&!Object.keys(u).length))}_validate(s,u,m,b,E={}){return(!E||E.validate!==!1)&&vc(this,s.call(Hs,{key:u,layerType:this.type,objectKey:m,value:b,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof ai&&pa(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Er={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Jr{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xr(h,s=1){let u=0,m=0;return{members:h.map(b=>{const E=Er[b.type].BYTES_PER_ELEMENT,C=u=xc(u,Math.max(s,E)),D=b.components||1;return m=Math.max(m,E),u+=E*D,{name:b.name,type:b.type,components:D,offset:C}}),size:xc(u,Math.max(m,s)),alignment:s}}function xc(h,s){return Math.ceil(h/s)*s}class _u extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const m=this.length;return this.resize(m+1),this.emplace(m,s,u)}emplace(s,u,m){const b=2*s;return this.int16[b+0]=u,this.int16[b+1]=m,s}}_u.prototype.bytesPerElement=4,li("StructArrayLayout2i4",_u);class yu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,m)}emplace(s,u,m,b){const E=3*s;return this.int16[E+0]=u,this.int16[E+1]=m,this.int16[E+2]=b,s}}yu.prototype.bytesPerElement=6,li("StructArrayLayout3i6",yu);class Ol extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m,b){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,m,b)}emplace(s,u,m,b,E){const C=4*s;return this.int16[C+0]=u,this.int16[C+1]=m,this.int16[C+2]=b,this.int16[C+3]=E,s}}Ol.prototype.bytesPerElement=8,li("StructArrayLayout4i8",Ol);class kf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C){const D=this.length;return this.resize(D+1),this.emplace(D,s,u,m,b,E,C)}emplace(s,u,m,b,E,C,D){const L=6*s;return this.int16[L+0]=u,this.int16[L+1]=m,this.int16[L+2]=b,this.int16[L+3]=E,this.int16[L+4]=C,this.int16[L+5]=D,s}}kf.prototype.bytesPerElement=12,li("StructArrayLayout2i4i12",kf);class Df extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C){const D=this.length;return this.resize(D+1),this.emplace(D,s,u,m,b,E,C)}emplace(s,u,m,b,E,C,D){const L=4*s,U=8*s;return this.int16[L+0]=u,this.int16[L+1]=m,this.uint8[U+4]=b,this.uint8[U+5]=E,this.uint8[U+6]=C,this.uint8[U+7]=D,s}}Df.prototype.bytesPerElement=8,li("StructArrayLayout2i4ub8",Df);class wc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const m=this.length;return this.resize(m+1),this.emplace(m,s,u)}emplace(s,u,m){const b=2*s;return this.float32[b+0]=u,this.float32[b+1]=m,s}}wc.prototype.bytesPerElement=8,li("StructArrayLayout2f8",wc);class Bf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C,D,L,U,H){const q=this.length;return this.resize(q+1),this.emplace(q,s,u,m,b,E,C,D,L,U,H)}emplace(s,u,m,b,E,C,D,L,U,H,q){const Q=10*s;return this.uint16[Q+0]=u,this.uint16[Q+1]=m,this.uint16[Q+2]=b,this.uint16[Q+3]=E,this.uint16[Q+4]=C,this.uint16[Q+5]=D,this.uint16[Q+6]=L,this.uint16[Q+7]=U,this.uint16[Q+8]=H,this.uint16[Q+9]=q,s}}Bf.prototype.bytesPerElement=20,li("StructArrayLayout10ui20",Bf);class T extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C,D,L,U,H,q,Q){const J=this.length;return this.resize(J+1),this.emplace(J,s,u,m,b,E,C,D,L,U,H,q,Q)}emplace(s,u,m,b,E,C,D,L,U,H,q,Q,J){const te=12*s;return this.int16[te+0]=u,this.int16[te+1]=m,this.int16[te+2]=b,this.int16[te+3]=E,this.uint16[te+4]=C,this.uint16[te+5]=D,this.uint16[te+6]=L,this.uint16[te+7]=U,this.int16[te+8]=H,this.int16[te+9]=q,this.int16[te+10]=Q,this.int16[te+11]=J,s}}T.prototype.bytesPerElement=24,li("StructArrayLayout4i4ui4i24",T);class n extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,m)}emplace(s,u,m,b){const E=3*s;return this.float32[E+0]=u,this.float32[E+1]=m,this.float32[E+2]=b,s}}n.prototype.bytesPerElement=12,li("StructArrayLayout3f12",n);class l extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}l.prototype.bytesPerElement=4,li("StructArrayLayout1ul4",l);class _ extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C,D,L,U){const H=this.length;return this.resize(H+1),this.emplace(H,s,u,m,b,E,C,D,L,U)}emplace(s,u,m,b,E,C,D,L,U,H){const q=10*s,Q=5*s;return this.int16[q+0]=u,this.int16[q+1]=m,this.int16[q+2]=b,this.int16[q+3]=E,this.int16[q+4]=C,this.int16[q+5]=D,this.uint32[Q+3]=L,this.uint16[q+8]=U,this.uint16[q+9]=H,s}}_.prototype.bytesPerElement=20,li("StructArrayLayout6i1ul2ui20",_);class y extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C){const D=this.length;return this.resize(D+1),this.emplace(D,s,u,m,b,E,C)}emplace(s,u,m,b,E,C,D){const L=6*s;return this.int16[L+0]=u,this.int16[L+1]=m,this.int16[L+2]=b,this.int16[L+3]=E,this.int16[L+4]=C,this.int16[L+5]=D,s}}y.prototype.bytesPerElement=12,li("StructArrayLayout2i2i2i12",y);class S extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E){const C=this.length;return this.resize(C+1),this.emplace(C,s,u,m,b,E)}emplace(s,u,m,b,E,C){const D=4*s,L=8*s;return this.float32[D+0]=u,this.float32[D+1]=m,this.float32[D+2]=b,this.int16[L+6]=E,this.int16[L+7]=C,s}}S.prototype.bytesPerElement=16,li("StructArrayLayout2f1f2i16",S);class M extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C){const D=this.length;return this.resize(D+1),this.emplace(D,s,u,m,b,E,C)}emplace(s,u,m,b,E,C,D){const L=16*s,U=4*s,H=8*s;return this.uint8[L+0]=u,this.uint8[L+1]=m,this.float32[U+1]=b,this.float32[U+2]=E,this.int16[H+6]=C,this.int16[H+7]=D,s}}M.prototype.bytesPerElement=16,li("StructArrayLayout2ub2f2i16",M);class O extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,m)}emplace(s,u,m,b){const E=3*s;return this.uint16[E+0]=u,this.uint16[E+1]=m,this.uint16[E+2]=b,s}}O.prototype.bytesPerElement=6,li("StructArrayLayout3ui6",O);class N extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se){const He=this.length;return this.resize(He+1),this.emplace(He,s,u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se)}emplace(s,u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se,He){const ke=24*s,K=12*s,Ae=48*s;return this.int16[ke+0]=u,this.int16[ke+1]=m,this.uint16[ke+2]=b,this.uint16[ke+3]=E,this.uint32[K+2]=C,this.uint32[K+3]=D,this.uint32[K+4]=L,this.uint16[ke+10]=U,this.uint16[ke+11]=H,this.uint16[ke+12]=q,this.float32[K+7]=Q,this.float32[K+8]=J,this.uint8[Ae+36]=te,this.uint8[Ae+37]=oe,this.uint8[Ae+38]=pe,this.uint32[K+10]=Se,this.int16[ke+22]=He,s}}N.prototype.bytesPerElement=48,li("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",N);class j extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se,He,ke,K,Ae,Be,ft,Dt,mt,wt,Wt,Bt){const $t=this.length;return this.resize($t+1),this.emplace($t,s,u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se,He,ke,K,Ae,Be,ft,Dt,mt,wt,Wt,Bt)}emplace(s,u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se,He,ke,K,Ae,Be,ft,Dt,mt,wt,Wt,Bt,$t){const Et=32*s,fi=16*s;return this.int16[Et+0]=u,this.int16[Et+1]=m,this.int16[Et+2]=b,this.int16[Et+3]=E,this.int16[Et+4]=C,this.int16[Et+5]=D,this.int16[Et+6]=L,this.int16[Et+7]=U,this.uint16[Et+8]=H,this.uint16[Et+9]=q,this.uint16[Et+10]=Q,this.uint16[Et+11]=J,this.uint16[Et+12]=te,this.uint16[Et+13]=oe,this.uint16[Et+14]=pe,this.uint16[Et+15]=Se,this.uint16[Et+16]=He,this.uint16[Et+17]=ke,this.uint16[Et+18]=K,this.uint16[Et+19]=Ae,this.uint16[Et+20]=Be,this.uint16[Et+21]=ft,this.uint16[Et+22]=Dt,this.uint32[fi+12]=mt,this.float32[fi+13]=wt,this.float32[fi+14]=Wt,this.uint16[Et+30]=Bt,this.uint16[Et+31]=$t,s}}j.prototype.bytesPerElement=64,li("StructArrayLayout8i15ui1ul2f2ui64",j);class Z extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}Z.prototype.bytesPerElement=4,li("StructArrayLayout1f4",Z);class Y extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,m)}emplace(s,u,m,b){const E=3*s;return this.uint16[6*s+0]=u,this.float32[E+1]=m,this.float32[E+2]=b,s}}Y.prototype.bytesPerElement=12,li("StructArrayLayout1ui2f12",Y);class G extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,m){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,m)}emplace(s,u,m,b){const E=4*s;return this.uint32[2*s+0]=u,this.uint16[E+2]=m,this.uint16[E+3]=b,s}}G.prototype.bytesPerElement=8,li("StructArrayLayout1ul2ui8",G);class re extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const m=this.length;return this.resize(m+1),this.emplace(m,s,u)}emplace(s,u,m){const b=2*s;return this.uint16[b+0]=u,this.uint16[b+1]=m,s}}re.prototype.bytesPerElement=4,li("StructArrayLayout2ui4",re);class ne extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}ne.prototype.bytesPerElement=2,li("StructArrayLayout1ui2",ne);class be extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,m,b){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,m,b)}emplace(s,u,m,b,E){const C=4*s;return this.float32[C+0]=u,this.float32[C+1]=m,this.float32[C+2]=b,this.float32[C+3]=E,s}}be.prototype.bytesPerElement=16,li("StructArrayLayout4f16",be);class ye extends Jr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ee(this.anchorPointX,this.anchorPointY)}}ye.prototype.size=20;class ve extends _{get(s){return new ye(this,s)}}li("CollisionBoxArray",ve);class Re extends Jr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Re.prototype.size=48;class Le extends N{get(s){return new Re(this,s)}}li("PlacedSymbolArray",Le);class Oe extends Jr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Oe.prototype.size=64;class ze extends j{get(s){return new Oe(this,s)}}li("SymbolInstanceArray",ze);class Xe extends Z{getoffsetX(s){return this.float32[1*s+0]}}li("GlyphOffsetArray",Xe);class Ve extends yu{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}li("SymbolLineVertexArray",Ve);class ct extends Jr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ct.prototype.size=12;class St extends Y{get(s){return new ct(this,s)}}li("TextAnchorOffsetArray",St);class yt extends Jr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}yt.prototype.size=8;class bt extends G{get(s){return new yt(this,s)}}li("FeatureIndexArray",bt);class xt extends _u{}class ti extends _u{}class Kt extends _u{}class Ot extends kf{}class di extends Df{}class er extends wc{}class cr extends Bf{}class Gr extends T{}class kr extends n{}class Yr extends l{}class Qr extends y{}class Or extends M{}class yr extends O{}class In extends re{}const Bn=Xr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qn}=Bn;class br{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,u,m,b){const E=this.segments[this.segments.length-1];return s>br.MAX_VERTEX_ARRAY_LENGTH&&sr(`Max vertices per segment is ${br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${br.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+s>br.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==b?this.createNewSegment(u,m,b):E}createNewSegment(s,u,m){const b={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return m!==void 0&&(b.sortKey=m),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(b),b}getOrCreateLatestSegment(s,u,m){return this.prepareSegment(0,s,u,m)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,m,b){return new br([{vertexOffset:s,primitiveOffset:u,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function tl(h,s){return 256*(h=oi(Math.floor(h),0,255))+oi(Math.floor(s),0,255)}br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,li("SegmentVector",br);const jo=Xr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var il,Ll,bu,rl={exports:{}},Fl={exports:{}},$s={exports:{}},nl=function(){if(bu)return rl.exports;bu=1;var h=(il||(il=1,Fl.exports=function(u,m){var b,E,C,D,L,U,H,q;for(E=u.length-(b=3&u.length),C=m,L=3432918353,U=461845907,q=0;q<E;)H=255&u.charCodeAt(q)|(255&u.charCodeAt(++q))<<8|(255&u.charCodeAt(++q))<<16|(255&u.charCodeAt(++q))<<24,++q,C=27492+(65535&(D=5*(65535&(C=(C^=H=(65535&(H=(H=(65535&H)*L+(((H>>>16)*L&65535)<<16)&4294967295)<<15|H>>>17))*U+(((H>>>16)*U&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(H=0,b){case 3:H^=(255&u.charCodeAt(q+2))<<16;case 2:H^=(255&u.charCodeAt(q+1))<<8;case 1:C^=H=(65535&(H=(H=(65535&(H^=255&u.charCodeAt(q)))*L+(((H>>>16)*L&65535)<<16)&4294967295)<<15|H>>>17))*U+(((H>>>16)*U&65535)<<16)&4294967295}return C^=u.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0}),Fl.exports),s=(Ll||(Ll=1,$s.exports=function(u,m){for(var b,E=u.length,C=m^E,D=0;E>=4;)b=1540483477*(65535&(b=255&u.charCodeAt(D)|(255&u.charCodeAt(++D))<<8|(255&u.charCodeAt(++D))<<16|(255&u.charCodeAt(++D))<<24))+((1540483477*(b>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),E-=4,++D;switch(E){case 3:C^=(255&u.charCodeAt(D+2))<<16;case 2:C^=(255&u.charCodeAt(D+1))<<8;case 1:C=1540483477*(65535&(C^=255&u.charCodeAt(D)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0}),$s.exports);return rl.exports=h,rl.exports.murmur3=h,rl.exports.murmur2=s,rl.exports}(),xa=w(nl);class sl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,u,m,b){this.ids.push(mn(s)),this.positions.push(u,m,b)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=mn(s);let m=0,b=this.ids.length-1;for(;m<b;){const C=m+b>>1;this.ids[C]>=u?b=C:m=C+1}const E=[];for(;this.ids[m]===u;)E.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return E}static serialize(s,u){const m=new Float64Array(s.ids),b=new Uint32Array(s.positions);return _n(m,b,0,m.length-1),u&&u.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(s){const u=new sl;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u}}function mn(h){const s=+h;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:xa(String(h))}function _n(h,s,u,m){for(;u<m;){const b=h[u+m>>1];let E=u-1,C=m+1;for(;;){do E++;while(h[E]<b);do C--;while(h[C]>b);if(E>=C)break;Ss(h,E,C),Ss(s,3*E,3*C),Ss(s,3*E+1,3*C+1),Ss(s,3*E+2,3*C+2)}C-u<m-C?(_n(h,s,u,C),u=C+1):(_n(h,s,C+1,m),m=C)}}function Ss(h,s,u){const m=h[s];h[s]=h[u],h[u]=m}li("FeaturePositionMap",sl);class Nr{constructor(s,u){this.gl=s.gl,this.location=u}}class gh extends Nr{constructor(s,u){super(s,u),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class nd extends Nr{constructor(s,u){super(s,u),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class sd extends Nr{constructor(s,u){super(s,u),this.current=ir.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const w0=new Float32Array(16);function Of(h){return[tl(255*h.r,255*h.g),tl(255*h.b,255*h.a)]}class vu{constructor(s,u,m){this.value=s,this.uniformNames=u.map(b=>`u_${b}`),this.type=m}setUniform(s,u,m){s.set(m.constantOr(this.value))}getBinding(s,u,m){return this.type==="color"?new sd(s,u):new gh(s,u)}}class io{constructor(s,u){this.uniformNames=u.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr}setUniform(s,u,m,b){const E=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&s.set(E)}getBinding(s,u,m){return m.substr(0,9)==="u_pattern"?new nd(s,u):new gh(s,u)}}class Vo{constructor(s,u,m,b){this.expression=s,this.type=m,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(s,u,m,b,E){const C=this.paintVertexArray.length,D=this.expression.evaluate(new Ze(0),u,{},b,[],E);this.paintVertexArray.resize(s),this._setPaintValue(C,s,D)}updatePaintArray(s,u,m,b){const E=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(s,u,E)}_setPaintValue(s,u,m){if(this.type==="color"){const b=Of(m);for(let E=s;E<u;E++)this.paintVertexArray.emplace(E,b[0],b[1])}else{for(let b=s;b<u;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ro{constructor(s,u,m,b,E,C){this.expression=s,this.uniformNames=u.map(D=>`u_${D}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(D=>({name:`a_${D}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(s,u,m,b,E){const C=this.expression.evaluate(new Ze(this.zoom),u,{},b,[],E),D=this.expression.evaluate(new Ze(this.zoom+1),u,{},b,[],E),L=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(L,s,C,D)}updatePaintArray(s,u,m,b){const E=this.expression.evaluate({zoom:this.zoom},m,b),C=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(s,u,E,C)}_setPaintValue(s,u,m,b){if(this.type==="color"){const E=Of(m),C=Of(b);for(let D=s;D<u;D++)this.paintVertexArray.emplace(D,E[0],E[1],C[0],C[1])}else{for(let E=s;E<u;E++)this.paintVertexArray.emplace(E,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=oi(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);s.set(b)}getBinding(s,u,m){return new gh(s,u)}}class wa{constructor(s,u,m,b,E,C){this.expression=s,this.type=u,this.useIntegerZoom=m,this.zoom=b,this.layerId=C,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(s,u,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(b,s,u.patterns&&u.patterns[this.layerId],m)}updatePaintArray(s,u,m,b,E){this._setPaintValues(s,u,m.patterns&&m.patterns[this.layerId],E)}_setPaintValues(s,u,m,b){if(!b||!m)return;const{min:E,mid:C,max:D}=m,L=b[E],U=b[C],H=b[D];if(L&&U&&H)for(let q=s;q<u;q++)this.zoomInPaintVertexArray.emplace(q,U.tl[0],U.tl[1],U.br[0],U.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],U.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(q,U.tl[0],U.tl[1],U.br[0],U.br[1],H.tl[0],H.tl[1],H.br[0],H.br[1],U.pixelRatio,H.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,jo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,jo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class mh{constructor(s,u,m){this.binders={},this._buffers=[];const b=[];for(const E in s.paint._values){if(!m(E))continue;const C=s.paint.get(E);if(!(C instanceof ai&&pa(C.property.specification)))continue;const D=Lf(E,s.type),L=C.value,U=C.property.specification.type,H=C.property.useIntegerZoom,q=C.property.specification["property-type"],Q=q==="cross-faded"||q==="cross-faded-data-driven";if(L.kind==="constant")this.binders[E]=Q?new io(L.value,D):new vu(L.value,D,U),b.push(`/u_${E}`);else if(L.kind==="source"||Q){const J=Ay(E,U,"source");this.binders[E]=Q?new wa(L,U,H,u,J,s.id):new Vo(L,D,U,J),b.push(`/a_${E}`)}else{const J=Ay(E,U,"composite");this.binders[E]=new ro(L,D,U,H,u,J),b.push(`/z_${E}`)}}this.cacheKey=b.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof Vo||u instanceof ro?u.maxValue:0}populatePaintArrays(s,u,m,b,E){for(const C in this.binders){const D=this.binders[C];(D instanceof Vo||D instanceof ro||D instanceof wa)&&D.populatePaintArray(s,u,m,b,E)}}setConstantPatternPositions(s,u){for(const m in this.binders){const b=this.binders[m];b instanceof io&&b.setConstantPatternPositions(s,u)}}updatePaintArrays(s,u,m,b,E){let C=!1;for(const D in s){const L=u.getPositions(D);for(const U of L){const H=m.feature(U.index);for(const q in this.binders){const Q=this.binders[q];if((Q instanceof Vo||Q instanceof ro||Q instanceof wa)&&Q.expression.isStateDependent===!0){const J=b.paint.get(q);Q.expression=J.value,Q.updatePaintArray(U.start,U.end,H,s[D],E),C=!0}}}}return C}defines(){const s=[];for(const u in this.binders){const m=this.binders[u];(m instanceof vu||m instanceof io)&&s.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return s}getBinderAttributes(){const s=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Vo||m instanceof ro)for(let b=0;b<m.paintVertexAttributes.length;b++)s.push(m.paintVertexAttributes[b].name);else if(m instanceof wa)for(let b=0;b<jo.members.length;b++)s.push(jo.members[b].name)}return s}getBinderUniforms(){const s=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof vu||m instanceof io||m instanceof ro)for(const b of m.uniformNames)s.push(b)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,u){const m=[];for(const b in this.binders){const E=this.binders[b];if(E instanceof vu||E instanceof io||E instanceof ro){for(const C of E.uniformNames)if(u[C]){const D=E.getBinding(s,u[C],C);m.push({name:C,property:b,binding:D})}}}return m}setUniforms(s,u,m,b){for(const{name:E,property:C,binding:D}of u)this.binders[C].setUniform(D,b,m.get(C),E)}updatePaintBuffers(s){this._buffers=[];for(const u in this.binders){const m=this.binders[u];if(s&&m instanceof wa){const b=s.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof Vo||m instanceof ro)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(s){for(const u in this.binders){const m=this.binders[u];(m instanceof Vo||m instanceof ro||m instanceof wa)&&m.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof Vo||u instanceof ro||u instanceof wa)&&u.destroy()}}}class ol{constructor(s,u,m=()=>!0){this.programConfigurations={};for(const b of s)this.programConfigurations[b.id]=new mh(b,u,m);this.needsUpload=!1,this._featureMap=new sl,this._bufferOffset=0}populatePaintArrays(s,u,m,b,E,C){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(s,u,b,E,C);u.id!==void 0&&this._featureMap.add(u.id,m,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,m,b){for(const E of m)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(s,this._featureMap,u,E,b)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function Lf(h,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${s}-`,"").replace(/-/g,"_")]}function Ay(h,s,u){const m={color:{source:wc,composite:be},number:{source:Z,composite:wc}},b=function(E){return{"line-pattern":{source:cr,composite:cr},"fill-pattern":{source:cr,composite:cr},"fill-extrusion-pattern":{source:cr,composite:cr}}[E]}(h);return b&&b[u]||m[s][u]}li("ConstantBinder",vu),li("CrossFadedConstantBinder",io),li("SourceExpressionBinder",Vo),li("CrossFadedCompositeBinder",wa),li("CompositeExpressionBinder",ro),li("ProgramConfiguration",mh,{omit:["_buffers"]}),li("ProgramConfigurationSet",ol);const T0=Math.pow(2,14)-1,dy=-T0-1;function xu(h){const s=Me/h.extent,u=h.loadGeometry();for(let m=0;m<u.length;m++){const b=u[m];for(let E=0;E<b.length;E++){const C=b[E],D=Math.round(C.x*s),L=Math.round(C.y*s);C.x=oi(D,dy,T0),C.y=oi(L,dy,T0),(D<C.x||D>C.x+1||L<C.y||L>C.y+1)&&sr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function wu(h,s){return{type:h.type,id:h.id,properties:h.properties,geometry:s?xu(h):[]}}const py=-32768;function ZT(h,s,u,m,b){h.emplaceBack(py+8*s+m,py+8*u+b)}class S0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ti,this.indexArray=new yr,this.segments=new br,this.programConfigurations=new ol(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,m){const b=this.layers[0],E=[];let C=null,D=!1,L=b.type==="heatmap";if(b.type==="circle"){const H=b;C=H.layout.get("circle-sort-key"),D=!C.isConstant(),L=L||H.paint.get("circle-pitch-alignment")==="map"}const U=L?u.subdivisionGranularity.circle:1;for(const{feature:H,id:q,index:Q,sourceLayerIndex:J}of s){const te=this.layers[0]._featureFilter.needGeometry,oe=wu(H,te);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),oe,m))continue;const pe=D?C.evaluate(oe,{},m):void 0,Se={id:q,properties:H.properties,type:H.type,sourceLayerIndex:J,index:Q,geometry:te?oe.geometry:xu(H),patterns:{},sortKey:pe};E.push(Se)}D&&E.sort((H,q)=>H.sortKey-q.sortKey);for(const H of E){const{geometry:q,index:Q,sourceLayerIndex:J}=H,te=s[Q].feature;this.addFeature(H,q,Q,m,U),u.featureIndex.insert(te,q,Q,J,this.index)}}update(s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Qn),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,m,b,E=1){let C;switch(E){case 1:C=[0,7];break;case 3:C=[0,2,5,7];break;case 5:C=[0,1,3,4,6,7];break;case 7:C=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const D=C.length;for(const L of u)for(const U of L){const H=U.x,q=U.y;if(H<0||H>=Me||q<0||q>=Me)continue;const Q=this.segments.prepareSegment(D*D,this.layoutVertexArray,this.indexArray,s.sortKey),J=Q.vertexLength;for(let te=0;te<D;te++)for(let oe=0;oe<D;oe++)ZT(this.layoutVertexArray,H,q,C[oe],C[te]);for(let te=0;te<D-1;te++)for(let oe=0;oe<D-1;oe++){const pe=J+te*D+oe,Se=J+(te+1)*D+oe;this.indexArray.emplaceBack(pe,Se+1,pe+1),this.indexArray.emplaceBack(pe,Se,Se+1)}Q.vertexLength+=D*D,Q.primitiveLength+=(D-1)*(D-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,{},b)}}function gy(h,s){for(let u=0;u<h.length;u++)if(Tu(s,h[u]))return!0;for(let u=0;u<s.length;u++)if(Tu(h,s[u]))return!0;return!!E0(h,s)}function qT(h,s,u){return!!Tu(h,s)||!!C0(s,h,u)}function my(h,s){if(h.length===1)return yy(s,h[0]);for(let u=0;u<s.length;u++){const m=s[u];for(let b=0;b<m.length;b++)if(Tu(h,m[b]))return!0}for(let u=0;u<h.length;u++)if(yy(s,h[u]))return!0;for(let u=0;u<s.length;u++)if(E0(h,s[u]))return!0;return!1}function XT(h,s,u){if(h.length>1){if(E0(h,s))return!0;for(let m=0;m<s.length;m++)if(C0(s[m],h,u))return!0}for(let m=0;m<h.length;m++)if(C0(h[m],s,u))return!0;return!1}function E0(h,s){if(h.length===0||s.length===0)return!1;for(let u=0;u<h.length-1;u++){const m=h[u],b=h[u+1];for(let E=0;E<s.length-1;E++)if(GT(m,b,s[E],s[E+1]))return!0}return!1}function GT(h,s,u,m){return ur(h,u,m)!==ur(s,u,m)&&ur(h,s,u)!==ur(h,s,m)}function C0(h,s,u){const m=u*u;if(s.length===1)return h.distSqr(s[0])<m;for(let b=1;b<s.length;b++)if(_y(h,s[b-1],s[b])<m)return!0;return!1}function _y(h,s,u){const m=s.distSqr(u);if(m===0)return h.distSqr(s);const b=((h.x-s.x)*(u.x-s.x)+(h.y-s.y)*(u.y-s.y))/m;return h.distSqr(b<0?s:b>1?u:u.sub(s)._mult(b)._add(s))}function yy(h,s){for(let u=0;u<h.length;u++)if(Tu(h[u],s))return!0;return!1}function Tu(h,s){let u=!1;for(let m=0,b=h.length-1;m<h.length;b=m++){const E=h[m],C=h[b];E.y>s.y!=C.y>s.y&&s.x<(C.x-E.x)*(s.y-E.y)/(C.y-E.y)+E.x&&(u=!u)}return u}function YT(h,s,u){const m=u[0],b=u[2];if(h.x<m.x&&s.x<m.x||h.x>b.x&&s.x>b.x||h.y<m.y&&s.y<m.y||h.y>b.y&&s.y>b.y)return!1;const E=ur(h,s,u[0]);return E!==ur(h,s,u[1])||E!==ur(h,s,u[2])||E!==ur(h,s,u[3])}function Ff(h,s,u){const m=s.paint.get(h).value;return m.kind==="constant"?m.value:u.programConfigurations.get(s.id).getMaxValue(h)}function od(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function ad(h,s,u,m,b){if(!s[0]&&!s[1])return h;const E=ee.convert(s)._mult(b);u==="viewport"&&E._rotate(-m);const C=[];for(let D=0;D<h.length;D++)C.push(h[D].sub(E));return C}let by,vy;li("CircleBucket",S0,{omit:["layers"]});var QT={get paint(){return vy=vy||new bi({"circle-radius":new Gt(ge.paint_circle["circle-radius"]),"circle-color":new Gt(ge.paint_circle["circle-color"]),"circle-blur":new Gt(ge.paint_circle["circle-blur"]),"circle-opacity":new Gt(ge.paint_circle["circle-opacity"]),"circle-translate":new Ft(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return by=by||new bi({"circle-sort-key":new Gt(ge.layout_circle["circle-sort-key"])})}};class KT extends Ii{constructor(s){super(s,QT)}createBucket(s){return new S0(s)}queryRadius(s){const u=s;return Ff("circle-radius",this,u)+Ff("circle-stroke-width",this,u)+od(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:u,featureState:m,geometry:b,transform:E,pixelsToTileUnits:C,unwrappedTileID:D,getElevation:L}){const U=ad(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,C),H=this.paint.get("circle-radius").evaluate(u,m)+this.paint.get("circle-stroke-width").evaluate(u,m),q=this.paint.get("circle-pitch-alignment")==="map",Q=q?U:function(te,oe,pe,Se){return te.map(He=>xy(He,oe,pe,Se))}(U,E,D,L),J=q?H*C:H;for(const te of b)for(const oe of te){const pe=q?oe:xy(oe,E,D,L);let Se=J;const He=E.projectTileCoordinates(oe.x,oe.y,D,L).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Se*=He/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Se*=E.cameraToCenterDistance/He),qT(Q,pe,Se))return!0}return!1}}function xy(h,s,u,m){const b=s.projectTileCoordinates(h.x,h.y,u,m).point;return new ee((.5*b.x+.5)*s.width,(.5*-b.y+.5)*s.height)}class wy extends S0{}let Ty;li("HeatmapBucket",wy,{omit:["layers"]});var JT={get paint(){return Ty=Ty||new bi({"heatmap-radius":new Gt(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ht(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(ge.paint_heatmap["heatmap-opacity"])})}};function I0(h,{width:s,height:u},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==s*u*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${s*u*m}`)}else b=new Uint8Array(s*u*m);return h.width=s,h.height=u,h.data=b,h}function Sy(h,{width:s,height:u},m){if(s===h.width&&u===h.height)return;const b=I0({},{width:s,height:u},m);P0(h,b,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,s),height:Math.min(h.height,u)},m),h.width=s,h.height=u,h.data=b.data}function P0(h,s,u,m,b,E){if(b.width===0||b.height===0)return s;if(b.width>h.width||b.height>h.height||u.x>h.width-b.width||u.y>h.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>s.width||b.height>s.height||m.x>s.width-b.width||m.y>s.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const C=h.data,D=s.data;if(C===D)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<b.height;L++){const U=((u.y+L)*h.width+u.x)*E,H=((m.y+L)*s.width+m.x)*E;for(let q=0;q<b.width*E;q++)D[H+q]=C[U+q]}return s}class Nf{constructor(s,u){I0(this,s,1,u)}resize(s){Sy(this,s,1)}clone(){return new Nf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,m,b,E){P0(s,u,m,b,E,1)}}class _o{constructor(s,u){I0(this,s,4,u)}resize(s){Sy(this,s,4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,m,b,E){P0(s,u,m,b,E,4)}}function Ey(h){const s={},u=h.resolution||256,m=h.clips?h.clips.length:1,b=h.image||new _o({width:u,height:m});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const E=(C,D,L)=>{s[h.evaluationKey]=L;const U=h.expression.evaluate(s);b.data[C+D+0]=Math.floor(255*U.r/U.a),b.data[C+D+1]=Math.floor(255*U.g/U.a),b.data[C+D+2]=Math.floor(255*U.b/U.a),b.data[C+D+3]=Math.floor(255*U.a)};if(h.clips)for(let C=0,D=0;C<m;++C,D+=4*u)for(let L=0,U=0;L<u;L++,U+=4){const H=L/(u-1),{start:q,end:Q}=h.clips[C];E(D,U,q*(1-H)+Q*H)}else for(let C=0,D=0;C<u;C++,D+=4)E(0,D,C/(u-1));return b}li("AlphaImage",Nf),li("RGBAImage",_o);const M0="big-fb";class eS extends Ii{createBucket(s){return new wy(s)}constructor(s){super(s,JT),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ey({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(M0)&&this.heatmapFbos.delete(M0)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Cy;var tS={get paint(){return Cy=Cy||new bi({"hillshade-illumination-direction":new Ft(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ft(ge.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ft(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(ge.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ft(ge.paint_hillshade["hillshade-method"])})}};class iS extends Ii{constructor(s){super(s,tS),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let s=this.paint.get("hillshade-illumination-direction").values,u=this.paint.get("hillshade-illumination-altitude").values,m=this.paint.get("hillshade-highlight-color").values,b=this.paint.get("hillshade-shadow-color").values;const E=Math.max(s.length,u.length,m.length,b.length);s=s.concat(Array(E-s.length).fill(s.at(-1))),u=u.concat(Array(E-u.length).fill(u.at(-1))),m=m.concat(Array(E-m.length).fill(m.at(-1))),b=b.concat(Array(E-b.length).fill(b.at(-1)));const C=u.map(rs);return{directionRadians:s.map(rs),altitudeRadians:C,shadowColor:b,highlightColor:m}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const rS=Xr([{name:"a_pos",components:2,type:"Int16"}],4),{members:nS}=rS;function R0(h,s,u){const m=u.patternDependencies;let b=!1;for(const E of s){const C=E.paint.get(`${h}-pattern`);C.isConstant()||(b=!0);const D=C.constantOr(null);D&&(b=!0,m[D.to]=!0,m[D.from]=!0)}return b}function k0(h,s,u,m,b){const E=b.patternDependencies;for(const C of s){const D=C.paint.get(`${h}-pattern`).value;if(D.kind!=="constant"){let L=D.evaluate({zoom:m-1},u,{},b.availableImages),U=D.evaluate({zoom:m},u,{},b.availableImages),H=D.evaluate({zoom:m+1},u,{},b.availableImages);L=L&&L.name?L.name:L,U=U&&U.name?U.name:U,H=H&&H.name?H.name:H,E[L]=!0,E[U]=!0,E[H]=!0,u.patterns[C.id]={min:L,mid:U,max:H}}}return u}function Iy(h,s,u,m,b){let E;if(b===function(C,D,L,U){let H=0;for(let q=D,Q=L-U;q<L;q+=U)H+=(C[Q]-C[q])*(C[q+1]+C[Q+1]),Q=q;return H}(h,s,u,m)>0)for(let C=s;C<u;C+=m)E=ky(C/m|0,h[C],h[C+1],E);else for(let C=u-m;C>=s;C-=m)E=ky(C/m|0,h[C],h[C+1],E);return E&&_h(E,E.next)&&(Vf(E),E=E.next),E}function Su(h,s){if(!h)return h;s||(s=h);let u,m=h;do if(u=!1,m.steiner||!_h(m,m.next)&&un(m.prev,m,m.next)!==0)m=m.next;else{if(Vf(m),m=s=m.prev,m===m.next)break;u=!0}while(u||m!==s);return s}function zf(h,s,u,m,b,E,C){if(!h)return;!C&&E&&function(L,U,H,q){let Q=L;do Q.z===0&&(Q.z=D0(Q.x,Q.y,U,H,q)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==L);Q.prevZ.nextZ=null,Q.prevZ=null,function(J){let te,oe=1;do{let pe,Se=J;J=null;let He=null;for(te=0;Se;){te++;let ke=Se,K=0;for(let Be=0;Be<oe&&(K++,ke=ke.nextZ,ke);Be++);let Ae=oe;for(;K>0||Ae>0&&ke;)K!==0&&(Ae===0||!ke||Se.z<=ke.z)?(pe=Se,Se=Se.nextZ,K--):(pe=ke,ke=ke.nextZ,Ae--),He?He.nextZ=pe:J=pe,pe.prevZ=He,He=pe;Se=ke}He.nextZ=null,oe*=2}while(te>1)}(Q)}(h,m,b,E);let D=h;for(;h.prev!==h.next;){const L=h.prev,U=h.next;if(E?oS(h,m,b,E):sS(h))s.push(L.i,h.i,U.i),Vf(h),h=U.next,D=U.next;else if((h=U)===D){C?C===1?zf(h=aS(Su(h),s),s,u,m,b,E,2):C===2&&lS(h,s,u,m,b,E):zf(Su(h),s,u,m,b,E,1);break}}}function sS(h){const s=h.prev,u=h,m=h.next;if(un(s,u,m)>=0)return!1;const b=s.x,E=u.x,C=m.x,D=s.y,L=u.y,U=m.y,H=Math.min(b,E,C),q=Math.min(D,L,U),Q=Math.max(b,E,C),J=Math.max(D,L,U);let te=m.next;for(;te!==s;){if(te.x>=H&&te.x<=Q&&te.y>=q&&te.y<=J&&Uf(b,D,E,L,C,U,te.x,te.y)&&un(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function oS(h,s,u,m){const b=h.prev,E=h,C=h.next;if(un(b,E,C)>=0)return!1;const D=b.x,L=E.x,U=C.x,H=b.y,q=E.y,Q=C.y,J=Math.min(D,L,U),te=Math.min(H,q,Q),oe=Math.max(D,L,U),pe=Math.max(H,q,Q),Se=D0(J,te,s,u,m),He=D0(oe,pe,s,u,m);let ke=h.prevZ,K=h.nextZ;for(;ke&&ke.z>=Se&&K&&K.z<=He;){if(ke.x>=J&&ke.x<=oe&&ke.y>=te&&ke.y<=pe&&ke!==b&&ke!==C&&Uf(D,H,L,q,U,Q,ke.x,ke.y)&&un(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,K.x>=J&&K.x<=oe&&K.y>=te&&K.y<=pe&&K!==b&&K!==C&&Uf(D,H,L,q,U,Q,K.x,K.y)&&un(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;ke&&ke.z>=Se;){if(ke.x>=J&&ke.x<=oe&&ke.y>=te&&ke.y<=pe&&ke!==b&&ke!==C&&Uf(D,H,L,q,U,Q,ke.x,ke.y)&&un(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;K&&K.z<=He;){if(K.x>=J&&K.x<=oe&&K.y>=te&&K.y<=pe&&K!==b&&K!==C&&Uf(D,H,L,q,U,Q,K.x,K.y)&&un(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function aS(h,s){let u=h;do{const m=u.prev,b=u.next.next;!_h(m,b)&&My(m,u,u.next,b)&&jf(m,b)&&jf(b,m)&&(s.push(m.i,u.i,b.i),Vf(u),Vf(u.next),u=h=b),u=u.next}while(u!==h);return Su(u)}function lS(h,s,u,m,b,E){let C=h;do{let D=C.next.next;for(;D!==C.prev;){if(C.i!==D.i&&AS(C,D)){let L=Ry(C,D);return C=Su(C,C.next),L=Su(L,L.next),zf(C,s,u,m,b,E,0),void zf(L,s,u,m,b,E,0)}D=D.next}C=C.next}while(C!==h)}function cS(h,s){let u=h.x-s.x;return u===0&&(u=h.y-s.y,u===0)&&(u=(h.next.y-h.y)/(h.next.x-h.x)-(s.next.y-s.y)/(s.next.x-s.x)),u}function uS(h,s){const u=function(b,E){let C=E;const D=b.x,L=b.y;let U,H=-1/0;if(_h(b,C))return C;do{if(_h(b,C.next))return C.next;if(L<=C.y&&L>=C.next.y&&C.next.y!==C.y){const oe=C.x+(L-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(oe<=D&&oe>H&&(H=oe,U=C.x<C.next.x?C:C.next,oe===D))return U}C=C.next}while(C!==E);if(!U)return null;const q=U,Q=U.x,J=U.y;let te=1/0;C=U;do{if(D>=C.x&&C.x>=Q&&D!==C.x&&Py(L<J?D:H,L,Q,J,L<J?H:D,L,C.x,C.y)){const oe=Math.abs(L-C.y)/(D-C.x);jf(C,b)&&(oe<te||oe===te&&(C.x>U.x||C.x===U.x&&hS(U,C)))&&(U=C,te=oe)}C=C.next}while(C!==q);return U}(h,s);if(!u)return s;const m=Ry(u,h);return Su(m,m.next),Su(u,u.next)}function hS(h,s){return un(h.prev,h,s.prev)<0&&un(s.next,h,h.next)<0}function D0(h,s,u,m,b){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*b|0)|h<<8))|h<<4))|h<<2))|h<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-m)*b|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function fS(h){let s=h,u=h;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==h);return u}function Py(h,s,u,m,b,E,C,D){return(b-C)*(s-D)>=(h-C)*(E-D)&&(h-C)*(m-D)>=(u-C)*(s-D)&&(u-C)*(E-D)>=(b-C)*(m-D)}function Uf(h,s,u,m,b,E,C,D){return!(h===C&&s===D)&&Py(h,s,u,m,b,E,C,D)}function AS(h,s){return h.next.i!==s.i&&h.prev.i!==s.i&&!function(u,m){let b=u;do{if(b.i!==u.i&&b.next.i!==u.i&&b.i!==m.i&&b.next.i!==m.i&&My(b,b.next,u,m))return!0;b=b.next}while(b!==u);return!1}(h,s)&&(jf(h,s)&&jf(s,h)&&function(u,m){let b=u,E=!1;const C=(u.x+m.x)/2,D=(u.y+m.y)/2;do b.y>D!=b.next.y>D&&b.next.y!==b.y&&C<(b.next.x-b.x)*(D-b.y)/(b.next.y-b.y)+b.x&&(E=!E),b=b.next;while(b!==u);return E}(h,s)&&(un(h.prev,h,s.prev)||un(h,s.prev,s))||_h(h,s)&&un(h.prev,h,h.next)>0&&un(s.prev,s,s.next)>0)}function un(h,s,u){return(s.y-h.y)*(u.x-s.x)-(s.x-h.x)*(u.y-s.y)}function _h(h,s){return h.x===s.x&&h.y===s.y}function My(h,s,u,m){const b=cd(un(h,s,u)),E=cd(un(h,s,m)),C=cd(un(u,m,h)),D=cd(un(u,m,s));return b!==E&&C!==D||!(b!==0||!ld(h,u,s))||!(E!==0||!ld(h,m,s))||!(C!==0||!ld(u,h,m))||!(D!==0||!ld(u,s,m))}function ld(h,s,u){return s.x<=Math.max(h.x,u.x)&&s.x>=Math.min(h.x,u.x)&&s.y<=Math.max(h.y,u.y)&&s.y>=Math.min(h.y,u.y)}function cd(h){return h>0?1:h<0?-1:0}function jf(h,s){return un(h.prev,h,h.next)<0?un(h,s,h.next)>=0&&un(h,h.prev,s)>=0:un(h,s,h.prev)<0||un(h,h.next,s)<0}function Ry(h,s){const u=B0(h.i,h.x,h.y),m=B0(s.i,s.x,s.y),b=h.next,E=s.prev;return h.next=s,s.prev=h,u.next=b,b.prev=u,m.next=u,u.prev=m,E.next=m,m.prev=E,m}function ky(h,s,u,m){const b=B0(h,s,u);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Vf(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function B0(h,s,u){return{i:h,x:s,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class yh{constructor(s,u){if(u>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=u}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class ud{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}ud.noSubdivision=new ud({fill:new yh(0,0),line:new yh(0,0),tile:new yh(0,0),stencil:new yh(0,0),circle:1}),li("SubdivisionGranularityExpression",yh),li("SubdivisionGranularitySetting",ud);const bh=-32768,Wf=32767;class dS{constructor(s,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=Me/s,this._canonical=u}_getKey(s,u){return(s+=32768)<<16|(u+=32768)<<0}_vertexToIndex(s,u){if(s<-32768||u<-32768||s>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const m=0|Math.round(s),b=0|Math.round(u),E=this._getKey(m,b);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const C=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,C),this._vertexBuffer.push(m,b),C}_subdivideTrianglesScanline(s){if(this._granularity<2)return function(b,E){const C=[];for(let D=0;D<E.length;D+=3){const L=E[D],U=E[D+1],H=E[D+2],q=b[2*L],Q=b[2*L+1];(b[2*U]-q)*(b[2*H+1]-Q)-(b[2*U+1]-Q)*(b[2*H]-q)>0?(C.push(L),C.push(H),C.push(U)):(C.push(L),C.push(U),C.push(H))}return C}(this._vertexBuffer,s);const u=[],m=s.length;for(let b=0;b<m;b+=3){const E=[s[b+0],s[b+1],s[b+2]],C=[this._vertexBuffer[2*s[b+0]+0],this._vertexBuffer[2*s[b+0]+1],this._vertexBuffer[2*s[b+1]+0],this._vertexBuffer[2*s[b+1]+1],this._vertexBuffer[2*s[b+2]+0],this._vertexBuffer[2*s[b+2]+1]];let D=1/0,L=1/0,U=-1/0,H=-1/0;for(let oe=0;oe<3;oe++){const pe=C[2*oe],Se=C[2*oe+1];D=Math.min(D,pe),U=Math.max(U,pe),L=Math.min(L,Se),H=Math.max(H,Se)}if(D===U||L===H)continue;const q=Math.floor(D/this._granularityCellSize),Q=Math.ceil(U/this._granularityCellSize),J=Math.floor(L/this._granularityCellSize),te=Math.ceil(H/this._granularityCellSize);if(q!==Q||J!==te)for(let oe=J;oe<te;oe++){const pe=this._scanlineGenerateVertexRingForCellRow(oe,C,E);pS(this._vertexBuffer,pe,u)}else u.push(...E)}return u}_scanlineGenerateVertexRingForCellRow(s,u,m){const b=s*this._granularityCellSize,E=b+this._granularityCellSize,C=[];for(let D=0;D<3;D++){const L=u[2*D],U=u[2*D+1],H=u[2*(D+1)%6],q=u[(2*(D+1)+1)%6],Q=u[2*(D+2)%6],J=u[(2*(D+2)+1)%6],te=H-L,oe=q-U,pe=te===0,Se=oe===0,He=(b-U)/oe,ke=(E-U)/oe,K=Math.min(He,ke),Ae=Math.max(He,ke);if(!Se&&(K>=1||Ae<=0)||Se&&(U<b||U>E)){q>=b&&q<=E&&C.push(m[(D+1)%3]);continue}!Se&&K>0&&C.push(this._vertexToIndex(L+te*K,U+oe*K));const Be=L+te*Math.max(K,0),ft=L+te*Math.min(Ae,1);pe||this._generateIntraEdgeVertices(C,L,U,H,q,Be,ft),!Se&&Ae<1&&C.push(this._vertexToIndex(L+te*Ae,U+oe*Ae)),(Se||q>=b&&q<=E)&&C.push(m[(D+1)%3]),!Se&&(q<=b||q>=E)&&this._generateInterEdgeVertices(C,L,U,H,q,Q,J,ft,b,E)}return C}_generateIntraEdgeVertices(s,u,m,b,E,C,D){const L=b-u,U=E-m,H=U===0,q=H?Math.min(u,b):Math.min(C,D),Q=H?Math.max(u,b):Math.max(C,D),J=Math.floor(q/this._granularityCellSize)+1,te=Math.ceil(Q/this._granularityCellSize)-1;if(H?u<b:C<D)for(let oe=J;oe<=te;oe++){const pe=oe*this._granularityCellSize;s.push(this._vertexToIndex(pe,m+U*(pe-u)/L))}else for(let oe=te;oe>=J;oe--){const pe=oe*this._granularityCellSize;s.push(this._vertexToIndex(pe,m+U*(pe-u)/L))}}_generateInterEdgeVertices(s,u,m,b,E,C,D,L,U,H){const q=E-m,Q=C-b,J=D-E,te=(U-E)/J,oe=(H-E)/J,pe=Math.min(te,oe),Se=Math.max(te,oe),He=b+Q*pe;let ke=Math.floor(Math.min(He,L)/this._granularityCellSize)+1,K=Math.ceil(Math.max(He,L)/this._granularityCellSize)-1,Ae=L<He;const Be=J===0;if(Be&&(D===U||D===H))return;if(Be||pe>=1||Se<=0){const Dt=m-D,mt=C+(u-C)*Math.min((U-D)/Dt,(H-D)/Dt);ke=Math.floor(Math.min(mt,L)/this._granularityCellSize)+1,K=Math.ceil(Math.max(mt,L)/this._granularityCellSize)-1,Ae=L<mt}const ft=q>0?H:U;if(Ae)for(let Dt=ke;Dt<=K;Dt++)s.push(this._vertexToIndex(Dt*this._granularityCellSize,ft));else for(let Dt=K;Dt>=ke;Dt--)s.push(this._vertexToIndex(Dt*this._granularityCellSize,ft))}_generateOutline(s){const u=[];for(const m of s){const b=Eu(m,this._granularity,!0),E=this._pointArrayToIndices(b),C=[];for(let D=1;D<E.length;D++)C.push(E[D-1]),C.push(E[D]);u.push(C)}return u}_handlePoles(s){let u=!1,m=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(m=!0)),(u||m)&&this._fillPoles(s,u,m)}_ensureNoPoleVertices(){const s=this._vertexBuffer;for(let u=0;u<s.length;u+=2){const m=s[u+1];m===bh&&(s[u+1]=-32767),m===Wf&&(s[u+1]=32766)}}_generatePoleQuad(s,u,m,b,E,C){b>E!=(C===bh)?(s.push(u),s.push(m),s.push(this._vertexToIndex(b,C)),s.push(m),s.push(this._vertexToIndex(E,C)),s.push(this._vertexToIndex(b,C))):(s.push(m),s.push(u),s.push(this._vertexToIndex(b,C)),s.push(this._vertexToIndex(E,C)),s.push(m),s.push(this._vertexToIndex(b,C)))}_fillPoles(s,u,m){const b=this._vertexBuffer,E=Me,C=s.length;for(let D=2;D<C;D+=3){const L=s[D-2],U=s[D-1],H=s[D],q=b[2*L],Q=b[2*L+1],J=b[2*U],te=b[2*U+1],oe=b[2*H],pe=b[2*H+1];u&&(Q===0&&te===0&&this._generatePoleQuad(s,L,U,q,J,bh),te===0&&pe===0&&this._generatePoleQuad(s,U,H,J,oe,bh),pe===0&&Q===0&&this._generatePoleQuad(s,H,L,oe,q,bh)),m&&(Q===E&&te===E&&this._generatePoleQuad(s,L,U,q,J,Wf),te===E&&pe===E&&this._generatePoleQuad(s,U,H,J,oe,Wf),pe===E&&Q===E&&this._generatePoleQuad(s,H,L,oe,q,Wf))}}_initializeVertices(s){for(let u=0;u<s.length;u+=2)this._vertexToIndex(s[u],s[u+1])}subdividePolygonInternal(s,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:m,holeIndices:b}=function(D){const L=[],U=[];for(const H of D)if(H.length!==0){H!==D[0]&&L.push(U.length/2);for(let q=0;q<H.length;q++)U.push(H[q].x),U.push(H[q].y)}return{flattened:U,holeIndices:L}}(s);let E;this._initializeVertices(m);try{const D=function(U,H,q=2){const Q=H&&H.length,J=Q?H[0]*q:U.length;let te=Iy(U,0,J,q,!0);const oe=[];if(!te||te.next===te.prev)return oe;let pe,Se,He;if(Q&&(te=function(ke,K,Ae,Be){const ft=[];for(let Dt=0,mt=K.length;Dt<mt;Dt++){const wt=Iy(ke,K[Dt]*Be,Dt<mt-1?K[Dt+1]*Be:ke.length,Be,!1);wt===wt.next&&(wt.steiner=!0),ft.push(fS(wt))}ft.sort(cS);for(let Dt=0;Dt<ft.length;Dt++)Ae=uS(ft[Dt],Ae);return Ae}(U,H,te,q)),U.length>80*q){pe=1/0,Se=1/0;let ke=-1/0,K=-1/0;for(let Ae=q;Ae<J;Ae+=q){const Be=U[Ae],ft=U[Ae+1];Be<pe&&(pe=Be),ft<Se&&(Se=ft),Be>ke&&(ke=Be),ft>K&&(K=ft)}He=Math.max(ke-pe,K-Se),He=He!==0?32767/He:0}return zf(te,oe,q,pe,Se,He,0),oe}(m,b),L=this._convertIndices(m,D);E=this._subdivideTrianglesScanline(L)}catch(D){console.error(D)}let C=[];return u&&(C=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:C}}_convertIndices(s,u){const m=[];for(let b=0;b<u.length;b++)m.push(this._vertexToIndex(s[2*u[b]],s[2*u[b]+1]));return m}_pointArrayToIndices(s){const u=[];for(let m=0;m<s.length;m++){const b=s[m];u.push(this._vertexToIndex(b.x,b.y))}return u}}function Dy(h,s,u,m=!0){return new dS(u,s).subdividePolygonInternal(h,m)}function Eu(h,s,u=!1){if(!h||h.length<1)return[];if(h.length<2)return[];const m=h[0],b=h[h.length-1],E=u&&(m.x!==b.x||m.y!==b.y);if(s<2)return E?[...h,h[0]]:[...h];const C=Math.floor(Me/s),D=[];D.push(new ee(h[0].x,h[0].y));const L=h.length,U=E?L:L-1;for(let H=0;H<U;H++){const q=h[H],Q=H<L-1?h[H+1]:h[0],J=q.x,te=q.y,oe=Q.x,pe=Q.y,Se=J!==oe,He=te!==pe;if(!Se&&!He)continue;const ke=oe-J,K=pe-te,Ae=Math.abs(ke),Be=Math.abs(K);let ft=J,Dt=te;for(;;){const wt=ke>0?(Math.floor(ft/C)+1)*C:(Math.ceil(ft/C)-1)*C,Wt=K>0?(Math.floor(Dt/C)+1)*C:(Math.ceil(Dt/C)-1)*C,Bt=Math.abs(ft-wt),$t=Math.abs(Dt-Wt),Et=Math.abs(ft-oe),fi=Math.abs(Dt-pe),Si=Se?Bt/Ae:Number.POSITIVE_INFINITY,xi=He?$t/Be:Number.POSITIVE_INFINITY;if((Et<=Bt||!Se)&&(fi<=$t||!He))break;if(Si<xi&&Se||!He){ft=wt,Dt+=K*Si;const pi=new ee(ft,Math.round(Dt));D[D.length-1].x===pi.x&&D[D.length-1].y===pi.y||D.push(pi)}else{ft+=ke*xi,Dt=Wt;const pi=new ee(Math.round(ft),Dt);D[D.length-1].x===pi.x&&D[D.length-1].y===pi.y||D.push(pi)}}const mt=new ee(oe,pe);D[D.length-1].x===mt.x&&D[D.length-1].y===mt.y||D.push(mt)}return D}function pS(h,s,u){if(s.length===0)throw new Error("Subdivision vertex ring is empty.");let m=0,b=h[2*s[0]];for(let L=1;L<s.length;L++){const U=h[2*s[L]];U<b&&(b=U,m=L)}const E=s.length;let C=m,D=(C+1)%E;for(;;){const L=C-1>=0?C-1:E-1,U=(D+1)%E,H=h[2*s[L]],q=h[2*s[U]],Q=h[2*s[C]],J=h[2*s[C]+1],te=h[2*s[D]+1];let oe=!1;if(H<q)oe=!0;else if(H>q)oe=!1;else{const pe=te-J,Se=-(h[2*s[D]]-Q),He=J<te?1:-1;((H-Q)*pe+(h[2*s[L]+1]-J)*Se)*He>((q-Q)*pe+(h[2*s[U]+1]-J)*Se)*He&&(oe=!0)}if(oe){const pe=s[L],Se=s[C],He=s[D];pe!==Se&&pe!==He&&Se!==He&&u.push(He,Se,pe),C--,C<0&&(C=E-1)}else{const pe=s[U],Se=s[C],He=s[D];pe!==Se&&pe!==He&&Se!==He&&u.push(He,Se,pe),D++,D>=E&&(D=0)}if(L===U)break}}function By(h,s,u,m,b,E,C,D,L){const U=b.length/2,H=C&&D&&L;if(U<br.MAX_VERTEX_ARRAY_LENGTH){const q=s.prepareSegment(U,u,m),Q=q.vertexLength;for(let oe=0;oe<E.length;oe+=3)m.emplaceBack(Q+E[oe],Q+E[oe+1],Q+E[oe+2]);let J,te;q.vertexLength+=U,q.primitiveLength+=E.length/3,H&&(te=C.prepareSegment(U,u,D),J=te.vertexLength,te.vertexLength+=U);for(let oe=0;oe<b.length;oe+=2)h(b[oe],b[oe+1]);if(H)for(let oe=0;oe<L.length;oe++){const pe=L[oe];for(let Se=1;Se<pe.length;Se+=2)D.emplaceBack(J+pe[Se-1],J+pe[Se]);te.primitiveLength+=pe.length/2}}else(function(q,Q,J,te,oe,pe){const Se=[];for(let Be=0;Be<te.length/2;Be++)Se.push(-1);const He={count:0};let ke=0,K=q.getOrCreateLatestSegment(Q,J),Ae=K.vertexLength;for(let Be=2;Be<oe.length;Be+=3){const ft=oe[Be-2],Dt=oe[Be-1],mt=oe[Be];let wt=Se[ft]<ke,Wt=Se[Dt]<ke,Bt=Se[mt]<ke;K.vertexLength+((wt?1:0)+(Wt?1:0)+(Bt?1:0))>br.MAX_VERTEX_ARRAY_LENGTH&&(K=q.createNewSegment(Q,J),ke=He.count,wt=!0,Wt=!0,Bt=!0,Ae=0);const $t=Hf(Se,te,pe,He,ft,wt,K),Et=Hf(Se,te,pe,He,Dt,Wt,K),fi=Hf(Se,te,pe,He,mt,Bt,K);J.emplaceBack(Ae+$t-ke,Ae+Et-ke,Ae+fi-ke),K.primitiveLength++}})(s,u,m,b,E,h),H&&function(q,Q,J,te,oe,pe){const Se=[];for(let Be=0;Be<te.length/2;Be++)Se.push(-1);const He={count:0};let ke=0,K=q.getOrCreateLatestSegment(Q,J),Ae=K.vertexLength;for(let Be=0;Be<oe.length;Be++){const ft=oe[Be];for(let Dt=1;Dt<oe[Be].length;Dt+=2){const mt=ft[Dt-1],wt=ft[Dt];let Wt=Se[mt]<ke,Bt=Se[wt]<ke;K.vertexLength+((Wt?1:0)+(Bt?1:0))>br.MAX_VERTEX_ARRAY_LENGTH&&(K=q.createNewSegment(Q,J),ke=He.count,Wt=!0,Bt=!0,Ae=0);const $t=Hf(Se,te,pe,He,mt,Wt,K),Et=Hf(Se,te,pe,He,wt,Bt,K);J.emplaceBack(Ae+$t-ke,Ae+Et-ke),K.primitiveLength++}}}(C,u,D,b,L,h),s.forceNewSegmentOnNextPrepare(),C==null||C.forceNewSegmentOnNextPrepare()}function Hf(h,s,u,m,b,E,C){if(E){const D=m.count;return u(s[2*b],s[2*b+1]),h[b]=m.count,m.count++,C.vertexLength++,D}return h[b]}class O0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kt,this.indexArray=new yr,this.indexArray2=new In,this.programConfigurations=new ol(s.layers,s.zoom),this.segments=new br,this.segments2=new br,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,m){this.hasPattern=R0("fill",this.layers,u);const b=this.layers[0].layout.get("fill-sort-key"),E=!b.isConstant(),C=[];for(const{feature:D,id:L,index:U,sourceLayerIndex:H}of s){const q=this.layers[0]._featureFilter.needGeometry,Q=wu(D,q);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),Q,m))continue;const J=E?b.evaluate(Q,{},m,u.availableImages):void 0,te={id:L,properties:D.properties,type:D.type,sourceLayerIndex:H,index:U,geometry:q?Q.geometry:xu(D),patterns:{},sortKey:J};C.push(te)}E&&C.sort((D,L)=>D.sortKey-L.sortKey);for(const D of C){const{geometry:L,index:U,sourceLayerIndex:H}=D;if(this.hasPattern){const q=k0("fill",this.layers,D,this.zoom,u);this.patternFeatures.push(q)}else this.addFeature(D,L,U,m,{},u.subdivisionGranularity);u.featureIndex.insert(s[U].feature,L,U,H,this.index)}}update(s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,m)}addFeatures(s,u,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,u,m,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,nS),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,u,m,b,E,C){for(const D of Xa(u,500)){const L=Dy(D,b,C.fill.getGranularityForZoomLevel(b.z)),U=this.layoutVertexArray;By((H,q)=>{U.emplaceBack(H,q)},this.segments,this.layoutVertexArray,this.indexArray,L.verticesFlattened,L.indicesTriangles,this.segments2,this.indexArray2,L.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,E,b)}}let Oy,Ly;li("FillBucket",O0,{omit:["layers","patternFeatures"]});var gS={get paint(){return Ly=Ly||new bi({"fill-antialias":new Ft(ge.paint_fill["fill-antialias"]),"fill-opacity":new Gt(ge.paint_fill["fill-opacity"]),"fill-color":new Gt(ge.paint_fill["fill-color"]),"fill-outline-color":new Gt(ge.paint_fill["fill-outline-color"]),"fill-translate":new Ft(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ri(ge.paint_fill["fill-pattern"])})},get layout(){return Oy=Oy||new bi({"fill-sort-key":new Gt(ge.layout_fill["fill-sort-key"])})}};class mS extends Ii{constructor(s){super(s,gS)}recalculate(s,u){super.recalculate(s,u);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new O0(s)}queryRadius(){return od(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:u,transform:m,pixelsToTileUnits:b}){return my(ad(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-m.bearingInRadians,b),u)}isTileClipped(){return!0}}const _S=Xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),yS=Xr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bS}=_S;var L0,Fy,F0,Ny,N0,zy,Uy,hd={};function jy(){if(Fy)return L0;Fy=1;var h=F();function s(b,E,C,D,L){this.properties={},this.extent=C,this.type=0,this._pbf=b,this._geometry=-1,this._keys=D,this._values=L,b.readFields(u,this,E)}function u(b,E,C){b==1?E.id=C.readVarint():b==2?function(D,L){for(var U=D.readVarint()+D.pos;D.pos<U;){var H=L._keys[D.readVarint()],q=L._values[D.readVarint()];L.properties[H]=q}}(C,E):b==3?E.type=C.readVarint():b==4&&(E._geometry=C.pos)}function m(b){for(var E,C,D=0,L=0,U=b.length,H=U-1;L<U;H=L++)D+=((C=b[H]).x-(E=b[L]).x)*(E.y+C.y);return D}return L0=s,s.types=["Unknown","Point","LineString","Polygon"],s.prototype.loadGeometry=function(){var b=this._pbf;b.pos=this._geometry;for(var E,C=b.readVarint()+b.pos,D=1,L=0,U=0,H=0,q=[];b.pos<C;){if(L<=0){var Q=b.readVarint();D=7&Q,L=Q>>3}if(L--,D===1||D===2)U+=b.readSVarint(),H+=b.readSVarint(),D===1&&(E&&q.push(E),E=[]),E.push(new h(U,H));else{if(D!==7)throw new Error("unknown command "+D);E&&E.push(E[0].clone())}}return E&&q.push(E),q},s.prototype.bbox=function(){var b=this._pbf;b.pos=this._geometry;for(var E=b.readVarint()+b.pos,C=1,D=0,L=0,U=0,H=1/0,q=-1/0,Q=1/0,J=-1/0;b.pos<E;){if(D<=0){var te=b.readVarint();C=7&te,D=te>>3}if(D--,C===1||C===2)(L+=b.readSVarint())<H&&(H=L),L>q&&(q=L),(U+=b.readSVarint())<Q&&(Q=U),U>J&&(J=U);else if(C!==7)throw new Error("unknown command "+C)}return[H,Q,q,J]},s.prototype.toGeoJSON=function(b,E,C){var D,L,U=this.extent*Math.pow(2,C),H=this.extent*b,q=this.extent*E,Q=this.loadGeometry(),J=s.types[this.type];function te(Se){for(var He=0;He<Se.length;He++){var ke=Se[He];Se[He]=[360*(ke.x+H)/U-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+q)/U)*Math.PI/180))-90]}}switch(this.type){case 1:var oe=[];for(D=0;D<Q.length;D++)oe[D]=Q[D][0];te(Q=oe);break;case 2:for(D=0;D<Q.length;D++)te(Q[D]);break;case 3:for(Q=function(Se){var He=Se.length;if(He<=1)return[Se];for(var ke,K,Ae=[],Be=0;Be<He;Be++){var ft=m(Se[Be]);ft!==0&&(K===void 0&&(K=ft<0),K===ft<0?(ke&&Ae.push(ke),ke=[Se[Be]]):ke.push(Se[Be]))}return ke&&Ae.push(ke),Ae}(Q),D=0;D<Q.length;D++)for(L=0;L<Q[D].length;L++)te(Q[D][L])}Q.length===1?Q=Q[0]:J="Multi"+J;var pe={type:"Feature",geometry:{type:J,coordinates:Q},properties:this.properties};return"id"in this&&(pe.id=this.id),pe},L0}function Vy(){if(Ny)return F0;Ny=1;var h=jy();function s(m,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=m,this._keys=[],this._values=[],this._features=[],m.readFields(u,this,b),this.length=this._features.length}function u(m,b,E){m===15?b.version=E.readVarint():m===1?b.name=E.readString():m===5?b.extent=E.readVarint():m===2?b._features.push(E.pos):m===3?b._keys.push(E.readString()):m===4&&b._values.push(function(C){for(var D=null,L=C.readVarint()+C.pos;C.pos<L;){var U=C.readVarint()>>3;D=U===1?C.readString():U===2?C.readFloat():U===3?C.readDouble():U===4?C.readVarint64():U===5?C.readVarint():U===6?C.readSVarint():U===7?C.readBoolean():null}return D}(E))}return F0=s,s.prototype.feature=function(m){if(m<0||m>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[m];var b=this._pbf.readVarint()+this._pbf.pos;return new h(this._pbf,b,this.extent,this._keys,this._values)},F0}function Wy(){return Uy||(Uy=1,hd.VectorTile=function(){if(zy)return N0;zy=1;var h=Vy();function s(u,m,b){if(u===3){var E=new h(b,b.readVarint()+b.pos);E.length&&(m[E.name]=E)}}return N0=function(u,m){this.layers=u.readFields(s,{},m)},N0}(),hd.VectorTileFeature=jy(),hd.VectorTileLayer=Vy()),hd}var $f=w(Wy());const vS=$f.VectorTileFeature.types,z0=Math.pow(2,13);function Zf(h,s,u,m,b,E,C,D){h.emplaceBack(s,u,2*Math.floor(m*z0)+C,b*z0*2,E*z0*2,Math.round(D))}class U0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ot,this.centroidVertexArray=new xt,this.indexArray=new yr,this.programConfigurations=new ol(s.layers,s.zoom),this.segments=new br,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,m){this.features=[],this.hasPattern=R0("fill-extrusion",this.layers,u);for(const{feature:b,id:E,index:C,sourceLayerIndex:D}of s){const L=this.layers[0]._featureFilter.needGeometry,U=wu(b,L);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),U,m))continue;const H={id:E,sourceLayerIndex:D,index:C,geometry:L?U.geometry:xu(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(k0("fill-extrusion",this.layers,H,this.zoom,u)):this.addFeature(H,H.geometry,C,m,{},u.subdivisionGranularity),u.featureIndex.insert(b,H.geometry,C,D,this.index,!0)}}addFeatures(s,u,m){for(const b of this.features){const{geometry:E}=b;this.addFeature(b,E,b.index,u,m,s.subdivisionGranularity)}}update(s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,bS),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,yS.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,u,m,b,E,C){for(const D of Xa(u,500)){const L={x:0,y:0,sampleCount:0},U=this.layoutVertexArray.length;this.processPolygon(L,b,s,D,C);const H=this.layoutVertexArray.length-U,q=Math.floor(L.x/L.sampleCount),Q=Math.floor(L.y/L.sampleCount);for(let J=0;J<H;J++)this.centroidVertexArray.emplaceBack(q,Q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,E,b)}processPolygon(s,u,m,b,E){if(b.length<1||Hy(b[0]))return;for(const q of b)q.length!==0&&xS(s,q);const C={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},D=E.fill.getGranularityForZoomLevel(u.z),L=vS[m.type]==="Polygon";for(const q of b){if(q.length===0||Hy(q))continue;const Q=Eu(q,D,L);this._generateSideFaces(Q,C)}if(!L)return;const U=Dy(b,u,D,!1),H=this.layoutVertexArray;By((q,Q)=>{Zf(H,q,Q,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,U.verticesFlattened,U.indicesTriangles)}_generateSideFaces(s,u){let m=0;for(let b=1;b<s.length;b++){const E=s[b],C=s[b-1];if(wS(E,C))continue;u.segment.vertexLength+4>br.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const D=E.sub(C)._perp()._unit(),L=C.dist(E);m+L>32768&&(m=0),Zf(this.layoutVertexArray,E.x,E.y,D.x,D.y,0,0,m),Zf(this.layoutVertexArray,E.x,E.y,D.x,D.y,0,1,m),m+=L,Zf(this.layoutVertexArray,C.x,C.y,D.x,D.y,0,0,m),Zf(this.layoutVertexArray,C.x,C.y,D.x,D.y,0,1,m);const U=u.segment.vertexLength;this.indexArray.emplaceBack(U,U+2,U+1),this.indexArray.emplaceBack(U+1,U+2,U+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function xS(h,s){for(let u=0;u<s.length;u++){const m=s[u];u===s.length-1&&s[0].x===m.x&&s[0].y===m.y||(h.x+=m.x,h.y+=m.y,h.sampleCount++)}}function wS(h,s){return h.x===s.x&&(h.x<0||h.x>Me)||h.y===s.y&&(h.y<0||h.y>Me)}function Hy(h){return h.every(s=>s.x<0)||h.every(s=>s.x>Me)||h.every(s=>s.y<0)||h.every(s=>s.y>Me)}let $y;li("FillExtrusionBucket",U0,{omit:["layers","features"]});var TS={get paint(){return $y=$y||new bi({"fill-extrusion-opacity":new Ft(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ri(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class SS extends Ii{constructor(s){super(s,TS)}createBucket(s){return new U0(s)}queryRadius(){return od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:u,featureState:m,geometry:b,transform:E,pixelsToTileUnits:C,pixelPosMatrix:D}){const L=ad(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,C),U=this.paint.get("fill-extrusion-height").evaluate(u,m),H=this.paint.get("fill-extrusion-base").evaluate(u,m),q=function(J,te,oe){const pe=[];for(const Se of J){const He=[Se.x,Se.y,0,1];Jt(He,He,te),pe.push(new ee(He[0]/He[3],He[1]/He[3]))}return pe}(L,D),Q=function(J,te,oe,pe){const Se=[],He=[],ke=pe[8]*te,K=pe[9]*te,Ae=pe[10]*te,Be=pe[11]*te,ft=pe[8]*oe,Dt=pe[9]*oe,mt=pe[10]*oe,wt=pe[11]*oe;for(const Wt of J){const Bt=[],$t=[];for(const Et of Wt){const fi=Et.x,Si=Et.y,xi=pe[0]*fi+pe[4]*Si+pe[12],pi=pe[1]*fi+pe[5]*Si+pe[13],ar=pe[2]*fi+pe[6]*Si+pe[14],en=pe[3]*fi+pe[7]*Si+pe[15],Mn=ar+Ae,ds=en+Be,bo=xi+ft,qs=pi+Dt,Kn=ar+mt,Kr=en+wt,On=new ee((xi+ke)/ds,(pi+K)/ds);On.z=Mn/ds,Bt.push(On);const Jn=new ee(bo/Kr,qs/Kr);Jn.z=Kn/Kr,$t.push(Jn)}Se.push(Bt),He.push($t)}return[Se,He]}(b,H,U,D);return function(J,te,oe){let pe=1/0;my(oe,te)&&(pe=Zy(oe,te[0]));for(let Se=0;Se<te.length;Se++){const He=te[Se],ke=J[Se];for(let K=0;K<He.length-1;K++){const Ae=He[K],Be=[Ae,He[K+1],ke[K+1],ke[K],Ae];gy(oe,Be)&&(pe=Math.min(pe,Zy(oe,Be)))}}return pe!==1/0&&pe}(Q[0],Q[1],q)}}function qf(h,s){return h.x*s.x+h.y*s.y}function Zy(h,s){if(h.length===1){let u=0;const m=s[u++];let b;for(;!b||m.equals(b);)if(b=s[u++],!b)return 1/0;for(;u<s.length;u++){const E=s[u],C=h[0],D=b.sub(m),L=E.sub(m),U=C.sub(m),H=qf(D,D),q=qf(D,L),Q=qf(L,L),J=qf(U,D),te=qf(U,L),oe=H*Q-q*q,pe=(Q*J-q*te)/oe,Se=(H*te-q*J)/oe,He=m.z*(1-pe-Se)+b.z*pe+E.z*Se;if(isFinite(He))return He}return 1/0}{let u=1/0;for(const m of s)u=Math.min(u,m.z);return u}}const ES=Xr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:CS}=ES,IS=Xr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:PS}=IS,MS=$f.VectorTileFeature.types,RS=Math.cos(Math.PI/180*37.5),qy=Math.pow(2,14)/.5;class j0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new di,this.layoutVertexArray2=new er,this.indexArray=new yr,this.programConfigurations=new ol(s.layers,s.zoom),this.segments=new br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,m){this.hasPattern=R0("line",this.layers,u);const b=this.layers[0].layout.get("line-sort-key"),E=!b.isConstant(),C=[];for(const{feature:D,id:L,index:U,sourceLayerIndex:H}of s){const q=this.layers[0]._featureFilter.needGeometry,Q=wu(D,q);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),Q,m))continue;const J=E?b.evaluate(Q,{},m):void 0,te={id:L,properties:D.properties,type:D.type,sourceLayerIndex:H,index:U,geometry:q?Q.geometry:xu(D),patterns:{},sortKey:J};C.push(te)}E&&C.sort((D,L)=>D.sortKey-L.sortKey);for(const D of C){const{geometry:L,index:U,sourceLayerIndex:H}=D;if(this.hasPattern){const q=k0("line",this.layers,D,this.zoom,u);this.patternFeatures.push(q)}else this.addFeature(D,L,U,m,{},u.subdivisionGranularity);u.featureIndex.insert(s[U].feature,L,U,H,this.index)}}update(s,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,m)}addFeatures(s,u,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,u,m,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,PS)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,CS),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,u,m,b,E,C){const D=this.layers[0].layout,L=D.get("line-join").evaluate(s,{}),U=D.get("line-cap"),H=D.get("line-miter-limit"),q=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const Q of u)this.addLine(Q,s,L,U,H,q,b,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,E,b)}addLine(s,u,m,b,E,C,D,L){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=Eu(s,D?L.line.getGranularityForZoomLevel(D.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<s.length-1;ke++)this.totalDistance+=s[ke].dist(s[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const U=MS[u.type]==="Polygon";let H=s.length;for(;H>=2&&s[H-1].equals(s[H-2]);)H--;let q=0;for(;q<H-1&&s[q].equals(s[q+1]);)q++;if(H<(U?3:2))return;m==="bevel"&&(E=1.05);const Q=this.overscaling<=16?15*Me/(512*this.overscaling):0,J=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let te,oe,pe,Se,He;this.e1=this.e2=-1,U&&(te=s[H-2],He=s[q].sub(te)._unit()._perp());for(let ke=q;ke<H;ke++){if(pe=ke===H-1?U?s[q+1]:void 0:s[ke+1],pe&&s[ke].equals(pe))continue;He&&(Se=He),te&&(oe=te),te=s[ke],He=pe?pe.sub(te)._unit()._perp():Se,Se=Se||He;let K=Se.add(He);K.x===0&&K.y===0||K._unit();const Ae=Se.x*He.x+Se.y*He.y,Be=K.x*He.x+K.y*He.y,ft=Be!==0?1/Be:1/0,Dt=2*Math.sqrt(2-2*Be),mt=Be<RS&&oe&&pe,wt=Se.x*He.y-Se.y*He.x>0;if(mt&&ke>q){const $t=te.dist(oe);if($t>2*Q){const Et=te.sub(te.sub(oe)._mult(Q/$t)._round());this.updateDistance(oe,Et),this.addCurrentVertex(Et,Se,0,0,J),oe=Et}}const Wt=oe&&pe;let Bt=Wt?m:U?"butt":b;if(Wt&&Bt==="round"&&(ft<C?Bt="miter":ft<=2&&(Bt="fakeround")),Bt==="miter"&&ft>E&&(Bt="bevel"),Bt==="bevel"&&(ft>2&&(Bt="flipbevel"),ft<E&&(Bt="miter")),oe&&this.updateDistance(oe,te),Bt==="miter")K._mult(ft),this.addCurrentVertex(te,K,0,0,J);else if(Bt==="flipbevel"){if(ft>100)K=He.mult(-1);else{const $t=ft*Se.add(He).mag()/Se.sub(He).mag();K._perp()._mult($t*(wt?-1:1))}this.addCurrentVertex(te,K,0,0,J),this.addCurrentVertex(te,K.mult(-1),0,0,J)}else if(Bt==="bevel"||Bt==="fakeround"){const $t=-Math.sqrt(ft*ft-1),Et=wt?$t:0,fi=wt?0:$t;if(oe&&this.addCurrentVertex(te,Se,Et,fi,J),Bt==="fakeround"){const Si=Math.round(180*Dt/Math.PI/20);for(let xi=1;xi<Si;xi++){let pi=xi/Si;if(pi!==.5){const en=pi-.5;pi+=pi*en*(pi-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*en*en+(.848013+Ae*(.215638*Ae-1.06021)))}const ar=He.sub(Se)._mult(pi)._add(Se)._unit()._mult(wt?-1:1);this.addHalfVertex(te,ar.x,ar.y,!1,wt,0,J)}}pe&&this.addCurrentVertex(te,He,-Et,-fi,J)}else if(Bt==="butt")this.addCurrentVertex(te,K,0,0,J);else if(Bt==="square"){const $t=oe?1:-1;this.addCurrentVertex(te,K,$t,$t,J)}else Bt==="round"&&(oe&&(this.addCurrentVertex(te,Se,0,0,J),this.addCurrentVertex(te,Se,1,1,J,!0)),pe&&(this.addCurrentVertex(te,He,-1,-1,J,!0),this.addCurrentVertex(te,He,0,0,J)));if(mt&&ke<H-1){const $t=te.dist(pe);if($t>2*Q){const Et=te.add(pe.sub(te)._mult(Q/$t)._round());this.updateDistance(te,Et),this.addCurrentVertex(Et,He,0,0,J),te=Et}}}}addCurrentVertex(s,u,m,b,E,C=!1){const D=u.y*b-u.x,L=-u.y-u.x*b;this.addHalfVertex(s,u.x+u.y*m,u.y-u.x*m,C,!1,m,E),this.addHalfVertex(s,D,L,C,!0,-b,E),this.distance>qy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,u,m,b,E,C))}addHalfVertex({x:s,y:u},m,b,E,C,D,L){const U=.5*(this.lineClips?this.scaledDistance*(qy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(E?1:0),(u<<1)+(C?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(D===0?0:D<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,H,this.e2),L.primitiveLength++),C?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,u){this.distance+=s.dist(u),this.updateScaledDistance()}}let Xy,Gy;li("LineBucket",j0,{omit:["layers","patternFeatures"]});var Yy={get paint(){return Gy=Gy||new bi({"line-opacity":new Gt(ge.paint_line["line-opacity"]),"line-color":new Gt(ge.paint_line["line-color"]),"line-translate":new Ft(ge.paint_line["line-translate"]),"line-translate-anchor":new Ft(ge.paint_line["line-translate-anchor"]),"line-width":new Gt(ge.paint_line["line-width"]),"line-gap-width":new Gt(ge.paint_line["line-gap-width"]),"line-offset":new Gt(ge.paint_line["line-offset"]),"line-blur":new Gt(ge.paint_line["line-blur"]),"line-dasharray":new mi(ge.paint_line["line-dasharray"]),"line-pattern":new Ri(ge.paint_line["line-pattern"]),"line-gradient":new Ht(ge.paint_line["line-gradient"])})},get layout(){return Xy=Xy||new bi({"line-cap":new Ft(ge.layout_line["line-cap"]),"line-join":new Gt(ge.layout_line["line-join"]),"line-miter-limit":new Ft(ge.layout_line["line-miter-limit"]),"line-round-limit":new Ft(ge.layout_line["line-round-limit"]),"line-sort-key":new Gt(ge.layout_line["line-sort-key"])})}};class kS extends Gt{possiblyEvaluate(s,u){return u=new Ze(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(s,u)}evaluate(s,u,m,b){return u=Oi({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(s,u,m,b)}}let fd;class DS extends Ii{constructor(s){super(s,Yy),this.gradientVersion=0,fd||(fd=new kS(Yy.paint.properties["line-width"].specification),fd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,u){super.recalculate(s,u),this.paint._values["line-floorwidth"]=fd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new j0(s)}queryRadius(s){const u=s,m=Qy(Ff("line-width",this,u),Ff("line-gap-width",this,u)),b=Ff("line-offset",this,u);return m/2+Math.abs(b)+od(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:u,featureState:m,geometry:b,transform:E,pixelsToTileUnits:C}){const D=ad(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,C),L=C/2*Qy(this.paint.get("line-width").evaluate(u,m),this.paint.get("line-gap-width").evaluate(u,m)),U=this.paint.get("line-offset").evaluate(u,m);return U&&(b=function(H,q){const Q=[];for(let J=0;J<H.length;J++){const te=H[J],oe=[];for(let pe=0;pe<te.length;pe++){const Se=te[pe-1],He=te[pe],ke=te[pe+1],K=pe===0?new ee(0,0):He.sub(Se)._unit()._perp(),Ae=pe===te.length-1?new ee(0,0):ke.sub(He)._unit()._perp(),Be=K._add(Ae)._unit(),ft=Be.x*Ae.x+Be.y*Ae.y;ft!==0&&Be._mult(1/ft),oe.push(Be._mult(q)._add(He))}Q.push(oe)}return Q}(b,U*C)),function(H,q,Q){for(let J=0;J<q.length;J++){const te=q[J];if(H.length>=3){for(let oe=0;oe<te.length;oe++)if(Tu(H,te[oe]))return!0}if(XT(H,te,Q))return!0}return!1}(D,b,L)}isTileClipped(){return!0}}function Qy(h,s){return s>0?s+2*h:h}const BS=Xr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),OS=Xr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const LS=Xr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Xr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ky=Xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),FS=Xr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function NS(h,s,u){return h.sections.forEach(m=>{m.text=function(b,E,C){const D=E.layout.get("text-transform").evaluate(C,{});return D==="uppercase"?b=b.toLocaleUpperCase():D==="lowercase"&&(b=b.toLocaleLowerCase()),je.applyArabicShaping&&(b=je.applyArabicShaping(b)),b}(m.text,s,u)}),h}Xr([{name:"triangle",components:3,type:"Uint16"}]),Xr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Xr([{type:"Float32",name:"offsetX"}]),Xr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Xr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Xf={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var Jy,V0,e2,Pn=24,W0={};function zS(){return Jy||(Jy=1,W0.read=function(h,s,u,m,b){var E,C,D=8*b-m-1,L=(1<<D)-1,U=L>>1,H=-7,q=u?b-1:0,Q=u?-1:1,J=h[s+q];for(q+=Q,E=J&(1<<-H)-1,J>>=-H,H+=D;H>0;E=256*E+h[s+q],q+=Q,H-=8);for(C=E&(1<<-H)-1,E>>=-H,H+=m;H>0;C=256*C+h[s+q],q+=Q,H-=8);if(E===0)E=1-U;else{if(E===L)return C?NaN:1/0*(J?-1:1);C+=Math.pow(2,m),E-=U}return(J?-1:1)*C*Math.pow(2,E-m)},W0.write=function(h,s,u,m,b,E){var C,D,L,U=8*E-b-1,H=(1<<U)-1,q=H>>1,Q=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=m?0:E-1,te=m?1:-1,oe=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(D=isNaN(s)?1:0,C=H):(C=Math.floor(Math.log(s)/Math.LN2),s*(L=Math.pow(2,-C))<1&&(C--,L*=2),(s+=C+q>=1?Q/L:Q*Math.pow(2,1-q))*L>=2&&(C++,L/=2),C+q>=H?(D=0,C=H):C+q>=1?(D=(s*L-1)*Math.pow(2,b),C+=q):(D=s*Math.pow(2,q-1)*Math.pow(2,b),C=0));b>=8;h[u+J]=255&D,J+=te,D/=256,b-=8);for(C=C<<b|D,U+=b;U>0;h[u+J]=255&C,J+=te,C/=256,U-=8);h[u+J-te]|=128*oe}),W0}function t2(){if(e2)return V0;e2=1,V0=s;var h=zS();function s(K){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(K)?K:new Uint8Array(K||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var u=4294967296,m=1/u,b=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function E(K){return K.type===s.Bytes?K.readVarint()+K.pos:K.pos+1}function C(K,Ae,Be){return Be?4294967296*Ae+(K>>>0):4294967296*(Ae>>>0)+(K>>>0)}function D(K,Ae,Be){var ft=Ae<=16383?1:Ae<=2097151?2:Ae<=268435455?3:Math.floor(Math.log(Ae)/(7*Math.LN2));Be.realloc(ft);for(var Dt=Be.pos-1;Dt>=K;Dt--)Be.buf[Dt+ft]=Be.buf[Dt]}function L(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeVarint(K[Be])}function U(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeSVarint(K[Be])}function H(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeFloat(K[Be])}function q(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeDouble(K[Be])}function Q(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeBoolean(K[Be])}function J(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeFixed32(K[Be])}function te(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeSFixed32(K[Be])}function oe(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeFixed64(K[Be])}function pe(K,Ae){for(var Be=0;Be<K.length;Be++)Ae.writeSFixed64(K[Be])}function Se(K,Ae){return(K[Ae]|K[Ae+1]<<8|K[Ae+2]<<16)+16777216*K[Ae+3]}function He(K,Ae,Be){K[Be]=Ae,K[Be+1]=Ae>>>8,K[Be+2]=Ae>>>16,K[Be+3]=Ae>>>24}function ke(K,Ae){return(K[Ae]|K[Ae+1]<<8|K[Ae+2]<<16)+(K[Ae+3]<<24)}return s.prototype={destroy:function(){this.buf=null},readFields:function(K,Ae,Be){for(Be=Be||this.length;this.pos<Be;){var ft=this.readVarint(),Dt=ft>>3,mt=this.pos;this.type=7&ft,K(Dt,Ae,this),this.pos===mt&&this.skip(ft)}return Ae},readMessage:function(K,Ae){return this.readFields(K,Ae,this.readVarint()+this.pos)},readFixed32:function(){var K=Se(this.buf,this.pos);return this.pos+=4,K},readSFixed32:function(){var K=ke(this.buf,this.pos);return this.pos+=4,K},readFixed64:function(){var K=Se(this.buf,this.pos)+Se(this.buf,this.pos+4)*u;return this.pos+=8,K},readSFixed64:function(){var K=Se(this.buf,this.pos)+ke(this.buf,this.pos+4)*u;return this.pos+=8,K},readFloat:function(){var K=h.read(this.buf,this.pos,!0,23,4);return this.pos+=4,K},readDouble:function(){var K=h.read(this.buf,this.pos,!0,52,8);return this.pos+=8,K},readVarint:function(K){var Ae,Be,ft=this.buf;return Ae=127&(Be=ft[this.pos++]),Be<128?Ae:(Ae|=(127&(Be=ft[this.pos++]))<<7,Be<128?Ae:(Ae|=(127&(Be=ft[this.pos++]))<<14,Be<128?Ae:(Ae|=(127&(Be=ft[this.pos++]))<<21,Be<128?Ae:function(Dt,mt,wt){var Wt,Bt,$t=wt.buf;if(Wt=(112&(Bt=$t[wt.pos++]))>>4,Bt<128||(Wt|=(127&(Bt=$t[wt.pos++]))<<3,Bt<128)||(Wt|=(127&(Bt=$t[wt.pos++]))<<10,Bt<128)||(Wt|=(127&(Bt=$t[wt.pos++]))<<17,Bt<128)||(Wt|=(127&(Bt=$t[wt.pos++]))<<24,Bt<128)||(Wt|=(1&(Bt=$t[wt.pos++]))<<31,Bt<128))return C(Dt,Wt,mt);throw new Error("Expected varint not more than 10 bytes")}(Ae|=(15&(Be=ft[this.pos]))<<28,K,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var K=this.readVarint();return K%2==1?(K+1)/-2:K/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var K=this.readVarint()+this.pos,Ae=this.pos;return this.pos=K,K-Ae>=12&&b?function(Be,ft,Dt){return b.decode(Be.subarray(ft,Dt))}(this.buf,Ae,K):function(Be,ft,Dt){for(var mt="",wt=ft;wt<Dt;){var Wt,Bt,$t,Et=Be[wt],fi=null,Si=Et>239?4:Et>223?3:Et>191?2:1;if(wt+Si>Dt)break;Si===1?Et<128&&(fi=Et):Si===2?(192&(Wt=Be[wt+1]))==128&&(fi=(31&Et)<<6|63&Wt)<=127&&(fi=null):Si===3?(Bt=Be[wt+2],(192&(Wt=Be[wt+1]))==128&&(192&Bt)==128&&((fi=(15&Et)<<12|(63&Wt)<<6|63&Bt)<=2047||fi>=55296&&fi<=57343)&&(fi=null)):Si===4&&(Bt=Be[wt+2],$t=Be[wt+3],(192&(Wt=Be[wt+1]))==128&&(192&Bt)==128&&(192&$t)==128&&((fi=(15&Et)<<18|(63&Wt)<<12|(63&Bt)<<6|63&$t)<=65535||fi>=1114112)&&(fi=null)),fi===null?(fi=65533,Si=1):fi>65535&&(fi-=65536,mt+=String.fromCharCode(fi>>>10&1023|55296),fi=56320|1023&fi),mt+=String.fromCharCode(fi),wt+=Si}return mt}(this.buf,Ae,K)},readBytes:function(){var K=this.readVarint()+this.pos,Ae=this.buf.subarray(this.pos,K);return this.pos=K,Ae},readPackedVarint:function(K,Ae){if(this.type!==s.Bytes)return K.push(this.readVarint(Ae));var Be=E(this);for(K=K||[];this.pos<Be;)K.push(this.readVarint(Ae));return K},readPackedSVarint:function(K){if(this.type!==s.Bytes)return K.push(this.readSVarint());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readSVarint());return K},readPackedBoolean:function(K){if(this.type!==s.Bytes)return K.push(this.readBoolean());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readBoolean());return K},readPackedFloat:function(K){if(this.type!==s.Bytes)return K.push(this.readFloat());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readFloat());return K},readPackedDouble:function(K){if(this.type!==s.Bytes)return K.push(this.readDouble());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readDouble());return K},readPackedFixed32:function(K){if(this.type!==s.Bytes)return K.push(this.readFixed32());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readFixed32());return K},readPackedSFixed32:function(K){if(this.type!==s.Bytes)return K.push(this.readSFixed32());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readSFixed32());return K},readPackedFixed64:function(K){if(this.type!==s.Bytes)return K.push(this.readFixed64());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readFixed64());return K},readPackedSFixed64:function(K){if(this.type!==s.Bytes)return K.push(this.readSFixed64());var Ae=E(this);for(K=K||[];this.pos<Ae;)K.push(this.readSFixed64());return K},skip:function(K){var Ae=7&K;if(Ae===s.Varint)for(;this.buf[this.pos++]>127;);else if(Ae===s.Bytes)this.pos=this.readVarint()+this.pos;else if(Ae===s.Fixed32)this.pos+=4;else{if(Ae!==s.Fixed64)throw new Error("Unimplemented type: "+Ae);this.pos+=8}},writeTag:function(K,Ae){this.writeVarint(K<<3|Ae)},realloc:function(K){for(var Ae=this.length||16;Ae<this.pos+K;)Ae*=2;if(Ae!==this.length){var Be=new Uint8Array(Ae);Be.set(this.buf),this.buf=Be,this.length=Ae}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(K){this.realloc(4),He(this.buf,K,this.pos),this.pos+=4},writeSFixed32:function(K){this.realloc(4),He(this.buf,K,this.pos),this.pos+=4},writeFixed64:function(K){this.realloc(8),He(this.buf,-1&K,this.pos),He(this.buf,Math.floor(K*m),this.pos+4),this.pos+=8},writeSFixed64:function(K){this.realloc(8),He(this.buf,-1&K,this.pos),He(this.buf,Math.floor(K*m),this.pos+4),this.pos+=8},writeVarint:function(K){(K=+K||0)>268435455||K<0?function(Ae,Be){var ft,Dt;if(Ae>=0?(ft=Ae%4294967296|0,Dt=Ae/4294967296|0):(Dt=~(-Ae/4294967296),4294967295^(ft=~(-Ae%4294967296))?ft=ft+1|0:(ft=0,Dt=Dt+1|0)),Ae>=18446744073709552e3||Ae<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Be.realloc(10),function(mt,wt,Wt){Wt.buf[Wt.pos++]=127&mt|128,mt>>>=7,Wt.buf[Wt.pos++]=127&mt|128,mt>>>=7,Wt.buf[Wt.pos++]=127&mt|128,mt>>>=7,Wt.buf[Wt.pos++]=127&mt|128,Wt.buf[Wt.pos]=127&(mt>>>=7)}(ft,0,Be),function(mt,wt){var Wt=(7&mt)<<4;wt.buf[wt.pos++]|=Wt|((mt>>>=3)?128:0),mt&&(wt.buf[wt.pos++]=127&mt|((mt>>>=7)?128:0),mt&&(wt.buf[wt.pos++]=127&mt|((mt>>>=7)?128:0),mt&&(wt.buf[wt.pos++]=127&mt|((mt>>>=7)?128:0),mt&&(wt.buf[wt.pos++]=127&mt|((mt>>>=7)?128:0),mt&&(wt.buf[wt.pos++]=127&mt)))))}(Dt,Be)}(K,this):(this.realloc(4),this.buf[this.pos++]=127&K|(K>127?128:0),K<=127||(this.buf[this.pos++]=127&(K>>>=7)|(K>127?128:0),K<=127||(this.buf[this.pos++]=127&(K>>>=7)|(K>127?128:0),K<=127||(this.buf[this.pos++]=K>>>7&127))))},writeSVarint:function(K){this.writeVarint(K<0?2*-K-1:2*K)},writeBoolean:function(K){this.writeVarint(!!K)},writeString:function(K){K=String(K),this.realloc(4*K.length),this.pos++;var Ae=this.pos;this.pos=function(ft,Dt,mt){for(var wt,Wt,Bt=0;Bt<Dt.length;Bt++){if((wt=Dt.charCodeAt(Bt))>55295&&wt<57344){if(!Wt){wt>56319||Bt+1===Dt.length?(ft[mt++]=239,ft[mt++]=191,ft[mt++]=189):Wt=wt;continue}if(wt<56320){ft[mt++]=239,ft[mt++]=191,ft[mt++]=189,Wt=wt;continue}wt=Wt-55296<<10|wt-56320|65536,Wt=null}else Wt&&(ft[mt++]=239,ft[mt++]=191,ft[mt++]=189,Wt=null);wt<128?ft[mt++]=wt:(wt<2048?ft[mt++]=wt>>6|192:(wt<65536?ft[mt++]=wt>>12|224:(ft[mt++]=wt>>18|240,ft[mt++]=wt>>12&63|128),ft[mt++]=wt>>6&63|128),ft[mt++]=63&wt|128)}return mt}(this.buf,K,this.pos);var Be=this.pos-Ae;Be>=128&&D(Ae,Be,this),this.pos=Ae-1,this.writeVarint(Be),this.pos+=Be},writeFloat:function(K){this.realloc(4),h.write(this.buf,K,this.pos,!0,23,4),this.pos+=4},writeDouble:function(K){this.realloc(8),h.write(this.buf,K,this.pos,!0,52,8),this.pos+=8},writeBytes:function(K){var Ae=K.length;this.writeVarint(Ae),this.realloc(Ae);for(var Be=0;Be<Ae;Be++)this.buf[this.pos++]=K[Be]},writeRawMessage:function(K,Ae){this.pos++;var Be=this.pos;K(Ae,this);var ft=this.pos-Be;ft>=128&&D(Be,ft,this),this.pos=Be-1,this.writeVarint(ft),this.pos+=ft},writeMessage:function(K,Ae,Be){this.writeTag(K,s.Bytes),this.writeRawMessage(Ae,Be)},writePackedVarint:function(K,Ae){Ae.length&&this.writeMessage(K,L,Ae)},writePackedSVarint:function(K,Ae){Ae.length&&this.writeMessage(K,U,Ae)},writePackedBoolean:function(K,Ae){Ae.length&&this.writeMessage(K,Q,Ae)},writePackedFloat:function(K,Ae){Ae.length&&this.writeMessage(K,H,Ae)},writePackedDouble:function(K,Ae){Ae.length&&this.writeMessage(K,q,Ae)},writePackedFixed32:function(K,Ae){Ae.length&&this.writeMessage(K,J,Ae)},writePackedSFixed32:function(K,Ae){Ae.length&&this.writeMessage(K,te,Ae)},writePackedFixed64:function(K,Ae){Ae.length&&this.writeMessage(K,oe,Ae)},writePackedSFixed64:function(K,Ae){Ae.length&&this.writeMessage(K,pe,Ae)},writeBytesField:function(K,Ae){this.writeTag(K,s.Bytes),this.writeBytes(Ae)},writeFixed32Field:function(K,Ae){this.writeTag(K,s.Fixed32),this.writeFixed32(Ae)},writeSFixed32Field:function(K,Ae){this.writeTag(K,s.Fixed32),this.writeSFixed32(Ae)},writeFixed64Field:function(K,Ae){this.writeTag(K,s.Fixed64),this.writeFixed64(Ae)},writeSFixed64Field:function(K,Ae){this.writeTag(K,s.Fixed64),this.writeSFixed64(Ae)},writeVarintField:function(K,Ae){this.writeTag(K,s.Varint),this.writeVarint(Ae)},writeSVarintField:function(K,Ae){this.writeTag(K,s.Varint),this.writeSVarint(Ae)},writeStringField:function(K,Ae){this.writeTag(K,s.Bytes),this.writeString(Ae)},writeFloatField:function(K,Ae){this.writeTag(K,s.Fixed32),this.writeFloat(Ae)},writeDoubleField:function(K,Ae){this.writeTag(K,s.Fixed64),this.writeDouble(Ae)},writeBooleanField:function(K,Ae){this.writeVarintField(K,!!Ae)}},V0}var H0=w(t2());const $0=3;function US(h,s,u){h===1&&u.readMessage(jS,s)}function jS(h,s,u){if(h===3){const{id:m,bitmap:b,width:E,height:C,left:D,top:L,advance:U}=u.readMessage(VS,{});s.push({id:m,bitmap:new Nf({width:E+2*$0,height:C+2*$0},b),metrics:{width:E,height:C,left:D,top:L,advance:U}})}}function VS(h,s,u){h===1?s.id=u.readVarint():h===2?s.bitmap=u.readBytes():h===3?s.width=u.readVarint():h===4?s.height=u.readVarint():h===5?s.left=u.readSVarint():h===6?s.top=u.readSVarint():h===7&&(s.advance=u.readVarint())}const WS=$0;function i2(h){let s=0,u=0;for(const C of h)s+=C.w*C.h,u=Math.max(u,C.w);h.sort((C,D)=>D.h-C.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let b=0,E=0;for(const C of h)for(let D=m.length-1;D>=0;D--){const L=m[D];if(!(C.w>L.w||C.h>L.h)){if(C.x=L.x,C.y=L.y,E=Math.max(E,C.y+C.h),b=Math.max(b,C.x+C.w),C.w===L.w&&C.h===L.h){const U=m.pop();D<m.length&&(m[D]=U)}else C.h===L.h?(L.x+=C.w,L.w-=C.w):C.w===L.w?(L.y+=C.h,L.h-=C.h):(m.push({x:L.x+C.w,y:L.y,w:L.w-C.w,h:C.h}),L.y+=C.h,L.h-=C.h);break}}return{w:b,h:E,fill:s/(b*E)||0}}const Zs=1;class Z0{constructor(s,{pixelRatio:u,version:m,stretchX:b,stretchY:E,content:C,textFitWidth:D,textFitHeight:L}){this.paddedRect=s,this.pixelRatio=u,this.stretchX=b,this.stretchY=E,this.content=C,this.version=m,this.textFitWidth=D,this.textFitHeight=L}get tl(){return[this.paddedRect.x+Zs,this.paddedRect.y+Zs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zs,this.paddedRect.y+this.paddedRect.h-Zs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Zs)/this.pixelRatio,(this.paddedRect.h-2*Zs)/this.pixelRatio]}}class r2{constructor(s,u){const m={},b={};this.haveRenderCallbacks=[];const E=[];this.addImages(s,m,E),this.addImages(u,b,E);const{w:C,h:D}=i2(E),L=new _o({width:C||1,height:D||1});for(const U in s){const H=s[U],q=m[U].paddedRect;_o.copy(H.data,L,{x:0,y:0},{x:q.x+Zs,y:q.y+Zs},H.data)}for(const U in u){const H=u[U],q=b[U].paddedRect,Q=q.x+Zs,J=q.y+Zs,te=H.data.width,oe=H.data.height;_o.copy(H.data,L,{x:0,y:0},{x:Q,y:J},H.data),_o.copy(H.data,L,{x:0,y:oe-1},{x:Q,y:J-1},{width:te,height:1}),_o.copy(H.data,L,{x:0,y:0},{x:Q,y:J+oe},{width:te,height:1}),_o.copy(H.data,L,{x:te-1,y:0},{x:Q-1,y:J},{width:1,height:oe}),_o.copy(H.data,L,{x:0,y:0},{x:Q+te,y:J},{width:1,height:oe})}this.image=L,this.iconPositions=m,this.patternPositions=b}addImages(s,u,m){for(const b in s){const E=s[b],C={x:0,y:0,w:E.data.width+2*Zs,h:E.data.height+2*Zs};m.push(C),u[b]=new Z0(C,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(s,u){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in s.updatedImages)this.patchUpdatedImage(this.iconPositions[m],s.getImage(m),u),this.patchUpdatedImage(this.patternPositions[m],s.getImage(m),u)}patchUpdatedImage(s,u,m){if(!s||!u||s.version===u.version)return;s.version=u.version;const[b,E]=s.tl;m.update(u.data,void 0,{x:b,y:E})}}var Tc;li("ImagePosition",Z0),li("ImageAtlas",r2),f.al=void 0,(Tc=f.al||(f.al={}))[Tc.none=0]="none",Tc[Tc.horizontal=1]="horizontal",Tc[Tc.vertical=2]="vertical",Tc[Tc.horizontalOnly=3]="horizontalOnly";const Ad=-17;class Gf{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(s,u,m){const b=new Gf;return b.scale=s||1,b.fontStack=u,b.verticalAlign=m||"bottom",b}static forImage(s,u){const m=new Gf;return m.imageName=s,m.verticalAlign=u||"bottom",m}}class vh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u){const m=new vh;for(let b=0;b<s.sections.length;b++){const E=s.sections[b];E.image?m.addImageSection(E):m.addTextSection(E,u)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let u="";for(let m=0;m<s.length;m++){const b=s.charCodeAt(m+1)||null,E=s.charCodeAt(m-1)||null;u+=b&&X(b)&&!Xf[s[m+1]]||E&&X(E)&&!Xf[s[m-1]]||!Xf[s[m]]?s[m]:Xf[s[m]]}return u}(this.text)}trim(){let s=0;for(let m=0;m<this.text.length&&pd[this.text.charCodeAt(m)];m++)s++;let u=this.text.length;for(let m=this.text.length-1;m>=0&&m>=s&&pd[this.text.charCodeAt(m)];m--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const m=new vh;return m.text=this.text.substring(s,u),m.sectionIndex=this.sectionIndex.slice(s,u),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}getMaxImageSize(s){let u=0,m=0;for(let b=0;b<this.length();b++){const E=this.getSection(b);if(E.imageName){const C=s[E.imageName];if(!C)continue;const D=C.displaySize;u=Math.max(u,D[0]),m=Math.max(m,D[1])}}return{maxImageWidth:u,maxImageHeight:m}}addTextSection(s,u){this.text+=s.text,this.sections.push(Gf.forText(s.scale,s.fontStack||u,s.verticalAlign));const m=this.sections.length-1;for(let b=0;b<s.text.length;++b)this.sectionIndex.push(m)}addImageSection(s){const u=s.image?s.image.name:"";if(u.length===0)return void sr("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Gf.forImage(u,s.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function dd(h,s,u,m,b,E,C,D,L,U,H,q,Q,J,te){const oe=vh.fromFeature(h,b);let pe;q===f.al.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:He}=je;if(Se&&oe.sections.length===1){pe=[];const Ae=Se(oe.toString(),q0(oe,U,E,s,m,J));for(const Be of Ae){const ft=new vh;ft.text=Be,ft.sections=oe.sections;for(let Dt=0;Dt<Be.length;Dt++)ft.sectionIndex.push(0);pe.push(ft)}}else if(He){pe=[];const Ae=He(oe.text,oe.sectionIndex,q0(oe,U,E,s,m,J));for(const Be of Ae){const ft=new vh;ft.text=Be[0],ft.sectionIndex=Be[1],ft.sections=oe.sections,pe.push(ft)}}else pe=function(Ae,Be){const ft=[],Dt=Ae.text;let mt=0;for(const wt of Be)ft.push(Ae.substring(mt,wt)),mt=wt;return mt<Dt.length&&ft.push(Ae.substring(mt,Dt.length)),ft}(oe,q0(oe,U,E,s,m,J));const ke=[],K={positionedLines:ke,text:oe.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Ae,Be,ft,Dt,mt,wt,Wt,Bt,$t,Et,fi,Si){let xi=0,pi=0,ar=0,en=0;const Mn=Bt==="right"?1:Bt==="left"?0:.5,ds=Pn/Si;let bo=0;for(const Kr of mt){Kr.trim();const On=Kr.getMaxScale(),Jn={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[bo]=Jn;const es=Jn.positionedGlyphs;let Ls=0;if(!Kr.length()){pi+=wt,++bo;continue}const vo=qS(Dt,Kr,ds);for(let Xs=0;Xs<Kr.length();Xs++){const Rn=Kr.getSection(Xs),Fn=Kr.getSectionIndex(Xs),Nn=Kr.getCharCode(Xs),yn=XS($t,fi,Nn);let zr;if(Rn.imageName){if(Ae.iconsInText=!0,Rn.scale=Rn.scale*ds,zr=YS(Rn,yn,On,vo,Dt),!zr)continue;Ls=Math.max(Ls,zr.imageOffset)}else if(zr=GS(Rn,Nn,yn,vo,Be,ft),!zr)continue;const{rect:Ta,metrics:Sh,baselineOffset:Sa}=zr;es.push({glyph:Nn,imageName:Rn.imageName,x:xi,y:pi+Sa+Ad,vertical:yn,scale:Rn.scale,fontStack:Rn.fontStack,sectionIndex:Fn,metrics:Sh,rect:Ta}),yn?(Ae.verticalizable=!0,xi+=(Rn.imageName?Sh.advance:Pn)*Rn.scale+Et):xi+=Sh.advance*Rn.scale+Et}es.length!==0&&(ar=Math.max(xi-Et,ar),QS(es,0,es.length-1,Mn)),xi=0,Jn.lineOffset=Math.max(Ls,(On-1)*Pn);const Ln=wt*On+Ls;pi+=Ln,en=Math.max(Ln,en),++bo}const{horizontalAlign:qs,verticalAlign:Kn}=X0(Wt);(function(Kr,On,Jn,es,Ls,vo,Ln,Xs,Rn){const Fn=(On-Jn)*Ls;let Nn=0;Nn=vo!==Ln?-Xs*es-Ad:-es*Rn*Ln+.5*Ln;for(const yn of Kr)for(const zr of yn.positionedGlyphs)zr.x+=Fn,zr.y+=Nn})(Ae.positionedLines,Mn,qs,Kn,ar,en,wt,pi,mt.length),Ae.top+=-Kn*pi,Ae.bottom=Ae.top+pi,Ae.left+=-qs*ar,Ae.right=Ae.left+ar}(K,s,u,m,pe,C,D,L,q,U,Q,te),!function(Ae){for(const Be of Ae)if(Be.positionedGlyphs.length!==0)return!1;return!0}(ke)&&K}const pd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HS={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},$S={40:!0};function n2(h,s,u,m,b,E){if(s.imageName){const C=m[s.imageName];return C?C.displaySize[0]*s.scale*Pn/E+b:0}{const C=u[s.fontStack],D=C&&C[h];return D?D.metrics.advance*s.scale+b:0}}function s2(h,s,u,m){const b=Math.pow(h-s,2);return m?h<s?b/2:2*b:b+Math.abs(u)*u}function ZS(h,s,u){let m=0;return h===10&&(m-=1e4),u&&(m+=150),h!==40&&h!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function o2(h,s,u,m,b,E){let C=null,D=s2(s,u,b,E);for(const L of m){const U=s2(s-L.x,u,b,E)+L.badness;U<=D&&(C=L,D=U)}return{index:h,x:s,priorBreak:C,badness:D}}function a2(h){return h?a2(h.priorBreak).concat(h.index):[]}function q0(h,s,u,m,b,E){if(!h)return[];const C=[],D=function(q,Q,J,te,oe,pe){let Se=0;for(let He=0;He<q.length();He++){const ke=q.getSection(He);Se+=n2(q.getCharCode(He),ke,te,oe,Q,pe)}return Se/Math.max(1,Math.ceil(Se/J))}(h,s,u,m,b,E),L=h.text.indexOf("â")>=0;let U=0;for(let q=0;q<h.length();q++){const Q=h.getSection(q),J=h.getCharCode(q);if(pd[J]||(U+=n2(J,Q,m,b,s,E)),q<h.length()-1){const te=!((H=J)<11904)&&(!!g["CJK Compatibility Forms"](H)||!!g["CJK Compatibility"](H)||!!g["CJK Strokes"](H)||!!g["CJK Symbols and Punctuation"](H)||!!g["Enclosed CJK Letters and Months"](H)||!!g["Halfwidth and Fullwidth Forms"](H)||!!g["Ideographic Description Characters"](H)||!!g["Vertical Forms"](H)||z.test(String.fromCodePoint(H)));(HS[J]||te||Q.imageName||q!==h.length()-2&&$S[h.getCharCode(q+1)])&&C.push(o2(q+1,U,D,C,ZS(J,h.getCharCode(q+1),te&&L),!1))}}var H;return a2(o2(h.length(),U,D,C,0,!0))}function X0(h){let s=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function qS(h,s,u){const m=s.getMaxScale()*Pn,{maxImageWidth:b,maxImageHeight:E}=s.getMaxImageSize(h),C=Math.max(m,E*u);return{verticalLineContentWidth:Math.max(m,b*u),horizontalLineContentHeight:C}}function l2(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function XS(h,s,u){return!(h===f.al.horizontal||!s&&!$(u)||s&&(pd[u]||(m=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(m)))));var m}function GS(h,s,u,m,b,E){const C=E[h.fontStack],D=function(U,H,q,Q){if(U&&U.rect)return U;const J=H[q.fontStack],te=J&&J[Q];return te?{rect:null,metrics:te.metrics}:null}(C&&C[s],b,h,s);if(D===null)return null;let L;if(u)L=m.verticalLineContentWidth-h.scale*Pn;else{const U=l2(h.verticalAlign);L=(m.horizontalLineContentHeight-h.scale*Pn)*U}return{rect:D.rect,metrics:D.metrics,baselineOffset:L}}function YS(h,s,u,m,b){const E=b[h.imageName];if(!E)return null;const C=E.paddedRect,D=E.displaySize,L={width:D[0],height:D[1],left:Zs,top:-3,advance:s?D[1]:D[0]};let U;if(s)U=m.verticalLineContentWidth-D[1]*h.scale;else{const H=l2(h.verticalAlign);U=(m.horizontalLineContentHeight-D[1]*h.scale)*H}return{rect:C,metrics:L,baselineOffset:U,imageOffset:(s?D[0]:D[1])*h.scale-Pn*u}}function QS(h,s,u,m){if(m===0)return;const b=h[u],E=(h[u].x+b.metrics.advance*b.scale)*m;for(let C=s;C<=u;C++)h[C].x-=E}function KS(h,s,u){const{horizontalAlign:m,verticalAlign:b}=X0(u),E=s[0]-h.displaySize[0]*m,C=s[1]-h.displaySize[1]*b;return{image:h,top:C,bottom:C+h.displaySize[1],left:E,right:E+h.displaySize[0]}}function c2(h){var s,u;let m=h.left,b=h.top,E=h.right-m,C=h.bottom-b;const D=(s=h.image.textFitWidth)!==null&&s!==void 0?s:"stretchOrShrink",L=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",U=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(L==="proportional"){if(D==="stretchOnly"&&E/C<U||D==="proportional"){const H=Math.ceil(C*U);m*=H/E,E=H}}else if(D==="proportional"&&L==="stretchOnly"&&U!==0&&E/C>U){const H=Math.ceil(E/U);b*=H/C,C=H}return{x1:m,y1:b,x2:m+E,y2:b+C}}function u2(h,s,u,m,b,E){const C=h.image;let D;if(C.content){const pe=C.content,Se=C.pixelRatio||1;D=[pe[0]/Se,pe[1]/Se,C.displaySize[0]-pe[2]/Se,C.displaySize[1]-pe[3]/Se]}const L=s.left*E,U=s.right*E;let H,q,Q,J;u==="width"||u==="both"?(J=b[0]+L-m[3],q=b[0]+U+m[1]):(J=b[0]+(L+U-C.displaySize[0])/2,q=J+C.displaySize[0]);const te=s.top*E,oe=s.bottom*E;return u==="height"||u==="both"?(H=b[1]+te-m[0],Q=b[1]+oe+m[2]):(H=b[1]+(te+oe-C.displaySize[1])/2,Q=H+C.displaySize[1]),{image:C,top:H,right:q,bottom:Q,left:J,collisionPadding:D}}const Yf=255,al=128,Sc=Yf*al;function h2(h,s){const{expression:u}=s;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ze(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=u;let E=0;for(;E<m.length&&m[E]<=h;)E++;E=Math.max(0,E-1);let C=E;for(;C<m.length&&m[C]<h+1;)C++;C=Math.min(m.length-1,C);const D=m[E],L=m[C];return u.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:L,interpolationType:b}:{kind:"camera",minZoom:D,maxZoom:L,minSize:u.evaluate(new Ze(D)),maxSize:u.evaluate(new Ze(L)),interpolationType:b}}}function G0(h,s,u){let m="never";const b=h.get(s);return b?m=b:h.get(u)&&(m="always"),m}const JS=$f.VectorTileFeature.types,eE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gd(h,s,u,m,b,E,C,D,L,U,H,q,Q){const J=D?Math.min(Sc,Math.round(D[0])):0,te=D?Math.min(Sc,Math.round(D[1])):0;h.emplaceBack(s,u,Math.round(32*m),Math.round(32*b),E,C,(J<<1)+(L?1:0),te,16*U,16*H,256*q,256*Q)}function Y0(h,s,u){h.emplaceBack(s.x,s.y,u),h.emplaceBack(s.x,s.y,u),h.emplaceBack(s.x,s.y,u),h.emplaceBack(s.x,s.y,u)}function tE(h){for(const s of h.sections)if(we(s.text))return!0;return!1}class Q0{constructor(s){this.layoutVertexArray=new Gr,this.indexArray=new yr,this.programConfigurations=s,this.segments=new br,this.dynamicLayoutVertexArray=new kr,this.opacityVertexArray=new Yr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,u,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,BS.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,OS.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,eE,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}li("SymbolBuffers",Q0);class K0{constructor(s,u,m){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new m,this.segments=new br,this.collisionVertexArray=new Or}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,LS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}li("CollisionBuffers",K0);class xh{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(C=>C.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=h2(this.zoom,u["text-size"]),this.iconSizeData=h2(this.zoom,u["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),E=m.get("symbol-z-order");this.canOverlap=G0(m,"text-overlap","text-allow-overlap")!=="never"||G0(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(C=>f.al[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=s.sourceID}createArrays(){this.text=new Q0(new ol(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Q0(new ol(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new Xe,this.lineVertexArray=new Ve,this.symbolInstances=new ze,this.textAnchorOffsets=new St}calculateGlyphDependencies(s,u,m,b,E){for(let C=0;C<s.length;C++)if(u[s.charCodeAt(C)]=!0,(m||b)&&E){const D=Xf[s.charAt(C)];D&&(u[D.charCodeAt(0)]=!0)}}populate(s,u,m){const b=this.layers[0],E=b.layout,C=E.get("text-font"),D=E.get("text-field"),L=E.get("icon-image"),U=(D.value.kind!=="constant"||D.value.value instanceof ss&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),H=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,q=E.get("symbol-sort-key");if(this.features=[],!U&&!H)return;const Q=u.iconDependencies,J=u.glyphDependencies,te=u.availableImages,oe=new Ze(this.zoom);for(const{feature:pe,id:Se,index:He,sourceLayerIndex:ke}of s){const K=b._featureFilter.needGeometry,Ae=wu(pe,K);if(!b._featureFilter.filter(oe,Ae,m))continue;let Be,ft;if(K||(Ae.geometry=xu(pe)),U){const mt=b.getValueAndResolveTokens("text-field",Ae,m,te),wt=ss.factory(mt),Wt=this.hasRTLText=this.hasRTLText||tE(wt);(!Wt||je.getRTLTextPluginStatus()==="unavailable"||Wt&&je.isParsed())&&(Be=NS(wt,b,Ae))}if(H){const mt=b.getValueAndResolveTokens("icon-image",Ae,m,te);ft=mt instanceof os?mt:os.fromString(mt)}if(!Be&&!ft)continue;const Dt=this.sortFeaturesByKey?q.evaluate(Ae,{},m):void 0;if(this.features.push({id:Se,text:Be,icon:ft,index:He,sourceLayerIndex:ke,geometry:Ae.geometry,properties:pe.properties,type:JS[pe.type],sortKey:Dt}),ft&&(Q[ft.name]=!0),Be){const mt=C.evaluate(Ae,{},m).join(","),wt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.al.vertical)>=0;for(const Wt of Be.sections)if(Wt.image)Q[Wt.image.name]=!0;else{const Bt=v(Be.toString()),$t=Wt.fontStack||mt,Et=J[$t]=J[$t]||{};this.calculateGlyphDependencies(Wt.text,Et,wt,this.allowVerticalPlacement,Bt)}}}E.get("symbol-placement")==="line"&&(this.features=function(pe){const Se={},He={},ke=[];let K=0;function Ae(mt){ke.push(pe[mt]),K++}function Be(mt,wt,Wt){const Bt=He[mt];return delete He[mt],He[wt]=Bt,ke[Bt].geometry[0].pop(),ke[Bt].geometry[0]=ke[Bt].geometry[0].concat(Wt[0]),Bt}function ft(mt,wt,Wt){const Bt=Se[wt];return delete Se[wt],Se[mt]=Bt,ke[Bt].geometry[0].shift(),ke[Bt].geometry[0]=Wt[0].concat(ke[Bt].geometry[0]),Bt}function Dt(mt,wt,Wt){const Bt=Wt?wt[0][wt[0].length-1]:wt[0][0];return`${mt}:${Bt.x}:${Bt.y}`}for(let mt=0;mt<pe.length;mt++){const wt=pe[mt],Wt=wt.geometry,Bt=wt.text?wt.text.toString():null;if(!Bt){Ae(mt);continue}const $t=Dt(Bt,Wt),Et=Dt(Bt,Wt,!0);if($t in He&&Et in Se&&He[$t]!==Se[Et]){const fi=ft($t,Et,Wt),Si=Be($t,Et,ke[fi].geometry);delete Se[$t],delete He[Et],He[Dt(Bt,ke[Si].geometry,!0)]=Si,ke[fi].geometry=null}else $t in He?Be($t,Et,Wt):Et in Se?ft($t,Et,Wt):(Ae(mt),Se[$t]=K-1,He[Et]=K-1)}return ke.filter(mt=>mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,Se)=>pe.sortKey-Se.sortKey)}update(s,u,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,m),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const m=this.lineVertexArray.length;if(s.segment!==void 0){let b=s.dist(u[s.segment+1]),E=s.dist(u[s.segment]);const C={};for(let D=s.segment+1;D<u.length;D++)C[D]={x:u[D].x,y:u[D].y,tileUnitDistanceFromAnchor:b},D<u.length-1&&(b+=u[D+1].dist(u[D]));for(let D=s.segment||0;D>=0;D--)C[D]={x:u[D].x,y:u[D].y,tileUnitDistanceFromAnchor:E},D>0&&(E+=u[D-1].dist(u[D]));for(let D=0;D<u.length;D++){const L=C[D];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(s,u,m,b,E,C,D,L,U,H,q,Q){const J=s.indexArray,te=s.layoutVertexArray,oe=s.segments.prepareSegment(4*u.length,te,J,this.canOverlap?C.sortKey:void 0),pe=this.glyphOffsetArray.length,Se=oe.vertexLength,He=this.allowVerticalPlacement&&D===f.al.vertical?Math.PI/2:0,ke=C.text&&C.text.sections;for(let K=0;K<u.length;K++){const{tl:Ae,tr:Be,bl:ft,br:Dt,tex:mt,pixelOffsetTL:wt,pixelOffsetBR:Wt,minFontScaleX:Bt,minFontScaleY:$t,glyphOffset:Et,isSDF:fi,sectionIndex:Si}=u[K],xi=oe.vertexLength,pi=Et[1];gd(te,L.x,L.y,Ae.x,pi+Ae.y,mt.x,mt.y,m,fi,wt.x,wt.y,Bt,$t),gd(te,L.x,L.y,Be.x,pi+Be.y,mt.x+mt.w,mt.y,m,fi,Wt.x,wt.y,Bt,$t),gd(te,L.x,L.y,ft.x,pi+ft.y,mt.x,mt.y+mt.h,m,fi,wt.x,Wt.y,Bt,$t),gd(te,L.x,L.y,Dt.x,pi+Dt.y,mt.x+mt.w,mt.y+mt.h,m,fi,Wt.x,Wt.y,Bt,$t),Y0(s.dynamicLayoutVertexArray,L,He),J.emplaceBack(xi,xi+2,xi+1),J.emplaceBack(xi+1,xi+2,xi+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),K!==u.length-1&&Si===u[K+1].sectionIndex||s.programConfigurations.populatePaintArrays(te.length,C,C.index,{},Q,ke&&ke[Si])}s.placedSymbolArray.emplaceBack(L.x,L.y,pe,this.glyphOffsetArray.length-pe,Se,U,H,L.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],D,0,!1,0,q)}_addCollisionDebugVertex(s,u,m,b,E,C){return u.emplaceBack(0,0),s.emplaceBack(m.x,m.y,b,E,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(s,u,m,b,E,C,D){const L=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),U=L.vertexLength,H=E.layoutVertexArray,q=E.collisionVertexArray,Q=D.anchorX,J=D.anchorY;this._addCollisionDebugVertex(H,q,C,Q,J,new ee(s,u)),this._addCollisionDebugVertex(H,q,C,Q,J,new ee(m,u)),this._addCollisionDebugVertex(H,q,C,Q,J,new ee(m,b)),this._addCollisionDebugVertex(H,q,C,Q,J,new ee(s,b)),L.vertexLength+=4;const te=E.indexArray;te.emplaceBack(U,U+1),te.emplaceBack(U+1,U+2),te.emplaceBack(U+2,U+3),te.emplaceBack(U+3,U),L.primitiveLength+=4}addDebugCollisionBoxes(s,u,m,b){for(let E=s;E<u;E++){const C=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,b?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new K0(Qr,Ky.members,In),this.iconCollisionBox=new K0(Qr,Ky.members,In);for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(s,u,m,b,E,C,D,L,U){const H={};for(let q=u;q<m;q++){const Q=s.get(q);H.textBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},H.textFeatureIndex=Q.featureIndex;break}for(let q=b;q<E;q++){const Q=s.get(q);H.verticalTextBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},H.verticalTextFeatureIndex=Q.featureIndex;break}for(let q=C;q<D;q++){const Q=s.get(q);H.iconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},H.iconFeatureIndex=Q.featureIndex;break}for(let q=L;q<U;q++){const Q=s.get(q);H.verticalIconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},H.verticalIconFeatureIndex=Q.featureIndex;break}return H}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,u){const m=s.placedSymbolArray.get(u),b=m.vertexStartIndex+4*m.numGlyphs;for(let E=m.vertexStartIndex;E<b;E+=4)s.indexArray.emplaceBack(E,E+2,E+1),s.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),m=Math.cos(s),b=[],E=[],C=[];for(let D=0;D<this.symbolInstances.length;++D){C.push(D);const L=this.symbolInstances.get(D);b.push(0|Math.round(u*L.anchorX+m*L.anchorY)),E.push(L.featureIndex)}return C.sort((D,L)=>b[D]-b[L]||E[L]-E[D]),C}addToSortKeyRanges(s,u){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===u?m.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const m=this.symbolInstances.get(u);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,E,C)=>{b>=0&&C.indexOf(b)===E&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let f2,A2;li("SymbolBucket",xh,{omit:["layers","collisionBoxArray","features","compareText"]}),xh.MAX_GLYPHS=65535,xh.addDynamicAttributes=Y0;var J0={get paint(){return A2=A2||new bi({"icon-opacity":new Gt(ge.paint_symbol["icon-opacity"]),"icon-color":new Gt(ge.paint_symbol["icon-color"]),"icon-halo-color":new Gt(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(ge.paint_symbol["text-opacity"]),"text-color":new Gt(ge.paint_symbol["text-color"],{runtimeType:Ei,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Gt(ge.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(ge.paint_symbol["text-halo-blur"]),"text-translate":new Ft(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(ge.paint_symbol["text-translate-anchor"])})},get layout(){return f2=f2||new bi({"symbol-placement":new Ft(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(ge.layout_symbol["icon-size"]),"icon-text-fit":new Ft(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(ge.layout_symbol["icon-image"]),"icon-rotate":new Gt(ge.layout_symbol["icon-rotate"]),"icon-padding":new Gt(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(ge.layout_symbol["icon-offset"]),"icon-anchor":new Gt(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(ge.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(ge.layout_symbol["text-field"]),"text-font":new Gt(ge.layout_symbol["text-font"]),"text-size":new Gt(ge.layout_symbol["text-size"]),"text-max-width":new Gt(ge.layout_symbol["text-max-width"]),"text-line-height":new Ft(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(ge.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(ge.layout_symbol["text-justify"]),"text-radial-offset":new Gt(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(ge.layout_symbol["text-anchor"]),"text-max-angle":new Ft(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(ge.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(ge.layout_symbol["text-rotate"]),"text-padding":new Ft(ge.layout_symbol["text-padding"]),"text-keep-upright":new Ft(ge.layout_symbol["text-keep-upright"]),"text-transform":new Gt(ge.layout_symbol["text-transform"]),"text-offset":new Gt(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(ge.layout_symbol["text-optional"])})}};class d2{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:ri,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}li("FormatSectionOverride",d2,{omit:["defaultValue"]});class md extends Ii{constructor(s){super(s,J0)}recalculate(s,u){if(super.recalculate(s,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const E of m)b.indexOf(E)<0&&b.push(E);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,u,m,b){const E=this.layout.get(s).evaluate(u,{},m,b),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||Uo(C.value)||!E?E:function(D,L){return L.replace(/{([^{}]+)}/g,(U,H)=>D&&H in D?String(D[H]):"")}(u.properties,E)}createBucket(s){return new xh(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of J0.paint.overridableProperties){if(!md.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),m=new d2(u),b=new gc(m,u.property.specification);let E=null;E=u.value.kind==="constant"||u.value.kind==="source"?new lu("source",b):new mc("composite",b,u.value.zoomStops),this.paint._values[s]=new ai(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,m){return!(!this.layout||u.isDataDriven()||m.isDataDriven())&&md.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const m=s.get("text-field"),b=J0.paint.properties[u];let E=!1;const C=D=>{for(const L of D)if(b.overrides&&b.overrides.hasOverride(L))return void(E=!0)};if(m.value.kind==="constant"&&m.value.value instanceof ss)C(m.value.value.sections);else if(m.value.kind==="source"){const D=U=>{E||(U instanceof Ui&&Vr(U.value)===Mo?C(U.value.sections):U instanceof Jl?C(U.sections):U.eachChild(D))},L=m.value;L._styleExpression&&D(L._styleExpression.expression)}return E}}let p2;var iE={get paint(){return p2=p2||new bi({"background-color":new Ft(ge.paint_background["background-color"]),"background-pattern":new mi(ge.paint_background["background-pattern"]),"background-opacity":new Ft(ge.paint_background["background-opacity"])})}};class rE extends Ii{constructor(s){super(s,iE)}}let g2;var nE={get paint(){return g2=g2||new bi({"raster-opacity":new Ft(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(ge.paint_raster["raster-saturation"]),"raster-contrast":new Ft(ge.paint_raster["raster-contrast"]),"raster-resampling":new Ft(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(ge.paint_raster["raster-fade-duration"])})}};class sE extends Ii{constructor(s){super(s,nE)}}class oE extends Ii{constructor(s){super(s,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class aE{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const lE={once:!0},eg=63710088e-1;class Ec{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ec(Zi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,m=this.lat*u,b=s.lat*u,E=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((s.lng-this.lng)*u);return eg*Math.acos(Math.min(E,1))}static convert(s){if(s instanceof Ec)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Ec(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Ec(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const m2=2*Math.PI*eg;function _2(h){return m2*Math.cos(h*Math.PI/180)}function y2(h){return(180+h)/360}function b2(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function v2(h,s){return h/_2(s)}function tg(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function x2(h,s){return h*_2(tg(s))}class Qf{constructor(s,u,m=0){this.x=+s,this.y=+u,this.z=+m}static fromLngLat(s,u=0){const m=Ec.convert(s);return new Qf(y2(m.lng),b2(m.lat),v2(u,m.lat))}toLngLat(){return new Ec(360*this.x-180,tg(this.y))}toAltitude(){return x2(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/m2*(s=tg(this.y),1/Math.cos(s*Math.PI/180));var s}}function w2(h,s,u){var m=2*Math.PI*6378137/256/Math.pow(2,u);return[h*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}class ig{constructor(s,u,m){if(!function(b,E,C){return!(b<0||b>25||C<0||C>=Math.pow(2,b)||E<0||E>=Math.pow(2,b))}(s,u,m))throw new Error(`x=${u}, y=${m}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=u,this.y=m,this.key=wh(0,s,s,u,m)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,u,m){const b=(C=this.y,D=this.z,L=w2(256*(E=this.x),256*(C=Math.pow(2,D)-C-1),D),U=w2(256*(E+1),256*(C+1),D),L[0]+","+L[1]+","+U[0]+","+U[1]);var E,C,D,L,U;const H=function(q,Q,J){let te,oe="";for(let pe=q;pe>0;pe--)te=1<<pe-1,oe+=(Q&te?1:0)+(J&te?2:0);return oe}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,H).replace(/{bbox-epsg-3857}/g,b)}isChildOf(s){const u=this.z-s.z;return u>0&&s.x===this.x>>u&&s.y===this.y>>u}getTilePoint(s){const u=Math.pow(2,this.z);return new ee((s.x*u-this.x)*Me,(s.y*u-this.y)*Me)}toString(){return`${this.z}/${this.x}/${this.y}`}}class T2{constructor(s,u){this.wrap=s,this.canonical=u,this.key=wh(s,u.z,u.z,u.x,u.y)}}class yo{constructor(s,u,m,b,E){if(this.terrainRttPosMatrix32f=null,s<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${m}`);this.overscaledZ=s,this.wrap=u,this.canonical=new ig(m,+b,+E),this.key=wh(u,s,m,b,E)}clone(){return new yo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-s;return s>this.canonical.z?new yo(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yo(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-s;return s>this.canonical.z?wh(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):wh(this.wrap*+u,s,s,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new yo(u,this.wrap,u,m,b),new yo(u,this.wrap,u,m+1,b),new yo(u,this.wrap,u,m,b+1),new yo(u,this.wrap,u,m+1,b+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new yo(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new T2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Qf(s.x-this.wrap,s.y))}}function wh(h,s,u,m,b){(h*=2)<0&&(h=-1*h-1);const E=1<<u;return(E*E*h+E*b+m).toString(36)+u.toString(36)+s.toString(36)}li("CanonicalTileID",ig),li("OverscaledTileID",yo,{omit:["terrainRttPosMatrix32f"]});class S2{constructor(s,u,m,b=1,E=1,C=1,D=0){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void sr(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const L=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=E,this.blueFactor=C,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let U=0;U<L;U++)this.data[this._idx(-1,U)]=this.data[this._idx(0,U)],this.data[this._idx(L,U)]=this.data[this._idx(L-1,U)],this.data[this._idx(U,-1)]=this.data[this._idx(U,0)],this.data[this._idx(U,L)]=this.data[this._idx(U,L-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(L,-1)]=this.data[this._idx(L-1,0)],this.data[this._idx(-1,L)]=this.data[this._idx(0,L-1)],this.data[this._idx(L,L)]=this.data[this._idx(L-1,L-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let U=0;U<L;U++)for(let H=0;H<L;H++){const q=this.get(U,H);q>this.max&&(this.max=q),q<this.min&&(this.min=q)}}get(s,u){const m=new Uint8Array(this.data.buffer),b=4*this._idx(s,u);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}unpack(s,u,m){return s*this.redFactor+u*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new _o({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,u,m){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let b=u*this.dim,E=u*this.dim+this.dim,C=m*this.dim,D=m*this.dim+this.dim;switch(u){case-1:b=E-1;break;case 1:E=b+1}switch(m){case-1:C=D-1;break;case 1:D=C+1}const L=-u*this.dim,U=-m*this.dim;for(let H=C;H<D;H++)for(let q=b;q<E;q++)this.data[this._idx(q,H)]=s.data[this._idx(q+L,H+U)]}}li("DEMData",S2);class E2{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const m=s[u];this._stringToNumber[m]=u,this._numberToString[u]=m}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class C2{constructor(s,u,m,b,E){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=m,s._y=b,this.properties=s.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s}}class I2{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new va(Me,16,0),this.grid3D=new va(Me,16,0),this.featureIndexArray=new bt,this.promoteId=u}insert(s,u,m,b,E,C){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,E);const L=C?this.grid3D:this.grid;for(let U=0;U<u.length;U++){const H=u[U],q=[1/0,1/0,-1/0,-1/0];for(let Q=0;Q<H.length;Q++){const J=H[Q];q[0]=Math.min(q[0],J.x),q[1]=Math.min(q[1],J.y),q[2]=Math.max(q[2],J.x),q[3]=Math.max(q[3],J.y)}q[0]<Me&&q[1]<Me&&q[2]>=0&&q[3]>=0&&L.insert(D,q[0],q[1],q[2],q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $f.VectorTile(new H0(this.rawTileData)).layers,this.sourceLayerCoder=new E2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,u,m,b){this.loadVTLayers();const E=s.params,C=Me/s.tileSize/s.scale,D=Ka(E.filter),L=s.queryGeometry,U=s.queryPadding*C,H=M2(L),q=this.grid.query(H.minX-U,H.minY-U,H.maxX+U,H.maxY+U),Q=M2(s.cameraQueryGeometry),J=this.grid3D.query(Q.minX-U,Q.minY-U,Q.maxX+U,Q.maxY+U,(pe,Se,He,ke)=>function(K,Ae,Be,ft,Dt){for(const wt of K)if(Ae<=wt.x&&Be<=wt.y&&ft>=wt.x&&Dt>=wt.y)return!0;const mt=[new ee(Ae,Be),new ee(Ae,Dt),new ee(ft,Dt),new ee(ft,Be)];if(K.length>2){for(const wt of mt)if(Tu(K,wt))return!0}for(let wt=0;wt<K.length-1;wt++)if(YT(K[wt],K[wt+1],mt))return!0;return!1}(s.cameraQueryGeometry,pe-U,Se-U,He+U,ke+U));for(const pe of J)q.push(pe);q.sort(cE);const te={};let oe;for(let pe=0;pe<q.length;pe++){const Se=q[pe];if(Se===oe)continue;oe=Se;const He=this.featureIndexArray.get(Se);let ke=null;this.loadMatchingFeature(te,He.bucketIndex,He.sourceLayerIndex,He.featureIndex,D,E.layers,E.availableImages,u,m,b,(K,Ae,Be)=>(ke||(ke=xu(K)),Ae.queryIntersectsFeature({queryGeometry:L,feature:K,featureState:Be,geometry:ke,zoom:this.z,transform:s.transform,pixelsToTileUnits:C,pixelPosMatrix:s.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:s.getElevation})))}return te}loadMatchingFeature(s,u,m,b,E,C,D,L,U,H,q){const Q=this.bucketLayerIDs[u];if(C&&!Q.some(pe=>C.has(pe)))return;const J=this.sourceLayerCoder.decode(m),te=this.vtLayers[J].feature(b);if(E.needGeometry){const pe=wu(te,!0);if(!E.filter(new Ze(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!E.filter(new Ze(this.tileID.overscaledZ),te))return;const oe=this.getId(te,J);for(let pe=0;pe<Q.length;pe++){const Se=Q[pe];if(C&&!C.has(Se))continue;const He=L[Se];if(!He)continue;let ke={};oe&&H&&(ke=H.getState(He.sourceLayer||"_geojsonTileLayer",oe));const K=Oi({},U[Se]);K.paint=P2(K.paint,He.paint,te,ke,D),K.layout=P2(K.layout,He.layout,te,ke,D);const Ae=!q||q(te,He,ke);if(!Ae)continue;const Be=new C2(te,this.z,this.x,this.y,oe);Be.layer=K;let ft=s[Se];ft===void 0&&(ft=s[Se]=[]),ft.push({featureIndex:b,feature:Be,intersectionZ:Ae})}}lookupSymbolFeatures(s,u,m,b,E,C,D,L){const U={};this.loadVTLayers();const H=Ka(E);for(const q of s)this.loadMatchingFeature(U,m,b,q,H,C,D,L,u);return U}hasLayer(s){for(const u of this.bucketLayerIDs)for(const m of u)if(s===m)return!0;return!1}getId(s,u){var m;let b=s.id;return this.promoteId&&(b=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof b=="boolean"&&(b=Number(b)),b===void 0&&(!((m=s.properties)===null||m===void 0)&&m.cluster)&&this.promoteId&&(b=Number(s.properties.cluster_id))),b}}function P2(h,s,u,m,b){return Ar(h,(E,C)=>{const D=s instanceof Ni?s.get(C):null;return D&&D.evaluate?D.evaluate(u,m,b):D})}function M2(h){let s=1/0,u=1/0,m=-1/0,b=-1/0;for(const E of h)s=Math.min(s,E.x),u=Math.min(u,E.y),m=Math.max(m,E.x),b=Math.max(b,E.y);return{minX:s,minY:u,maxX:m,maxY:b}}function cE(h,s){return s-h}function R2(h,s,u,m,b){const E=[];for(let C=0;C<h.length;C++){const D=h[C];let L;for(let U=0;U<D.length-1;U++){let H=D[U],q=D[U+1];H.x<s&&q.x<s||(H.x<s?H=new ee(s,H.y+(s-H.x)/(q.x-H.x)*(q.y-H.y))._round():q.x<s&&(q=new ee(s,H.y+(s-H.x)/(q.x-H.x)*(q.y-H.y))._round()),H.y<u&&q.y<u||(H.y<u?H=new ee(H.x+(u-H.y)/(q.y-H.y)*(q.x-H.x),u)._round():q.y<u&&(q=new ee(H.x+(u-H.y)/(q.y-H.y)*(q.x-H.x),u)._round()),H.x>=m&&q.x>=m||(H.x>=m?H=new ee(m,H.y+(m-H.x)/(q.x-H.x)*(q.y-H.y))._round():q.x>=m&&(q=new ee(m,H.y+(m-H.x)/(q.x-H.x)*(q.y-H.y))._round()),H.y>=b&&q.y>=b||(H.y>=b?H=new ee(H.x+(b-H.y)/(q.y-H.y)*(q.x-H.x),b)._round():q.y>=b&&(q=new ee(H.x+(b-H.y)/(q.y-H.y)*(q.x-H.x),b)._round()),L&&H.equals(L[L.length-1])||(L=[H],E.push(L)),L.push(q)))))}}return E}li("FeatureIndex",I2,{omit:["rawTileData","sourceLayerCoder"]});class Cc extends ee{constructor(s,u,m,b){super(s,u),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Cc(this.x,this.y,this.angle,this.segment)}}function k2(h,s,u,m,b){if(s.segment===void 0||u===0)return!0;let E=s,C=s.segment+1,D=0;for(;D>-u/2;){if(C--,C<0)return!1;D-=h[C].dist(E),E=h[C]}D+=h[C].dist(h[C+1]),C++;const L=[];let U=0;for(;D<u/2;){const H=h[C],q=h[C+1];if(!q)return!1;let Q=h[C-1].angleTo(H)-H.angleTo(q);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:D,angleDelta:Q}),U+=Q;D-L[0].distance>m;)U-=L.shift().angleDelta;if(U>b)return!1;C++,D+=H.dist(q)}return!0}function D2(h){let s=0;for(let u=0;u<h.length-1;u++)s+=h[u].dist(h[u+1]);return s}function B2(h,s,u){return h?.6*s*u:0}function O2(h,s){return Math.max(h?h.right-h.left:0,s?s.right-s.left:0)}function uE(h,s,u,m,b,E){const C=B2(u,b,E),D=O2(u,m)*E;let L=0;const U=D2(h)/2;for(let H=0;H<h.length-1;H++){const q=h[H],Q=h[H+1],J=q.dist(Q);if(L+J>U){const te=(U-L)/J,oe=Bs.number(q.x,Q.x,te),pe=Bs.number(q.y,Q.y,te),Se=new Cc(oe,pe,Q.angleTo(q),H);return Se._round(),!C||k2(h,Se,D,C,s)?Se:void 0}L+=J}}function hE(h,s,u,m,b,E,C,D,L){const U=B2(m,E,C),H=O2(m,b),q=H*C,Q=h[0].x===0||h[0].x===L||h[0].y===0||h[0].y===L;return s-q<s/4&&(s=q+s/4),L2(h,Q?s/2*D%s:(H/2+2*E)*C*D%s,s,U,u,q,Q,!1,L)}function L2(h,s,u,m,b,E,C,D,L){const U=E/2,H=D2(h);let q=0,Q=s-u,J=[];for(let te=0;te<h.length-1;te++){const oe=h[te],pe=h[te+1],Se=oe.dist(pe),He=pe.angleTo(oe);for(;Q+u<q+Se;){Q+=u;const ke=(Q-q)/Se,K=Bs.number(oe.x,pe.x,ke),Ae=Bs.number(oe.y,pe.y,ke);if(K>=0&&K<L&&Ae>=0&&Ae<L&&Q-U>=0&&Q+U<=H){const Be=new Cc(K,Ae,He,te);Be._round(),m&&!k2(h,Be,E,m,b)||J.push(Be)}}q+=Se}return D||J.length||C||(J=L2(h,q/2,u,m,b,E,C,!0,L)),J}li("Anchor",Cc);const Kf=Zs;function F2(h,s,u,m){const b=[],E=h.image,C=E.pixelRatio,D=E.paddedRect.w-2*Kf,L=E.paddedRect.h-2*Kf;let U={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const H=E.stretchX||[[0,D]],q=E.stretchY||[[0,L]],Q=(Et,fi)=>Et+fi[1]-fi[0],J=H.reduce(Q,0),te=q.reduce(Q,0),oe=D-J,pe=L-te;let Se=0,He=J,ke=0,K=te,Ae=0,Be=oe,ft=0,Dt=pe;if(E.content&&m){const Et=E.content,fi=Et[2]-Et[0],Si=Et[3]-Et[1];(E.textFitWidth||E.textFitHeight)&&(U=c2(h)),Se=_d(H,0,Et[0]),ke=_d(q,0,Et[1]),He=_d(H,Et[0],Et[2]),K=_d(q,Et[1],Et[3]),Ae=Et[0]-Se,ft=Et[1]-ke,Be=fi-He,Dt=Si-K}const mt=U.x1,wt=U.y1,Wt=U.x2-mt,Bt=U.y2-wt,$t=(Et,fi,Si,xi)=>{const pi=yd(Et.stretch-Se,He,Wt,mt),ar=bd(Et.fixed-Ae,Be,Et.stretch,J),en=yd(fi.stretch-ke,K,Bt,wt),Mn=bd(fi.fixed-ft,Dt,fi.stretch,te),ds=yd(Si.stretch-Se,He,Wt,mt),bo=bd(Si.fixed-Ae,Be,Si.stretch,J),qs=yd(xi.stretch-ke,K,Bt,wt),Kn=bd(xi.fixed-ft,Dt,xi.stretch,te),Kr=new ee(pi,en),On=new ee(ds,en),Jn=new ee(ds,qs),es=new ee(pi,qs),Ls=new ee(ar/C,Mn/C),vo=new ee(bo/C,Kn/C),Ln=s*Math.PI/180;if(Ln){const Fn=Math.sin(Ln),Nn=Math.cos(Ln),yn=[Nn,-Fn,Fn,Nn];Kr._matMult(yn),On._matMult(yn),es._matMult(yn),Jn._matMult(yn)}const Xs=Et.stretch+Et.fixed,Rn=fi.stretch+fi.fixed;return{tl:Kr,tr:On,bl:es,br:Jn,tex:{x:E.paddedRect.x+Kf+Xs,y:E.paddedRect.y+Kf+Rn,w:Si.stretch+Si.fixed-Xs,h:xi.stretch+xi.fixed-Rn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ls,pixelOffsetBR:vo,minFontScaleX:Be/C/Wt,minFontScaleY:Dt/C/Bt,isSDF:u}};if(m&&(E.stretchX||E.stretchY)){const Et=N2(H,oe,J),fi=N2(q,pe,te);for(let Si=0;Si<Et.length-1;Si++){const xi=Et[Si],pi=Et[Si+1];for(let ar=0;ar<fi.length-1;ar++)b.push($t(xi,fi[ar],pi,fi[ar+1]))}}else b.push($t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:L+1}));return b}function _d(h,s,u){let m=0;for(const b of h)m+=Math.max(s,Math.min(u,b[1]))-Math.max(s,Math.min(u,b[0]));return m}function N2(h,s,u){const m=[{fixed:-1,stretch:0}];for(const[b,E]of h){const C=m[m.length-1];m.push({fixed:b-C.stretch,stretch:C.stretch}),m.push({fixed:b-C.stretch,stretch:C.stretch+(E-b)})}return m.push({fixed:s+Kf,stretch:u}),m}function yd(h,s,u,m){return h/s*u+m}function bd(h,s,u,m){return h-s*u/m}class vd{constructor(s,u,m,b,E,C,D,L,U,H){var q;if(this.boxStartIndex=s.length,U){let Q=C.top,J=C.bottom;const te=C.collisionPadding;te&&(Q-=te[1],J+=te[3]);let oe=J-Q;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const Q=!((q=C.image)===null||q===void 0)&&q.content&&(C.image.textFitWidth||C.image.textFitHeight)?c2(C):{x1:C.left,y1:C.top,x2:C.right,y2:C.bottom};Q.y1=Q.y1*D-L[0],Q.y2=Q.y2*D+L[2],Q.x1=Q.x1*D-L[3],Q.x2=Q.x2*D+L[1];const J=C.collisionPadding;if(J&&(Q.x1-=J[0]*D,Q.y1-=J[1]*D,Q.x2+=J[2]*D,Q.y2+=J[3]*D),H){const te=new ee(Q.x1,Q.y1),oe=new ee(Q.x2,Q.y1),pe=new ee(Q.x1,Q.y2),Se=new ee(Q.x2,Q.y2),He=H*Math.PI/180;te._rotate(He),oe._rotate(He),pe._rotate(He),Se._rotate(He),Q.x1=Math.min(te.x,oe.x,pe.x,Se.x),Q.x2=Math.max(te.x,oe.x,pe.x,Se.x),Q.y1=Math.min(te.y,oe.y,pe.y,Se.y),Q.y2=Math.max(te.y,oe.y,pe.y,Se.y)}s.emplaceBack(u.x,u.y,Q.x1,Q.y1,Q.x2,Q.y2,m,b,E)}this.boxEndIndex=s.length}}class fE{constructor(s=[],u=(m,b)=>m<b?-1:m>b?1:0){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:m}=this,b=u[s];for(;s>0;){const E=s-1>>1,C=u[E];if(m(b,C)>=0)break;u[s]=C,s=E}u[s]=b}_down(s){const{data:u,compare:m}=this,b=this.length>>1,E=u[s];for(;s<b;){let C=1+(s<<1);const D=C+1;if(D<this.length&&m(u[D],u[C])<0&&(C=D),m(u[C],E)>=0)break;u[s]=u[C],s=C}u[s]=E}}function AE(h,s=1,u=!1){let m=1/0,b=1/0,E=-1/0,C=-1/0;const D=h[0];for(let J=0;J<D.length;J++){const te=D[J];(!J||te.x<m)&&(m=te.x),(!J||te.y<b)&&(b=te.y),(!J||te.x>E)&&(E=te.x),(!J||te.y>C)&&(C=te.y)}const L=Math.min(E-m,C-b);let U=L/2;const H=new fE([],dE);if(L===0)return new ee(m,b);for(let J=m;J<E;J+=L)for(let te=b;te<C;te+=L)H.push(new Th(J+U,te+U,U,h));let q=function(J){let te=0,oe=0,pe=0;const Se=J[0];for(let He=0,ke=Se.length,K=ke-1;He<ke;K=He++){const Ae=Se[He],Be=Se[K],ft=Ae.x*Be.y-Be.x*Ae.y;oe+=(Ae.x+Be.x)*ft,pe+=(Ae.y+Be.y)*ft,te+=3*ft}return new Th(oe/te,pe/te,0,J)}(h),Q=H.length;for(;H.length;){const J=H.pop();(J.d>q.d||!q.d)&&(q=J,u&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,Q)),J.max-q.d<=s||(U=J.h/2,H.push(new Th(J.p.x-U,J.p.y-U,U,h)),H.push(new Th(J.p.x+U,J.p.y-U,U,h)),H.push(new Th(J.p.x-U,J.p.y+U,U,h)),H.push(new Th(J.p.x+U,J.p.y+U,U,h)),Q+=4)}return u&&(console.log(`num probes: ${Q}`),console.log(`best distance: ${q.d}`)),q.p}function dE(h,s){return s.max-h.max}function Th(h,s,u,m){this.p=new ee(h,s),this.h=u,this.d=function(b,E){let C=!1,D=1/0;for(let L=0;L<E.length;L++){const U=E[L];for(let H=0,q=U.length,Q=q-1;H<q;Q=H++){const J=U[H],te=U[Q];J.y>b.y!=te.y>b.y&&b.x<(te.x-J.x)*(b.y-J.y)/(te.y-J.y)+J.x&&(C=!C),D=Math.min(D,_y(b,J,te))}}return(C?1:-1)*Math.sqrt(D)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var As;f.aB=void 0,(As=f.aB||(f.aB={}))[As.center=1]="center",As[As.left=2]="left",As[As.right=3]="right",As[As.top=4]="top",As[As.bottom=5]="bottom",As[As["top-left"]=6]="top-left",As[As["top-right"]=7]="top-right",As[As["bottom-left"]=8]="bottom-left",As[As["bottom-right"]=9]="bottom-right";const Ic=7,rg=Number.POSITIVE_INFINITY;function z2(h,s){return s[1]!==rg?function(u,m,b){let E=0,C=0;switch(m=Math.abs(m),b=Math.abs(b),u){case"top-right":case"top-left":case"top":C=b-Ic;break;case"bottom-right":case"bottom-left":case"bottom":C=-b+Ic}switch(u){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,C]}(h,s[0],s[1]):function(u,m){let b=0,E=0;m<0&&(m=0);const C=m/Math.SQRT2;switch(u){case"top-right":case"top-left":E=C-Ic;break;case"bottom-right":case"bottom-left":E=-C+Ic;break;case"bottom":E=-m+Ic;break;case"top":E=m-Ic}switch(u){case"top-right":case"bottom-right":b=-C;break;case"top-left":case"bottom-left":b=C;break;case"left":b=m;break;case"right":b=-m}return[b,E]}(h,s[0])}function U2(h,s,u){var m;const b=h.layout,E=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(s,{},u);if(E){const D=E.values,L=[];for(let U=0;U<D.length;U+=2){const H=L[U]=D[U],q=D[U+1].map(Q=>Q*Pn);H.startsWith("top")?q[1]-=Ic:H.startsWith("bottom")&&(q[1]+=Ic),L[U+1]=q}return new Zn(L)}const C=b.get("text-variable-anchor");if(C){let D;D=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(s,{},u)*Pn,rg]:b.get("text-offset").evaluate(s,{},u).map(U=>U*Pn);const L=[];for(const U of C)L.push(U,z2(U,D));return new Zn(L)}return null}function ng(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pE(h,s,u,m,b,E,C,D,L,U,H,q){let Q=E.textMaxSize.evaluate(s,{});Q===void 0&&(Q=C);const J=h.layers[0].layout,te=J.get("icon-offset").evaluate(s,{},H),oe=V2(u.horizontal),pe=C/24,Se=h.tilePixelRatio*pe,He=h.tilePixelRatio*Q/24,ke=h.tilePixelRatio*D,K=h.tilePixelRatio*J.get("symbol-spacing"),Ae=J.get("text-padding")*h.tilePixelRatio,Be=function(Si,xi,pi,ar=1){const en=Si.get("icon-padding").evaluate(xi,{},pi),Mn=en&&en.values;return[Mn[0]*ar,Mn[1]*ar,Mn[2]*ar,Mn[3]*ar]}(J,s,H,h.tilePixelRatio),ft=J.get("text-max-angle")/180*Math.PI,Dt=J.get("text-rotation-alignment")!=="viewport"&&J.get("symbol-placement")!=="point",mt=J.get("icon-rotation-alignment")==="map"&&J.get("symbol-placement")!=="point",wt=J.get("symbol-placement"),Wt=K/2,Bt=J.get("icon-text-fit");let $t;m&&Bt!=="none"&&(h.allowVerticalPlacement&&u.vertical&&($t=u2(m,u.vertical,Bt,J.get("icon-text-fit-padding"),te,pe)),oe&&(m=u2(m,oe,Bt,J.get("icon-text-fit-padding"),te,pe)));const Et=H?q.line.getGranularityForZoomLevel(H.z):1,fi=(Si,xi)=>{xi.x<0||xi.x>=Me||xi.y<0||xi.y>=Me||function(pi,ar,en,Mn,ds,bo,qs,Kn,Kr,On,Jn,es,Ls,vo,Ln,Xs,Rn,Fn,Nn,yn,zr,Ta,Sh,Sa,_E){const Eh=pi.addToLineVertexArray(ar,en);let Cu,Ch,Ih,Ph,Z2=0,q2=0,X2=0,G2=0,fg=-1,Ag=-1;const Nl={};let Y2=xa("");if(pi.allowVerticalPlacement&&Mn.vertical){const Es=Kn.layout.get("text-rotate").evaluate(zr,{},Sa)+90;Ih=new vd(Kr,ar,On,Jn,es,Mn.vertical,Ls,vo,Ln,Es),qs&&(Ph=new vd(Kr,ar,On,Jn,es,qs,Rn,Fn,Ln,Es))}if(ds){const Es=Kn.layout.get("icon-rotate").evaluate(zr,{}),xo=Kn.layout.get("icon-text-fit")!=="none",Iu=F2(ds,Es,Sh,xo),Ca=qs?F2(qs,Es,Sh,xo):void 0;Ch=new vd(Kr,ar,On,Jn,es,ds,Rn,Fn,!1,Es),Z2=4*Iu.length;const Pu=pi.iconSizeData;let ll=null;Pu.kind==="source"?(ll=[al*Kn.layout.get("icon-size").evaluate(zr,{})],ll[0]>Sc&&sr(`${pi.layerIds[0]}: Value for "icon-size" is >= ${Yf}. Reduce your "icon-size".`)):Pu.kind==="composite"&&(ll=[al*Ta.compositeIconSizes[0].evaluate(zr,{},Sa),al*Ta.compositeIconSizes[1].evaluate(zr,{},Sa)],(ll[0]>Sc||ll[1]>Sc)&&sr(`${pi.layerIds[0]}: Value for "icon-size" is >= ${Yf}. Reduce your "icon-size".`)),pi.addSymbols(pi.icon,Iu,ll,yn,Nn,zr,f.al.none,ar,Eh.lineStartIndex,Eh.lineLength,-1,Sa),fg=pi.icon.placedSymbolArray.length-1,Ca&&(q2=4*Ca.length,pi.addSymbols(pi.icon,Ca,ll,yn,Nn,zr,f.al.vertical,ar,Eh.lineStartIndex,Eh.lineLength,-1,Sa),Ag=pi.icon.placedSymbolArray.length-1)}const Q2=Object.keys(Mn.horizontal);for(const Es of Q2){const xo=Mn.horizontal[Es];if(!Cu){Y2=xa(xo.text);const Ca=Kn.layout.get("text-rotate").evaluate(zr,{},Sa);Cu=new vd(Kr,ar,On,Jn,es,xo,Ls,vo,Ln,Ca)}const Iu=xo.positionedLines.length===1;if(X2+=j2(pi,ar,xo,bo,Kn,Ln,zr,Xs,Eh,Mn.vertical?f.al.horizontal:f.al.horizontalOnly,Iu?Q2:[Es],Nl,fg,Ta,Sa),Iu)break}Mn.vertical&&(G2+=j2(pi,ar,Mn.vertical,bo,Kn,Ln,zr,Xs,Eh,f.al.vertical,["vertical"],Nl,Ag,Ta,Sa));const yE=Cu?Cu.boxStartIndex:pi.collisionBoxArray.length,bE=Cu?Cu.boxEndIndex:pi.collisionBoxArray.length,vE=Ih?Ih.boxStartIndex:pi.collisionBoxArray.length,xE=Ih?Ih.boxEndIndex:pi.collisionBoxArray.length,wE=Ch?Ch.boxStartIndex:pi.collisionBoxArray.length,TE=Ch?Ch.boxEndIndex:pi.collisionBoxArray.length,SE=Ph?Ph.boxStartIndex:pi.collisionBoxArray.length,EE=Ph?Ph.boxEndIndex:pi.collisionBoxArray.length;let Ea=-1;const wd=(Es,xo)=>Es&&Es.circleDiameter?Math.max(Es.circleDiameter,xo):xo;Ea=wd(Cu,Ea),Ea=wd(Ih,Ea),Ea=wd(Ch,Ea),Ea=wd(Ph,Ea);const K2=Ea>-1?1:0;K2&&(Ea*=_E/Pn),pi.glyphOffsetArray.length>=xh.MAX_GLYPHS&&sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zr.sortKey!==void 0&&pi.addToSortKeyRanges(pi.symbolInstances.length,zr.sortKey);const CE=U2(Kn,zr,Sa),[IE,PE]=function(Es,xo){const Iu=Es.length,Ca=xo==null?void 0:xo.values;if((Ca==null?void 0:Ca.length)>0)for(let Pu=0;Pu<Ca.length;Pu+=2){const ll=Ca[Pu+1];Es.emplaceBack(f.aB[Ca[Pu]],ll[0],ll[1])}return[Iu,Es.length]}(pi.textAnchorOffsets,CE);pi.symbolInstances.emplaceBack(ar.x,ar.y,Nl.right>=0?Nl.right:-1,Nl.center>=0?Nl.center:-1,Nl.left>=0?Nl.left:-1,Nl.vertical||-1,fg,Ag,Y2,yE,bE,vE,xE,wE,TE,SE,EE,On,X2,G2,Z2,q2,K2,0,Ls,Ea,IE,PE)}(h,xi,Si,u,m,b,$t,h.layers[0],h.collisionBoxArray,s.index,s.sourceLayerIndex,h.index,Se,[Ae,Ae,Ae,Ae],Dt,L,ke,Be,mt,te,s,E,U,H,C)};if(wt==="line")for(const Si of R2(s.geometry,0,0,Me,Me)){const xi=Eu(Si,Et),pi=hE(xi,K,ft,u.vertical||oe,m,24,He,h.overscaling,Me);for(const ar of pi)oe&&gE(h,oe.text,Wt,ar)||fi(xi,ar)}else if(wt==="line-center"){for(const Si of s.geometry)if(Si.length>1){const xi=Eu(Si,Et),pi=uE(xi,ft,u.vertical||oe,m,24,He);pi&&fi(xi,pi)}}else if(s.type==="Polygon")for(const Si of Xa(s.geometry,0)){const xi=AE(Si,16);fi(Eu(Si[0],Et,!0),new Cc(xi.x,xi.y,0))}else if(s.type==="LineString")for(const Si of s.geometry){const xi=Eu(Si,Et);fi(xi,new Cc(xi[0].x,xi[0].y,0))}else if(s.type==="Point")for(const Si of s.geometry)for(const xi of Si)fi([xi],new Cc(xi.x,xi.y,0))}function j2(h,s,u,m,b,E,C,D,L,U,H,q,Q,J,te){const oe=function(He,ke,K,Ae,Be,ft,Dt,mt){const wt=Ae.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Wt=[];for(const Bt of ke.positionedLines)for(const $t of Bt.positionedGlyphs){if(!$t.rect)continue;const Et=$t.rect||{};let fi=WS+1,Si=!0,xi=1,pi=0;const ar=(Be||mt)&&$t.vertical,en=$t.metrics.advance*$t.scale/2;if(mt&&ke.verticalizable&&(pi=Bt.lineOffset/2-($t.imageName?-(Pn-$t.metrics.width*$t.scale)/2:($t.scale-1)*Pn)),$t.imageName){const Fn=Dt[$t.imageName];Si=Fn.sdf,xi=Fn.pixelRatio,fi=Zs/xi}const Mn=Be?[$t.x+en,$t.y]:[0,0];let ds=Be?[0,0]:[$t.x+en+K[0],$t.y+K[1]-pi],bo=[0,0];ar&&(bo=ds,ds=[0,0]);const qs=$t.metrics.isDoubleResolution?2:1,Kn=($t.metrics.left-fi)*$t.scale-en+ds[0],Kr=(-$t.metrics.top-fi)*$t.scale+ds[1],On=Kn+Et.w/qs*$t.scale/xi,Jn=Kr+Et.h/qs*$t.scale/xi,es=new ee(Kn,Kr),Ls=new ee(On,Kr),vo=new ee(Kn,Jn),Ln=new ee(On,Jn);if(ar){const Fn=new ee(-en,en-Ad),Nn=-Math.PI/2,yn=Pn/2-en,zr=new ee(5-Ad-yn,-($t.imageName?yn:0)),Ta=new ee(...bo);es._rotateAround(Nn,Fn)._add(zr)._add(Ta),Ls._rotateAround(Nn,Fn)._add(zr)._add(Ta),vo._rotateAround(Nn,Fn)._add(zr)._add(Ta),Ln._rotateAround(Nn,Fn)._add(zr)._add(Ta)}if(wt){const Fn=Math.sin(wt),Nn=Math.cos(wt),yn=[Nn,-Fn,Fn,Nn];es._matMult(yn),Ls._matMult(yn),vo._matMult(yn),Ln._matMult(yn)}const Xs=new ee(0,0),Rn=new ee(0,0);Wt.push({tl:es,tr:Ls,bl:vo,br:Ln,tex:Et,writingMode:ke.writingMode,glyphOffset:Mn,sectionIndex:$t.sectionIndex,isSDF:Si,pixelOffsetTL:Xs,pixelOffsetBR:Rn,minFontScaleX:0,minFontScaleY:0})}return Wt}(0,u,D,b,E,C,m,h.allowVerticalPlacement),pe=h.textSizeData;let Se=null;pe.kind==="source"?(Se=[al*b.layout.get("text-size").evaluate(C,{})],Se[0]>Sc&&sr(`${h.layerIds[0]}: Value for "text-size" is >= ${Yf}. Reduce your "text-size".`)):pe.kind==="composite"&&(Se=[al*J.compositeTextSizes[0].evaluate(C,{},te),al*J.compositeTextSizes[1].evaluate(C,{},te)],(Se[0]>Sc||Se[1]>Sc)&&sr(`${h.layerIds[0]}: Value for "text-size" is >= ${Yf}. Reduce your "text-size".`)),h.addSymbols(h.text,oe,Se,D,E,C,U,s,L.lineStartIndex,L.lineLength,Q,te);for(const He of H)q[He]=h.text.placedSymbolArray.length-1;return 4*oe.length}function V2(h){for(const s in h)return h[s];return null}function gE(h,s,u,m){const b=h.compareText;if(s in b){const E=b[s];for(let C=E.length-1;C>=0;C--)if(m.dist(E[C])<u)return!0}else b[s]=[];return b[s].push(m),!1}const W2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sg{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,m]=new Uint8Array(s,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const E=W2[15&m];if(!E)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(s,2,1),[D]=new Uint32Array(s,4,1);return new sg(D,C,E,s)}constructor(s,u=64,m=Float64Array,b){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=m,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const E=W2.indexOf(this.ArrayType),C=2*s*this.ArrayType.BYTES_PER_ELEMENT,D=s*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-D%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+D+L,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+C+D+L),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+D+L,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=s)}add(s,u){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=s,this.coords[this._pos++]=u,m}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return og(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,u,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:C,nodeSize:D}=this,L=[0,E.length-1,0],U=[];for(;L.length;){const H=L.pop()||0,q=L.pop()||0,Q=L.pop()||0;if(q-Q<=D){for(let pe=Q;pe<=q;pe++){const Se=C[2*pe],He=C[2*pe+1];Se>=s&&Se<=m&&He>=u&&He<=b&&U.push(E[pe])}continue}const J=Q+q>>1,te=C[2*J],oe=C[2*J+1];te>=s&&te<=m&&oe>=u&&oe<=b&&U.push(E[J]),(H===0?s<=te:u<=oe)&&(L.push(Q),L.push(J-1),L.push(1-H)),(H===0?m>=te:b>=oe)&&(L.push(J+1),L.push(q),L.push(1-H))}return U}within(s,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:E,nodeSize:C}=this,D=[0,b.length-1,0],L=[],U=m*m;for(;D.length;){const H=D.pop()||0,q=D.pop()||0,Q=D.pop()||0;if(q-Q<=C){for(let pe=Q;pe<=q;pe++)$2(E[2*pe],E[2*pe+1],s,u)<=U&&L.push(b[pe]);continue}const J=Q+q>>1,te=E[2*J],oe=E[2*J+1];$2(te,oe,s,u)<=U&&L.push(b[J]),(H===0?s-m<=te:u-m<=oe)&&(D.push(Q),D.push(J-1),D.push(1-H)),(H===0?s+m>=te:u+m>=oe)&&(D.push(J+1),D.push(q),D.push(1-H))}return L}}function og(h,s,u,m,b,E){if(b-m<=u)return;const C=m+b>>1;H2(h,s,C,m,b,E),og(h,s,u,m,C-1,1-E),og(h,s,u,C+1,b,1-E)}function H2(h,s,u,m,b,E){for(;b>m;){if(b-m>600){const U=b-m+1,H=u-m+1,q=Math.log(U),Q=.5*Math.exp(2*q/3),J=.5*Math.sqrt(q*Q*(U-Q)/U)*(H-U/2<0?-1:1);H2(h,s,u,Math.max(m,Math.floor(u-H*Q/U+J)),Math.min(b,Math.floor(u+(U-H)*Q/U+J)),E)}const C=s[2*u+E];let D=m,L=b;for(Jf(h,s,m,u),s[2*b+E]>C&&Jf(h,s,m,b);D<L;){for(Jf(h,s,D,L),D++,L--;s[2*D+E]<C;)D++;for(;s[2*L+E]>C;)L--}s[2*m+E]===C?Jf(h,s,m,L):(L++,Jf(h,s,L,b)),L<=u&&(m=L+1),u<=L&&(b=L-1)}}function Jf(h,s,u,m){ag(h,u,m),ag(s,2*u,2*m),ag(s,2*u+1,2*m+1)}function ag(h,s,u){const m=h[s];h[s]=h[u],h[u]=m}function $2(h,s,u,m){const b=h-u,E=s-m;return b*b+E*E}var lg;f.co=void 0,(lg=f.co||(f.co={})).create="create",lg.load="load",lg.fullLoad="fullLoad";let xd=null,eA=[];const cg=1e3/60,ug="loadTime",hg="fullLoadTime",mE={mark(h){performance.mark(h)},frame(h){const s=h;xd!=null&&eA.push(s-xd),xd=s},clearMetrics(){xd=null,eA=[],performance.clearMeasures(ug),performance.clearMeasures(hg);for(const h in f.co)performance.clearMarks(f.co[h])},getPerformanceMetrics(){performance.measure(ug,f.co.create,f.co.load),performance.measure(hg,f.co.create,f.co.fullLoad);const h=performance.getEntriesByName(ug)[0].duration,s=performance.getEntriesByName(hg)[0].duration,u=eA.length,m=1/(eA.reduce((E,C)=>E+C,0)/u/1e3),b=eA.filter(E=>E>cg).reduce((E,C)=>E+(C-cg)/cg,0);return{loadTime:h,fullLoadTime:s,fps:m,percentDroppedFrames:b/(u+b)*100,totalFrames:u}}};f.$=Qf,f.A=Ke,f.B=Bs,f.C=Ze,f.D=Ft,f.E=$e,f.F=ph,f.G=function(h){if(Vt==null){const s=h.navigator?h.navigator.userAgent:null;Vt=!!h.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Vt},f.H=class{constructor(h,s){this.target=h,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new aE(()=>this.process()),this.subscription=Tn(this.target,"message",u=>this.receive(u),!1),this.globalScope=qi(self)?h:window}registerMessageHandler(h,s){this.messageHandlers[h]=s}sendAsync(h,s){return new Promise((u,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=s?Tn(s.signal,"abort",()=>{E==null||E.unsubscribe(),delete this.resolveRejects[b];const L={id:b,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},lE):null;this.resolveRejects[b]={resolve:L=>{E==null||E.unsubscribe(),u(L)},reject:L=>{E==null||E.unsubscribe(),m(L)}};const C=[],D=Object.assign(Object.assign({},h),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Ts(h.data,C)});this.target.postMessage(D,{transfer:C})})}receive(h){const s=h.data,u=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[u];const m=this.abortControllers[u];return delete this.abortControllers[u],void(m&&m.abort())}if(qi(self)||s.mustQueue)return this.tasks[u]=s,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,s)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),s=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(h,s)}processTask(h,s){return a(this,void 0,void 0,function*(){if(s.type==="<response>"){const b=this.resolveRejects[h];return delete this.resolveRejects[h],b?void(s.error?b.reject(d(s.error)):b.resolve(d(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=d(s.data),m=new AbortController;this.abortControllers[h]=m;try{const b=yield this.messageHandlers[s.type](s.sourceMapId,u,m);this.completeTask(h,null,b)}catch(b){this.completeTask(h,b)}})}completeTask(h,s,u){const m=[];delete this.abortControllers[h];const b={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Ts(s):null,data:Ts(u,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.I=Z0,f.J=Na,f.K=function(){var h=new Ke(16);return Ke!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},f.L=function(h,s,u){var m,b,E,C,D,L,U,H,q,Q,J,te,oe=u[0],pe=u[1],Se=u[2];return s===h?(h[12]=s[0]*oe+s[4]*pe+s[8]*Se+s[12],h[13]=s[1]*oe+s[5]*pe+s[9]*Se+s[13],h[14]=s[2]*oe+s[6]*pe+s[10]*Se+s[14],h[15]=s[3]*oe+s[7]*pe+s[11]*Se+s[15]):(b=s[1],E=s[2],C=s[3],D=s[4],L=s[5],U=s[6],H=s[7],q=s[8],Q=s[9],J=s[10],te=s[11],h[0]=m=s[0],h[1]=b,h[2]=E,h[3]=C,h[4]=D,h[5]=L,h[6]=U,h[7]=H,h[8]=q,h[9]=Q,h[10]=J,h[11]=te,h[12]=m*oe+D*pe+q*Se+s[12],h[13]=b*oe+L*pe+Q*Se+s[13],h[14]=E*oe+U*pe+J*Se+s[14],h[15]=C*oe+H*pe+te*Se+s[15]),h},f.M=function(h,s,u){var m=u[0],b=u[1],E=u[2];return h[0]=s[0]*m,h[1]=s[1]*m,h[2]=s[2]*m,h[3]=s[3]*m,h[4]=s[4]*b,h[5]=s[5]*b,h[6]=s[6]*b,h[7]=s[7]*b,h[8]=s[8]*E,h[9]=s[9]*E,h[10]=s[10]*E,h[11]=s[11]*E,h[12]=s[12],h[13]=s[13],h[14]=s[14],h[15]=s[15],h},f.N=function(h,s,u){var m=s[0],b=s[1],E=s[2],C=s[3],D=s[4],L=s[5],U=s[6],H=s[7],q=s[8],Q=s[9],J=s[10],te=s[11],oe=s[12],pe=s[13],Se=s[14],He=s[15],ke=u[0],K=u[1],Ae=u[2],Be=u[3];return h[0]=ke*m+K*D+Ae*q+Be*oe,h[1]=ke*b+K*L+Ae*Q+Be*pe,h[2]=ke*E+K*U+Ae*J+Be*Se,h[3]=ke*C+K*H+Ae*te+Be*He,h[4]=(ke=u[4])*m+(K=u[5])*D+(Ae=u[6])*q+(Be=u[7])*oe,h[5]=ke*b+K*L+Ae*Q+Be*pe,h[6]=ke*E+K*U+Ae*J+Be*Se,h[7]=ke*C+K*H+Ae*te+Be*He,h[8]=(ke=u[8])*m+(K=u[9])*D+(Ae=u[10])*q+(Be=u[11])*oe,h[9]=ke*b+K*L+Ae*Q+Be*pe,h[10]=ke*E+K*U+Ae*J+Be*Se,h[11]=ke*C+K*H+Ae*te+Be*He,h[12]=(ke=u[12])*m+(K=u[13])*D+(Ae=u[14])*q+(Be=u[15])*oe,h[13]=ke*b+K*L+Ae*Q+Be*pe,h[14]=ke*E+K*U+Ae*J+Be*Se,h[15]=ke*C+K*H+Ae*te+Be*He,h},f.O=function(h,s){const u={};for(let m=0;m<s.length;m++){const b=s[m];b in h&&(u[b]=h[b])}return u},f.P=ee,f.Q=Ec,f.R=_o,f.S=b2,f.T=st,f.U=y2,f.V=Ce,f.W=De,f.X=dr,f.Y=yo,f.Z=Me,f._=a,f.a=lo,f.a$=function(h,s,u){var m=Math.sin(u),b=Math.cos(u),E=s[4],C=s[5],D=s[6],L=s[7],U=s[8],H=s[9],q=s[10],Q=s[11];return s!==h&&(h[0]=s[0],h[1]=s[1],h[2]=s[2],h[3]=s[3],h[12]=s[12],h[13]=s[13],h[14]=s[14],h[15]=s[15]),h[4]=E*b+U*m,h[5]=C*b+H*m,h[6]=D*b+q*m,h[7]=L*b+Q*m,h[8]=U*b-E*m,h[9]=H*b-C*m,h[10]=q*b-D*m,h[11]=Q*b-L*m,h},f.a0=25,f.a1=ig,f.a2=h=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(u=>{s.onloadstart=()=>{u(s)};for(const m of h){const b=window.document.createElement("source");rt(m)||(s.crossOrigin="Anonymous"),b.src=m,s.appendChild(b)}})},f.a3=We,f.a4=function(){return Li++},f.a5=ve,f.a6=xh,f.a7=Ka,f.a8=wu,f.a9=C2,f.aA=function(h,s,u,m,b=!1){if(!u[0]&&!u[1])return[0,0];const E=b?m==="map"?-h.bearingInRadians:0:m==="viewport"?h.bearingInRadians:0;if(E){const C=Math.sin(E),D=Math.cos(E);u=[u[0]*D-u[1]*C,u[0]*C+u[1]*D]}return[b?u[0]:dt(s,u[0],h.zoom),b?u[1]:dt(s,u[1],h.zoom)]},f.aC=G0,f.aD=ng,f.aE=X0,f.aF=sg,f.aG=Xr,f.aH=ud,f.aI=xt,f.aJ=br,f.aK=yr,f.aL=Zi,f.aM=Sn,f.aN=x2,f.aO=function(h,s,u){return h[0]=s[0]*u,h[1]=s[1]*u,h[2]=s[2]*u,h},f.aP=function(h,s,u){return h[0]=s[0]+u[0],h[1]=s[1]+u[1],h[2]=s[2]+u[2],h},f.aQ=function(h){var s=new Ke(3);return s[0]=h[0],s[1]=h[1],s[2]=h[2],s},f.aR=function(h,s,u){return h[0]=s[0]*u[0],h[1]=s[1]*u[1],h[2]=s[2]*u[2],h[3]=s[3]*u[3],h},f.aS=function(h,s,u){return h[0]=s[0]-u[0],h[1]=s[1]-u[1],h[2]=s[2]-u[2],h},f.aT=function(h,s){var u=s[0],m=s[1],b=s[2],E=u*u+m*m+b*b;return E>0&&(E=1/Math.sqrt(E)),h[0]=s[0]*E,h[1]=s[1]*E,h[2]=s[2]*E,h},f.aU=function(h,s,u){var m=s[0],b=s[1],E=s[2],C=u[0],D=u[1],L=u[2];return h[0]=b*L-E*D,h[1]=E*C-m*L,h[2]=m*D-b*C,h},f.aV=function(h,s){return h[0]*s[0]+h[1]*s[1]+h[2]*s[2]},f.aW=T2,f.aX=wh,f.aY=function(h,s,u,m,b){var E,C=1/Math.tan(s/2);return h[0]=C/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=C,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,b!=null&&b!==1/0?(h[10]=(b+m)*(E=1/(m-b)),h[14]=2*b*m*E):(h[10]=-1,h[14]=-2*m),h},f.aZ=function(h){var s=new Ke(16);return s[0]=h[0],s[1]=h[1],s[2]=h[2],s[3]=h[3],s[4]=h[4],s[5]=h[5],s[6]=h[6],s[7]=h[7],s[8]=h[8],s[9]=h[9],s[10]=h[10],s[11]=h[11],s[12]=h[12],s[13]=h[13],s[14]=h[14],s[15]=h[15],s},f.a_=function(h,s,u){var m=Math.sin(u),b=Math.cos(u),E=s[0],C=s[1],D=s[2],L=s[3],U=s[4],H=s[5],q=s[6],Q=s[7];return s!==h&&(h[8]=s[8],h[9]=s[9],h[10]=s[10],h[11]=s[11],h[12]=s[12],h[13]=s[13],h[14]=s[14],h[15]=s[15]),h[0]=E*b+U*m,h[1]=C*b+H*m,h[2]=D*b+q*m,h[3]=L*b+Q*m,h[4]=U*b-E*m,h[5]=H*b-C*m,h[6]=q*b-D*m,h[7]=Q*b-L*m,h},f.aa=function(h){const s={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,m,b,E)=>{const C=b||E;return s[m]=!C||C.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s},f.ab=rs,f.ac=function(h){return Math.pow(2,h)},f.ad=It,f.ae=oi,f.af=85.051129,f.ag=v2,f.ah=function(h){return Math.log(h)/Math.LN2},f.ai=function(h){var s=h[0],u=h[1];return s*s+u*u},f.aj=function(h,s){const u=[];for(const m in h)m in s||u.push(m);return u},f.ak=function(h,s){let u=0,m=0;if(h.kind==="constant")m=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:b,minZoom:E,maxZoom:C}=h,D=b?oi(Cn.interpolationFactor(b,s,E,C),0,1):0;h.kind==="camera"?m=Bs.number(h.minSize,h.maxSize,D):u=D}return{uSizeT:u,uSize:m}},f.am=function(h,{uSize:s,uSizeT:u},{lowerSize:m,upperSize:b}){return h.kind==="source"?m/al:h.kind==="composite"?Bs.number(m/al,b/al,u):s},f.an=function(h,s){var u=s[0],m=s[1],b=s[2],E=s[3],C=s[4],D=s[5],L=s[6],U=s[7],H=s[8],q=s[9],Q=s[10],J=s[11],te=s[12],oe=s[13],pe=s[14],Se=s[15],He=u*D-m*C,ke=u*L-b*C,K=u*U-E*C,Ae=m*L-b*D,Be=m*U-E*D,ft=b*U-E*L,Dt=H*oe-q*te,mt=H*pe-Q*te,wt=H*Se-J*te,Wt=q*pe-Q*oe,Bt=q*Se-J*oe,$t=Q*Se-J*pe,Et=He*$t-ke*Bt+K*Wt+Ae*wt-Be*mt+ft*Dt;return Et?(h[0]=(D*$t-L*Bt+U*Wt)*(Et=1/Et),h[1]=(b*Bt-m*$t-E*Wt)*Et,h[2]=(oe*ft-pe*Be+Se*Ae)*Et,h[3]=(Q*Be-q*ft-J*Ae)*Et,h[4]=(L*wt-C*$t-U*mt)*Et,h[5]=(u*$t-b*wt+E*mt)*Et,h[6]=(pe*K-te*ft-Se*ke)*Et,h[7]=(H*ft-Q*K+J*ke)*Et,h[8]=(C*Bt-D*wt+U*Dt)*Et,h[9]=(m*wt-u*Bt-E*Dt)*Et,h[10]=(te*Be-oe*K+Se*He)*Et,h[11]=(q*K-H*Be-J*He)*Et,h[12]=(D*mt-C*Wt-L*Dt)*Et,h[13]=(u*Wt-m*mt+b*Dt)*Et,h[14]=(oe*ke-te*Ae-pe*He)*Et,h[15]=(H*Ae-q*ke+Q*He)*Et,h):null},f.ao=Fe,f.ap=function(h){return Math.hypot(h[0],h[1])},f.aq=function(h){return h[0]=0,h[1]=0,h},f.ar=function(h,s,u){return h[0]=s[0]*u,h[1]=s[1]*u,h},f.as=Y0,f.at=Jt,f.au=function(h,s,u,m){const b=s.y-h.y,E=s.x-h.x,C=m.y-u.y,D=m.x-u.x,L=C*E-D*b;if(L===0)return null;const U=(D*(h.y-u.y)-C*(h.x-u.x))/L;return new ee(h.x+U*E,h.y+U*b)},f.av=R2,f.aw=gy,f.ax=function(h){let s=1/0,u=1/0,m=-1/0,b=-1/0;for(const E of h)s=Math.min(s,E.x),u=Math.min(u,E.y),m=Math.max(m,E.x),b=Math.max(b,E.y);return[s,u,m,b]},f.ay=Pn,f.az=dt,f.b=zt,f.b$=class extends ne{},f.b0=function(){const h=new Float32Array(16);return It(h),h},f.b1=function(){const h=new Float64Array(16);return It(h),h},f.b2=function(){return new Float64Array(16)},f.b3=function(h,s,u){const m=new Float64Array(4);return function(b,E,C,D){var L=.5*Math.PI/180;E*=L,C*=L,D*=L;var U=Math.sin(E),H=Math.cos(E),q=Math.sin(C),Q=Math.cos(C),J=Math.sin(D),te=Math.cos(D);b[0]=U*Q*te-H*q*J,b[1]=H*q*te+U*Q*J,b[2]=H*Q*J-U*q*te,b[3]=H*Q*te+U*q*J}(m,h,s-90,u),m},f.b4=function(h,s,u,m){var b,E,C,D,L,U=s[0],H=s[1],q=s[2],Q=s[3],J=u[0],te=u[1],oe=u[2],pe=u[3];return(E=U*J+H*te+q*oe+Q*pe)<0&&(E=-E,J=-J,te=-te,oe=-oe,pe=-pe),1-E>Ye?(b=Math.acos(E),C=Math.sin(b),D=Math.sin((1-m)*b)/C,L=Math.sin(m*b)/C):(D=1-m,L=m),h[0]=D*U+L*J,h[1]=D*H+L*te,h[2]=D*q+L*oe,h[3]=D*Q+L*pe,h},f.b5=function(h){const s=new Float64Array(9);var u,m,b,E,C,D,L,U,H,q,Q,J,te,oe,pe,Se,He,ke;q=(b=(m=h)[0])*(L=b+b),Q=(E=m[1])*L,te=(C=m[2])*L,oe=C*(U=E+E),Se=(D=m[3])*L,He=D*U,ke=D*(H=C+C),(u=s)[0]=1-(J=E*U)-(pe=C*H),u[3]=Q-ke,u[6]=te+He,u[1]=Q+ke,u[4]=1-q-pe,u[7]=oe-Se,u[2]=te-He,u[5]=oe+Se,u[8]=1-q-J;const K=Sn(-Math.asin(oi(s[2],-1,1)));let Ae,Be;return Math.hypot(s[5],s[8])<.001?(Ae=0,Be=-Sn(Math.atan2(s[3],s[4]))):(Ae=Sn(s[5]===0&&s[8]===0?0:Math.atan2(s[5],s[8])),Be=Sn(s[1]===0&&s[0]===0?0:Math.atan2(s[1],s[0]))),{roll:Ae,pitch:K+90,bearing:Be}},f.b6=function(h,s){return h.roll==s.roll&&h.pitch==s.pitch&&h.bearing==s.bearing},f.b7=ir,f.b8=gh,f.b9=bh,f.bA=function(h){if(h.type==="custom")return new oE(h);switch(h.type){case"background":return new rE(h);case"circle":return new KT(h);case"fill":return new mS(h);case"fill-extrusion":return new SS(h);case"heatmap":return new eS(h);case"hillshade":return new iS(h);case"line":return new DS(h);case"raster":return new sE(h);case"symbol":return new md(h)}},f.bB=Fi,f.bC=function(h,s){if(!h)return[{command:"setStyle",args:[s]}];let u=[];try{if(!ot(h.version,s.version))return[{command:"setStyle",args:[s]}];ot(h.center,s.center)||u.push({command:"setCenter",args:[s.center]}),ot(h.state,s.state)||u.push({command:"setGlobalState",args:[s.state]}),ot(h.centerAltitude,s.centerAltitude)||u.push({command:"setCenterAltitude",args:[s.centerAltitude]}),ot(h.zoom,s.zoom)||u.push({command:"setZoom",args:[s.zoom]}),ot(h.bearing,s.bearing)||u.push({command:"setBearing",args:[s.bearing]}),ot(h.pitch,s.pitch)||u.push({command:"setPitch",args:[s.pitch]}),ot(h.roll,s.roll)||u.push({command:"setRoll",args:[s.roll]}),ot(h.sprite,s.sprite)||u.push({command:"setSprite",args:[s.sprite]}),ot(h.glyphs,s.glyphs)||u.push({command:"setGlyphs",args:[s.glyphs]}),ot(h.transition,s.transition)||u.push({command:"setTransition",args:[s.transition]}),ot(h.light,s.light)||u.push({command:"setLight",args:[s.light]}),ot(h.terrain,s.terrain)||u.push({command:"setTerrain",args:[s.terrain]}),ot(h.sky,s.sky)||u.push({command:"setSky",args:[s.sky]}),ot(h.projection,s.projection)||u.push({command:"setProjection",args:[s.projection]});const m={},b=[];(function(C,D,L,U){let H;for(H in D=D||{},C=C||{})Object.prototype.hasOwnProperty.call(C,H)&&(Object.prototype.hasOwnProperty.call(D,H)||Rt(H,L,U));for(H in D)Object.prototype.hasOwnProperty.call(D,H)&&(Object.prototype.hasOwnProperty.call(C,H)?ot(C[H],D[H])||(C[H].type==="geojson"&&D[H].type==="geojson"&&ii(C,D,H)?pt(L,{command:"setGeoJSONSourceData",args:[H,D[H].data]}):Qt(H,D,L,U)):nt(H,D,L))})(h.sources,s.sources,b,m);const E=[];h.layers&&h.layers.forEach(C=>{"source"in C&&m[C.source]?u.push({command:"removeLayer",args:[C.id]}):E.push(C)}),u=u.concat(b),function(C,D,L){D=D||[];const U=(C=C||[]).map(Qe),H=D.map(Qe),q=C.reduce(ht,{}),Q=D.reduce(ht,{}),J=U.slice(),te=Object.create(null);let oe,pe,Se,He,ke;for(let K=0,Ae=0;K<U.length;K++)oe=U[K],Object.prototype.hasOwnProperty.call(Q,oe)?Ae++:(pt(L,{command:"removeLayer",args:[oe]}),J.splice(J.indexOf(oe,Ae),1));for(let K=0,Ae=0;K<H.length;K++)oe=H[H.length-1-K],J[J.length-1-K]!==oe&&(Object.prototype.hasOwnProperty.call(q,oe)?(pt(L,{command:"removeLayer",args:[oe]}),J.splice(J.lastIndexOf(oe,J.length-Ae),1)):Ae++,He=J[J.length-K],pt(L,{command:"addLayer",args:[Q[oe],He]}),J.splice(J.length-K,0,oe),te[oe]=!0);for(let K=0;K<H.length;K++)if(oe=H[K],pe=q[oe],Se=Q[oe],!te[oe]&&!ot(pe,Se))if(ot(pe.source,Se.source)&&ot(pe["source-layer"],Se["source-layer"])&&ot(pe.type,Se.type)){for(ke in gi(pe.layout,Se.layout,L,oe,null,"setLayoutProperty"),gi(pe.paint,Se.paint,L,oe,null,"setPaintProperty"),ot(pe.filter,Se.filter)||pt(L,{command:"setFilter",args:[oe,Se.filter]}),ot(pe.minzoom,Se.minzoom)&&ot(pe.maxzoom,Se.maxzoom)||pt(L,{command:"setLayerZoomRange",args:[oe,Se.minzoom,Se.maxzoom]}),pe)Object.prototype.hasOwnProperty.call(pe,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?gi(pe[ke],Se[ke],L,oe,ke.slice(6),"setPaintProperty"):ot(pe[ke],Se[ke])||pt(L,{command:"setLayerProperty",args:[oe,ke,Se[ke]]}));for(ke in Se)Object.prototype.hasOwnProperty.call(Se,ke)&&!Object.prototype.hasOwnProperty.call(pe,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?gi(pe[ke],Se[ke],L,oe,ke.slice(6),"setPaintProperty"):ot(pe[ke],Se[ke])||pt(L,{command:"setLayerProperty",args:[oe,ke,Se[ke]]}))}else pt(L,{command:"removeLayer",args:[oe]}),He=J[J.lastIndexOf(oe)+1],pt(L,{command:"addLayer",args:[Se,He]})}(E,s.layers,u)}catch(m){console.warn("Unable to compute style diff:",m),u=[{command:"setStyle",args:[s]}]}return u},f.bD=function(h){const s=[],u=h.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},f.bE=function h(s,u){if(Array.isArray(s)){if(!Array.isArray(u)||s.length!==u.length)return!1;for(let m=0;m<s.length;m++)if(!h(s[m],u[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&u!==null){if(typeof u!="object"||Object.keys(s).length!==Object.keys(u).length)return!1;for(const m in s)if(!h(s[m],u[m]))return!1;return!0}return s===u},f.bF=Ar,f.bG=Yi,f.bH=class extends Nr{constructor(h,s){super(h,s),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},f.bI=sd,f.bJ=class extends Nr{constructor(h,s){super(h,s),this.current=w0}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let s=1;s<16;s++)if(h[s]!==this.current[s]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},f.bK=nd,f.bL=class extends Nr{constructor(h,s){super(h,s),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},f.bM=class extends Nr{constructor(h,s){super(h,s),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},f.bN=kt,f.bO=function(h,s){var u=Math.sin(s),m=Math.cos(s);return h[0]=m,h[1]=u,h[2]=0,h[3]=-u,h[4]=m,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},f.bP=function(h,s,u){var m=s[0],b=s[1],E=s[2];return h[0]=m*u[0]+b*u[3]+E*u[6],h[1]=m*u[1]+b*u[4]+E*u[7],h[2]=m*u[2]+b*u[5]+E*u[8],h},f.bQ=function(h,s,u,m,b,E,C){var D=1/(s-u),L=1/(m-b),U=1/(E-C);return h[0]=-2*D,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*L,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*U,h[11]=0,h[12]=(s+u)*D,h[13]=(b+m)*L,h[14]=(C+E)*U,h[15]=1,h},f.bR=class extends Nr{constructor(h,s){super(h,s),this.current=new Array}set(h){if(h!=this.current){this.current=h;const s=new Float32Array(4*h.length);for(let u=0;u<h.length;u++)s[4*u]=h[u].r,s[4*u+1]=h[u].g,s[4*u+2]=h[u].b,s[4*u+3]=h[u].a;this.gl.uniform4fv(this.location,s)}}},f.bS=class extends Nr{constructor(h,s){super(h,s),this.current=new Array}set(h){if(h!=this.current){this.current=h;const s=new Float32Array(h);this.gl.uniform1fv(this.location,s)}}},f.bT=class extends S{},f.bU=FS,f.bV=class extends O{},f.bW=M0,f.bX=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},f.bY=Ey,f.bZ=function(h,s,u){var m=s[0],b=s[1],E=s[2],C=u[3]*m+u[7]*b+u[11]*E+u[15];return h[0]=(u[0]*m+u[4]*b+u[8]*E+u[12])/(C=C||1),h[1]=(u[1]*m+u[5]*b+u[9]*E+u[13])/C,h[2]=(u[2]*m+u[6]*b+u[10]*E+u[14])/C,h},f.b_=class extends Ol{},f.ba=Wf,f.bb=yh,f.bc=Pt,f.bd=Ct,f.be=as,f.bf=function(h,s,u,m,b){return Pt(m,b,oi((h-s)/(u-s),0,1))},f.bg=vt,f.bh=function(){return new Float64Array(3)},f.bi=function(h,s,u,m){return h[0]=s[0]+u[0]*m,h[1]=s[1]+u[1]*m,h[2]=s[2]+u[2]*m,h},f.bj=Xt,f.bk=function(){return new Float64Array(4)},f.bl=function(h,s,u,m){var b=[],E=[];return b[0]=s[0]-u[0],b[1]=s[1]-u[1],b[2]=s[2]-u[2],E[0]=b[0]*Math.cos(m)-b[1]*Math.sin(m),E[1]=b[0]*Math.sin(m)+b[1]*Math.cos(m),E[2]=b[2],h[0]=E[0]+u[0],h[1]=E[1]+u[1],h[2]=E[2]+u[2],h},f.bm=function(h,s,u,m){var b=[],E=[];return b[0]=s[0]-u[0],b[1]=s[1]-u[1],b[2]=s[2]-u[2],E[0]=b[0],E[1]=b[1]*Math.cos(m)-b[2]*Math.sin(m),E[2]=b[1]*Math.sin(m)+b[2]*Math.cos(m),h[0]=E[0]+u[0],h[1]=E[1]+u[1],h[2]=E[2]+u[2],h},f.bn=function(h,s,u,m){var b=[],E=[];return b[0]=s[0]-u[0],b[1]=s[1]-u[1],b[2]=s[2]-u[2],E[0]=b[2]*Math.sin(m)+b[0]*Math.cos(m),E[1]=b[1],E[2]=b[2]*Math.cos(m)-b[0]*Math.sin(m),h[0]=E[0]+u[0],h[1]=E[1]+u[1],h[2]=E[2]+u[2],h},f.bo=Lt,f.bp=function(h,s,u){var m=Math.sin(u),b=Math.cos(u),E=s[0],C=s[1],D=s[2],L=s[3],U=s[8],H=s[9],q=s[10],Q=s[11];return s!==h&&(h[4]=s[4],h[5]=s[5],h[6]=s[6],h[7]=s[7],h[12]=s[12],h[13]=s[13],h[14]=s[14],h[15]=s[15]),h[0]=E*b-U*m,h[1]=C*b-H*m,h[2]=D*b-q*m,h[3]=L*b-Q*m,h[8]=E*m+U*b,h[9]=C*m+H*b,h[10]=D*m+q*b,h[11]=L*m+Q*b,h},f.bq=function(h,s){const u=vt(h,360),m=vt(s,360),b=m-u,E=m>u?b-360:b+360;return Math.abs(b)<Math.abs(E)?b:E},f.br=function(h){return h[0]=0,h[1]=0,h[2]=0,h},f.bs=function(h,s,u,m){const b=Math.sqrt(h*h+s*s),E=Math.sqrt(u*u+m*m);h/=b,s/=b,u/=E,m/=E;const C=Math.acos(h*u+s*m);return-s*u+h*m>0?C:-C},f.bt=function(h,s){return h[0]*s[0]+h[1]*s[1]+h[2]*s[2]+h[3]},f.bu=eg,f.bv=function(h,s){const u=vt(h,2*Math.PI),m=vt(s,2*Math.PI);return Math.min(Math.abs(u-m),Math.abs(u-m+2*Math.PI),Math.abs(u-m-2*Math.PI))},f.bw=function(){const h={},s=ge.$version;for(const u in ge.$root){const m=ge.$root[u];if(m.required){let b=null;b=u==="version"?s:m.type==="array"?[]:{},b!=null&&(h[u]=b)}}return h},f.bx=p,f.by=ns,f.bz=function(h){h=h.slice();const s=Object.create(null);for(let u=0;u<h.length;u++)s[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=Ge(h[u],s[h[u].ref]));return h},f.c=Qs,f.c0=function(h,s){return h[0]===s[0]&&h[1]===s[1]&&h[2]===s[2]&&h[3]===s[3]&&h[4]===s[4]&&h[5]===s[5]&&h[6]===s[6]&&h[7]===s[7]&&h[8]===s[8]&&h[9]===s[9]&&h[10]===s[10]&&h[11]===s[11]&&h[12]===s[12]&&h[13]===s[13]&&h[14]===s[14]&&h[15]===s[15]},f.c1=function(h,s){var u=h[0],m=h[1],b=h[2],E=h[3],C=h[4],D=h[5],L=h[6],U=h[7],H=h[8],q=h[9],Q=h[10],J=h[11],te=h[12],oe=h[13],pe=h[14],Se=h[15],He=s[0],ke=s[1],K=s[2],Ae=s[3],Be=s[4],ft=s[5],Dt=s[6],mt=s[7],wt=s[8],Wt=s[9],Bt=s[10],$t=s[11],Et=s[12],fi=s[13],Si=s[14],xi=s[15];return Math.abs(u-He)<=Ye*Math.max(1,Math.abs(u),Math.abs(He))&&Math.abs(m-ke)<=Ye*Math.max(1,Math.abs(m),Math.abs(ke))&&Math.abs(b-K)<=Ye*Math.max(1,Math.abs(b),Math.abs(K))&&Math.abs(E-Ae)<=Ye*Math.max(1,Math.abs(E),Math.abs(Ae))&&Math.abs(C-Be)<=Ye*Math.max(1,Math.abs(C),Math.abs(Be))&&Math.abs(D-ft)<=Ye*Math.max(1,Math.abs(D),Math.abs(ft))&&Math.abs(L-Dt)<=Ye*Math.max(1,Math.abs(L),Math.abs(Dt))&&Math.abs(U-mt)<=Ye*Math.max(1,Math.abs(U),Math.abs(mt))&&Math.abs(H-wt)<=Ye*Math.max(1,Math.abs(H),Math.abs(wt))&&Math.abs(q-Wt)<=Ye*Math.max(1,Math.abs(q),Math.abs(Wt))&&Math.abs(Q-Bt)<=Ye*Math.max(1,Math.abs(Q),Math.abs(Bt))&&Math.abs(J-$t)<=Ye*Math.max(1,Math.abs(J),Math.abs($t))&&Math.abs(te-Et)<=Ye*Math.max(1,Math.abs(te),Math.abs(Et))&&Math.abs(oe-fi)<=Ye*Math.max(1,Math.abs(oe),Math.abs(fi))&&Math.abs(pe-Si)<=Ye*Math.max(1,Math.abs(pe),Math.abs(Si))&&Math.abs(Se-xi)<=Ye*Math.max(1,Math.abs(Se),Math.abs(xi))},f.c2=function(h,s){return h[0]=s[0],h[1]=s[1],h[2]=s[2],h[3]=s[3],h[4]=s[4],h[5]=s[5],h[6]=s[6],h[7]=s[7],h[8]=s[8],h[9]=s[9],h[10]=s[10],h[11]=s[11],h[12]=s[12],h[13]=s[13],h[14]=s[14],h[15]=s[15],h},f.c3=h=>h.type==="symbol",f.c4=h=>h.type==="circle",f.c5=h=>h.type==="heatmap",f.c6=h=>h.type==="line",f.c7=h=>h.type==="fill",f.c8=h=>h.type==="fill-extrusion",f.c9=h=>h.type==="hillshade",f.cA=O0,f.cB=U0,f.cC=$f,f.cD=H0,f.cE=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},f.cF=function(h,s,u,m,b){return a(this,void 0,void 0,function*(){if(De())try{return yield dr(h,s,u,m,b)}catch{}return function(E,C,D,L,U){const H=E.width,q=E.height;tr&&or||(tr=new OffscreenCanvas(H,q),or=tr.getContext("2d",{willReadFrequently:!0})),tr.width=H,tr.height=q,or.drawImage(E,0,0,H,q);const Q=or.getImageData(C,D,L,U);return or.clearRect(0,0,H,q),Q.data}(h,s,u,m,b)})},f.cG=S2,f.cH=w,f.cI=F,f.cJ=Wy,f.cK=t2,f.cL=Ml,f.cM=je,f.ca=h=>h.type==="raster",f.cb=h=>h.type==="background",f.cc=h=>h.type==="custom",f.cd=ei,f.ce=function(h,s,u){const m=tt(s.x-u.x,s.y-u.y),b=tt(h.x-u.x,h.y-u.y);var E,C;return Sn(Math.atan2(m[0]*b[1]-m[1]*b[0],(E=m)[0]*(C=b)[0]+E[1]*C[1]))},f.cf=Ai,f.cg=function(h,s){return ao[s]&&(h instanceof MouseEvent||h instanceof WheelEvent)},f.ch=function(h,s){return js[s]&&"touches"in h},f.ci=function(h){return js[h]||ao[h]},f.cj=function(h,s,u){var m=s[0],b=s[1];return h[0]=u[0]*m+u[4]*b+u[12],h[1]=u[1]*m+u[5]*b+u[13],h},f.ck=function(h,s){const{x:u,y:m}=Qf.fromLngLat(s);return!(h<0||h>25||m<0||m>=1||u<0||u>=1)},f.cl=function(h,s){return h[0]=s[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=s[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=s[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},f.cm=class extends yu{},f.cn=mE,f.cp=function(h){return h.message===Io},f.cq=ks,f.cr=function(h,s){lo.REGISTERED_PROTOCOLS[h]=s},f.cs=function(h){delete lo.REGISTERED_PROTOCOLS[h]},f.ct=function(h,s){const u={};for(let b=0;b<h.length;b++){const E=s&&s[h[b].id]||fh(h[b]);s&&(s[h[b].id]=E);let C=u[E];C||(C=u[E]=[]),C.push(h[b])}const m=[];for(const b in u)m.push(u[b]);return m},f.cu=li,f.cv=E2,f.cw=I2,f.cx=r2,f.cy=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Me/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const s=h.bucket.layers[0],u=s.layout,m=s._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Ze(h.bucket.zoom+1),h.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Ze(h.bucket.zoom+1),h.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Ze(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:H}=h.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Ze(U),h.canonical),m["text-size"].possiblyEvaluate(new Ze(H),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:H}=h.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Ze(U),h.canonical),m["icon-size"].possiblyEvaluate(new Ze(H),h.canonical)]}const E=u.get("text-line-height")*Pn,C=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",D=u.get("text-keep-upright"),L=u.get("text-size");for(const U of h.bucket.features){const H=u.get("text-font").evaluate(U,{},h.canonical).join(","),q=L.evaluate(U,{},h.canonical),Q=b.layoutTextSize.evaluate(U,{},h.canonical),J=b.layoutIconSize.evaluate(U,{},h.canonical),te={horizontal:{},vertical:void 0},oe=U.text;let pe,Se=[0,0];if(oe){const K=oe.toString(),Ae=u.get("text-letter-spacing").evaluate(U,{},h.canonical)*Pn,Be=x(K)?Ae:0,ft=u.get("text-anchor").evaluate(U,{},h.canonical),Dt=U2(s,U,h.canonical);if(!Dt){const Bt=u.get("text-radial-offset").evaluate(U,{},h.canonical);Se=Bt?z2(ft,[Bt*Pn,rg]):u.get("text-offset").evaluate(U,{},h.canonical).map($t=>$t*Pn)}let mt=C?"center":u.get("text-justify").evaluate(U,{},h.canonical);const wt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(U,{},h.canonical)*Pn:1/0,Wt=()=>{h.bucket.allowVerticalPlacement&&v(K)&&(te.vertical=dd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,H,wt,E,ft,"left",Be,Se,f.al.vertical,!0,Q,q))};if(!C&&Dt){const Bt=new Set;if(mt==="auto")for(let Et=0;Et<Dt.values.length;Et+=2)Bt.add(ng(Dt.values[Et]));else Bt.add(mt);let $t=!1;for(const Et of Bt)if(!te.horizontal[Et])if($t)te.horizontal[Et]=te.horizontal[0];else{const fi=dd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,H,wt,E,"center",Et,Be,Se,f.al.horizontal,!1,Q,q);fi&&(te.horizontal[Et]=fi,$t=fi.positionedLines.length===1)}Wt()}else{mt==="auto"&&(mt=ng(ft));const Bt=dd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,H,wt,E,ft,mt,Be,Se,f.al.horizontal,!1,Q,q);Bt&&(te.horizontal[mt]=Bt),Wt(),v(K)&&C&&D&&(te.vertical=dd(oe,h.glyphMap,h.glyphPositions,h.imagePositions,H,wt,E,ft,mt,Be,Se,f.al.vertical,!1,Q,q))}}let He=!1;if(U.icon&&U.icon.name){const K=h.imageMap[U.icon.name];K&&(pe=KS(h.imagePositions[U.icon.name],u.get("icon-offset").evaluate(U,{},h.canonical),u.get("icon-anchor").evaluate(U,{},h.canonical)),He=!!K.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=He:h.bucket.sdfIcons!==He&&sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(K.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const ke=V2(te.horizontal)||te.vertical;h.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||pe)&&pE(h.bucket,U,te,pe,h.imageMap,b,Q,J,Se,He,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},f.cz=j0,f.d=rt,f.e=Oi,f.f=h=>a(void 0,void 0,void 0,function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(s)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.g=Po,f.h=h=>new Promise((s,u)=>{const m=new Image;m.onload=()=>{s(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Pi})},m.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(h)],{type:"image/png"});m.src=h.byteLength?URL.createObjectURL(b):Pi}),f.i=qi,f.j=(h,s)=>Ks(Oi(h,{type:"json"}),s),f.k=ue,f.l=me,f.m=Ks,f.n=(h,s)=>Ks(Oi(h,{type:"arrayBuffer"}),s),f.o=function(h){return new H0(h).readFields(US,[])},f.p=i2,f.q=Nf,f.r=bi,f.s=Tn,f.t=go,f.u=g,f.v=ge,f.w=sr,f.x=vc,f.y=Hs,f.z=function([h,s,u]){return s+=90,s*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(s)*Math.sin(u),y:h*Math.sin(s)*Math.sin(u),z:h*Math.cos(u)}}}),o("worker",["./shared"],function(f){class a{constructor(ae){this.keyCache={},ae&&this.replace(ae)}replace(ae){this._layerConfigs={},this._layers={},this.update(ae,[])}update(ae,le){for(const ue of ae){this._layerConfigs[ue.id]=ue;const $e=this._layers[ue.id]=f.bA(ue);$e._featureFilter=f.a7($e.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of le)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const me=f.ct(Object.values(this._layerConfigs),this.keyCache);for(const ue of me){const $e=ue.map(nt=>this._layers[nt.id]),ge=$e[0];if(ge.visibility==="none")continue;const ut=ge.source||"";let Ge=this.familiesBySource[ut];Ge||(Ge=this.familiesBySource[ut]={});const ot=ge.sourceLayer||"_geojsonTileLayer";let pt=Ge[ot];pt||(pt=Ge[ot]=[]),pt.push($e)}}}class w{constructor(ae){const le={},me=[];for(const ut in ae){const Ge=ae[ut],ot=le[ut]={};for(const pt in Ge){const nt=Ge[+pt];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Rt={x:0,y:0,w:nt.bitmap.width+2,h:nt.bitmap.height+2};me.push(Rt),ot[pt]={rect:Rt,metrics:nt.metrics}}}const{w:ue,h:$e}=f.p(me),ge=new f.q({width:ue||1,height:$e||1});for(const ut in ae){const Ge=ae[ut];for(const ot in Ge){const pt=Ge[+ot];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const nt=le[ut][ot].rect;f.q.copy(pt.bitmap,ge,{x:0,y:0},{x:nt.x+1,y:nt.y+1},pt.bitmap)}}this.image=ge,this.positions=le}}f.cu("GlyphAtlas",w);class P{constructor(ae){this.tileID=new f.Y(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.uid=ae.uid,this.zoom=ae.zoom,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ae.showCollisionBoxes,this.collectResourceTiming=!!ae.collectResourceTiming,this.returnDependencies=!!ae.returnDependencies,this.promoteId=ae.promoteId,this.inFlightDependencies=[]}parse(ae,le,me,ue,$e){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=ae,this.collisionBoxArray=new f.a5;const ge=new f.cv(Object.keys(ae.layers).sort()),ut=new f.cw(this.tileID,this.promoteId);ut.bucketLayerIDs=[];const Ge={},ot={featureIndex:ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me,subdivisionGranularity:$e},pt=le.familiesBySource[this.source];for(const ri in pt){const _t=ae.layers[ri];if(!_t)continue;_t.version===1&&f.w(`Vector tile source "${this.source}" layer "${ri}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ui=ge.encode(ri),ni=[];for(let Ei=0;Ei<_t.length;Ei++){const Tr=_t.feature(Ei),Xi=ut.getId(Tr,ri);ni.push({feature:Tr,id:Xi,index:Ei,sourceLayerIndex:ui})}for(const Ei of pt[ri]){const Tr=Ei[0];Tr.source!==this.source&&f.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(k(Ei,this.zoom,me),(Ge[Tr.id]=Tr.createBucket({index:ut.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ui,sourceID:this.source})).populate(ni,ot,this.tileID.canonical),ut.bucketLayerIDs.push(Ei.map(Xi=>Xi.id)))}}const nt=f.bF(ot.glyphDependencies,ri=>Object.keys(ri).map(Number));this.inFlightDependencies.forEach(ri=>ri==null?void 0:ri.abort()),this.inFlightDependencies=[];let Rt=Promise.resolve({});if(Object.keys(nt).length){const ri=new AbortController;this.inFlightDependencies.push(ri),Rt=ue.sendAsync({type:"GG",data:{stacks:nt,source:this.source,tileID:this.tileID,type:"glyphs"}},ri)}const Qt=Object.keys(ot.iconDependencies);let ii=Promise.resolve({});if(Qt.length){const ri=new AbortController;this.inFlightDependencies.push(ri),ii=ue.sendAsync({type:"GI",data:{icons:Qt,source:this.source,tileID:this.tileID,type:"icons"}},ri)}const gi=Object.keys(ot.patternDependencies);let Qe=Promise.resolve({});if(gi.length){const ri=new AbortController;this.inFlightDependencies.push(ri),Qe=ue.sendAsync({type:"GI",data:{icons:gi,source:this.source,tileID:this.tileID,type:"patterns"}},ri)}const[ht,We,Tt]=yield Promise.all([Rt,ii,Qe]),A=new w(ht),ie=new f.cx(We,Tt);for(const ri in Ge){const _t=Ge[ri];_t instanceof f.a6?(k(_t.layers,this.zoom,me),f.cy({bucket:_t,glyphMap:ht,glyphPositions:A.positions,imageMap:We,imagePositions:ie.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ot.subdivisionGranularity})):_t.hasPattern&&(_t instanceof f.cz||_t instanceof f.cA||_t instanceof f.cB)&&(k(_t.layers,this.zoom,me),_t.addFeatures(ot,this.tileID.canonical,ie.patternPositions))}return this.status="done",{buckets:Object.values(Ge).filter(ri=>!ri.isEmpty()),featureIndex:ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:A.image,imageAtlas:ie,glyphMap:this.returnDependencies?ht:null,iconMap:this.returnDependencies?We:null,glyphPositions:this.returnDependencies?A.positions:null}})}}function k(rt,ae,le){const me=new f.C(ae);for(const ue of rt)ue.recalculate(me,le)}class F{constructor(ae,le,me){this.actor=ae,this.layerIndex=le,this.availableImages=me,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ae,le){return f._(this,void 0,void 0,function*(){const me=yield f.n(ae.request,le);try{return{vectorTile:new f.cC.VectorTile(new f.cD(me.data)),rawData:me.data,cacheControl:me.cacheControl,expires:me.expires}}catch(ue){const $e=new Uint8Array(me.data);let ge=`Unable to parse the tile at ${ae.request.url}, `;throw ge+=$e[0]===31&&$e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(ge)}})}loadTile(ae){return f._(this,void 0,void 0,function*(){const le=ae.uid,me=!!(ae&&ae.request&&ae.request.collectResourceTiming)&&new f.cE(ae.request),ue=new P(ae);this.loading[le]=ue;const $e=new AbortController;ue.abort=$e;try{const ge=yield this.loadVectorTile(ae,$e);if(delete this.loading[le],!ge)return null;const ut=ge.rawData,Ge={};ge.expires&&(Ge.expires=ge.expires),ge.cacheControl&&(Ge.cacheControl=ge.cacheControl);const ot={};if(me){const nt=me.finish();nt&&(ot.resourceTiming=JSON.parse(JSON.stringify(nt)))}ue.vectorTile=ge.vectorTile;const pt=ue.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,ae.subdivisionGranularity);this.loaded[le]=ue,this.fetching[le]={rawTileData:ut,cacheControl:Ge,resourceTiming:ot};try{const nt=yield pt;return f.e({rawTileData:ut.slice(0)},nt,Ge,ot)}finally{delete this.fetching[le]}}catch(ge){throw delete this.loading[le],ue.status="done",this.loaded[le]=ue,ge}})}reloadTile(ae){return f._(this,void 0,void 0,function*(){const le=ae.uid;if(!this.loaded||!this.loaded[le])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const me=this.loaded[le];if(me.showCollisionBoxes=ae.showCollisionBoxes,me.status==="parsing"){const ue=yield me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,ae.subdivisionGranularity);let $e;if(this.fetching[le]){const{rawTileData:ge,cacheControl:ut,resourceTiming:Ge}=this.fetching[le];delete this.fetching[le],$e=f.e({rawTileData:ge.slice(0)},ue,ut,Ge)}else $e=ue;return $e}if(me.status==="done"&&me.vectorTile)return me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,ae.subdivisionGranularity)})}abortTile(ae){return f._(this,void 0,void 0,function*(){const le=this.loading,me=ae.uid;le&&le[me]&&le[me].abort&&(le[me].abort.abort(),delete le[me])})}removeTile(ae){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ae.uid]&&delete this.loaded[ae.uid]})}}class V{constructor(){this.loaded={}}loadTile(ae){return f._(this,void 0,void 0,function*(){const{uid:le,encoding:me,rawImageData:ue,redFactor:$e,greenFactor:ge,blueFactor:ut,baseShift:Ge}=ae,ot=ue.width+2,pt=ue.height+2,nt=f.b(ue)?new f.R({width:ot,height:pt},yield f.cF(ue,-1,-1,ot,pt)):ue,Rt=new f.cG(le,nt,me,$e,ge,ut,Ge);return this.loaded=this.loaded||{},this.loaded[le]=Rt,Rt})}removeTile(ae){const le=this.loaded,me=ae.uid;le&&le[me]&&delete le[me]}}var W,ee,he=function(){if(ee)return W;function rt(le,me){if(le.length!==0){ae(le[0],me);for(var ue=1;ue<le.length;ue++)ae(le[ue],!me)}}function ae(le,me){for(var ue=0,$e=0,ge=0,ut=le.length,Ge=ut-1;ge<ut;Ge=ge++){var ot=(le[ge][0]-le[Ge][0])*(le[Ge][1]+le[ge][1]),pt=ue+ot;$e+=Math.abs(ue)>=Math.abs(ot)?ue-pt+ot:ot-pt+ue,ue=pt}ue+$e>=0!=!!me&&le.reverse()}return ee=1,W=function le(me,ue){var $e,ge=me&&me.type;if(ge==="FeatureCollection")for($e=0;$e<me.features.length;$e++)le(me.features[$e],ue);else if(ge==="GeometryCollection")for($e=0;$e<me.geometries.length;$e++)le(me.geometries[$e],ue);else if(ge==="Feature")le(me.geometry,ue);else if(ge==="Polygon")rt(me.coordinates,ue);else if(ge==="MultiPolygon")for($e=0;$e<me.coordinates.length;$e++)rt(me.coordinates[$e],ue);return me}}(),Ie=f.cH(he);const Ee=f.cC.VectorTileFeature.prototype.toGeoJSON;class Ne{constructor(ae){this._feature=ae,this.extent=f.Z,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const le of this._feature.geometry)ae.push([new f.P(le[0],le[1])]);return ae}{const ae=[];for(const le of this._feature.geometry){const me=[];for(const ue of le)me.push(new f.P(ue[0],ue[1]));ae.push(me)}return ae}}toGeoJSON(ae,le,me){return Ee.call(this,ae,le,me)}}class Ce{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.Z,this.length=ae.length,this._features=ae}feature(ae){return new Ne(this._features[ae])}}var De,Ye,Ke,kt={exports:{}},It=function(){if(Ke)return kt.exports;Ke=1;var rt=f.cK(),ae=function(){if(Ye)return De;Ye=1;var pt=f.cI(),nt=f.cJ().VectorTileFeature;function Rt(ii,gi){this.options=gi||{},this.features=ii,this.length=ii.length}function Qt(ii,gi){this.id=typeof ii.id=="number"?ii.id:void 0,this.type=ii.type,this.rawGeometry=ii.type===1?[ii.geometry]:ii.geometry,this.properties=ii.tags,this.extent=gi||4096}return De=Rt,Rt.prototype.feature=function(ii){return new Qt(this.features[ii],this.options.extent)},Qt.prototype.loadGeometry=function(){var ii=this.rawGeometry;this.geometry=[];for(var gi=0;gi<ii.length;gi++){for(var Qe=ii[gi],ht=[],We=0;We<Qe.length;We++)ht.push(new pt(Qe[We][0],Qe[We][1]));this.geometry.push(ht)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ii=this.geometry,gi=1/0,Qe=-1/0,ht=1/0,We=-1/0,Tt=0;Tt<ii.length;Tt++)for(var A=ii[Tt],ie=0;ie<A.length;ie++){var ri=A[ie];gi=Math.min(gi,ri.x),Qe=Math.max(Qe,ri.x),ht=Math.min(ht,ri.y),We=Math.max(We,ri.y)}return[gi,ht,Qe,We]},Qt.prototype.toGeoJSON=nt.prototype.toGeoJSON,De}();function le(pt){var nt=new rt;return function(Rt,Qt){for(var ii in Rt.layers)Qt.writeMessage(3,me,Rt.layers[ii])}(pt,nt),nt.finish()}function me(pt,nt){var Rt;nt.writeVarintField(15,pt.version||1),nt.writeStringField(1,pt.name||""),nt.writeVarintField(5,pt.extent||4096);var Qt={keys:[],values:[],keycache:{},valuecache:{}};for(Rt=0;Rt<pt.length;Rt++)Qt.feature=pt.feature(Rt),nt.writeMessage(2,ue,Qt);var ii=Qt.keys;for(Rt=0;Rt<ii.length;Rt++)nt.writeStringField(3,ii[Rt]);var gi=Qt.values;for(Rt=0;Rt<gi.length;Rt++)nt.writeMessage(4,ot,gi[Rt])}function ue(pt,nt){var Rt=pt.feature;Rt.id!==void 0&&nt.writeVarintField(1,Rt.id),nt.writeMessage(2,$e,pt),nt.writeVarintField(3,Rt.type),nt.writeMessage(4,Ge,Rt)}function $e(pt,nt){var Rt=pt.feature,Qt=pt.keys,ii=pt.values,gi=pt.keycache,Qe=pt.valuecache;for(var ht in Rt.properties){var We=Rt.properties[ht],Tt=gi[ht];if(We!==null){Tt===void 0&&(Qt.push(ht),gi[ht]=Tt=Qt.length-1),nt.writeVarint(Tt);var A=typeof We;A!=="string"&&A!=="boolean"&&A!=="number"&&(We=JSON.stringify(We));var ie=A+":"+We,ri=Qe[ie];ri===void 0&&(ii.push(We),Qe[ie]=ri=ii.length-1),nt.writeVarint(ri)}}}function ge(pt,nt){return(nt<<3)+(7&pt)}function ut(pt){return pt<<1^pt>>31}function Ge(pt,nt){for(var Rt=pt.loadGeometry(),Qt=pt.type,ii=0,gi=0,Qe=Rt.length,ht=0;ht<Qe;ht++){var We=Rt[ht],Tt=1;Qt===1&&(Tt=We.length),nt.writeVarint(ge(1,Tt));for(var A=Qt===3?We.length-1:We.length,ie=0;ie<A;ie++){ie===1&&Qt!==1&&nt.writeVarint(ge(2,A-1));var ri=We[ie].x-ii,_t=We[ie].y-gi;nt.writeVarint(ut(ri)),nt.writeVarint(ut(_t)),ii+=ri,gi+=_t}Qt===3&&nt.writeVarint(ge(7,1))}}function ot(pt,nt){var Rt=typeof pt;Rt==="string"?nt.writeStringField(1,pt):Rt==="boolean"?nt.writeBooleanField(7,pt):Rt==="number"&&(pt%1!=0?nt.writeDoubleField(3,pt):pt<0?nt.writeSVarintField(6,pt):nt.writeVarintField(5,pt))}return kt.exports=le,kt.exports.fromVectorTileJs=le,kt.exports.fromGeojsonVt=function(pt,nt){nt=nt||{};var Rt={};for(var Qt in pt)Rt[Qt]=new ae(pt[Qt].features,nt),Rt[Qt].name=Qt,Rt[Qt].version=nt.version,Rt[Qt].extent=nt.extent;return le({layers:Rt})},kt.exports.GeoJSONWrapper=ae,kt.exports}(),jt=f.cH(It);const Lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:rt=>rt},Mt=Math.fround||(vi=new Float32Array(1),rt=>(vi[0]=+rt,vi[0]));var vi;const Xt=3,Jt=5,zi=6;class Fe{constructor(ae){this.options=Object.assign(Object.create(Lt),ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ae){const{log:le,minZoom:me,maxZoom:ue}=this.options;le&&console.time("total time");const $e=`prepare ${ae.length} points`;le&&console.time($e),this.points=ae;const ge=[];for(let Ge=0;Ge<ae.length;Ge++){const ot=ae[Ge];if(!ot.geometry)continue;const[pt,nt]=ot.geometry.coordinates,Rt=Mt(dt(pt)),Qt=Mt(vt(nt));ge.push(Rt,Qt,1/0,Ge,-1,1),this.options.reduce&&ge.push(0)}let ut=this.trees[ue+1]=this._createTree(ge);le&&console.timeEnd($e);for(let Ge=ue;Ge>=me;Ge--){const ot=+Date.now();ut=this.trees[Ge]=this._createTree(this._cluster(ut,Ge)),le&&console.log("z%d: %d clusters in %dms",Ge,ut.numItems,+Date.now()-ot)}return le&&console.timeEnd("total time"),this}getClusters(ae,le){let me=((ae[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,ae[1]));let $e=ae[2]===180?180:((ae[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,ae[3]));if(ae[2]-ae[0]>=360)me=-180,$e=180;else if(me>$e){const nt=this.getClusters([me,ue,180,ge],le),Rt=this.getClusters([-180,ue,$e,ge],le);return nt.concat(Rt)}const ut=this.trees[this._limitZoom(le)],Ge=ut.range(dt(me),vt(ge),dt($e),vt(ue)),ot=ut.data,pt=[];for(const nt of Ge){const Rt=this.stride*nt;pt.push(ot[Rt+Jt]>1?tt(ot,Rt,this.clusterProps):this.points[ot[Rt+Xt]])}return pt}getChildren(ae){const le=this._getOriginId(ae),me=this._getOriginZoom(ae),ue="No cluster with the specified id.",$e=this.trees[me];if(!$e)throw new Error(ue);const ge=$e.data;if(le*this.stride>=ge.length)throw new Error(ue);const ut=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Ge=$e.within(ge[le*this.stride],ge[le*this.stride+1],ut),ot=[];for(const pt of Ge){const nt=pt*this.stride;ge[nt+4]===ae&&ot.push(ge[nt+Jt]>1?tt(ge,nt,this.clusterProps):this.points[ge[nt+Xt]])}if(ot.length===0)throw new Error(ue);return ot}getLeaves(ae,le,me){const ue=[];return this._appendLeaves(ue,ae,le=le||10,me=me||0,0),ue}getTile(ae,le,me){const ue=this.trees[this._limitZoom(ae)],$e=Math.pow(2,ae),{extent:ge,radius:ut}=this.options,Ge=ut/ge,ot=(me-Ge)/$e,pt=(me+1+Ge)/$e,nt={features:[]};return this._addTileFeatures(ue.range((le-Ge)/$e,ot,(le+1+Ge)/$e,pt),ue.data,le,me,$e,nt),le===0&&this._addTileFeatures(ue.range(1-Ge/$e,ot,1,pt),ue.data,$e,me,$e,nt),le===$e-1&&this._addTileFeatures(ue.range(0,ot,Ge/$e,pt),ue.data,-1,me,$e,nt),nt.features.length?nt:null}getClusterExpansionZoom(ae){let le=this._getOriginZoom(ae)-1;for(;le<=this.options.maxZoom;){const me=this.getChildren(ae);if(le++,me.length!==1)break;ae=me[0].properties.cluster_id}return le}_appendLeaves(ae,le,me,ue,$e){const ge=this.getChildren(le);for(const ut of ge){const Ge=ut.properties;if(Ge&&Ge.cluster?$e+Ge.point_count<=ue?$e+=Ge.point_count:$e=this._appendLeaves(ae,Ge.cluster_id,me,ue,$e):$e<ue?$e++:ae.push(ut),ae.length===me)break}return $e}_createTree(ae){const le=new f.aF(ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<ae.length;me+=this.stride)le.add(ae[me],ae[me+1]);return le.finish(),le.data=ae,le}_addTileFeatures(ae,le,me,ue,$e,ge){for(const ut of ae){const Ge=ut*this.stride,ot=le[Ge+Jt]>1;let pt,nt,Rt;if(ot)pt=Me(le,Ge,this.clusterProps),nt=le[Ge],Rt=le[Ge+1];else{const gi=this.points[le[Ge+Xt]];pt=gi.properties;const[Qe,ht]=gi.geometry.coordinates;nt=dt(Qe),Rt=vt(ht)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(nt*$e-me)),Math.round(this.options.extent*(Rt*$e-ue))]],tags:pt};let ii;ii=ot||this.options.generateId?le[Ge+Xt]:this.points[le[Ge+Xt]].id,ii!==void 0&&(Qt.id=ii),ge.features.push(Qt)}}_limitZoom(ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+ae),this.options.maxZoom+1))}_cluster(ae,le){const{radius:me,extent:ue,reduce:$e,minPoints:ge}=this.options,ut=me/(ue*Math.pow(2,le)),Ge=ae.data,ot=[],pt=this.stride;for(let nt=0;nt<Ge.length;nt+=pt){if(Ge[nt+2]<=le)continue;Ge[nt+2]=le;const Rt=Ge[nt],Qt=Ge[nt+1],ii=ae.within(Ge[nt],Ge[nt+1],ut),gi=Ge[nt+Jt];let Qe=gi;for(const ht of ii){const We=ht*pt;Ge[We+2]>le&&(Qe+=Ge[We+Jt])}if(Qe>gi&&Qe>=ge){let ht,We=Rt*gi,Tt=Qt*gi,A=-1;const ie=((nt/pt|0)<<5)+(le+1)+this.points.length;for(const ri of ii){const _t=ri*pt;if(Ge[_t+2]<=le)continue;Ge[_t+2]=le;const ui=Ge[_t+Jt];We+=Ge[_t]*ui,Tt+=Ge[_t+1]*ui,Ge[_t+4]=ie,$e&&(ht||(ht=this._map(Ge,nt,!0),A=this.clusterProps.length,this.clusterProps.push(ht)),$e(ht,this._map(Ge,_t)))}Ge[nt+4]=ie,ot.push(We/Qe,Tt/Qe,1/0,ie,-1,Qe),$e&&ot.push(A)}else{for(let ht=0;ht<pt;ht++)ot.push(Ge[nt+ht]);if(Qe>1)for(const ht of ii){const We=ht*pt;if(!(Ge[We+2]<=le)){Ge[We+2]=le;for(let Tt=0;Tt<pt;Tt++)ot.push(Ge[We+Tt])}}}}return ot}_getOriginId(ae){return ae-this.points.length>>5}_getOriginZoom(ae){return(ae-this.points.length)%32}_map(ae,le,me){if(ae[le+Jt]>1){const ge=this.clusterProps[ae[le+zi]];return me?Object.assign({},ge):ge}const ue=this.points[ae[le+Xt]].properties,$e=this.options.map(ue);return me&&$e===ue?Object.assign({},$e):$e}}function tt(rt,ae,le){return{type:"Feature",id:rt[ae+Xt],properties:Me(rt,ae,le),geometry:{type:"Point",coordinates:[(me=rt[ae],360*(me-.5)),Pt(rt[ae+1])]}};var me}function Me(rt,ae,le){const me=rt[ae+Jt],ue=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,$e=rt[ae+zi],ge=$e===-1?{}:Object.assign({},le[$e]);return Object.assign(ge,{cluster:!0,cluster_id:rt[ae+Xt],point_count:me,point_count_abbreviated:ue})}function dt(rt){return rt/360+.5}function vt(rt){const ae=Math.sin(rt*Math.PI/180),le=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return le<0?0:le>1?1:le}function Pt(rt){const ae=(180-360*rt)*Math.PI/180;return 360*Math.atan(Math.exp(ae))/Math.PI-90}function Ct(rt,ae,le,me){let ue=me;const $e=ae+(le-ae>>1);let ge,ut=le-ae;const Ge=rt[ae],ot=rt[ae+1],pt=rt[le],nt=rt[le+1];for(let Rt=ae+3;Rt<le;Rt+=3){const Qt=ei(rt[Rt],rt[Rt+1],Ge,ot,pt,nt);if(Qt>ue)ge=Rt,ue=Qt;else if(Qt===ue){const ii=Math.abs(Rt-$e);ii<ut&&(ge=Rt,ut=ii)}}ue>me&&(ge-ae>3&&Ct(rt,ae,ge,me),rt[ge+2]=ue,le-ge>3&&Ct(rt,ge,le,me))}function ei(rt,ae,le,me,ue,$e){let ge=ue-le,ut=$e-me;if(ge!==0||ut!==0){const Ge=((rt-le)*ge+(ae-me)*ut)/(ge*ge+ut*ut);Ge>1?(le=ue,me=$e):Ge>0&&(le+=ge*Ge,me+=ut*Ge)}return ge=rt-le,ut=ae-me,ge*ge+ut*ut}function Ai(rt,ae,le,me){const ue={id:rt??null,type:ae,geometry:le,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")oi(ue,le);else if(ae==="Polygon")oi(ue,le[0]);else if(ae==="MultiLineString")for(const $e of le)oi(ue,$e);else if(ae==="MultiPolygon")for(const $e of le)oi(ue,$e[0]);return ue}function oi(rt,ae){for(let le=0;le<ae.length;le+=3)rt.minX=Math.min(rt.minX,ae[le]),rt.minY=Math.min(rt.minY,ae[le+1]),rt.maxX=Math.max(rt.maxX,ae[le]),rt.maxY=Math.max(rt.maxY,ae[le+1])}function Zi(rt,ae,le,me){if(!ae.geometry)return;const ue=ae.geometry.coordinates;if(ue&&ue.length===0)return;const $e=ae.geometry.type,ge=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let ut=[],Ge=ae.id;if(le.promoteId?Ge=ae.properties[le.promoteId]:le.generateId&&(Ge=me||0),$e==="Point")Oi(ue,ut);else if($e==="MultiPoint")for(const ot of ue)Oi(ot,ut);else if($e==="LineString")Li(ue,ut,ge,!1);else if($e==="MultiLineString"){if(le.lineMetrics){for(const ot of ue)ut=[],Li(ot,ut,ge,!1),rt.push(Ai(Ge,"LineString",ut,ae.properties));return}Ar(ue,ut,ge,!1)}else if($e==="Polygon")Ar(ue,ut,ge,!0);else{if($e!=="MultiPolygon"){if($e==="GeometryCollection"){for(const ot of ae.geometry.geometries)Zi(rt,{id:Ge,geometry:ot,properties:ae.properties},le,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ot of ue){const pt=[];Ar(ot,pt,ge,!0),ut.push(pt)}}rt.push(Ai(Ge,$e,ut,ae.properties))}function Oi(rt,ae){ae.push(Yi(rt[0]),Fi(rt[1]),0)}function Li(rt,ae,le,me){let ue,$e,ge=0;for(let Ge=0;Ge<rt.length;Ge++){const ot=Yi(rt[Ge][0]),pt=Fi(rt[Ge][1]);ae.push(ot,pt,0),Ge>0&&(ge+=me?(ue*pt-ot*$e)/2:Math.sqrt(Math.pow(ot-ue,2)+Math.pow(pt-$e,2))),ue=ot,$e=pt}const ut=ae.length-3;ae[2]=1,Ct(ae,0,ut,le),ae[ut+2]=1,ae.size=Math.abs(ge),ae.start=0,ae.end=ae.size}function Ar(rt,ae,le,me){for(let ue=0;ue<rt.length;ue++){const $e=[];Li(rt[ue],$e,le,me),ae.push($e)}}function Yi(rt){return rt/360+.5}function Fi(rt){const ae=Math.sin(rt*Math.PI/180),le=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return le<0?0:le>1?1:le}function wr(rt,ae,le,me,ue,$e,ge,ut){if(me/=ae,$e>=(le/=ae)&&ge<me)return rt;if(ge<le||$e>=me)return null;const Ge=[];for(const ot of rt){const pt=ot.geometry;let nt=ot.type;const Rt=ue===0?ot.minX:ot.minY,Qt=ue===0?ot.maxX:ot.maxY;if(Rt>=le&&Qt<me){Ge.push(ot);continue}if(Qt<le||Rt>=me)continue;let ii=[];if(nt==="Point"||nt==="MultiPoint")sr(pt,ii,le,me,ue);else if(nt==="LineString")ur(pt,ii,le,me,ue,!1,ut.lineMetrics);else if(nt==="MultiLineString")Vt(pt,ii,le,me,ue,!1);else if(nt==="Polygon")Vt(pt,ii,le,me,ue,!0);else if(nt==="MultiPolygon")for(const gi of pt){const Qe=[];Vt(gi,Qe,le,me,ue,!0),Qe.length&&ii.push(Qe)}if(ii.length){if(ut.lineMetrics&&nt==="LineString"){for(const gi of ii)Ge.push(Ai(ot.id,nt,gi,ot.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(ii.length===1?(nt="LineString",ii=ii[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=ii.length===3?"Point":"MultiPoint"),Ge.push(Ai(ot.id,nt,ii,ot.tags))}}return Ge.length?Ge:null}function sr(rt,ae,le,me,ue){for(let $e=0;$e<rt.length;$e+=3){const ge=rt[$e+ue];ge>=le&&ge<=me&&zt(ae,rt[$e],rt[$e+1],rt[$e+2])}}function ur(rt,ae,le,me,ue,$e,ge){let ut=qi(rt);const Ge=ue===0?Pi:dr;let ot,pt,nt=rt.start;for(let Qe=0;Qe<rt.length-3;Qe+=3){const ht=rt[Qe],We=rt[Qe+1],Tt=rt[Qe+2],A=rt[Qe+3],ie=rt[Qe+4],ri=ue===0?ht:We,_t=ue===0?A:ie;let ui=!1;ge&&(ot=Math.sqrt(Math.pow(ht-A,2)+Math.pow(We-ie,2))),ri<le?_t>le&&(pt=Ge(ut,ht,We,A,ie,le),ge&&(ut.start=nt+ot*pt)):ri>me?_t<me&&(pt=Ge(ut,ht,We,A,ie,me),ge&&(ut.start=nt+ot*pt)):zt(ut,ht,We,Tt),_t<le&&ri>=le&&(pt=Ge(ut,ht,We,A,ie,le),ui=!0),_t>me&&ri<=me&&(pt=Ge(ut,ht,We,A,ie,me),ui=!0),!$e&&ui&&(ge&&(ut.end=nt+ot*pt),ae.push(ut),ut=qi(rt)),ge&&(nt+=ot)}let Rt=rt.length-3;const Qt=rt[Rt],ii=rt[Rt+1],gi=ue===0?Qt:ii;gi>=le&&gi<=me&&zt(ut,Qt,ii,rt[Rt+2]),Rt=ut.length-3,$e&&Rt>=3&&(ut[Rt]!==ut[0]||ut[Rt+1]!==ut[1])&&zt(ut,ut[0],ut[1],ut[2]),ut.length&&ae.push(ut)}function qi(rt){const ae=[];return ae.size=rt.size,ae.start=rt.start,ae.end=rt.end,ae}function Vt(rt,ae,le,me,ue,$e){for(const ge of rt)ur(ge,ae,le,me,ue,$e,!1)}function zt(rt,ae,le,me){rt.push(ae,le,me)}function Pi(rt,ae,le,me,ue,$e){const ge=($e-ae)/(me-ae);return zt(rt,$e,le+(ue-le)*ge,1),ge}function dr(rt,ae,le,me,ue,$e){const ge=($e-le)/(ue-le);return zt(rt,ae+(me-ae)*ge,$e,1),ge}function tr(rt,ae){const le=[];for(let me=0;me<rt.length;me++){const ue=rt[me],$e=ue.type;let ge;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")ge=or(ue.geometry,ae);else if($e==="MultiLineString"||$e==="Polygon"){ge=[];for(const ut of ue.geometry)ge.push(or(ut,ae))}else if($e==="MultiPolygon"){ge=[];for(const ut of ue.geometry){const Ge=[];for(const ot of ut)Ge.push(or(ot,ae));ge.push(Ge)}}le.push(Ai(ue.id,$e,ge,ue.tags))}return le}function or(rt,ae){const le=[];le.size=rt.size,rt.start!==void 0&&(le.start=rt.start,le.end=rt.end);for(let me=0;me<rt.length;me+=3)le.push(rt[me]+ae,rt[me+1],rt[me+2]);return le}function Tn(rt,ae){if(rt.transformed)return rt;const le=1<<rt.z,me=rt.x,ue=rt.y;for(const $e of rt.features){const ge=$e.geometry,ut=$e.type;if($e.geometry=[],ut===1)for(let Ge=0;Ge<ge.length;Ge+=2)$e.geometry.push(rs(ge[Ge],ge[Ge+1],ae,le,me,ue));else for(let Ge=0;Ge<ge.length;Ge++){const ot=[];for(let pt=0;pt<ge[Ge].length;pt+=2)ot.push(rs(ge[Ge][pt],ge[Ge][pt+1],ae,le,me,ue));$e.geometry.push(ot)}}return rt.transformed=!0,rt}function rs(rt,ae,le,me,ue,$e){return[Math.round(le*(rt*me-ue)),Math.round(le*(ae*me-$e))]}function Sn(rt,ae,le,me,ue){const $e=ae===ue.maxZoom?0:ue.tolerance/((1<<ae)*ue.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:rt.length,source:null,x:le,y:me,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ut of rt)js(ge,ut,$e,ue);return ge}function js(rt,ae,le,me){const ue=ae.geometry,$e=ae.type,ge=[];if(rt.minX=Math.min(rt.minX,ae.minX),rt.minY=Math.min(rt.minY,ae.minY),rt.maxX=Math.max(rt.maxX,ae.maxX),rt.maxY=Math.max(rt.maxY,ae.maxY),$e==="Point"||$e==="MultiPoint")for(let ut=0;ut<ue.length;ut+=3)ge.push(ue[ut],ue[ut+1]),rt.numPoints++,rt.numSimplified++;else if($e==="LineString")ao(ge,ue,rt,le,!1,!1);else if($e==="MultiLineString"||$e==="Polygon")for(let ut=0;ut<ue.length;ut++)ao(ge,ue[ut],rt,le,$e==="Polygon",ut===0);else if($e==="MultiPolygon")for(let ut=0;ut<ue.length;ut++){const Ge=ue[ut];for(let ot=0;ot<Ge.length;ot++)ao(ge,Ge[ot],rt,le,!0,ot===0)}if(ge.length){let ut=ae.tags||null;if($e==="LineString"&&me.lineMetrics){ut={};for(const ot in ae.tags)ut[ot]=ae.tags[ot];ut.mapbox_clip_start=ue.start/ue.size,ut.mapbox_clip_end=ue.end/ue.size}const Ge={geometry:ge,type:$e==="Polygon"||$e==="MultiPolygon"?3:$e==="LineString"||$e==="MultiLineString"?2:1,tags:ut};ae.id!==null&&(Ge.id=ae.id),rt.features.push(Ge)}}function ao(rt,ae,le,me,ue,$e){const ge=me*me;if(me>0&&ae.size<(ue?ge:me))return void(le.numPoints+=ae.length/3);const ut=[];for(let Ge=0;Ge<ae.length;Ge+=3)(me===0||ae[Ge+2]>ge)&&(le.numSimplified++,ut.push(ae[Ge],ae[Ge+1])),le.numPoints++;ue&&function(Ge,ot){let pt=0;for(let nt=0,Rt=Ge.length,Qt=Rt-2;nt<Rt;Qt=nt,nt+=2)pt+=(Ge[nt]-Ge[Qt])*(Ge[nt+1]+Ge[Qt+1]);if(pt>0===ot)for(let nt=0,Rt=Ge.length;nt<Rt/2;nt+=2){const Qt=Ge[nt],ii=Ge[nt+1];Ge[nt]=Ge[Rt-2-nt],Ge[nt+1]=Ge[Rt-1-nt],Ge[Rt-2-nt]=Qt,Ge[Rt-1-nt]=ii}}(ut,$e),rt.push(ut)}const Io={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qs{constructor(ae,le){const me=(le=this.options=function($e,ge){for(const ut in ge)$e[ut]=ge[ut];return $e}(Object.create(Io),le)).debug;if(me&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function($e,ge){const ut=[];if($e.type==="FeatureCollection")for(let Ge=0;Ge<$e.features.length;Ge++)Zi(ut,$e.features[Ge],ge,Ge);else Zi(ut,$e.type==="Feature"?$e:{geometry:$e},ge);return ut}(ae,le);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function($e,ge){const ut=ge.buffer/ge.extent;let Ge=$e;const ot=wr($e,1,-1-ut,ut,0,-1,2,ge),pt=wr($e,1,1-ut,2+ut,0,-1,2,ge);return(ot||pt)&&(Ge=wr($e,1,-ut,1+ut,0,-1,2,ge)||[],ot&&(Ge=tr(ot,1).concat(Ge)),pt&&(Ge=Ge.concat(tr(pt,-1)))),Ge}(ue,le),ue.length&&this.splitTile(ue,0,0,0),me&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ae,le,me,ue,$e,ge,ut){const Ge=[ae,le,me,ue],ot=this.options,pt=ot.debug;for(;Ge.length;){ue=Ge.pop(),me=Ge.pop(),le=Ge.pop(),ae=Ge.pop();const nt=1<<le,Rt=lo(le,me,ue);let Qt=this.tiles[Rt];if(!Qt&&(pt>1&&console.time("creation"),Qt=this.tiles[Rt]=Sn(ae,le,me,ue,ot),this.tileCoords.push({z:le,x:me,y:ue}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,me,ue,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const ui=`z${le}`;this.stats[ui]=(this.stats[ui]||0)+1,this.total++}if(Qt.source=ae,$e==null){if(le===ot.indexMaxZoom||Qt.numPoints<=ot.indexMaxPoints)continue}else{if(le===ot.maxZoom||le===$e)continue;if($e!=null){const ui=$e-le;if(me!==ge>>ui||ue!==ut>>ui)continue}}if(Qt.source=null,ae.length===0)continue;pt>1&&console.time("clipping");const ii=.5*ot.buffer/ot.extent,gi=.5-ii,Qe=.5+ii,ht=1+ii;let We=null,Tt=null,A=null,ie=null,ri=wr(ae,nt,me-ii,me+Qe,0,Qt.minX,Qt.maxX,ot),_t=wr(ae,nt,me+gi,me+ht,0,Qt.minX,Qt.maxX,ot);ae=null,ri&&(We=wr(ri,nt,ue-ii,ue+Qe,1,Qt.minY,Qt.maxY,ot),Tt=wr(ri,nt,ue+gi,ue+ht,1,Qt.minY,Qt.maxY,ot),ri=null),_t&&(A=wr(_t,nt,ue-ii,ue+Qe,1,Qt.minY,Qt.maxY,ot),ie=wr(_t,nt,ue+gi,ue+ht,1,Qt.minY,Qt.maxY,ot),_t=null),pt>1&&console.timeEnd("clipping"),Ge.push(We||[],le+1,2*me,2*ue),Ge.push(Tt||[],le+1,2*me,2*ue+1),Ge.push(A||[],le+1,2*me+1,2*ue),Ge.push(ie||[],le+1,2*me+1,2*ue+1)}}getTile(ae,le,me){ae=+ae,le=+le,me=+me;const ue=this.options,{extent:$e,debug:ge}=ue;if(ae<0||ae>24)return null;const ut=1<<ae,Ge=lo(ae,le=le+ut&ut-1,me);if(this.tiles[Ge])return Tn(this.tiles[Ge],$e);ge>1&&console.log("drilling down to z%d-%d-%d",ae,le,me);let ot,pt=ae,nt=le,Rt=me;for(;!ot&&pt>0;)pt--,nt>>=1,Rt>>=1,ot=this.tiles[lo(pt,nt,Rt)];return ot&&ot.source?(ge>1&&(console.log("found parent tile z%d-%d-%d",pt,nt,Rt),console.time("drilling down")),this.splitTile(ot.source,pt,nt,Rt,ae,le,me),ge>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Tn(this.tiles[Ge],$e):null):null}}function lo(rt,ae,le){return 32*((1<<rt)*le+ae)+rt}function Po(rt,ae){return ae?rt.properties[ae]:rt.id}function Na(rt,ae){if(rt==null)return!0;if(rt.type==="Feature")return Po(rt,ae)!=null;if(rt.type==="FeatureCollection"){const le=new Set;for(const me of rt.features){const ue=Po(me,ae);if(ue==null||le.has(ue))return!1;le.add(ue)}return!0}return!1}function ks(rt,ae){const le=new Map;if(rt!=null)if(rt.type==="Feature")le.set(Po(rt,ae),rt);else for(const me of rt.features)le.set(Po(me,ae),me);return le}class ns extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ae,le){return f._(this,void 0,void 0,function*(){const me=ae.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!ue)return null;const $e=new Ce(ue.features);let ge=jt($e);return ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),{vectorTile:$e,rawData:ge.buffer}})}loadData(ae){return f._(this,void 0,void 0,function*(){var le;(le=this._pendingRequest)===null||le===void 0||le.abort();const me=!!(ae&&ae.request&&ae.request.collectResourceTiming)&&new f.cE(ae.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ae,this._pendingRequest),this._geoJSONIndex=ae.cluster?new Fe(function({superclusterOptions:ge,clusterProperties:ut}){if(!ut||!ge)return ge;const Ge={},ot={},pt={accumulated:null,zoom:0},nt={properties:null},Rt=Object.keys(ut);for(const Qt of Rt){const[ii,gi]=ut[Qt],Qe=f.cL(gi),ht=f.cL(typeof ii=="string"?[ii,["accumulated"],["get",Qt]]:ii);Ge[Qt]=Qe.value,ot[Qt]=ht.value}return ge.map=Qt=>{nt.properties=Qt;const ii={};for(const gi of Rt)ii[gi]=Ge[gi].evaluate(pt,nt);return ii},ge.reduce=(Qt,ii)=>{nt.properties=ii;for(const gi of Rt)pt.accumulated=Qt[gi],Qt[gi]=ot[gi].evaluate(pt,nt)},ge}(ae)).load((yield this._pendingData).features):(ue=yield this._pendingData,new Qs(ue,ae.geojsonVtOptions)),this.loaded={};const $e={};if(me){const ge=me.finish();ge&&($e.resourceTiming={},$e.resourceTiming[ae.source]=JSON.parse(JSON.stringify(ge)))}return $e}catch($e){if(delete this._pendingRequest,f.cp($e))return{abandoned:!0};throw $e}var ue})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ae){const le=this.loaded;return le&&le[ae.uid]?super.reloadTile(ae):this.loadTile(ae)}loadAndProcessGeoJSON(ae,le){return f._(this,void 0,void 0,function*(){let me=yield this.loadGeoJSON(ae,le);if(delete this._pendingRequest,typeof me!="object")throw new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`);if(Ie(me,!0),ae.filter){const ue=f.cL(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(ge=>ue.value.evaluate({zoom:0},ge))}}return me})}loadGeoJSON(ae,le){return f._(this,void 0,void 0,function*(){const{promoteId:me}=ae;if(ae.request){const ue=yield f.j(ae.request,le);return this._dataUpdateable=Na(ue.data,me)?ks(ue.data,me):void 0,ue.data}if(typeof ae.data=="string")try{const ue=JSON.parse(ae.data);return this._dataUpdateable=Na(ue,me)?ks(ue,me):void 0,ue}catch{throw new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`)}if(!ae.dataDiff)throw new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ae.source}`);return function(ue,$e,ge){var ut,Ge,ot,pt;if($e.removeAll&&ue.clear(),$e.remove)for(const nt of $e.remove)ue.delete(nt);if($e.add)for(const nt of $e.add){const Rt=Po(nt,ge);Rt!=null&&ue.set(Rt,nt)}if($e.update)for(const nt of $e.update){let Rt=ue.get(nt.id);if(Rt==null)continue;const Qt=!nt.removeAllProperties&&(((ut=nt.removeProperties)===null||ut===void 0?void 0:ut.length)>0||((Ge=nt.addOrUpdateProperties)===null||Ge===void 0?void 0:Ge.length)>0);if((nt.newGeometry||nt.removeAllProperties||Qt)&&(Rt=Object.assign({},Rt),ue.set(nt.id,Rt),Qt&&(Rt.properties=Object.assign({},Rt.properties))),nt.newGeometry&&(Rt.geometry=nt.newGeometry),nt.removeAllProperties)Rt.properties={};else if(((ot=nt.removeProperties)===null||ot===void 0?void 0:ot.length)>0)for(const ii of nt.removeProperties)Object.prototype.hasOwnProperty.call(Rt.properties,ii)&&delete Rt.properties[ii];if(((pt=nt.addOrUpdateProperties)===null||pt===void 0?void 0:pt.length)>0)for(const{key:ii,value:gi}of nt.addOrUpdateProperties)Rt.properties[ii]=gi}}(this._dataUpdateable,ae.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ae){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ae){return this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId)}getClusterChildren(ae){return this._geoJSONIndex.getChildren(ae.clusterId)}getClusterLeaves(ae){return this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset)}}class Ks{constructor(ae){this.self=ae,this.actor=new f.H(ae),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(le,me)=>{if(this.externalWorkerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.externalWorkerSourceTypes[le]=me},this.self.addProtocol=f.cr,this.self.removeProtocol=f.cs,this.self.registerRTLTextPlugin=le=>{f.cM.setMethods(le)},this.actor.registerMessageHandler("LDT",(le,me)=>this._getDEMWorkerSource(le,me.source).loadTile(me)),this.actor.registerMessageHandler("RDT",(le,me)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(le,me.source).removeTile(me)})),this.actor.registerMessageHandler("GCEZ",(le,me)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(le,me.type,me.source).getClusterExpansionZoom(me)})),this.actor.registerMessageHandler("GCC",(le,me)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(le,me.type,me.source).getClusterChildren(me)})),this.actor.registerMessageHandler("GCL",(le,me)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(le,me.type,me.source).getClusterLeaves(me)})),this.actor.registerMessageHandler("LD",(le,me)=>this._getWorkerSource(le,me.type,me.source).loadData(me)),this.actor.registerMessageHandler("GD",(le,me)=>this._getWorkerSource(le,me.type,me.source).getData()),this.actor.registerMessageHandler("LT",(le,me)=>this._getWorkerSource(le,me.type,me.source).loadTile(me)),this.actor.registerMessageHandler("RT",(le,me)=>this._getWorkerSource(le,me.type,me.source).reloadTile(me)),this.actor.registerMessageHandler("AT",(le,me)=>this._getWorkerSource(le,me.type,me.source).abortTile(me)),this.actor.registerMessageHandler("RMT",(le,me)=>this._getWorkerSource(le,me.type,me.source).removeTile(me)),this.actor.registerMessageHandler("RS",(le,me)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[le]||!this.workerSources[le][me.type]||!this.workerSources[le][me.type][me.source])return;const ue=this.workerSources[le][me.type][me.source];delete this.workerSources[le][me.type][me.source],ue.removeSource!==void 0&&ue.removeSource(me)})),this.actor.registerMessageHandler("RM",le=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le]})),this.actor.registerMessageHandler("SR",(le,me)=>f._(this,void 0,void 0,function*(){this.referrer=me})),this.actor.registerMessageHandler("SRPS",(le,me)=>this._syncRTLPluginState(le,me)),this.actor.registerMessageHandler("IS",(le,me)=>f._(this,void 0,void 0,function*(){this.self.importScripts(me)})),this.actor.registerMessageHandler("SI",(le,me)=>this._setImages(le,me)),this.actor.registerMessageHandler("UL",(le,me)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(le).update(me.layers,me.removedIds)})),this.actor.registerMessageHandler("SL",(le,me)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(le).replace(me)}))}_setImages(ae,le){return f._(this,void 0,void 0,function*(){this.availableImages[ae]=le;for(const me in this.workerSources[ae]){const ue=this.workerSources[ae][me];for(const $e in ue)ue[$e].availableImages=le}})}_syncRTLPluginState(ae,le){return f._(this,void 0,void 0,function*(){return yield f.cM.syncState(le,this.self.importScripts)})}_getAvailableImages(ae){let le=this.availableImages[ae];return le||(le=[]),le}_getLayerIndex(ae){let le=this.layerIndexes[ae];return le||(le=this.layerIndexes[ae]=new a),le}_getWorkerSource(ae,le,me){if(this.workerSources[ae]||(this.workerSources[ae]={}),this.workerSources[ae][le]||(this.workerSources[ae][le]={}),!this.workerSources[ae][le][me]){const ue={sendAsync:($e,ge)=>($e.targetMapId=ae,this.actor.sendAsync($e,ge))};switch(le){case"vector":this.workerSources[ae][le][me]=new F(ue,this._getLayerIndex(ae),this._getAvailableImages(ae));break;case"geojson":this.workerSources[ae][le][me]=new ns(ue,this._getLayerIndex(ae),this._getAvailableImages(ae));break;default:this.workerSources[ae][le][me]=new this.externalWorkerSourceTypes[le](ue,this._getLayerIndex(ae),this._getAvailableImages(ae))}}return this.workerSources[ae][le][me]}_getDEMWorkerSource(ae,le){return this.demWorkerSources[ae]||(this.demWorkerSources[ae]={}),this.demWorkerSources[ae][le]||(this.demWorkerSources[ae][le]=new V),this.demWorkerSources[ae][le]}}return f.i(self)&&(self.worker=new Ks(self)),Ks}),o("index",["exports","./shared"],function(f,a){var w="5.5.0";function P(){var T=new a.A(4);return a.A!=Float32Array&&(T[1]=0,T[2]=0),T[0]=1,T[3]=1,T}let k,F;const V={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(T,n,l){const _=requestAnimationFrame(S=>{y(),n(S)}),{unsubscribe:y}=a.s(T.signal,"abort",()=>{y(),cancelAnimationFrame(_),l(a.c())},!1)},frameAsync(T){return new Promise((n,l)=>{this.frame(T,n,l)})},getImageData(T,n=0){return this.getImageCanvasContext(T).getImageData(-n,-n,T.width+2*n,T.height+2*n)},getImageCanvasContext(T){const n=window.document.createElement("canvas"),l=n.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return n.width=T.width,n.height=T.height,l.drawImage(T,0,0,T.width,T.height),l},resolveURL:T=>(k||(k=document.createElement("a")),k.href=T,k.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(F==null&&(F=matchMedia("(prefers-reduced-motion: reduce)")),F.matches)}};class W{static testProp(n){if(!W.docStyle)return n[0];for(let l=0;l<n.length;l++)if(n[l]in W.docStyle)return n[l];return n[0]}static create(n,l,_){const y=window.document.createElement(n);return l!==void 0&&(y.className=l),_&&_.appendChild(y),y}static createNS(n,l){return window.document.createElementNS(n,l)}static disableDrag(){W.docStyle&&W.selectProp&&(W.userSelect=W.docStyle[W.selectProp],W.docStyle[W.selectProp]="none")}static enableDrag(){W.docStyle&&W.selectProp&&(W.docStyle[W.selectProp]=W.userSelect)}static setTransform(n,l){n.style[W.transformProp]=l}static addEventListener(n,l,_,y={}){n.addEventListener(l,_,"passive"in y?y:y.capture)}static removeEventListener(n,l,_,y={}){n.removeEventListener(l,_,"passive"in y?y:y.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",W.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",W.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",W.suppressClickInternal,!0)},0)}static getScale(n){const l=n.getBoundingClientRect();return{x:l.width/n.offsetWidth||1,y:l.height/n.offsetHeight||1,boundingClientRect:l}}static getPoint(n,l,_){const y=l.boundingClientRect;return new a.P((_.clientX-y.left)/l.x-n.clientLeft,(_.clientY-y.top)/l.y-n.clientTop)}static mousePos(n,l){const _=W.getScale(n);return W.getPoint(n,_,l)}static touchPos(n,l){const _=[],y=W.getScale(n);for(let S=0;S<l.length;S++)_.push(W.getPoint(n,y,l[S]));return _}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}static sanitize(n){const l=new DOMParser().parseFromString(n,"text/html").body||document.createElement("body"),_=l.querySelectorAll("script");for(const y of _)y.remove();return W.clean(l),l.innerHTML}static isPossiblyDangerous(n,l){const _=l.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(n)||!_.includes("javascript:")&&!_.includes("data:"))||!!n.startsWith("on")||void 0}static clean(n){const l=n.children;for(const _ of l)W.removeAttributes(_),W.clean(_)}static removeAttributes(n){for(const{name:l,value:_}of n.attributes)W.isPossiblyDangerous(l,_)&&n.removeAttribute(l)}}W.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,W.selectProp=W.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),W.transformProp=W.testProp(["transform","WebkitTransform"]);const ee={supported:!1,testSupport:function(T){!Ee&&Ie&&(Ne?Ce(T):he=T)}};let he,Ie,Ee=!1,Ne=!1;function Ce(T){const n=T.createTexture();T.bindTexture(T.TEXTURE_2D,n);try{if(T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,Ie),T.isContextLost())return;ee.supported=!0}catch{}T.deleteTexture(n),Ee=!0}var De;typeof document<"u"&&(Ie=document.createElement("img"),Ie.onload=()=>{he&&Ce(he),he=null,Ne=!0},Ie.onerror=()=>{Ee=!0,he=null},Ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(T){let n,l,_,y;T.resetRequestQueue=()=>{n=[],l=0,_=0,y={}},T.addThrottleControl=N=>{const j=_++;return y[j]=N,j},T.removeThrottleControl=N=>{delete y[N],M()},T.getImage=(N,j,Z=!0)=>new Promise((Y,G)=>{ee.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*"),a.e(N,{type:"image"}),n.push({abortController:j,requestParameters:N,supportImageRefresh:Z,state:"queued",onError:re=>{G(re)},onSuccess:re=>{Y(re)}}),M()});const S=N=>a._(this,void 0,void 0,function*(){N.state="running";const{requestParameters:j,supportImageRefresh:Z,onError:Y,onSuccess:G,abortController:re}=N,ne=Z===!1&&!a.i(self)&&!a.g(j.url)&&(!j.headers||Object.keys(j.headers).reduce((ve,Re)=>ve&&Re==="accept",!0));l++;const be=ne?O(j,re):a.m(j,re);try{const ve=yield be;delete N.abortController,N.state="completed",ve.data instanceof HTMLImageElement||a.b(ve.data)?G(ve):ve.data&&G({data:yield(ye=ve.data,typeof createImageBitmap=="function"?a.f(ye):a.h(ye)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete N.abortController,Y(ve)}finally{l--,M()}var ye}),M=()=>{const N=(()=>{for(const j of Object.keys(y))if(y[j]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let j=l;j<N&&n.length>0;j++){const Z=n.shift();Z.abortController.signal.aborted?j--:S(Z)}},O=(N,j)=>new Promise((Z,Y)=>{const G=new Image,re=N.url,ne=N.credentials;ne&&ne==="include"?G.crossOrigin="use-credentials":(ne&&ne==="same-origin"||!a.d(re))&&(G.crossOrigin="anonymous"),j.signal.addEventListener("abort",()=>{G.src="",Y(a.c())}),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,Z({data:G})},G.onerror=()=>{G.onerror=G.onload=null,j.signal.aborted||Y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=re})}(De||(De={})),De.resetRequestQueue();class Ye{constructor(n){this._transformRequestFn=n}transformRequest(n,l){return this._transformRequestFn&&this._transformRequestFn(n,l)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function Ke(T){const n=[];if(typeof T=="string")n.push({id:"default",url:T});else if(T&&T.length>0){const l=[];for(const{id:_,url:y}of T){const S=`${_}${y}`;l.indexOf(S)===-1&&(l.push(S),n.push({id:_,url:y}))}}return n}function kt(T,n,l){try{const _=new URL(T);return _.pathname+=`${n}${l}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${T}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class It{constructor(n,l,_,y){this.context=n,this.format=_,this.texture=n.gl.createTexture(),this.update(l,y)}update(n,l,_){const{width:y,height:S}=n,M=!(this.size&&this.size[0]===y&&this.size[1]===S||_),{context:O}=this,{gl:N}=O;if(this.useMipmap=!!(l&&l.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),O.pixelStoreUnpackFlipY.set(!1),O.pixelStoreUnpack.set(1),O.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!l||l.premultiply!==!1)),M)this.size=[y,S],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||a.b(n)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,n):N.texImage2D(N.TEXTURE_2D,0,this.format,y,S,0,this.format,N.UNSIGNED_BYTE,n.data);else{const{x:j,y:Z}=_||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||a.b(n)?N.texSubImage2D(N.TEXTURE_2D,0,j,Z,N.RGBA,N.UNSIGNED_BYTE,n):N.texSubImage2D(N.TEXTURE_2D,0,j,Z,y,S,N.RGBA,N.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D),O.pixelStoreUnpackFlipY.setDefault(),O.pixelStoreUnpack.setDefault(),O.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,l,_){const{context:y}=this,{gl:S}=y;S.bindTexture(S.TEXTURE_2D,this.texture),_!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=S.LINEAR),n!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,n),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,_||n),this.filter=n),l!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,l),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function jt(T){const{userImage:n}=T;return!!(n&&n.render&&n.render())&&(T.data.replace(new Uint8Array(n.data.buffer)),!0)}class Lt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,promiseResolve:_}of this.requestors)_(this._getImagesForIds(l));this.requestors=[]}}getImage(n){const l=this.images[n];if(l&&!l.data&&l.spriteData){const _=l.spriteData;l.data=new a.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),l.spriteData=null}return l}addImage(n,l){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let _=!0;const y=l.data||l.spriteData;return this._validateStretch(l.stretchX,y&&y.width)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(l.stretchY,y&&y.height)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(l.content,l)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,l){if(!n)return!0;let _=0;for(const y of n){if(y[0]<_||y[1]<y[0]||l<y[1])return!1;_=y[1]}return!0}_validateContent(n,l){if(!n)return!0;if(n.length!==4)return!1;const _=l.spriteData,y=_&&_.width||l.data.width,S=_&&_.height||l.data.height;return!(n[0]<0||y<n[0]||n[1]<0||S<n[1]||n[2]<0||y<n[2]||n[3]<0||S<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,l,_=!0){const y=this.getImage(n);if(_&&(y.data.width!==l.data.width||y.data.height!==l.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=y.version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise((l,_)=>{let y=!0;if(!this.isLoaded())for(const S of n)this.images[S]||(y=!1);this.isLoaded()||y?l(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:l})})}_getImagesForIds(n){const l={};for(const _ of n){let y=this.getImage(_);y||(this.fire(new a.l("styleimagemissing",{id:_})),y=this.getImage(_)),y?l[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return l}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],_=this.getImage(n);if(!_)return null;if(l&&l.position.version===_.version)return l.position;if(l)l.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new a.I(y,_);this.patterns[n]={bin:y,position:S}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new It(n,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const S in this.patterns)n.push(this.patterns[S].bin);const{w:l,h:_}=a.p(n),y=this.atlasImage;y.resize({width:l||1,height:_||1});for(const S in this.patterns){const{bin:M}=this.patterns[S],O=M.x+1,N=M.y+1,j=this.getImage(S).data,Z=j.width,Y=j.height;a.R.copy(j,y,{x:0,y:0},{x:O,y:N},{width:Z,height:Y}),a.R.copy(j,y,{x:0,y:Y-1},{x:O,y:N-1},{width:Z,height:1}),a.R.copy(j,y,{x:0,y:0},{x:O,y:N+Y},{width:Z,height:1}),a.R.copy(j,y,{x:Z-1,y:0},{x:O-1,y:N},{width:1,height:Y}),a.R.copy(j,y,{x:0,y:0},{x:O+Z,y:N},{width:1,height:Y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const _=this.getImage(l);_||a.w(`Image with ID: "${l}" was not found`),jt(_)&&this.updateImage(l,_)}}}const Mt=1e20;function vi(T,n,l,_,y,S,M,O,N){for(let j=n;j<n+_;j++)Xt(T,l*S+j,S,y,M,O,N);for(let j=l;j<l+y;j++)Xt(T,j*S+n,1,_,M,O,N)}function Xt(T,n,l,_,y,S,M){S[0]=0,M[0]=-1e20,M[1]=Mt,y[0]=T[n];for(let O=1,N=0,j=0;O<_;O++){y[O]=T[n+O*l];const Z=O*O;do{const Y=S[N];j=(y[O]-y[Y]+Z-Y*Y)/(O-Y)/2}while(j<=M[N]&&--N>-1);N++,S[N]=O,M[N]=j,M[N+1]=Mt}for(let O=0,N=0;O<_;O++){for(;M[N+1]<O;)N++;const j=S[N],Z=O-j;T[n+O*l]=y[j]+Z*Z}}class Jt{constructor(n,l){this.requestManager=n,this.localIdeographFontFamily=l,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return a._(this,void 0,void 0,function*(){const l=[];for(const S in n)for(const M of n[S])l.push(this._getAndCacheGlyphsPromise(S,M));const _=yield Promise.all(l),y={};for(const{stack:S,id:M,glyph:O}of _)y[S]||(y[S]={}),y[S][M]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};return y})}_getAndCacheGlyphsPromise(n,l){return a._(this,void 0,void 0,function*(){let _=this.entries[n];_||(_=this.entries[n]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[l];if(y!==void 0)return{stack:n,id:l,glyph:y};if(y=this._tinySDF(_,n,l),y)return _.glyphs[l]=y,{stack:n,id:l,glyph:y};const S=Math.floor(l/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[S])return{stack:n,id:l,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[S]){const O=Jt.loadGlyphRange(n,S,this.url,this.requestManager);_.requests[S]=O}const M=yield _.requests[S];for(const O in M)this._doesCharSupportLocalGlyph(+O)||(_.glyphs[+O]=M[+O]);return _.ranges[S]=!0,{stack:n,id:l,glyph:M[l]||null}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(n))||a.u["CJK Unified Ideographs"](n)||a.u["Hangul Syllables"](n)||a.u.Hiragana(n)||a.u.Katakana(n)||a.u["CJK Symbols and Punctuation"](n)||a.u["Halfwidth and Fullwidth Forms"](n))}_tinySDF(n,l,_){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(_))return;let S=n.tinySDF;if(!S){let O="400";/bold/i.test(l)?O="900":/medium/i.test(l)?O="500":/light/i.test(l)&&(O="200"),S=n.tinySDF=new Jt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:O})}const M=S.draw(String.fromCharCode(_));return{id:_,bitmap:new a.q({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}}Jt.loadGlyphRange=function(T,n,l,_){return a._(this,void 0,void 0,function*(){const y=256*n,S=y+255,M=_.transformRequest(l.replace("{fontstack}",T).replace("{range}",`${y}-${S}`),"Glyphs"),O=yield a.n(M,new AbortController);if(!O||!O.data)throw new Error(`Could not load glyph range. range: ${n}, ${y}-${S}`);const N={};for(const j of a.o(O.data))N[j.id]=j;return N})},Jt.TinySDF=class{constructor({fontSize:T=24,buffer:n=3,radius:l=8,cutoff:_=.25,fontFamily:y="sans-serif",fontWeight:S="normal",fontStyle:M="normal"}={}){this.buffer=n,this.cutoff=_,this.radius=l;const O=this.size=T+4*n,N=this._createCanvas(O),j=this.ctx=N.getContext("2d",{willReadFrequently:!0});j.font=`${M} ${S} ${T}px ${y}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(T){const n=document.createElement("canvas");return n.width=n.height=T,n}draw(T){const{width:n,actualBoundingBoxAscent:l,actualBoundingBoxDescent:_,actualBoundingBoxLeft:y,actualBoundingBoxRight:S}=this.ctx.measureText(T),M=Math.ceil(l),O=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-y))),N=Math.min(this.size-this.buffer,M+Math.ceil(_)),j=O+2*this.buffer,Z=N+2*this.buffer,Y=Math.max(j*Z,0),G=new Uint8ClampedArray(Y),re={data:G,width:j,height:Z,glyphWidth:O,glyphHeight:N,glyphTop:M,glyphLeft:0,glyphAdvance:n};if(O===0||N===0)return re;const{ctx:ne,buffer:be,gridInner:ye,gridOuter:ve}=this;ne.clearRect(be,be,O,N),ne.fillText(T,be,be+M);const Re=ne.getImageData(be,be,O,N);ve.fill(Mt,0,Y),ye.fill(0,0,Y);for(let Le=0;Le<N;Le++)for(let Oe=0;Oe<O;Oe++){const ze=Re.data[4*(Le*O+Oe)+3]/255;if(ze===0)continue;const Xe=(Le+be)*j+Oe+be;if(ze===1)ve[Xe]=0,ye[Xe]=Mt;else{const Ve=.5-ze;ve[Xe]=Ve>0?Ve*Ve:0,ye[Xe]=Ve<0?Ve*Ve:0}}vi(ve,0,0,j,Z,j,this.f,this.v,this.z),vi(ye,be,be,O,N,j,this.f,this.v,this.z);for(let Le=0;Le<Y;Le++){const Oe=Math.sqrt(ve[Le])-Math.sqrt(ye[Le]);G[Le]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return re}};class zi{constructor(){this.specification=a.v.light.position}possiblyEvaluate(n,l){return a.z(n.expression.evaluate(l))}interpolate(n,l,_){return{x:a.B.number(n.x,l.x,_),y:a.B.number(n.y,l.y,_),z:a.B.number(n.z,l.z,_)}}}let Fe;class tt extends a.E{constructor(n){super(),Fe=Fe||new a.r({anchor:new a.D(a.v.light.anchor),position:new zi,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Fe),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(a.t,n,l))for(const _ in n){const y=n[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,_){return(!_||_.validate!==!1)&&a.x(this,n.call(a.y,{value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Me=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class dt extends a.E{constructor(n){super(),this._transitionable=new a.T(Me),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0))}setSky(n,l={}){if(!this._validate(a.F,n,l)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in n){const y=n[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,_={}){return(_==null?void 0:_.validate)!==!1&&a.x(this,n.call(a.y,a.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class vt{constructor(n,l){this.width=n,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,l){const _=n.join(",")+String(l);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(n,l)),this.dashEntry[_]}getDashRanges(n,l,_){const y=[];let S=n.length%2==1?-n[n.length-1]*_:0,M=n[0]*_,O=!0;y.push({left:S,right:M,isDash:O,zeroLength:n[0]===0});let N=n[0];for(let j=1;j<n.length;j++){O=!O;const Z=n[j];S=N*_,N+=Z,M=N*_,y.push({left:S,right:M,isDash:O,zeroLength:Z===0})}return y}addRoundDash(n,l,_){const y=l/2;for(let S=-_;S<=_;S++){const M=this.width*(this.nextRow+_+S);let O=0,N=n[O];for(let j=0;j<this.width;j++){j/N.right>1&&(N=n[++O]);const Z=Math.abs(j-N.left),Y=Math.abs(j-N.right),G=Math.min(Z,Y);let re;const ne=S/_*(y+1);if(N.isDash){const be=y-Math.abs(ne);re=Math.sqrt(G*G+be*be)}else re=y-Math.sqrt(G*G+ne*ne);this.data[M+j]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(n){for(let O=n.length-1;O>=0;--O){const N=n[O],j=n[O+1];N.zeroLength?n.splice(O,1):j&&j.isDash===N.isDash&&(j.left=N.left,n.splice(O,1))}const l=n[0],_=n[n.length-1];l.isDash===_.isDash&&(l.left=_.left-this.width,_.right=l.right+this.width);const y=this.width*this.nextRow;let S=0,M=n[S];for(let O=0;O<this.width;O++){O/M.right>1&&(M=n[++S]);const N=Math.abs(O-M.left),j=Math.abs(O-M.right),Z=Math.min(N,j);this.data[y+O]=Math.max(0,Math.min(255,(M.isDash?Z:-Z)+128))}}addDash(n,l){const _=l?7:0,y=2*_+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let S=0;for(let O=0;O<n.length;O++)S+=n[O];if(S!==0){const O=this.width/S,N=this.getDashRanges(n,this.width,O);l?this.addRoundDash(N,O,_):this.addRegularDash(N)}const M={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:S};return this.nextRow+=y,this.dirty=!0,M}bind(n){const l=n.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class Ct{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ct.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const ei=Math.floor(V.hardwareConcurrency/2);let Ai,oi;function Zi(){return Ai||(Ai=new Ct),Ai}Ct.workerCount=a.G(globalThis)?Math.max(Math.min(ei,3),1):1;class Oi{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=l;const _=this.workerPool.acquire(l);for(let y=0;y<_.length;y++){const S=new a.H(_[y],l);S.name=`Worker ${y}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,l){const _=[];for(const y of this.actors)_.push(y.sendAsync({type:n,data:l}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,l){for(const _ of this.actors)_.registerMessageHandler(n,l)}}function Li(){return oi||(oi=new Oi(Zi(),a.J),oi.registerMessageHandler("GR",(T,n,l)=>a.m(n,l))),oi}function Ar(T,n){const l=a.K();return a.L(l,l,[1,1,0]),a.M(l,l,[.5*T.width,.5*T.height,1]),T.calculatePosMatrix?a.N(l,l,T.calculatePosMatrix(n.toUnwrapped())):l}function Yi(T,n,l,_,y,S,M){var O;const N=function(G,re,ne){if(G)for(const be of G){const ye=re[be];if(ye&&ye.source===ne&&ye.type==="fill-extrusion")return!0}else for(const be in re){const ye=re[be];if(ye.source===ne&&ye.type==="fill-extrusion")return!0}return!1}((O=y==null?void 0:y.layers)!==null&&O!==void 0?O:null,n,T.id),j=S.maxPitchScaleFactor(),Z=T.tilesIn(_,j,N);Z.sort(Fi);const Y=[];for(const G of Z)Y.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(n,l,T._state,G.queryGeometry,G.cameraQueryGeometry,G.scale,y,S,j,Ar(T.transform,G.tileID),M?(re,ne)=>M(G.tileID,re,ne):void 0)});return function(G,re){for(const ne in G)for(const be of G[ne])wr(be,re);return G}(function(G){const re={},ne={};for(const be of G){const ye=be.queryResults,ve=be.wrappedTileID,Re=ne[ve]=ne[ve]||{};for(const Le in ye){const Oe=ye[Le],ze=Re[Le]=Re[Le]||{},Xe=re[Le]=re[Le]||[];for(const Ve of Oe)ze[Ve.featureIndex]||(ze[Ve.featureIndex]=!0,Xe.push(Ve))}}return re}(Y),T)}function Fi(T,n){const l=T.tileID,_=n.tileID;return l.overscaledZ-_.overscaledZ||l.canonical.y-_.canonical.y||l.wrap-_.wrap||l.canonical.x-_.canonical.x}function wr(T,n){const l=T.feature,_=n.getFeatureState(l.layer["source-layer"],l.id);l.source=l.layer.source,l.layer["source-layer"]&&(l.sourceLayer=l.layer["source-layer"]),l.state=_}function sr(T,n,l){return a._(this,void 0,void 0,function*(){let _=T;if(T.url?_=(yield a.j(n.transformRequest(T.url,"Source"),l)).data:yield V.frameAsync(l),!_)return null;const y=a.O(a.e(_,T),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(y.vectorLayerIds=_.vector_layers.map(S=>S.id)),y})}class ur{constructor(n,l){n&&(l?this.setSouthWest(n).setNorthEast(l):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof a.Q?new a.Q(n.lng,n.lat):a.Q.convert(n),this}setSouthWest(n){return this._sw=n instanceof a.Q?new a.Q(n.lng,n.lat):a.Q.convert(n),this}extend(n){const l=this._sw,_=this._ne;let y,S;if(n instanceof a.Q)y=n,S=n;else{if(!(n instanceof ur))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(ur.convert(n)):this.extend(a.Q.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(a.Q.convert(n)):this;if(y=n._sw,S=n._ne,!y||!S)return this}return l||_?(l.lng=Math.min(y.lng,l.lng),l.lat=Math.min(y.lat,l.lat),_.lng=Math.max(S.lng,_.lng),_.lat=Math.max(S.lat,_.lat)):(this._sw=new a.Q(y.lng,y.lat),this._ne=new a.Q(S.lng,S.lat)),this}getCenter(){return new a.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.Q(this.getWest(),this.getNorth())}getSouthEast(){return new a.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:l,lat:_}=a.Q.convert(n);let y=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&y}static convert(n){return n instanceof ur?n:n&&new ur(n)}static fromLngLat(n,l=0){const _=360*l/40075017,y=_/Math.cos(Math.PI/180*n.lat);return new ur(new a.Q(n.lng-y,n.lat-_),new a.Q(n.lng+y,n.lat+_))}adjustAntiMeridian(){const n=new a.Q(this._sw.lng,this._sw.lat),l=new a.Q(this._ne.lng,this._ne.lat);return new ur(n,n.lng>l.lng?new a.Q(l.lng+360,l.lat):l)}}class qi{constructor(n,l,_){this.bounds=ur.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),_=Math.floor(a.U(this.bounds.getWest())*l),y=Math.floor(a.S(this.bounds.getNorth())*l),S=Math.ceil(a.U(this.bounds.getEast())*l),M=Math.ceil(a.S(this.bounds.getSouth())*l);return n.x>=_&&n.x<S&&n.y>=y&&n.y<M}}class Vt extends a.E{constructor(n,l,_,y){if(super(),this.id=n,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.O(l,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(a.e(this,n),n.bounds&&(this.tileBounds=new qi(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new a.k(n))}})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(n){return a._(this,void 0,void 0,function*(){const l=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(l,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};_.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise((S,M)=>{n.reloadPromise={resolve:S,reject:M}})}else n.actor=this.dispatcher.getActor(),y="LT";n.abortController=new AbortController;try{const S=yield n.actor.sendAsync({type:y,data:_},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,S)}catch(S){if(delete n.abortController,n.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(n,null)}})}_afterTileLoadWorkerResponse(n,l){if(l&&l.resourceTiming&&(n.resourceTiming=l.resourceTiming),l&&this.map._refreshExpiredTiles&&n.setExpiryData(l),n.loadVectorData(l,this.map.painter),n.reloadPromise){const _=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(_.resolve).catch(_.reject)}}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class zt extends a.E{constructor(n,l,_,y){super(),this.id=n,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},l),a.e(this,a.O(l,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(n=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(a.e(this,l),l.bounds&&(this.tileBounds=new qi(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(l){this._tileJSONRequest=null,this.fire(new a.k(l))}})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load(!0)}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}serialize(){return a.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return a._(this,void 0,void 0,function*(){const l=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const _=yield De.getImage(this.map._requestManager.transformRequest(l,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&n.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const y=this.map.painter.context,S=y.gl,M=_.data;n.texture=this.map.painter.getTileTexture(M.width),n.texture?n.texture.update(M,{useMipmap:!0}):(n.texture=new It(y,M,S.RGBA,{useMipmap:!0}),n.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(_){if(delete n.abortController,n.aborted)n.state="unloaded";else if(_)throw n.state="errored",_}})}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)})}hasTransition(){return!1}}class Pi extends zt{constructor(n,l,_,y){super(n,l,_,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(n){return a._(this,void 0,void 0,function*(){const l=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(l,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const y=yield De.getImage(_,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(y&&y.data){const S=y.data;this.map._refreshExpiredTiles&&(y.cacheControl||y.expires)&&n.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const M=a.b(S)&&a.V()?S:yield this.readImageNow(S),O={type:this.type,uid:n.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const N=yield n.actor.sendAsync({type:"LDT",data:O});n.dem=N,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(y){if(delete n.abortController,n.aborted)n.state="unloaded";else if(y)throw n.state="errored",y}})}readImageNow(n){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.W()){const l=n.width+2,_=n.height+2;try{return new a.R({width:l,height:_},yield a.X(n,-1,-1,l,_))}catch{}}return V.getImageData(n,1)})}_getNeighboringTiles(n){const l=n.canonical,_=Math.pow(2,l.z),y=(l.x-1+_)%_,S=l.x===0?n.wrap-1:n.wrap,M=(l.x+1+_)%_,O=l.x+1===_?n.wrap+1:n.wrap,N={};return N[new a.Y(n.overscaledZ,S,l.z,y,l.y).key]={backfilled:!1},N[new a.Y(n.overscaledZ,O,l.z,M,l.y).key]={backfilled:!1},l.y>0&&(N[new a.Y(n.overscaledZ,S,l.z,y,l.y-1).key]={backfilled:!1},N[new a.Y(n.overscaledZ,n.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},N[new a.Y(n.overscaledZ,O,l.z,M,l.y-1).key]={backfilled:!1}),l.y+1<_&&(N[new a.Y(n.overscaledZ,S,l.z,y,l.y+1).key]={backfilled:!1},N[new a.Y(n.overscaledZ,n.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},N[new a.Y(n.overscaledZ,O,l.z,M,l.y+1).key]={backfilled:!1}),N}unloadTile(n){return a._(this,void 0,void 0,function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))})}}class dr extends a.E{constructor(n,l,_,y){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(y),this._data=l.data,this._options=a.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId,l.clusterMaxZoom!==void 0&&this.maxzoom<=l.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${l.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(l.buffer!==void 0?l.buffer:128),tolerance:this._pixelsToTileUnits(l.tolerance!==void 0?l.tolerance:.375),extent:a.Z,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:a.Z,radius:this._pixelsToTileUnits(l.clusterRadius||50),log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(n){return n*(a.Z/this.tileSize)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData(),this}updateData(n){return this._updateWorkerData(n),this}getData(){return a._(this,void 0,void 0,function*(){const n=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})})}getCoordinatesFromGeometry(n){return n.type==="GeometryCollection"?n.geometries.map(l=>l.coordinates).flat(1/0):n.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const n=new ur,l=yield this.getData();let _;switch(l.type){case"FeatureCollection":_=l.features.map(y=>this.getCoordinatesFromGeometry(y.geometry)).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(l.geometry);break;default:_=this.getCoordinatesFromGeometry(l)}if(_.length==0)return n;for(let y=0;y<_.length-1;y+=2)n.extend([_[y],_[y+1]]);return n})}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(n.clusterRadius)),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=n.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,l,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:l,offset:_}})}_updateWorkerData(n){return a._(this,void 0,void 0,function*(){const l=a.e({type:this.type},this.workerOptions);n?l.dataDiff=n:typeof this._data=="string"?(l.request=this.map._requestManager.transformRequest(V.resolveURL(this._data),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.l("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:l});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));let y=null;_.resourceTiming&&_.resourceTiming[this.id]&&(y=_.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&a.e(S,{resourceTiming:y}),this.fire(new a.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(_))}})}loaded(){return this._pendingLoads===0}loadTile(n){return a._(this,void 0,void 0,function*(){const l=n.actor?"RT":"LT";n.actor=this.actor;const _={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};n.abortController=new AbortController;const y=yield this.actor.sendAsync({type:l,data:_},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(y,this.map.painter,l==="RT")})}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class tr extends a.E{constructor(n,l,_,y){super(),this.flippedWindingOrder=!1,this.id=n,this.dispatcher=_,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=l}load(n){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const l=yield De.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,l&&l.data&&(this.image=l.data,n&&(this.coordinates=n),this._finishLoading())}catch(l){this._request=null,this._loaded=!0,this.fire(new a.k(l))}})}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const l=n.map(a.$.fromLngLat);var _;return this.tileID=function(y){let S=1/0,M=1/0,O=-1/0,N=-1/0;for(const G of y)S=Math.min(S,G.x),M=Math.min(M,G.y),O=Math.max(O,G.x),N=Math.max(N,G.y);const j=Math.max(O-S,N-M),Z=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),Y=Math.pow(2,Z);return new a.a1(Z,Math.floor((S+O)/2*Y),Math.floor((M+N)/2*Y))}(l),this.terrainTileRanges=this._getOverlappingTileRanges(l),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=l.map(y=>this.tileID.getTilePoint(y)._round()),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,l=n.gl;this.texture||(this.texture=new It(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const S=this.tiles[y];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(n){let l=1/0,_=1/0,y=-1/0,S=-1/0;for(const O of n)l=Math.min(l,O.x),_=Math.min(_,O.y),y=Math.max(y,O.x),S=Math.max(S,O.y);const M={};for(let O=0;O<=a.a0;O++){const N=Math.pow(2,O),j=Math.floor(l*N),Z=Math.floor(_*N),Y=Math.floor(y*N),G=Math.floor(S*N);M[O]={minTileX:j,minTileY:Z,maxTileX:Y,maxTileY:G}}return M}}class or extends tr{constructor(n,l,_,y){super(n,l,_,y),this.roundZoom=!0,this.type="video",this.options=l}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const l of n.urls)this.urls.push(this.map._requestManager.transformRequest(l,"Source").url);try{const l=yield a.a2(this.urls);if(this._loaded=!0,!l)return;this.video=l,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(l){this.fire(new a.k(l))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const l=this.video.seekable;n<l.start(0)||n>l.end(0)?this.fire(new a.k(new a.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,l=n.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new It(n,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const S=this.tiles[y];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Tn extends tr{constructor(n,l,_,y){super(n,l,_,y),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(M=>typeof M!="number"))||this.fire(new a.k(new a.a3(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a3(`sources.${n}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new a.k(new a.a3(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a3(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a3(`sources.${n}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,_=l.gl;this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new It(l,this.canvas,_.RGBA,{premultiply:!0});let y=!1;for(const S in this.tiles){const M=this.tiles[S];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,y=!0)}y&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const rs={},Sn=T=>{switch(T){case"geojson":return dr;case"image":return tr;case"raster":return zt;case"raster-dem":return Pi;case"vector":return Vt;case"video":return or;case"canvas":return Tn}return rs[T]},js="RTLPluginLoaded";class ao extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Li()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch(l=>{throw this.status="error",l})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return a._(this,arguments,void 0,function*(l,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=V.resolveURL(l),!this.url)throw new Error(`requested url ${l} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(js))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Io=null;function Qs(){return Io||(Io=new ao),Io}class lo{constructor(n,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=a.a4(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const l=n+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,l,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(y,S){const M={};if(!S)return M;for(const O of y){const N=O.layerIds.map(j=>S.getLayer(j)).filter(Boolean);if(N.length!==0){O.layers=N,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map(j=>N.filter(Z=>Z.id===j)[0]));for(const j of N)M[j.id]=O}}return M}(n.buckets,l==null?void 0:l.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const S=this.buckets[y];if(S instanceof a.a6){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const S=this.buckets[y];if(S instanceof a.a6&&S.hasRTLText){this.hasRTLText=!0,Qs().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const S=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(y).queryRadius(S))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(n)}const l=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new It(n,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new It(n,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,l,_,y,S,M,O,N,j,Z,Y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:S,scale:M,tileSize:this.tileSize,pixelPosMatrix:Z,transform:N,params:O,queryPadding:this.queryPadding*j,getElevation:Y},n,l,_):{}}querySourceFeatures(n,l){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),S=l&&l.sourceLayer?l.sourceLayer:"",M=y._geojsonTileLayer||y[S];if(!M)return;const O=a.a7(l&&l.filter),{z:N,x:j,y:Z}=this.tileID.canonical,Y={z:N,x:j,y:Z};for(let G=0;G<M.length;G++){const re=M.feature(G);if(O.needGeometry){const ye=a.a8(re,!0);if(!O.filter(new a.C(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!O.filter(new a.C(this.tileID.overscaledZ),re))continue;const ne=_.getId(re,S),be=new a.a9(re,N,j,Z,ne);be.tile=Y,n.push(be)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const l=this.expirationTime;if(n.cacheControl){const _=a.aa(n.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(l)if(this.expirationTime<l)y=!0;else{const S=this.expirationTime-l;S?this.expirationTime=_+Math.max(S,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!l.style.hasLayer(y))continue;const S=this.buckets[y],M=S.layers[0].sourceLayer||"_geojsonTileLayer",O=_[M],N=n[M];if(!O||!N||Object.keys(N).length===0)continue;S.update(N,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const j=l&&l.style&&l.style.getLayer(y);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<V.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=V.now()+n}setDependencies(n,l){const _={};for(const y of l)_[y]=!0;this.dependencies[n]=_}hasDependency(n,l){for(const _ of n){const y=this.dependencies[_];if(y){for(const S of l)if(y[S])return!0}}return!1}}class Po{constructor(n,l){this.max=n,this.onRemove=l,this.reset()}reset(){for(const n in this.data)for(const l of this.data[n])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(n,l,_){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const S={value:l,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(n,S)},_)),this.data[y].push(S),this.order.push(y),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const l=this.data[n].shift();return l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),l.value}getByKey(n){const l=this.data[n];return l?l[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,l){if(!this.has(n))return this;const _=n.wrapped().key,y=l===void 0?0:this.data[_].indexOf(l),S=this.data[_][y];return this.data[_].splice(y,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(n){const l=[];for(const _ in this.data)for(const y of this.data[_])n(y.value)||l.push(y);for(const _ of l)this.remove(_.value.tileID,_)}}class Na{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,l,_){const y=String(l);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},a.e(this.stateChanges[n][y],_),this.deletedStates[n]===null){this.deletedStates[n]={};for(const S in this.state[n])S!==y&&(this.deletedStates[n][S]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const S in this.state[n][y])_[S]||(this.deletedStates[n][y][S]=null)}else for(const S in _)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][S]===null&&delete this.deletedStates[n][y][S]}removeFeatureState(n,l,_){if(this.deletedStates[n]===null)return;const y=String(l);if(this.deletedStates[n]=this.deletedStates[n]||{},_&&l!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][_]=null);else if(l!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(_ in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][_]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,l){const _=String(l),y=a.e({},(this.state[n]||{})[_],(this.stateChanges[n]||{})[_]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const S=this.deletedStates[n][l];if(S===null)return{};for(const M in S)delete y[M]}return y}initializeTileState(n,l){n.setFeatureState(this.state,l)}coalesceChanges(n,l){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const S={};for(const M in this.stateChanges[y])this.state[y][M]||(this.state[y][M]={}),a.e(this.state[y][M],this.stateChanges[y][M]),S[M]=this.state[y][M];_[y]=S}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const S={};if(this.deletedStates[y]===null)for(const M in this.state[y])S[M]={},this.state[y][M]={};else for(const M in this.deletedStates[y]){if(this.deletedStates[y][M]===null)this.state[y][M]={};else for(const O of Object.keys(this.deletedStates[y][M]))delete this.state[y][M][O];S[M]=this.state[y][M]}_[y]=_[y]||{},a.e(_[y],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in n)n[y].setFeatureState(_,l)}}const ks=89.25;function ns(T,n){const l=a.ae(n.lat,-85.051129,a.af);return new a.P(a.U(n.lng)*T,a.S(l)*T)}function Ks(T,n){return new a.$(n.x/T,n.y/T).toLngLat()}function rt(T){return T.cameraToCenterDistance*Math.min(.85*Math.tan(a.ab(90-T.pitch)),Math.tan(a.ab(ks-T.pitch)))}function ae(T,n){const l=T.canonical,_=n/a.ac(l.z),y=l.x+Math.pow(2,l.z)*T.wrap,S=a.ad(new Float64Array(16));return a.L(S,S,[y*_,l.y*_,0]),a.M(S,S,[_/a.Z,_/a.Z,1]),S}function le(T,n,l,_,y){const S=a.$.fromLngLat(T,n),M=y*a.ag(1,T.lat),O=M*Math.cos(a.ab(l)),N=Math.sqrt(M*M-O*O),j=N*Math.sin(a.ab(-_)),Z=N*Math.cos(a.ab(-_));return new a.$(S.x+j,S.y+Z,S.z+O)}function me(T,n,l){const _=n.intersectsFrustum(T);if(!l)return _;const y=n.intersectsPlane(l);return _===0||y===0?0:_===2&&y===2?2:1}function ue(T,n,l){let _=0;const y=(l-n)/10;for(let S=0;S<10;S++)_+=y*Math.pow(Math.cos(n+(S+.5)/10*(l-n)),T);return _}function $e(T,n){return function(l,_,y,S,M){const O=2*((T-1)/a.ah(Math.cos(a.ab(ks-M))/Math.cos(a.ab(ks)))-1),N=Math.acos(y/S),j=2*ue(O-1,0,a.ab(M/2)),Z=Math.min(a.ab(ks),N+a.ab(M/2)),Y=ue(O-1,Math.min(Z,N-a.ab(M/2)),Z),G=Math.atan(_/y),re=Math.hypot(_,y);let ne=l;return ne+=a.ah(S/re/Math.max(.5,Math.cos(a.ab(M/2)))),ne+=O*a.ah(Math.cos(G))/2,ne-=a.ah(Math.max(1,Y/j/n))/2,ne}}const ge=$e(9.314,3);function ut(T,n){const l=(n.roundZoom?Math.round:Math.floor)(T.zoom+a.ah(T.tileSize/n.tileSize));return Math.max(0,l)}function Ge(T,n){const l=T.getCameraFrustum(),_=T.getClippingPlane(),y=T.screenPointToMercatorCoordinate(T.getCameraPoint()),S=a.$.fromLngLat(T.center,T.elevation);y.z=S.z+Math.cos(T.pitchInRadians)*T.cameraToCenterDistance/T.worldSize;const M=T.getCoveringTilesDetailsProvider(),O=M.allowVariableZoom(T,n),N=ut(T,n),j=n.minzoom||0,Z=n.maxzoom!==void 0?n.maxzoom:T.maxZoom,Y=Math.min(Math.max(0,N),Z),G=Math.pow(2,Y),re=[G*y.x,G*y.y,0],ne=[G*S.x,G*S.y,0],be=Math.hypot(S.x-y.x,S.y-y.y),ye=Math.abs(S.z-y.z),ve=Math.hypot(be,ye),Re=ze=>({zoom:0,x:0,y:0,wrap:ze,fullyVisible:!1}),Le=[],Oe=[];if(T.renderWorldCopies&&M.allowWorldCopies())for(let ze=1;ze<=3;ze++)Le.push(Re(-ze)),Le.push(Re(ze));for(Le.push(Re(0));Le.length>0;){const ze=Le.pop(),Xe=ze.x,Ve=ze.y;let ct=ze.fullyVisible;const St={x:Xe,y:Ve,z:ze.zoom},yt=M.getTileAABB(St,ze.wrap,T.elevation,n);if(!ct){const Kt=me(l,yt,_);if(Kt===0)continue;ct=Kt===2}const bt=M.distanceToTile2d(y.x,y.y,St,yt);let xt=N;O&&(xt=(n.calculateTileZoom||ge)(T.zoom+a.ah(T.tileSize/n.tileSize),bt,ye,ve,T.fov)),xt=(n.roundZoom?Math.round:Math.floor)(xt),xt=Math.max(0,xt);const ti=Math.min(xt,Z);if(ze.wrap=M.getWrap(S,St,ze.wrap),ze.zoom>=ti){if(ze.zoom<j)continue;const Kt=Y-ze.zoom,Ot=re[0]-.5-(Xe<<Kt),di=re[1]-.5-(Ve<<Kt),er=n.reparseOverscaled?Math.max(ze.zoom,xt):ze.zoom;Oe.push({tileID:new a.Y(ze.zoom===Z?er:ze.zoom,ze.wrap,ze.zoom,Xe,Ve),distanceSq:a.ai([ne[0]-.5-Xe,ne[1]-.5-Ve]),tileDistanceToCamera:Math.sqrt(Ot*Ot+di*di)})}else for(let Kt=0;Kt<4;Kt++)Le.push({zoom:ze.zoom+1,x:(Xe<<1)+Kt%2,y:(Ve<<1)+(Kt>>1),wrap:ze.wrap,fullyVisible:ct})}return Oe.sort((ze,Xe)=>ze.distanceSq-Xe.distanceSq).map(ze=>ze.tileID)}class ot extends a.E{constructor(n,l,_){super(),this.id=n,this.dispatcher=_,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,S,M,O)=>{const N=new(Sn(S.type))(y,S,M,O);if(N.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${N.id}`);return N})(n,l,_,this),this._tiles={},this._cache=new Po(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Na,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const l=this._tiles[n];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,l,_){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,l,_)}catch(y){n.state="errored",y.status!==404?this._source.fire(new a.k(y,{tile:n})):this.update(this.transform,this.terrain)}})}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new a.l("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const _=this._tiles[l];_.upload(n),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(pt).map(n=>n.key)}getRenderableIds(n){const l=[];for(const _ in this._tiles)this._isIdRenderable(_,n)&&l.push(this._tiles[_]);return n?l.sort((_,y)=>{const S=_.tileID,M=y.tileID,O=new a.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),N=new a.P(M.canonical.x,M.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-M.overscaledZ||N.y-O.y||N.x-O.x}).map(_=>_.tileID.key):l.map(_=>_.tileID).sort(pt).map(_=>_.key)}hasRenderableParent(n){const l=this.findLoadedParent(n,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(n,l){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(l||!this._tiles[n].holdingForFade())}reload(n){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)(n||this._tiles[l].state!=="errored")&&this._reloadTile(l,"reloading")}}_reloadTile(n,l){return a._(this,void 0,void 0,function*(){const _=this._tiles[n];_&&(_.state!=="loading"&&(_.state=l),yield this._loadTile(_,n,l))})}_tileLoaded(n,l,_){n.timeAdded=V.now(),_==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(l,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const l=this.getRenderableIds();for(let y=0;y<l.length;y++){const S=l[y];if(n.neighboringTiles&&n.neighboringTiles[S]){const M=this.getTileByID(S);_(n,M),_(M,n)}}function _(y,S){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let M=S.tileID.canonical.x-y.tileID.canonical.x;const O=S.tileID.canonical.y-y.tileID.canonical.y,N=Math.pow(2,y.tileID.canonical.z),j=S.tileID.key;M===0&&O===0||Math.abs(O)>1||(Math.abs(M)>1&&(Math.abs(M+N)===1?M+=N:Math.abs(M-N)===1&&(M-=N)),S.dem&&y.dem&&(y.dem.backfillBorder(S.dem,M,O),y.neighboringTiles&&y.neighboringTiles[j]&&(y.neighboringTiles[j].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,l,_,y){for(const S in this._tiles){let M=this._tiles[S];if(y[S]||!M.hasData()||M.tileID.overscaledZ<=l||M.tileID.overscaledZ>_)continue;let O=M.tileID;for(;M&&M.tileID.overscaledZ>l+1;){const j=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[j.key],M&&M.hasData()&&(O=j)}let N=O;for(;N.overscaledZ>l;)if(N=N.scaledTo(N.overscaledZ-1),n[N.key]||n[N.canonical.key]){y[O.key]=O;break}}}findLoadedParent(n,l){if(n.key in this._loadedParentTiles){const _=this._loadedParentTiles[n.key];return _&&_.tileID.overscaledZ>=l?_:null}for(let _=n.overscaledZ-1;_>=l;_--){const y=n.scaledTo(_),S=this._getLoadedTile(y);if(S)return S}}findLoadedSibling(n){return this._getLoadedTile(n)}_getLoadedTile(n){const l=this._tiles[n.key];return l&&l.hasData()?l:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const l=Math.ceil(n.width/this._source.tileSize)+1,_=Math.ceil(n.height/this._source.tileSize)+1,y=Math.floor(l*_*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(S)}handleWrapJump(n){const l=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,l){const _={};for(const y in this._tiles){const S=this._tiles[y];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),_[S.tileID.key]=S}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(n,l,_,y,S,M){const O={},N={},j=Object.keys(n),Z=V.now();for(const Y of j){const G=n[Y],re=this._tiles[Y];if(!re||re.fadeEndTime!==0&&re.fadeEndTime<=Z)continue;const ne=this.findLoadedParent(G,l),be=this.findLoadedSibling(G),ye=ne||be||null;ye&&(this._addTile(ye.tileID),O[ye.tileID.key]=ye.tileID),N[Y]=G}this._retainLoadedChildren(N,y,_,n);for(const Y in O)n[Y]||(this._coveredTiles[Y]=!0,n[Y]=O[Y]);if(M){const Y={},G={};for(const re of S)this._tiles[re.key].hasData()?Y[re.key]=re:G[re.key]=re;for(const re in G){const ne=G[re].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(Y[ne[0].key]=n[ne[0].key]=ne[0],Y[ne[1].key]=n[ne[1].key]=ne[1],Y[ne[2].key]=n[ne[2].key]=ne[2],Y[ne[3].key]=n[ne[3].key]=ne[3],delete G[re])}for(const re in G){const ne=G[re],be=this.findLoadedParent(ne,this._source.minzoom),ye=this.findLoadedSibling(ne),ve=be||ye||null;if(ve){Y[ve.tileID.key]=n[ve.tileID.key]=ve.tileID;for(const Re in Y)Y[Re].isChildOf(ve.tileID)&&delete Y[Re]}}for(const re in this._tiles)Y[re]||(this._coveredTiles[re]=!0)}}update(n,l){if(!this._sourceLoaded||this._paused)return;let _;this.transform=n,this.terrain=l,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new a.Y(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y)):(_=Ge(n,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter(Z=>this._source.hasTile(Z)))):_=[];const y=ut(n,this._source),S=Math.max(y-ot.maxOverzooming,this._source.minzoom),M=Math.max(y+ot.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Z={};for(const Y of _)if(Y.canonical.z>this._source.minzoom){const G=Y.scaledTo(Y.canonical.z-1);Z[G.key]=G;const re=Y.scaledTo(Math.max(this._source.minzoom,Math.min(Y.canonical.z,5)));Z[re.key]=re}_=_.concat(Object.values(Z))}const O=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,O&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(_,y);nt(this._source.type)&&this._updateCoveredAndRetainedTiles(N,S,M,y,_,l);for(const Z in N)this._tiles[Z].clearFadeHold();const j=a.aj(this._tiles,N);for(const Z of j){const Y=this._tiles[Z];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(Z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,l){var _;const y={},S={},M=Math.max(l-ot.maxOverzooming,this._source.minzoom),O=Math.max(l+ot.maxUnderzooming,this._source.minzoom),N={};for(const j of n){const Z=this._addTile(j);y[j.key]=j,Z.hasData()||l<this._source.maxzoom&&(N[j.key]=j)}this._retainLoadedChildren(N,l,O,y);for(const j of n){let Z=this._tiles[j.key];if(Z.hasData())continue;if(l+1>this._source.maxzoom){const G=j.children(this._source.maxzoom)[0],re=this.getTile(G);if(re&&re.hasData()){y[G.key]=G;continue}}else{const G=j.children(this._source.maxzoom);if(y[G[0].key]&&y[G[1].key]&&y[G[2].key]&&y[G[3].key])continue}let Y=Z.wasRequested();for(let G=j.overscaledZ-1;G>=M;--G){const re=j.scaledTo(G);if(S[re.key])break;if(S[re.key]=!0,Z=this.getTile(re),!Z&&Y&&(Z=this._addTile(re)),Z){const ne=Z.hasData();if((ne||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||Y)&&(y[re.key]=re),Y=Z.wasRequested(),ne)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const l=[];let _,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}l.push(y.key);const S=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;y=S}for(const S of l)this._loadedParentTiles[S]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const n in this._tiles){const l=this._tiles[n].tileID,_=this._getLoadedTile(l);this._loadedSiblingTiles[l.key]=_}}_addTile(n){let l=this._tiles[n.key];if(l)return l;l=this._cache.getAndRemove(n),l&&(this._setTileReloadTimer(n.key,l),l.tileID=n,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,l)));const _=l;return l||(l=new lo(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(l,n.key,l.state)),l.uses++,this._tiles[n.key]=l,_||this._source.fire(new a.l("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(n,l){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const _=l.getExpiryTimeout();_&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},_))}refreshTiles(n){for(const l in this._tiles)this._isIdRenderable(l)&&n.some(_=>_.equals(this._tiles[l].tileID.canonical))&&this._reloadTile(l,"expired")}_removeTile(n){const l=this._tiles[n];l&&(l.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}_dataHandler(n){const l=n.sourceDataType;n.dataType==="source"&&l==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&l==="content"&&(this.reload(n.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,l,_){const y=[],S=this.transform;if(!S)return y;const M=_?S.getCameraQueryGeometry(n):n,O=n.map(ne=>S.screenPointToMercatorCoordinate(ne,this.terrain)),N=M.map(ne=>S.screenPointToMercatorCoordinate(ne,this.terrain)),j=this.getIds();let Z=1/0,Y=1/0,G=-1/0,re=-1/0;for(const ne of N)Z=Math.min(Z,ne.x),Y=Math.min(Y,ne.y),G=Math.max(G,ne.x),re=Math.max(re,ne.y);for(let ne=0;ne<j.length;ne++){const be=this._tiles[j[ne]];if(be.holdingForFade())continue;const ye=S.getCoveringTilesDetailsProvider().allowWorldCopies()?be.tileID:be.tileID.unwrapTo(0),ve=Math.pow(2,S.zoom-be.tileID.overscaledZ),Re=l*be.queryPadding*a.Z/be.tileSize/ve,Le=[ye.getTilePoint(new a.$(Z,Y)),ye.getTilePoint(new a.$(G,re))];if(Le[0].x-Re<a.Z&&Le[0].y-Re<a.Z&&Le[1].x+Re>=0&&Le[1].y+Re>=0){const Oe=O.map(Xe=>ye.getTilePoint(Xe)),ze=N.map(Xe=>ye.getTilePoint(Xe));y.push({tile:be,tileID:ye,queryGeometry:Oe,cameraQueryGeometry:ze,scale:ve})}}return y}getVisibleCoordinates(n){const l=this.getRenderableIds(n).map(_=>this._tiles[_].tileID);return this.transform&&this.transform.populateCache(l),l}hasTransition(){if(this._source.hasTransition())return!0;if(nt(this._source.type)){const n=V.now();for(const l in this._tiles)if(this._tiles[l].fadeEndTime>=n)return!0}return!1}setFeatureState(n,l,_){this._state.updateState(n=n||"_geojsonTileLayer",l,_)}removeFeatureState(n,l,_){this._state.removeFeatureState(n=n||"_geojsonTileLayer",l,_)}getFeatureState(n,l){return this._state.getState(n=n||"_geojsonTileLayer",l)}setDependencies(n,l,_){const y=this._tiles[n];y&&y.setDependencies(l,_)}reloadTilesForDependencies(n,l){for(const _ in this._tiles)this._tiles[_].hasDependency(n,l)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(n,l))}}function pt(T,n){const l=Math.abs(2*T.wrap)-+(T.wrap<0),_=Math.abs(2*n.wrap)-+(n.wrap<0);return T.overscaledZ-n.overscaledZ||_-l||n.canonical.y-T.canonical.y||n.canonical.x-T.canonical.x}function nt(T){return T==="raster"||T==="image"||T==="video"}ot.maxOverzooming=10,ot.maxUnderzooming=3;class Rt{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.ae(n,0,1);let l=1,_=this._distances[l];const y=n*this.paddedLength+this.padding;for(;_<y&&l<this._distances.length;)_=this._distances[++l];const S=l-1,M=this._distances[S],O=_-M,N=O>0?(y-M)/O:0;return this.points[S].mult(1-N).add(this.points[l].mult(N))}}function Qt(T,n){let l=!0;return T==="always"||T!=="never"&&n!=="never"||(l=!1),l}class ii{constructor(n,l,_){const y=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(l/_);for(let M=0;M<this.xCellCount*this.yCellCount;M++)y.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,_,y,S){this._forEachCell(l,_,y,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(S)}insertCircle(n,l,_,y){this._forEachCell(l-y,_-y,l+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(_),this.circles.push(y)}_insertBoxCell(n,l,_,y,S,M){this.boxCells[S].push(M)}_insertCircleCell(n,l,_,y,S,M){this.circleCells[S].push(M)}_query(n,l,_,y,S,M,O){if(_<0||n>this.width||y<0||l>this.height)return[];const N=[];if(n<=0&&l<=0&&this.width<=_&&this.height<=y){if(S)return[{key:null,x1:n,y1:l,x2:_,y2:y}];for(let j=0;j<this.boxKeys.length;j++)N.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const Z=this.circles[3*j],Y=this.circles[3*j+1],G=this.circles[3*j+2];N.push({key:this.circleKeys[j],x1:Z-G,y1:Y-G,x2:Z+G,y2:Y+G})}}else this._forEachCell(n,l,_,y,this._queryCell,N,{hitTest:S,overlapMode:M,seenUids:{box:{},circle:{}}},O);return N}query(n,l,_,y){return this._query(n,l,_,y,!1,null)}hitTest(n,l,_,y,S,M){return this._query(n,l,_,y,!0,S,M).length>0}hitTestCircle(n,l,_,y,S){const M=n-_,O=n+_,N=l-_,j=l+_;if(O<0||M>this.width||j<0||N>this.height)return!1;const Z=[];return this._forEachCell(M,N,O,j,this._queryCellCircle,Z,{hitTest:!0,overlapMode:y,circle:{x:n,y:l,radius:_},seenUids:{box:{},circle:{}}},S),Z.length>0}_queryCell(n,l,_,y,S,M,O,N){const{seenUids:j,hitTest:Z,overlapMode:Y}=O,G=this.boxCells[S];if(G!==null){const ne=this.bboxes;for(const be of G)if(!j.box[be]){j.box[be]=!0;const ye=4*be,ve=this.boxKeys[be];if(n<=ne[ye+2]&&l<=ne[ye+3]&&_>=ne[ye+0]&&y>=ne[ye+1]&&(!N||N(ve))&&(!Z||!Qt(Y,ve.overlapMode))&&(M.push({key:ve,x1:ne[ye],y1:ne[ye+1],x2:ne[ye+2],y2:ne[ye+3]}),Z))return!0}}const re=this.circleCells[S];if(re!==null){const ne=this.circles;for(const be of re)if(!j.circle[be]){j.circle[be]=!0;const ye=3*be,ve=this.circleKeys[be];if(this._circleAndRectCollide(ne[ye],ne[ye+1],ne[ye+2],n,l,_,y)&&(!N||N(ve))&&(!Z||!Qt(Y,ve.overlapMode))){const Re=ne[ye],Le=ne[ye+1],Oe=ne[ye+2];if(M.push({key:ve,x1:Re-Oe,y1:Le-Oe,x2:Re+Oe,y2:Le+Oe}),Z)return!0}}}return!1}_queryCellCircle(n,l,_,y,S,M,O,N){const{circle:j,seenUids:Z,overlapMode:Y}=O,G=this.boxCells[S];if(G!==null){const ne=this.bboxes;for(const be of G)if(!Z.box[be]){Z.box[be]=!0;const ye=4*be,ve=this.boxKeys[be];if(this._circleAndRectCollide(j.x,j.y,j.radius,ne[ye+0],ne[ye+1],ne[ye+2],ne[ye+3])&&(!N||N(ve))&&!Qt(Y,ve.overlapMode))return M.push(!0),!0}}const re=this.circleCells[S];if(re!==null){const ne=this.circles;for(const be of re)if(!Z.circle[be]){Z.circle[be]=!0;const ye=3*be,ve=this.circleKeys[be];if(this._circlesCollide(ne[ye],ne[ye+1],ne[ye+2],j.x,j.y,j.radius)&&(!N||N(ve))&&!Qt(Y,ve.overlapMode))return M.push(!0),!0}}}_forEachCell(n,l,_,y,S,M,O,N){const j=this._convertToXCellCoord(n),Z=this._convertToYCellCoord(l),Y=this._convertToXCellCoord(_),G=this._convertToYCellCoord(y);for(let re=j;re<=Y;re++)for(let ne=Z;ne<=G;ne++)if(S.call(this,n,l,_,y,this.xCellCount*ne+re,M,O,N))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,_,y,S,M){const O=y-n,N=S-l,j=_+M;return j*j>O*O+N*N}_circleAndRectCollide(n,l,_,y,S,M,O){const N=(M-y)/2,j=Math.abs(n-(y+N));if(j>N+_)return!1;const Z=(O-S)/2,Y=Math.abs(l-(S+Z));if(Y>Z+_)return!1;if(j<=N||Y<=Z)return!0;const G=j-N,re=Y-Z;return G*G+re*re<=_*_}}function gi(T,n,l){const _=a.K();if(!T){const{vecSouth:Y,vecEast:G}=ht(n),re=P();re[0]=G[0],re[1]=G[1],re[2]=Y[0],re[3]=Y[1],y=re,(Z=(M=(S=re)[0])*(j=S[3])-(N=S[2])*(O=S[1]))&&(y[0]=j*(Z=1/Z),y[1]=-O*Z,y[2]=-N*Z,y[3]=M*Z),_[0]=re[0],_[1]=re[1],_[4]=re[2],_[5]=re[3]}var y,S,M,O,N,j,Z;return a.M(_,_,[1/l,1/l,1]),_}function Qe(T,n,l,_){if(T){const y=a.K();if(!n){const{vecSouth:S,vecEast:M}=ht(l);y[0]=M[0],y[1]=M[1],y[4]=S[0],y[5]=S[1]}return a.M(y,y,[_,_,1]),y}return l.pixelsToClipSpaceMatrix}function ht(T){const n=Math.cos(T.rollInRadians),l=Math.sin(T.rollInRadians),_=Math.cos(T.pitchInRadians),y=Math.cos(T.bearingInRadians),S=Math.sin(T.bearingInRadians),M=a.ao();M[0]=-y*_*l-S*n,M[1]=-S*_*l+y*n;const O=a.ap(M);O<1e-9?a.aq(M):a.ar(M,M,1/O);const N=a.ao();N[0]=y*_*n-S*l,N[1]=S*_*n+y*l;const j=a.ap(N);return j<1e-9?a.aq(N):a.ar(N,N,1/j),{vecEast:N,vecSouth:M}}function We(T,n,l,_){let y;_?(y=[T,n,_(T,n),1],a.at(y,y,l)):(y=[T,n,0,1],Ds(y,y,l));const S=y[3];return{point:new a.P(y[0]/S,y[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function Tt(T,n){return .5+T/n*.5}function A(T,n){return T.x>=-n[0]&&T.x<=n[0]&&T.y>=-n[1]&&T.y<=n[1]}function ie(T,n,l,_,y,S,M,O,N,j,Z,Y,G){const re=l?T.textSizeData:T.iconSizeData,ne=a.ak(re,n.transform.zoom),be=[256/n.width*2+1,256/n.height*2+1],ye=l?T.text.dynamicLayoutVertexArray:T.icon.dynamicLayoutVertexArray;ye.clear();const ve=T.lineVertexArray,Re=l?T.text.placedSymbolArray:T.icon.placedSymbolArray,Le=n.transform.width/n.transform.height;let Oe=!1;for(let ze=0;ze<Re.length;ze++){const Xe=Re.get(ze);if(Xe.hidden||Xe.writingMode===a.al.vertical&&!Oe){nn(Xe.numGlyphs,ye);continue}Oe=!1;const Ve=new a.P(Xe.anchorX,Xe.anchorY),ct={getElevation:G,pitchedLabelPlaneMatrix:_,lineVertexArray:ve,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:Ve,unwrappedTileID:N,width:j,height:Z,translation:Y},St=si(Xe.anchorX,Xe.anchorY,ct);if(!A(St.point,be)){nn(Xe.numGlyphs,ye);continue}const yt=Tt(n.transform.cameraToCenterDistance,St.signedDistanceFromCamera),bt=a.am(re,ne,Xe),xt=S?bt*n.transform.getPitchedTextCorrection(Xe.anchorX,Xe.anchorY,N)/yt:bt*yt,ti=ui({projectionContext:ct,pitchedLabelPlaneMatrixInverse:y,symbol:Xe,fontSize:xt,flip:!1,keepUpright:M,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:ye,aspectRatio:Le,rotateToLine:O});Oe=ti.useVertical,(ti.notEnoughRoom||Oe||ti.needsFlipping&&ui({projectionContext:ct,pitchedLabelPlaneMatrixInverse:y,symbol:Xe,fontSize:xt,flip:!0,keepUpright:M,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:ye,aspectRatio:Le,rotateToLine:O}).notEnoughRoom)&&nn(Xe.numGlyphs,ye)}l?T.text.dynamicLayoutVertexBuffer.updateData(ye):T.icon.dynamicLayoutVertexBuffer.updateData(ye)}function ri(T,n,l,_,y,S,M,O){const N=S.glyphStartIndex+S.numGlyphs,j=S.lineStartIndex,Z=S.lineStartIndex+S.lineLength,Y=n.getoffsetX(S.glyphStartIndex),G=n.getoffsetX(N-1),re=Ko(T*Y,l,_,y,S.segment,j,Z,O,M);if(!re)return null;const ne=Ko(T*G,l,_,y,S.segment,j,Z,O,M);return ne?O.projectionCache.anyProjectionOccluded?null:{first:re,last:ne}:null}function _t(T,n,l,_){return T===a.al.horizontal&&Math.abs(l.y-n.y)>Math.abs(l.x-n.x)*_?{useVertical:!0}:(T===a.al.vertical?n.y<l.y:n.x>l.x)?{needsFlipping:!0}:null}function ui(T){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:l,symbol:_,fontSize:y,flip:S,keepUpright:M,glyphOffsetArray:O,dynamicLayoutVertexArray:N,aspectRatio:j,rotateToLine:Z}=T,Y=y/24,G=_.lineOffsetX*Y,re=_.lineOffsetY*Y;let ne;if(_.numGlyphs>1){const be=_.glyphStartIndex+_.numGlyphs,ye=_.lineStartIndex,ve=_.lineStartIndex+_.lineLength,Re=ri(Y,O,G,re,S,_,Z,n);if(!Re)return{notEnoughRoom:!0};const Le=Xi(Re.first.point.x,Re.first.point.y,n,l),Oe=Xi(Re.last.point.x,Re.last.point.y,n,l);if(M&&!S){const ze=_t(_.writingMode,Le,Oe,j);if(ze)return ze}ne=[Re.first];for(let ze=_.glyphStartIndex+1;ze<be-1;ze++)ne.push(Ko(Y*O.getoffsetX(ze),G,re,S,_.segment,ye,ve,n,Z));ne.push(Re.last)}else{if(M&&!S){const ye=Tr(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,ve=_.lineStartIndex+_.segment+1,Re=new a.P(n.lineVertexArray.getx(ve),n.lineVertexArray.gety(ve)),Le=Tr(Re.x,Re.y,n),Oe=Le.signedDistanceFromCamera>0?Le.point:ni(n.tileAnchorPoint,Re,ye,1,n),ze=Xi(ye.x,ye.y,n,l),Xe=Xi(Oe.x,Oe.y,n,l),Ve=_t(_.writingMode,ze,Xe,j);if(Ve)return Ve}const be=Ko(Y*O.getoffsetX(_.glyphStartIndex),G,re,S,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,n,Z);if(!be||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ne=[be]}for(const be of ne)a.as(N,be.point,be.angle);return{}}function ni(T,n,l,_,y){const S=T.add(T.sub(n)._unit()),M=Tr(S.x,S.y,y).point,O=l.sub(M);return l.add(O._mult(_/O.mag()))}function Ei(T,n,l){const _=n.projectionCache;if(_.projections[T])return _.projections[T];const y=new a.P(n.lineVertexArray.getx(T),n.lineVertexArray.gety(T)),S=Tr(y.x,y.y,n);if(S.signedDistanceFromCamera>0)return _.projections[T]=S.point,_.anyProjectionOccluded=_.anyProjectionOccluded||S.isOccluded,S.point;const M=T-l.direction;return ni(l.distanceFromAnchor===0?n.tileAnchorPoint:new a.P(n.lineVertexArray.getx(M),n.lineVertexArray.gety(M)),y,l.previousVertex,l.absOffsetX-l.distanceFromAnchor+1,n)}function Tr(T,n,l){const _=T+l.translation[0],y=n+l.translation[1];let S;return l.pitchWithMap?(S=We(_,y,l.pitchedLabelPlaneMatrix,l.getElevation),S.isOccluded=!1):(S=l.transform.projectTileCoordinates(_,y,l.unwrappedTileID,l.getElevation),S.point.x=(.5*S.point.x+.5)*l.width,S.point.y=(.5*-S.point.y+.5)*l.height),S}function Xi(T,n,l,_){if(l.pitchWithMap){const y=[T,n,0,1];return a.at(y,y,_),l.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],l.unwrappedTileID,l.getElevation).point}return{x:T/l.width*2-1,y:n/l.height*2-1}}function si(T,n,l){return l.transform.projectTileCoordinates(T,n,l.unwrappedTileID,l.getElevation)}function En(T,n,l){return T._unit()._perp()._mult(n*l)}function Mo(T,n,l,_,y,S,M,O,N){if(O.projectionCache.offsets[T])return O.projectionCache.offsets[T];const j=l.add(n);if(T+N.direction<_||T+N.direction>=y)return O.projectionCache.offsets[T]=j,j;const Z=Ei(T+N.direction,O,N),Y=En(Z.sub(l),M,N.direction),G=l.add(Y),re=Z.add(Y);return O.projectionCache.offsets[T]=a.au(S,j,G,re)||j,O.projectionCache.offsets[T]}function Ko(T,n,l,_,y,S,M,O,N){const j=_?T-n:T+n;let Z=j>0?1:-1,Y=0;_&&(Z*=-1,Y=Math.PI),Z<0&&(Y+=Math.PI);let G,re=Z>0?S+y:S+y+1;O.projectionCache.cachedAnchorPoint?G=O.projectionCache.cachedAnchorPoint:(G=Tr(O.tileAnchorPoint.x,O.tileAnchorPoint.y,O).point,O.projectionCache.cachedAnchorPoint=G);let ne,be,ye=G,ve=G,Re=0,Le=0;const Oe=Math.abs(j),ze=[];let Xe;for(;Re+Le<=Oe;){if(re+=Z,re<S||re>=M)return null;Re+=Le,ve=ye,be=ne;const St={absOffsetX:Oe,direction:Z,distanceFromAnchor:Re,previousVertex:ve};if(ye=Ei(re,O,St),l===0)ze.push(ve),Xe=ye.sub(ve);else{let yt;const bt=ye.sub(ve);yt=bt.mag()===0?En(Ei(re+Z,O,St).sub(ye),l,Z):En(bt,l,Z),be||(be=ve.add(yt)),ne=Mo(re,yt,ye,S,M,be,l,O,St),ze.push(be),Xe=ne.sub(be)}Le=Xe.mag()}const Ve=Xe._mult((Oe-Re)/Le)._add(be||ve),ct=Y+Math.atan2(ye.y-ve.y,ye.x-ve.x);return ze.push(Ve),{point:Ve,angle:N?ct:0,path:ze}}const Jo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nn(T,n){for(let l=0;l<T;l++){const _=n.length;n.resize(_+4),n.float32.set(Jo,3*_)}}function Ds(T,n,l){const _=n[0],y=n[1];return T[0]=l[0]*_+l[4]*y+l[12],T[1]=l[1]*_+l[5]*y+l[13],T[3]=l[3]*_+l[7]*y+l[15],T}const Sr=100;class Hn{constructor(n,l=new ii(n.width+200,n.height+200,25),_=new ii(n.width+200,n.height+200,25)){this.transform=n,this.grid=l,this.ignoredGrid=_,this.pitchFactor=Math.cos(n.pitch*Math.PI/180)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Sr,this.screenBottomBoundary=n.height+Sr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,l,_,y,S,M,O,N,j,Z,Y,G){const re=this.projectAndGetPerspectiveRatio(n.anchorPointX+N[0],n.anchorPointY+N[1],S,Z,G),ne=_*re.perspectiveRatio;let be;if(M||O)be=this._projectCollisionBox(n,ne,y,S,M,O,N,re,Z,Y,G);else{const Xe=re.x+(Y?Y.x*ne:0),Ve=re.y+(Y?Y.y*ne:0);be={allPointsOccluded:!1,box:[Xe+n.x1*ne,Ve+n.y1*ne,Xe+n.x2*ne,Ve+n.y2*ne]}}const[ye,ve,Re,Le]=be.box,Oe=M?be.allPointsOccluded:re.isOccluded;let ze=Oe;return ze||(ze=re.perspectiveRatio<this.perspectiveRatioCutoff),ze||(ze=!this.isInsideGrid(ye,ve,Re,Le)),ze||l!=="always"&&this.grid.hitTest(ye,ve,Re,Le,l,j)?{box:[ye,ve,Re,Le],placeable:!1,offscreen:!1,occluded:Oe}:{box:[ye,ve,Re,Le],placeable:!0,offscreen:this.isOffscreen(ye,ve,Re,Le),occluded:Oe}}placeCollisionCircles(n,l,_,y,S,M,O,N,j,Z,Y,G,re,ne){const be=[],ye=new a.P(l.anchorX,l.anchorY),ve=this.getPerspectiveRatio(ye.x,ye.y,M,ne),Re=(j?S*this.transform.getPitchedTextCorrection(l.anchorX,l.anchorY,M)/ve:S*ve)/a.ay,Le={getElevation:ne,pitchedLabelPlaneMatrix:O,lineVertexArray:_,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ye,unwrappedTileID:M,width:this.transform.width,height:this.transform.height,translation:re},Oe=ri(Re,y,l.lineOffsetX*Re,l.lineOffsetY*Re,!1,l,!1,Le);let ze=!1,Xe=!1,Ve=!0;if(Oe){const ct=.5*Y*ve+G,St=new a.P(-100,-100),yt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new Rt,xt=Oe.first,ti=Oe.last;let Kt=[];for(let er=xt.path.length-1;er>=1;er--)Kt.push(xt.path[er]);for(let er=1;er<ti.path.length;er++)Kt.push(ti.path[er]);const Ot=2.5*ct;if(j){const er=this.projectPathToScreenSpace(Kt,Le);Kt=er.some(cr=>cr.signedDistanceFromCamera<=0)?[]:er.map(cr=>cr.point)}let di=[];if(Kt.length>0){const er=Kt[0].clone(),cr=Kt[0].clone();for(let Gr=1;Gr<Kt.length;Gr++)er.x=Math.min(er.x,Kt[Gr].x),er.y=Math.min(er.y,Kt[Gr].y),cr.x=Math.max(cr.x,Kt[Gr].x),cr.y=Math.max(cr.y,Kt[Gr].y);di=er.x>=St.x&&cr.x<=yt.x&&er.y>=St.y&&cr.y<=yt.y?[Kt]:cr.x<St.x||er.x>yt.x||cr.y<St.y||er.y>yt.y?[]:a.av([Kt],St.x,St.y,yt.x,yt.y)}for(const er of di){bt.reset(er,.25*ct);let cr=0;cr=bt.length<=.5*ct?1:Math.ceil(bt.paddedLength/Ot)+1;for(let Gr=0;Gr<cr;Gr++){const kr=Gr/Math.max(cr-1,1),Yr=bt.lerp(kr),Qr=Yr.x+Sr,Or=Yr.y+Sr;be.push(Qr,Or,ct,0);const yr=Qr-ct,In=Or-ct,Bn=Qr+ct,Qn=Or+ct;if(Ve=Ve&&this.isOffscreen(yr,In,Bn,Qn),Xe=Xe||this.isInsideGrid(yr,In,Bn,Qn),n!=="always"&&this.grid.hitTestCircle(Qr,Or,ct,n,Z)&&(ze=!0,!N))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!N&&ze||!Xe||ve<this.perspectiveRatioCutoff?[]:be,offscreen:Ve,collisionDetected:ze}}projectPathToScreenSpace(n,l){const _=function(y,S){const M=a.K();return a.an(M,S.pitchedLabelPlaneMatrix),y.map(O=>{const N=We(O.x,O.y,M,S.getElevation),j=S.transform.projectTileCoordinates(N.point.x,N.point.y,S.unwrappedTileID,S.getElevation);return j.point.x=(.5*j.point.x+.5)*S.width,j.point.y=(.5*-j.point.y+.5)*S.height,j})}(n,l);return function(y){let S=0,M=0,O=0,N=0;for(let j=0;j<y.length;j++)y[j].isOccluded?(O=j+1,N=0):(N++,N>M&&(M=N,S=O));return y.slice(S,S+M)}(_)}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let _=1/0,y=1/0,S=-1/0,M=-1/0;for(const Z of n){const Y=new a.P(Z.x+Sr,Z.y+Sr);_=Math.min(_,Y.x),y=Math.min(y,Y.y),S=Math.max(S,Y.x),M=Math.max(M,Y.y),l.push(Y)}const O=this.grid.query(_,y,S,M).concat(this.ignoredGrid.query(_,y,S,M)),N={},j={};for(const Z of O){const Y=Z.key;if(N[Y.bucketInstanceId]===void 0&&(N[Y.bucketInstanceId]={}),N[Y.bucketInstanceId][Y.featureIndex])continue;const G=[new a.P(Z.x1,Z.y1),new a.P(Z.x2,Z.y1),new a.P(Z.x2,Z.y2),new a.P(Z.x1,Z.y2)];a.aw(l,G)&&(N[Y.bucketInstanceId][Y.featureIndex]=!0,j[Y.bucketInstanceId]===void 0&&(j[Y.bucketInstanceId]=[]),j[Y.bucketInstanceId].push(Y.featureIndex))}return j}insertCollisionBox(n,l,_,y,S,M){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:S,collisionGroupID:M,overlapMode:l},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,_,y,S,M){const O=_?this.ignoredGrid:this.grid,N={bucketInstanceId:y,featureIndex:S,collisionGroupID:M,overlapMode:l};for(let j=0;j<n.length;j+=4)O.insertCircle(N,n[j],n[j+1],n[j+2])}projectAndGetPerspectiveRatio(n,l,_,y,S){if(S){let M;y?(M=[n,l,y(n,l),1],a.at(M,M,S)):(M=[n,l,0,1],Ds(M,M,S));const O=M[3];return{x:(M[0]/O+1)/2*this.transform.width+Sr,y:(-M[1]/O+1)/2*this.transform.height+Sr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O*.5,isOccluded:!1,signedDistanceFromCamera:O}}{const M=this.transform.projectTileCoordinates(n,l,_,y);return{x:(M.point.x+1)/2*this.transform.width+Sr,y:(1-M.point.y)/2*this.transform.height+Sr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M.signedDistanceFromCamera*.5,isOccluded:M.isOccluded,signedDistanceFromCamera:M.signedDistanceFromCamera}}}getPerspectiveRatio(n,l,_,y){const S=this.transform.projectTileCoordinates(n,l,_,y);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(n,l,_,y){return _<Sr||n>=this.screenRightBoundary||y<Sr||l>this.screenBottomBoundary}isInsideGrid(n,l,_,y){return _>=0&&n<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=a.ad([]);return a.L(n,n,[-100,-100,0]),n}_projectCollisionBox(n,l,_,y,S,M,O,N,j,Z,Y){let G=1,re=0,ne=0,be=1;const ye=n.anchorPointX+O[0],ve=n.anchorPointY+O[1];if(M&&!S){const Kt=this.projectAndGetPerspectiveRatio(ye+1,ve,y,j,Y),Ot=Kt.x-N.x,di=Math.atan((Kt.y-N.y)/Ot)+(Ot<0?Math.PI:0),er=Math.sin(di),cr=Math.cos(di);G=cr,re=er,ne=-er,be=cr}else if(!M&&S){const Kt=ht(this.transform);G=Kt.vecEast[0],re=Kt.vecEast[1],ne=Kt.vecSouth[0],be=Kt.vecSouth[1]}let Re=N.x,Le=N.y,Oe=l;S&&(Re=ye,Le=ve,Oe=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),Oe*=this.transform.getPitchedTextCorrection(ye,ve,y),Z||(Oe*=a.ae(.5+N.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),Z&&(Re+=G*Z.x*Oe+ne*Z.y*Oe,Le+=re*Z.x*Oe+be*Z.y*Oe);const ze=n.x1*Oe,Xe=n.x2*Oe,Ve=(ze+Xe)/2,ct=n.y1*Oe,St=n.y2*Oe,yt=(ct+St)/2,bt=[{offsetX:ze,offsetY:ct},{offsetX:Ve,offsetY:ct},{offsetX:Xe,offsetY:ct},{offsetX:Xe,offsetY:yt},{offsetX:Xe,offsetY:St},{offsetX:Ve,offsetY:St},{offsetX:ze,offsetY:St},{offsetX:ze,offsetY:yt}];let xt=[];for(const{offsetX:Kt,offsetY:Ot}of bt)xt.push(new a.P(Re+G*Kt+ne*Ot,Le+re*Kt+be*Ot));let ti=!1;if(S){const Kt=xt.map(Ot=>this.projectAndGetPerspectiveRatio(Ot.x,Ot.y,y,j,Y));ti=Kt.some(Ot=>!Ot.isOccluded),xt=Kt.map(Ot=>new a.P(Ot.x,Ot.y))}else ti=!0;return{box:a.ax(xt),allPointsOccluded:!ti}}}class Br{constructor(n,l,_,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ys{constructor(n,l,_,y,S){this.text=new Br(n?n.text:null,l,_,S),this.icon=new Br(n?n.icon:null,l,y,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Di{constructor(n,l,_){this.text=n,this.icon=l,this.skipFade=_}}class fe{constructor(n,l,_,y,S){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=S}}class Mi{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:_=>_.collisionGroupID===l}}return this.collisionGroups[n]}}function Js(T,n,l,_,y){const{horizontalAlign:S,verticalAlign:M}=a.aE(T);return new a.P(-(S-.5)*n+_[0]*y,-(M-.5)*l+_[1]*y)}class Ku{constructor(n,l,_,y,S){this.transform=n.clone(),this.terrain=l,this.collisionIndex=new Hn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Mi(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const l=this.terrain;return l?(_,y)=>l.getElevation(n,_,y):null}getBucketParts(n,l,_,y){const S=_.getBucket(l),M=_.latestFeatureIndex;if(!S||!M||l.id!==S.layerIds[0])return;const O=_.collisionBoxArray,N=S.layers[0].layout,j=S.layers[0].paint,Z=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),Y=_.tileSize/a.Z,G=_.tileID.toUnwrapped(),re=N.get("text-rotation-alignment")==="map",ne=a.az(_,1,this.transform.zoom),be=a.aA(this.collisionIndex.transform,_,j.get("text-translate"),j.get("text-translate-anchor")),ye=a.aA(this.collisionIndex.transform,_,j.get("icon-translate"),j.get("icon-translate-anchor")),ve=gi(re,this.transform,ne);this.retainedQueryData[S.bucketInstanceId]=new fe(S.bucketInstanceId,M,S.sourceLayerIndex,S.index,_.tileID);const Re={bucket:S,layout:N,translationText:be,translationIcon:ye,unwrappedTileID:G,pitchedLabelPlaneMatrix:ve,scale:Z,textPixelRatio:Y,holdingForFade:_.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:a.ak(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(y)for(const Le of S.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:ze,symbolInstanceEnd:Xe}=Le;n.push({sortKey:Oe,symbolInstanceStart:ze,symbolInstanceEnd:Xe,parameters:Re})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Re})}attemptAnchorPlacement(n,l,_,y,S,M,O,N,j,Z,Y,G,re,ne,be,ye,ve,Re,Le,Oe){const ze=a.aB[n.textAnchor],Xe=[n.textOffset0,n.textOffset1],Ve=Js(ze,_,y,Xe,S),ct=this.collisionIndex.placeCollisionBox(l,G,N,j,Z,O,M,ye,Y.predicate,Le,Ve,Oe);if((!Re||this.collisionIndex.placeCollisionBox(Re,G,N,j,Z,O,M,ve,Y.predicate,Le,Ve,Oe).placeable)&&ct.placeable){let St;if(this.prevPlacement&&this.prevPlacement.variableOffsets[re.crossTileID]&&this.prevPlacement.placements[re.crossTileID]&&this.prevPlacement.placements[re.crossTileID].text&&(St=this.prevPlacement.variableOffsets[re.crossTileID].anchor),re.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[re.crossTileID]={textOffset:Xe,width:_,height:y,anchor:ze,textBoxScale:S,prevAnchor:St},this.markUsedJustification(ne,ze,re,be),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,be,re),this.placedOrientations[re.crossTileID]=be),{shift:Ve,placedGlyphBoxes:ct}}}placeLayerBucketPart(n,l,_){const{bucket:y,layout:S,translationText:M,translationIcon:O,unwrappedTileID:N,pitchedLabelPlaneMatrix:j,textPixelRatio:Z,holdingForFade:Y,collisionBoxArray:G,partiallyEvaluatedTextSize:re,collisionGroup:ne}=n.parameters,be=S.get("text-optional"),ye=S.get("icon-optional"),ve=a.aC(S,"text-overlap","text-allow-overlap"),Re=ve==="always",Le=a.aC(S,"icon-overlap","icon-allow-overlap"),Oe=Le==="always",ze=S.get("text-rotation-alignment")==="map",Xe=S.get("text-pitch-alignment")==="map",Ve=S.get("icon-text-fit")!=="none",ct=S.get("symbol-z-order")==="viewport-y",St=Re&&(Oe||!y.hasIconData()||ye),yt=Oe&&(Re||!y.hasTextData()||be);!y.collisionArrays&&G&&y.deserializeCollisionBoxes(G);const bt=this.retainedQueryData[y.bucketInstanceId].tileID,xt=this._getTerrainElevationFunc(bt),ti=this.transform.getFastPathSimpleProjectionMatrix(bt),Kt=(Ot,di,er)=>{var cr,Gr;if(l[Ot.crossTileID])return;if(Y)return void(this.placements[Ot.crossTileID]=new Di(!1,!1,!1));let kr=!1,Yr=!1,Qr=!0,Or=null,yr={box:null,placeable:!1,offscreen:null,occluded:!1},In={placeable:!1},Bn=null,Qn=null,br=null,tl=0,jo=0,il=0;di.textFeatureIndex?tl=di.textFeatureIndex:Ot.useRuntimeCollisionCircles&&(tl=Ot.featureIndex),di.verticalTextFeatureIndex&&(jo=di.verticalTextFeatureIndex);const Ll=di.textBox;if(Ll){const $s=mn=>{let _n=a.al.horizontal;if(y.allowVerticalPlacement&&!mn&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[Ot.crossTileID];Ss&&(this.placedOrientations[Ot.crossTileID]=Ss,_n=Ss,this.markUsedOrientation(y,_n,Ot))}return _n},nl=(mn,_n)=>{if(y.allowVerticalPlacement&&Ot.numVerticalGlyphVertices>0&&di.verticalTextBox){for(const Ss of y.writingModes)if(Ss===a.al.vertical?(yr=_n(),In=yr):yr=mn(),yr&&yr.placeable)break}else yr=mn()},xa=Ot.textAnchorOffsetStartIndex,sl=Ot.textAnchorOffsetEndIndex;if(sl===xa){const mn=(_n,Ss)=>{const Nr=this.collisionIndex.placeCollisionBox(_n,ve,Z,bt,N,Xe,ze,M,ne.predicate,xt,void 0,ti);return Nr&&Nr.placeable&&(this.markUsedOrientation(y,Ss,Ot),this.placedOrientations[Ot.crossTileID]=Ss),Nr};nl(()=>mn(Ll,a.al.horizontal),()=>{const _n=di.verticalTextBox;return y.allowVerticalPlacement&&Ot.numVerticalGlyphVertices>0&&_n?mn(_n,a.al.vertical):{box:null,offscreen:null}}),$s(yr&&yr.placeable)}else{let mn=a.aB[(Gr=(cr=this.prevPlacement)===null||cr===void 0?void 0:cr.variableOffsets[Ot.crossTileID])===null||Gr===void 0?void 0:Gr.anchor];const _n=(Nr,gh,nd)=>{const sd=Nr.x2-Nr.x1,w0=Nr.y2-Nr.y1,Of=Ot.textBoxScale,vu=Ve&&Le==="never"?gh:null;let io=null,Vo=ve==="never"?1:2,ro="never";mn&&Vo++;for(let wa=0;wa<Vo;wa++){for(let mh=xa;mh<sl;mh++){const ol=y.textAnchorOffsets.get(mh);if(mn&&ol.textAnchor!==mn)continue;const Lf=this.attemptAnchorPlacement(ol,Nr,sd,w0,Of,ze,Xe,Z,bt,N,ne,ro,Ot,y,nd,M,O,vu,xt);if(Lf&&(io=Lf.placedGlyphBoxes,io&&io.placeable))return kr=!0,Or=Lf.shift,io}mn?mn=null:ro=ve}return _&&!io&&(io={box:this.collisionIndex.placeCollisionBox(Ll,"always",Z,bt,N,Xe,ze,M,ne.predicate,xt,void 0,ti).box,offscreen:!1,placeable:!1,occluded:!1}),io};nl(()=>_n(Ll,di.iconBox,a.al.horizontal),()=>{const Nr=di.verticalTextBox;return y.allowVerticalPlacement&&(!yr||!yr.placeable)&&Ot.numVerticalGlyphVertices>0&&Nr?_n(Nr,di.verticalIconBox,a.al.vertical):{box:null,occluded:!0,offscreen:null}}),yr&&(kr=yr.placeable,Qr=yr.offscreen);const Ss=$s(yr&&yr.placeable);if(!kr&&this.prevPlacement){const Nr=this.prevPlacement.variableOffsets[Ot.crossTileID];Nr&&(this.variableOffsets[Ot.crossTileID]=Nr,this.markUsedJustification(y,Nr.anchor,Ot,Ss))}}}if(Bn=yr,kr=Bn&&Bn.placeable,Qr=Bn&&Bn.offscreen,Ot.useRuntimeCollisionCircles){const $s=y.text.placedSymbolArray.get(Ot.centerJustifiedTextSymbolIndex),nl=a.am(y.textSizeData,re,$s),xa=S.get("text-padding");Qn=this.collisionIndex.placeCollisionCircles(ve,$s,y.lineVertexArray,y.glyphOffsetArray,nl,N,j,_,Xe,ne.predicate,Ot.collisionCircleDiameter,xa,M,xt),Qn.circles.length&&Qn.collisionDetected&&!_&&a.w("Collisions detected, but collision boxes are not shown"),kr=Re||Qn.circles.length>0&&!Qn.collisionDetected,Qr=Qr&&Qn.offscreen}if(di.iconFeatureIndex&&(il=di.iconFeatureIndex),di.iconBox){const $s=nl=>this.collisionIndex.placeCollisionBox(nl,Le,Z,bt,N,Xe,ze,O,ne.predicate,xt,Ve&&Or?Or:void 0,ti);In&&In.placeable&&di.verticalIconBox?(br=$s(di.verticalIconBox),Yr=br.placeable):(br=$s(di.iconBox),Yr=br.placeable),Qr=Qr&&br.offscreen}const bu=be||Ot.numHorizontalGlyphVertices===0&&Ot.numVerticalGlyphVertices===0,rl=ye||Ot.numIconVertices===0;bu||rl?rl?bu||(Yr=Yr&&kr):kr=Yr&&kr:Yr=kr=Yr&&kr;const Fl=Yr&&br.placeable;if(kr&&Bn.placeable&&this.collisionIndex.insertCollisionBox(Bn.box,ve,S.get("text-ignore-placement"),y.bucketInstanceId,In&&In.placeable&&jo?jo:tl,ne.ID),Fl&&this.collisionIndex.insertCollisionBox(br.box,Le,S.get("icon-ignore-placement"),y.bucketInstanceId,il,ne.ID),Qn&&kr&&this.collisionIndex.insertCollisionCircles(Qn.circles,ve,S.get("text-ignore-placement"),y.bucketInstanceId,tl,ne.ID),_&&this.storeCollisionData(y.bucketInstanceId,er,di,Bn,br,Qn),Ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ot.crossTileID]=new Di((kr||St)&&!(Bn!=null&&Bn.occluded),(Yr||yt)&&!(br!=null&&br.occluded),Qr||y.justReloaded),l[Ot.crossTileID]=!0};if(ct){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ot=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let di=Ot.length-1;di>=0;--di){const er=Ot[di];Kt(y.symbolInstances.get(er),y.collisionArrays[er],er)}}else for(let Ot=n.symbolInstanceStart;Ot<n.symbolInstanceEnd;Ot++)Kt(y.symbolInstances.get(Ot),y.collisionArrays[Ot],Ot);y.justReloaded=!1}storeCollisionData(n,l,_,y,S,M){if(_.textBox||_.iconBox){let O,N;this.collisionBoxArrays.has(n)?O=this.collisionBoxArrays.get(n):(O=new Map,this.collisionBoxArrays.set(n,O)),O.has(l)?N=O.get(l):(N={text:null,icon:null},O.set(l,N)),_.textBox&&(N.text=y.box),_.iconBox&&(N.icon=S.box)}if(M){let O=this.collisionCircleArrays[n];O===void 0&&(O=this.collisionCircleArrays[n]=[]);for(let N=0;N<M.circles.length;N+=4)O.push(M.circles[N+0]-Sr),O.push(M.circles[N+1]-Sr),O.push(M.circles[N+2]),O.push(M.collisionDetected?1:0)}}markUsedJustification(n,l,_,y){let S;S=y===a.al.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[a.aD(l)];const M=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const O of M)O>=0&&(n.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:_.crossTileID)}markUsedOrientation(n,l,_){const y=l===a.al.horizontal||l===a.al.horizontalOnly?l:0,S=l===a.al.vertical?l:0,M=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const O of M)n.text.placedSymbolArray.get(O).placedOrientation=y;_.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let _=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(n):1,S=l?l.opacities:{},M=l?l.variableOffsets:{},O=l?l.placedOrientations:{};for(const N in this.placements){const j=this.placements[N],Z=S[N];Z?(this.opacities[N]=new ys(Z,y,j.text,j.icon),_=_||j.text!==Z.text.placed||j.icon!==Z.icon.placed):(this.opacities[N]=new ys(null,y,j.text,j.icon,j.skipFade),_=_||j.text||j.icon)}for(const N in S){const j=S[N];if(!this.opacities[N]){const Z=new ys(j,y,!1,!1);Z.isHidden()||(this.opacities[N]=Z,_=_||j.text.placed||j.icon.placed)}}for(const N in M)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=M[N]);for(const N in O)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=O[N]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const _={};for(const y of l){const S=y.getBucket(n);S&&y.latestFeatureIndex&&n.id===S.layerIds[0]&&this.updateBucketOpacities(S,y.tileID,_,y.collisionBoxArray)}}updateBucketOpacities(n,l,_,y){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const S=n.layers[0],M=S.layout,O=new ys(null,0,!1,!1,!0),N=M.get("text-allow-overlap"),j=M.get("icon-allow-overlap"),Z=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Y=M.get("text-rotation-alignment")==="map",G=M.get("text-pitch-alignment")==="map",re=M.get("icon-text-fit")!=="none",ne=new ys(null,0,N&&(j||!n.hasIconData()||M.get("icon-optional")),j&&(N||!n.hasTextData()||M.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const be=(ve,Re,Le)=>{for(let Oe=0;Oe<Re/4;Oe++)ve.opacityVertexArray.emplaceBack(Le);ve.hasVisibleVertices=ve.hasVisibleVertices||Le!==ea},ye=this.collisionBoxArrays.get(n.bucketInstanceId);for(let ve=0;ve<n.symbolInstances.length;ve++){const Re=n.symbolInstances.get(ve),{numHorizontalGlyphVertices:Le,numVerticalGlyphVertices:Oe,crossTileID:ze}=Re;let Xe=this.opacities[ze];_[ze]?Xe=O:Xe||(Xe=ne,this.opacities[ze]=Xe),_[ze]=!0;const Ve=Re.numIconVertices>0,ct=this.placedOrientations[Re.crossTileID],St=ct===a.al.vertical,yt=ct===a.al.horizontal||ct===a.al.horizontalOnly;if(Le>0||Oe>0){const xt=$c(Xe.text);be(n.text,Le,St?ea:xt),be(n.text,Oe,yt?ea:xt);const ti=Xe.text.isHidden();[Re.rightJustifiedTextSymbolIndex,Re.centerJustifiedTextSymbolIndex,Re.leftJustifiedTextSymbolIndex].forEach(di=>{di>=0&&(n.text.placedSymbolArray.get(di).hidden=ti||St?1:0)}),Re.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Re.verticalPlacedTextSymbolIndex).hidden=ti||yt?1:0);const Kt=this.variableOffsets[Re.crossTileID];Kt&&this.markUsedJustification(n,Kt.anchor,Re,ct);const Ot=this.placedOrientations[Re.crossTileID];Ot&&(this.markUsedJustification(n,"left",Re,Ot),this.markUsedOrientation(n,Ot,Re))}if(Ve){const xt=$c(Xe.icon),ti=!(re&&Re.verticalPlacedIconSymbolIndex&&St);Re.placedIconSymbolIndex>=0&&(be(n.icon,Re.numIconVertices,ti?xt:ea),n.icon.placedSymbolArray.get(Re.placedIconSymbolIndex).hidden=Xe.icon.isHidden()),Re.verticalPlacedIconSymbolIndex>=0&&(be(n.icon,Re.numVerticalIconVertices,ti?ea:xt),n.icon.placedSymbolArray.get(Re.verticalPlacedIconSymbolIndex).hidden=Xe.icon.isHidden())}const bt=ye&&ye.has(ve)?ye.get(ve):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const xt=n.collisionArrays[ve];if(xt){let ti=new a.P(0,0);if(xt.textBox||xt.verticalTextBox){let Kt=!0;if(Z){const Ot=this.variableOffsets[ze];Ot?(ti=Js(Ot.anchor,Ot.width,Ot.height,Ot.textOffset,Ot.textBoxScale),Y&&ti._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Kt=!1}if(xt.textBox||xt.verticalTextBox){let Ot;xt.textBox&&(Ot=St),xt.verticalTextBox&&(Ot=yt),Hc(n.textCollisionBox.collisionVertexArray,Xe.text.placed,!Kt||Ot,bt.text,ti.x,ti.y)}}if(xt.iconBox||xt.verticalIconBox){const Kt=!!(!yt&&xt.verticalIconBox);let Ot;xt.iconBox&&(Ot=Kt),xt.verticalIconBox&&(Ot=!Kt),Hc(n.iconCollisionBox.collisionVertexArray,Xe.icon.placed,Ot,bt.icon,re?ti.x:0,re?ti.y:0)}}}}if(n.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);n.bucketInstanceId in this.collisionCircleArrays&&(n.collisionCircleArray=this.collisionCircleArrays[n.bucketInstanceId],delete this.collisionCircleArrays[n.bucketInstanceId])}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const _=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function Hc(T,n,l,_,y,S){_&&_.length!==0||(_=[0,0,0,0]);const M=_[0]-Sr,O=_[1]-Sr,N=_[2]-Sr,j=_[3]-Sr;T.emplaceBack(n?1:0,l?1:0,y||0,S||0,M,O),T.emplaceBack(n?1:0,l?1:0,y||0,S||0,N,O),T.emplaceBack(n?1:0,l?1:0,y||0,S||0,N,j),T.emplaceBack(n?1:0,l?1:0,y||0,S||0,M,j)}const Ju=Math.pow(2,25),za=Math.pow(2,24),se=Math.pow(2,17),vf=Math.pow(2,16),xf=Math.pow(2,9),wf=Math.pow(2,8),eh=Math.pow(2,1);function $c(T){if(T.opacity===0&&!T.placed)return 0;if(T.opacity===1&&T.placed)return 4294967295;const n=T.placed?1:0,l=Math.floor(127*T.opacity);return l*Ju+n*za+l*se+n*vf+l*xf+n*wf+l*eh+n}const ea=0;class Xl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,l,_,y,S){const M=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(M,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((O,N)=>O.sortKey-N.sortKey));this._currentPartIndex<M.length;)if(l.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,S())return!0;return!1}}class Zc{constructor(n,l,_,y,S,M,O,N){this.placement=new Ku(n,l,M,O,N),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(n,l,_){const y=V.now(),S=()=>!this._forceFullPlacement&&V.now()-y>2;for(;this._currentPlacementIndex>=0;){const M=l[n[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=O)&&(!M.maxzoom||M.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Xl(M)),this._inProgressLayer.continuePlacement(_[M.source],this.placement,this._showCollisionBoxes,M,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ro=512/a.Z/2;class Vs{constructor(n,l,_){this.tileID=n,this.bucketInstanceId=_,this._symbolsByKey={};const y=new Map;for(let S=0;S<l.length;S++){const M=l.get(S),O=M.key,N=y.get(O);N?N.push(M):y.set(O,[M])}for(const[S,M]of y){const O={positions:M.map(N=>({x:Math.floor(N.anchorX*Ro),y:Math.floor(N.anchorY*Ro)})),crossTileIDs:M.map(N=>N.crossTileID)};if(O.positions.length>128){const N=new a.aF(O.positions.length,16,Uint16Array);for(const{x:j,y:Z}of O.positions)N.add(j,Z);N.finish(),delete O.positions,O.index=N}this._symbolsByKey[S]=O}}getScaledCoordinates(n,l){const{x:_,y,z:S}=this.tileID.canonical,{x:M,y:O,z:N}=l.canonical,j=Ro/Math.pow(2,N-S),Z=(O*a.Z+n.anchorY)*j,Y=y*a.Z*Ro;return{x:Math.floor((M*a.Z+n.anchorX)*j-_*a.Z*Ro),y:Math.floor(Z-Y)}}findMatches(n,l,_){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let S=0;S<n.length;S++){const M=n.get(S);if(M.crossTileID)continue;const O=this._symbolsByKey[M.key];if(!O)continue;const N=this.getScaledCoordinates(M,l);if(O.index){const j=O.index.range(N.x-y,N.y-y,N.x+y,N.y+y).sort();for(const Z of j){const Y=O.crossTileIDs[Z];if(!_[Y]){_[Y]=!0,M.crossTileID=Y;break}}}else if(O.positions)for(let j=0;j<O.positions.length;j++){const Z=O.positions[j],Y=O.crossTileIDs[j];if(Math.abs(Z.x-N.x)<=y&&Math.abs(Z.y-N.y)<=y&&!_[Y]){_[Y]=!0,M.crossTileID=Y;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class hn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ta{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const _ in this.indexes){const y=this.indexes[_],S={};for(const M in y){const O=y[M];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+l),S[O.tileID.key]=O}this.indexes[_]=S}this.lng=n}addBucket(n,l,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let S=0;S<l.symbolInstances.length;S++)l.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const S in this.indexes){const M=this.indexes[S];if(Number(S)>n.overscaledZ)for(const O in M){const N=M[O];N.tileID.isChildOf(n)&&N.findMatches(l.symbolInstances,n,y)}else{const O=M[n.scaledTo(Number(S)).key];O&&O.findMatches(l.symbolInstances,n,y)}}for(let S=0;S<l.symbolInstances.length;S++){const M=l.symbolInstances.get(S);M.crossTileID||(M.crossTileID=_.generate(),y[M.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Vs(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const _ of l.getCrossTileIDsLists())for(const y of _)delete this.usedCrossTileIDs[n][y]}removeStaleBuckets(n){let l=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const S in y)n[y[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[S]),delete y[S],l=!0)}return l}}class pl{constructor(){this.layerIndexes={},this.crossTileIDs=new hn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,_){let y=this.layerIndexes[n.id];y===void 0&&(y=this.layerIndexes[n.id]=new ta);let S=!1;const M={};y.handleWrapJump(_);for(const O of l){const N=O.getBucket(n);N&&n.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(O.tileID,N,this.crossTileIDs)&&(S=!0),M[N.bucketInstanceId]=!0)}return y.removeStaleBuckets(M)&&(S=!0),S}pruneUnusedLayers(n){const l={};n.forEach(_=>{l[_]=!0});for(const _ in this.layerIndexes)l[_]||delete this.layerIndexes[_]}}var qc="void main() {fragColor=vec4(1.0);}";const kn={prelude:lr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:lr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:lr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:lr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:lr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:lr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:lr(qc,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:lr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:lr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:lr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:lr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:lr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:lr(qc,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:lr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:lr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:lr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:lr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:lr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:lr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:lr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:lr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:lr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:lr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:lr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:lr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:lr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:lr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:lr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:lr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:lr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function lr(T,n){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=n.match(/in ([\w]+) ([\w]+)/g),y=T.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=S?S.concat(y):y,O={};return{fragmentSource:T=T.replace(l,(N,j,Z,Y,G)=>(O[G]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${Z} ${Y} ${G};
#else
uniform ${Z} ${Y} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${Z} ${Y} ${G} = u_${G};
#endif
`)),vertexSource:n=n.replace(l,(N,j,Z,Y,G)=>{const re=Y==="float"?"vec2":"vec4",ne=G.match(/color/)?"color":re;return O[G]?j==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${Z} ${re} a_${G};
out ${Z} ${Y} ${G};
#else
uniform ${Z} ${Y} u_${G};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${Z} ${Y} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${ne}(a_${G}, u_${G}_t);
#else
    ${Z} ${Y} ${G} = u_${G};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${Z} ${re} a_${G};
#else
uniform ${Z} ${Y} u_${G};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${Z} ${Y} ${G} = a_${G};
#else
    ${Z} ${Y} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${Z} ${Y} ${G} = unpack_mix_${ne}(a_${G}, u_${G}_t);
#else
    ${Z} ${Y} ${G} = u_${G};
#endif
`}),staticAttributes:_,staticUniforms:M}}class Ua{constructor(n,l,_){this.vertexBuffer=n,this.indexBuffer=l,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var $n=a.aG([{name:"a_pos",type:"Int16",components:2}]);const gr="#define PROJECTION_MERCATOR",ir="mercator";class ja{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ir}get shaderDefine(){return gr}get shaderPreludeCode(){return kn.projectionMercator}get vertexShaderPreludeCode(){return kn.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(n){}getMeshFromTileID(n,l,_,y,S){if(this._cachedMesh)return this._cachedMesh;const M=new a.aI;M.emplaceBack(0,0),M.emplaceBack(a.Z,0),M.emplaceBack(0,a.Z),M.emplaceBack(a.Z,a.Z);const O=n.createVertexBuffer(M,$n.members),N=a.aJ.simpleSegment(0,0,4,2),j=new a.aK;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3);const Z=n.createIndexBuffer(j);return this._cachedMesh=new Ua(O,Z,N),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(n){}}class gl{constructor(n=0,l=0,_=0,y=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=_,this.right=y}interpolate(n,l,_){return l.top!=null&&n.top!=null&&(this.top=a.B.number(n.top,l.top,_)),l.bottom!=null&&n.bottom!=null&&(this.bottom=a.B.number(n.bottom,l.bottom,_)),l.left!=null&&n.left!=null&&(this.left=a.B.number(n.left,l.left,_)),l.right!=null&&n.right!=null&&(this.right=a.B.number(n.right,l.right,_)),this}getCenter(n,l){const _=a.ae((this.left+n-this.right)/2,0,n),y=a.ae((this.top+l-this.bottom)/2,0,l);return new a.P(_,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new gl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Va(T,n){if(!T.renderWorldCopies||T.lngRange)return;const l=n.lng-T.center.lng;n.lng+=l>180?-360:l<-180?360:0}function ss(T){return Math.max(0,Math.floor(T))}class fn{constructor(n,l,_,y,S,M){this._callbacks=n,this._tileSize=512,this._renderWorldCopies=M===void 0||!!M,this._minZoom=l||0,this._maxZoom=_||22,this._minPitch=y??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ss(this._zoom),this._scale=a.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new gl,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(n,l,_){this._latRange=n.latRange,this._lngRange=n.lngRange,this._width=n.width,this._height=n.height,this._center=n.center,this._elevation=n.elevation,this._minElevationForCurrentTile=n.minElevationForCurrentTile,this._zoom=n.zoom,this._tileZoom=ss(this._zoom),this._scale=a.ac(this._zoom),this._bearingInRadians=n.bearingInRadians,this._fovInRadians=n.fovInRadians,this._pitchInRadians=n.pitchInRadians,this._rollInRadians=n.rollInRadians,this._unmodified=n.unmodified,this._edgeInsets=new gl(n.padding.top,n.padding.bottom,n.padding.left,n.padding.right),this._minZoom=n.minZoom,this._maxZoom=n.maxZoom,this._minPitch=n.minPitch,this._maxPitch=n.maxPitch,this._renderWorldCopies=n.renderWorldCopies,this._cameraToCenterDistance=n.cameraToCenterDistance,this._nearZ=n.nearZ,this._farZ=n.farZ,this._autoCalculateNearFarZ=!_&&n.autoCalculateNearFarZ,l&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(n){this._minElevationForCurrentTile=n}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(n){this._minZoom!==n&&(this._minZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(n){this._minPitch!==n&&(this._minPitch=n,this.setPitch(Math.max(this.pitch,n)))}get maxPitch(){return this._maxPitch}setMaxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.setPitch(Math.min(this.pitch,n)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(n){const l=a.aL(n,-180,180)*Math.PI/180;var _,y,S,M,O,N,j,Z,Y;this._bearingInRadians!==l&&(this._unmodified=!1,this._bearingInRadians=l,this._calcMatrices(),this._rotationMatrix=P(),_=this._rotationMatrix,S=-this._bearingInRadians,M=(y=this._rotationMatrix)[0],O=y[1],N=y[2],j=y[3],Z=Math.sin(S),Y=Math.cos(S),_[0]=M*Y+N*Z,_[1]=O*Y+j*Z,_[2]=M*-Z+N*Y,_[3]=O*-Z+j*Y)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(n){const l=a.ae(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==l&&(this._unmodified=!1,this._pitchInRadians=l,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(n){const l=n/180*Math.PI;this._rollInRadians!==l&&(this._unmodified=!1,this._rollInRadians=l,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aM(this._fovInRadians)}setFov(n){n=a.ae(n,.1,150),this.fov!==n&&(this._unmodified=!1,this._fovInRadians=a.ab(n),this._calcMatrices())}get zoom(){return this._zoom}setZoom(n){const l=this.getConstrained(this._center,n).zoom;this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this._tileZoom=Math.max(0,Math.floor(l)),this._scale=a.ac(l),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(n,l){this._autoCalculateNearFarZ=!1,this._nearZ=n,this._farZ=l,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,_){this._unmodified=!1,this._edgeInsets.interpolate(n,l,_),this._constrain(),this._calcMatrices()}resize(n,l,_=!0){this._width=n,this._height=l,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ur([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(n){n?(this._lngRange=[n.getWest(),n.getEast()],this._latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.af])}getConstrained(n,l){return this._callbacks.getConstrained(n,l)}getCameraQueryGeometry(n,l){if(l.length===1)return[l[0],n];{let _=n.x,y=n.y,S=n.x,M=n.y;for(const O of l)_=Math.min(_,O.x),y=Math.min(y,O.y),S=Math.max(S,O.x),M=Math.max(M,O.y);return[new a.P(_,y),new a.P(S,y),new a.P(S,M),new a.P(_,M),new a.P(_,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:l,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(l),this.setZoom(_),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let n=a.ad(new Float64Array(16));a.M(n,n,[this._width/2,-this._height/2,1]),a.L(n,n,[1,-1,0]),this._clipSpaceToPixelsMatrix=n,n=a.ad(new Float64Array(16)),a.M(n,n,[1,-1,1]),a.L(n,n,[-1,-1,0]),a.M(n,n,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=n,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(n,l,_,y){const S=_!==void 0?_:this.bearing,M=y=y!==void 0?y:this.pitch,O=a.$.fromLngLat(n,l),N=-Math.cos(a.ab(M)),j=Math.sin(a.ab(M)),Z=j*Math.sin(a.ab(S)),Y=-j*Math.cos(a.ab(S));let G=this.elevation;const re=l-G;let ne;N*re>=0||Math.abs(N)<.1?(ne=1e4,G=l+ne*N):ne=-re/N;let be,ye,ve=a.aN(1,O.y),Re=0;do{if(Re+=1,Re>10)break;ye=ne/ve,be=new a.$(O.x+Z*ye,O.y+Y*ye),ve=1/be.meterInMercatorCoordinateUnits()}while(Math.abs(ne-ye*ve)>1e-12);return{center:be.toLngLat(),elevation:G,zoom:a.ah(this.height/2/Math.tan(this.fovInRadians/2)/ye/this.tileSize)}}recalculateZoomAndCenter(n){if(this.elevation-n==0)return;const l=a.ag(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/l,y=a.$.fromLngLat(this.center,this.elevation),S=le(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=n;const M=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),a.aN(S.z,y.y),this.bearing,this.pitch);this._elevation=M.elevation,this._center=M.center,this.setZoom(M.zoom)}getCameraPoint(){const n=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(n*Math.sin(this.rollInRadians),n*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const n=a.ag(1,this.center.lat)*this.worldSize;return le(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/n).toLngLat()}getMercatorTileCoordinates(n){if(!n)return[0,0,1,1];const l=n.canonical.z>=0?1<<n.canonical.z:Math.pow(2,n.canonical.z);return[n.canonical.x/l,n.canonical.y/l,1/l/a.Z,1/l/a.Z]}}class jr{constructor(n,l){this.min=n,this.max=l,this.center=a.aO([],a.aP([],this.min,this.max),.5)}quadrant(n){const l=[n%2==0,n<2],_=a.aQ(this.min),y=a.aQ(this.max);for(let S=0;S<l.length;S++)_[S]=l[S]?this.min[S]:this.center[S],y[S]=l[S]?this.center[S]:this.max[S];return y[2]=this.max[2],new jr(_,y)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersectsFrustum(n){let l=!0;for(let _=0;_<n.planes.length;_++){const y=this.intersectsPlane(n.planes[_]);if(y===0)return 0;y===1&&(l=!1)}return l?2:n.aabb.min[0]>this.max[0]||n.aabb.min[1]>this.max[1]||n.aabb.min[2]>this.max[2]||n.aabb.max[0]<this.min[0]||n.aabb.max[1]<this.min[1]||n.aabb.max[2]<this.min[2]?0:1}intersectsPlane(n){let l=n[3],_=n[3];for(let y=0;y<3;y++)n[y]>0?(l+=n[y]*this.min[y],_+=n[y]*this.max[y]):(_+=n[y]*this.min[y],l+=n[y]*this.max[y]);return l>=0?2:_<0?0:1}}class an{distanceToTile2d(n,l,_,y){const S=y.distanceX([n,l]),M=y.distanceY([n,l]);return Math.hypot(S,M)}getWrap(n,l,_){return _}getTileAABB(n,l,_,y){var S,M;let O=_,N=_;if(y.terrain){const Z=new a.Y(n.z,l,n.z,n.x,n.y),Y=y.terrain.getMinMaxElevation(Z);O=(S=Y.minElevation)!==null&&S!==void 0?S:_,N=(M=Y.maxElevation)!==null&&M!==void 0?M:_}const j=1<<n.z;return new jr([l+n.x/j,n.y/j,O],[l+(n.x+1)/j,(n.y+1)/j,N])}allowVariableZoom(n,l){const _=n.fov*(Math.abs(Math.cos(n.rollInRadians))*n.height+Math.abs(Math.sin(n.rollInRadians))*n.width)/n.height,y=a.ae(78.5-_/2,0,60);return!!l.terrain||n.pitch>y}allowWorldCopies(){return!0}recalculateCache(){}}class Mr{constructor(n,l,_){this.points=n,this.planes=l,this.aabb=_}static fromInvProjectionMatrix(n,l=1,_=0){const y=Math.pow(2,_),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(j=>{const Z=1/(j=a.at([],j,n))[3]/l*y;return a.aR(j,j,[Z,Z,1/j[3],Z])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(j=>{const Z=a.aS([],S[j[0]],S[j[1]]),Y=a.aS([],S[j[2]],S[j[1]]),G=a.aT([],a.aU([],Z,Y)),re=-a.aV(G,S[j[1]]);return G.concat(re)}),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],N=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const j of S)for(let Z=0;Z<3;Z++)O[Z]=Math.min(O[Z],j[Z]),N[Z]=Math.max(N[Z],j[Z]);return new Mr(S,M,new jr(O,N))}}class Wa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,l,_){return this._helper.interpolatePadding(n,l,_)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,l,_=!0){this._helper.resize(n,l,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,l){this._helper.overrideNearFarZ(n,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n,l){}constructor(n,l,_,y,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new fn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(M,O)=>this.getConstrained(M,O)},n,l,_,y,S),this._coveringTilesDetailsProvider=new an}clone(){const n=new Wa;return n.apply(this),n}apply(n,l,_){this._helper.apply(n,l,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(n){const l=[new a.aW(0,n)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new a.P(0,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),M=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),O=Math.floor(Math.min(_.x,y.x,S.x,M.x)),N=Math.floor(Math.max(_.x,y.x,S.x,M.x)),j=1;for(let Z=O-j;Z<=N+j;Z++)Z!==0&&l.push(new a.aW(Z,n))}return l}getCameraFrustum(){return Mr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){const l=this.screenPointToLocation(this.centerPoint,n),_=n?n.getElevationForLngLatZoom(l,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(n,l){const _=a.ag(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(l,_),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),M=a.$.fromLngLat(n),O=new a.$(M.x-(y.x-S.x),M.y-(y.y-S.y));this.setCenter(O==null?void 0:O.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(n,l){return l?this.coordinatePoint(a.$.fromLngLat(n),l.getElevationForLngLatZoom(n,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.$.fromLngLat(n))}screenPointToLocation(n,l){var _;return(_=this.screenPointToMercatorCoordinate(n,l))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(n,l){if(l){const _=l.pointCoordinate(n);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(n)}screenPointToMercatorCoordinateAtZ(n,l){const _=l||0,y=[n.x,n.y,0,1],S=[n.x,n.y,1,1];a.at(y,y,this._pixelMatrixInverse),a.at(S,S,this._pixelMatrixInverse);const M=y[3],O=S[3],N=y[1]/M,j=S[1]/O,Z=y[2]/M,Y=S[2]/O,G=Z===Y?0:(_-Z)/(Y-Z);return new a.$(a.B.number(y[0]/M,S[0]/O,G)/this.worldSize,a.B.number(N,j,G)/this.worldSize,_)}coordinatePoint(n,l=0,_=this._pixelMatrix){const y=[n.x*this.worldSize,n.y*this.worldSize,l,1];return a.at(y,y,_),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const n=Math.max(0,this._helper._height/2-rt(this));return new ur().extend(this.screenPointToLocation(new a.P(0,n))).extend(this.screenPointToLocation(new a.P(this._helper._width,n))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(n,l){return l?l.pointCoordinate(n)!=null:n.y>this.height/2-rt(this)}calculatePosMatrix(n,l=!1,_){var y;const S=(y=n.key)!==null&&y!==void 0?y:a.aX(n.wrap,n.canonical.z,n.canonical.z,n.canonical.x,n.canonical.y),M=l?this._alignedPosMatrixCache:this._posMatrixCache;if(M.has(S)){const j=M.get(S);return _?j.f32:j.f64}const O=ae(n,this.worldSize);a.N(O,l?this._alignedProjMatrix:this._viewProjMatrix,O);const N={f64:O,f32:new Float32Array(O)};return M.set(S,N),_?N.f32:N.f64}calculateFogMatrix(n){const l=n.key,_=this._fogMatrixCacheF32;if(_.has(l))return _.get(l);const y=ae(n,this.worldSize);return a.N(y,this._fogMatrix,y),_.set(l,new Float32Array(y)),_.get(l)}getConstrained(n,l){l=a.ae(+l,this.minZoom,this.maxZoom);const _={center:new a.Q(n.lng,n.lat),zoom:l};let y=this._helper._lngRange;this._helper._renderWorldCopies||y!==null||(y=[-179.9999999999,180-1e-10]);const S=this.tileSize*a.ac(_.zoom);let M=0,O=S,N=0,j=S,Z=0,Y=0;const{x:G,y:re}=this.size;if(this._helper._latRange){const Le=this._helper._latRange;M=a.S(Le[1])*S,O=a.S(Le[0])*S,O-M<re&&(Z=re/(O-M))}y&&(N=a.aL(a.U(y[0])*S,0,S),j=a.aL(a.U(y[1])*S,0,S),j<N&&(j+=S),j-N<G&&(Y=G/(j-N)));const{x:ne,y:be}=ns(S,n);let ye,ve;const Re=Math.max(Y||0,Z||0);if(Re){const Le=new a.P(Y?(j+N)/2:ne,Z?(O+M)/2:be);return _.center=Ks(S,Le).wrap(),_.zoom+=a.ah(Re),_}if(this._helper._latRange){const Le=re/2;be-Le<M&&(ve=M+Le),be+Le>O&&(ve=O-Le)}if(y){const Le=(N+j)/2;let Oe=ne;this._helper._renderWorldCopies&&(Oe=a.aL(ne,Le-S/2,Le+S/2));const ze=G/2;Oe-ze<N&&(ye=N+ze),Oe+ze>j&&(ye=j-ze)}if(ye!==void 0||ve!==void 0){const Le=new a.P(ye??ne,ve??be);_.center=Ks(S,Le).wrap()}return _}calculateCenterFromCameraLngLatAlt(n,l,_,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,l,_,y)}_calculateNearFarZIfNeeded(n,l,_){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=n-y*this._helper._pixelPerMeter/Math.cos(l),M=y<0?S:n,O=Math.PI/2+this.pitchInRadians,N=a.ab(this.fov)*(Math.abs(Math.cos(a.ab(this.roll)))*this.height+Math.abs(Math.sin(a.ab(this.roll)))*this.width)/this.height*(.5+_.y/this.height),j=Math.sin(N)*M/Math.sin(a.ae(Math.PI-O-N,.01,Math.PI-.01)),Z=rt(this),Y=Math.atan(Z/this._helper.cameraToCenterDistance),G=a.ab(.75),re=Y>G?2*Y*(.5+_.y/(2*Z)):G,ne=Math.sin(re)*M/Math.sin(a.ae(Math.PI-O-re,.01,Math.PI-.01)),be=Math.min(j,ne);this._helper._farZ=1.01*(Math.cos(Math.PI/2-l)*be+M),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const n=this.centerOffset,l=ns(this.worldSize,this.center),_=l.x,y=l.y;this._helper._pixelPerMeter=a.ag(1,this.center.lat)*this.worldSize;const S=a.ab(Math.min(this.pitch,ks)),M=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let O;this._calculateNearFarZIfNeeded(M,S,n),O=new Float64Array(16),a.aY(O,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.an(this._invProjMatrix,O),O[8]=2*-n.x/this._helper._width,O[9]=2*n.y/this._helper._height,this._projectionMatrix=a.aZ(O),a.M(O,O,[1,-1,1]),a.L(O,O,[0,0,-this._helper.cameraToCenterDistance]),a.a_(O,O,-this.rollInRadians),a.a$(O,O,this.pitchInRadians),a.a_(O,O,-this.bearingInRadians),a.L(O,O,[-_,-y,0]),this._mercatorMatrix=a.M([],O,[this.worldSize,this.worldSize,this.worldSize]),a.M(O,O,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,O),a.L(O,O,[0,0,-this.elevation]),this._viewProjMatrix=O,this._invViewProjMatrix=a.an([],O);const N=[0,0,-1,1];a.at(N,N,this._invViewProjMatrix),this._cameraPosition=[N[0]/N[3],N[1]/N[3],N[2]/N[3]],this._fogMatrix=new Float64Array(16),a.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,M,this._helper._farZ),this._fogMatrix[8]=2*-n.x/this.width,this._fogMatrix[9]=2*n.y/this.height,a.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.L(this._fogMatrix,this._fogMatrix,[-_,-y,0]),a.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,O);const j=this._helper._width%2/2,Z=this._helper._height%2/2,Y=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),re=_-Math.round(_)+Y*j+G*Z,ne=y-Math.round(y)+Y*Z+G*j,be=new Float64Array(O);if(a.L(be,be,[re>.5?re-1:re,ne>.5?ne-1:ne,0]),this._alignedProjMatrix=be,O=a.an(new Float64Array(16),this._pixelMatrix),!O)throw new Error("failed to invert matrix");this._pixelMatrixInverse=O,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const n=this.screenPointToMercatorCoordinate(new a.P(0,0)),l=[n.x*this.worldSize,n.y*this.worldSize,0,1];return a.at(l,l,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const n=a.ag(1,this.center.lat)*this.worldSize;return le(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/n).toLngLat()}lngLatToCameraDepth(n,l){const _=a.$.fromLngLat(n),y=[_.x*this.worldSize,_.y*this.worldSize,l,1];return a.at(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(n){const{overscaledTileID:l,aligned:_,applyTerrainMatrix:y}=n,S=this._helper.getMercatorTileCoordinates(l),M=l?this.calculatePosMatrix(l,_,!0):null;let O;return O=l&&l.terrainRttPosMatrix32f&&y?l.terrainRttPosMatrix32f:M||a.b0(),{mainMatrix:O,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:O}}isLocationOccluded(n){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(n,l,_){return 1}transformLightDirection(n){return a.aQ(n)}getRayDirectionFromPixel(n){throw new Error("Not implemented.")}projectTileCoordinates(n,l,_,y){const S=this.calculatePosMatrix(_);let M;y?(M=[n,l,y(n,l),1],a.at(M,M,S)):(M=[n,l,0,1],Ds(M,M,S));const O=M[3];return{point:new a.P(M[0]/O,M[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}populateCache(n){for(const l of n)this.calculatePosMatrix(l)}getMatrixForModel(n,l){const _=a.$.fromLngLat(n,l),y=_.meterInMercatorCoordinateUnits(),S=a.b1();return a.L(S,S,[_.x,_.y,_.z]),a.a_(S,S,Math.PI),a.a$(S,S,Math.PI/2),a.M(S,S,[-y,y,y]),S}getProjectionDataForCustomLayer(n=!0){const l=new a.Y(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:l,applyGlobeMatrix:n}),y=ae(l,this.worldSize);a.N(y,this._viewProjMatrix,y),_.tileMercatorCoords=[0,0,1,1];const S=[a.Z,a.Z,this.worldSize/this._helper.pixelsPerMeter],M=a.b2();return a.M(M,y,S),_.fallbackMatrix=M,_.mainMatrix=M,_}getFastPathSimpleProjectionMatrix(n){return this.calculatePosMatrix(n)}}function Zn(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function os(T){if(T.useSlerp)if(T.k<1){const n=a.b3(T.startEulerAngles.roll,T.startEulerAngles.pitch,T.startEulerAngles.bearing),l=a.b3(T.endEulerAngles.roll,T.endEulerAngles.pitch,T.endEulerAngles.bearing),_=new Float64Array(4);a.b4(_,n,l,T.k);const y=a.b5(_);T.tr.setRoll(y.roll),T.tr.setPitch(y.pitch),T.tr.setBearing(y.bearing)}else T.tr.setRoll(T.endEulerAngles.roll),T.tr.setPitch(T.endEulerAngles.pitch),T.tr.setBearing(T.endEulerAngles.bearing);else T.tr.setRoll(a.B.number(T.startEulerAngles.roll,T.endEulerAngles.roll,T.k)),T.tr.setPitch(a.B.number(T.startEulerAngles.pitch,T.endEulerAngles.pitch,T.k)),T.tr.setBearing(a.B.number(T.startEulerAngles.bearing,T.endEulerAngles.bearing,T.k))}function as(T,n,l,_,y){const S=y.padding,M=ns(y.worldSize,l.getNorthWest()),O=ns(y.worldSize,l.getNorthEast()),N=ns(y.worldSize,l.getSouthEast()),j=ns(y.worldSize,l.getSouthWest()),Z=a.ab(-_),Y=M.rotate(Z),G=O.rotate(Z),re=N.rotate(Z),ne=j.rotate(Z),be=new a.P(Math.max(Y.x,G.x,ne.x,re.x),Math.max(Y.y,G.y,ne.y,re.y)),ye=new a.P(Math.min(Y.x,G.x,ne.x,re.x),Math.min(Y.y,G.y,ne.y,re.y)),ve=be.sub(ye),Re=(y.width-(S.left+S.right+n.left+n.right))/ve.x,Le=(y.height-(S.top+S.bottom+n.top+n.bottom))/ve.y;if(Le<0||Re<0)return void Zn();const Oe=Math.min(a.ah(y.scale*Math.min(Re,Le)),T.maxZoom),ze=a.P.convert(T.offset),Xe=new a.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(a.ab(_)),Ve=ze.add(Xe).mult(y.scale/a.ac(Oe));return{center:Ks(y.worldSize,M.add(N).div(2).sub(Ve)),zoom:Oe,bearing:_}}class ia{get useGlobeControls(){return!1}handlePanInertia(n,l){return{easingOffset:n,easingCenter:l.center}}handleMapControlsRollPitchBearingZoom(n,l){n.bearingDelta&&l.setBearing(l.bearing+n.bearingDelta),n.pitchDelta&&l.setPitch(l.pitch+n.pitchDelta),n.rollDelta&&l.setRoll(l.roll+n.rollDelta),n.zoomDelta&&l.setZoom(l.zoom+n.zoomDelta)}handleMapControlsPan(n,l,_){n.around.distSqr(l.centerPoint)<.01||l.setLocationAtPoint(_,n.around)}cameraForBoxAndBearing(n,l,_,y,S){return as(n,l,_,y,S)}handleJumpToCenterZoom(n,l){n.zoom!==(l.zoom!==void 0?+l.zoom:n.zoom)&&n.setZoom(+l.zoom),l.center!==void 0&&n.setCenter(a.Q.convert(l.center))}handleEaseTo(n,l){const _=n.zoom,y=n.padding,S={roll:n.roll,pitch:n.pitch,bearing:n.bearing},M={roll:l.roll===void 0?n.roll:l.roll,pitch:l.pitch===void 0?n.pitch:l.pitch,bearing:l.bearing===void 0?n.bearing:l.bearing},O=l.zoom!==void 0,N=!n.isPaddingEqual(l.padding);let j=!1;const Z=O?+l.zoom:n.zoom;let Y=n.centerPoint.add(l.offsetAsPoint);const G=n.screenPointToLocation(Y),{center:re,zoom:ne}=n.getConstrained(a.Q.convert(l.center||G),Z??_);Va(n,re);const be=ns(n.worldSize,G),ye=ns(n.worldSize,re).sub(be),ve=a.ac(ne-_);return j=ne!==_,{easeFunc:Re=>{if(j&&n.setZoom(a.B.number(_,ne,Re)),a.b6(S,M)||os({startEulerAngles:S,endEulerAngles:M,tr:n,k:Re,useSlerp:S.roll!=M.roll}),N&&(n.interpolatePadding(y,l.padding,Re),Y=n.centerPoint.add(l.offsetAsPoint)),l.around)n.setLocationAtPoint(l.around,l.aroundPoint);else{const Le=a.ac(n.zoom-_),Oe=ne>_?Math.min(2,ve):Math.max(.5,ve),ze=Math.pow(Oe,1-Re),Xe=Ks(n.worldSize,be.add(ye.mult(Re*ze)).mult(Le));n.setLocationAtPoint(n.renderWorldCopies?Xe.wrap():Xe,Y)}},isZooming:j,elevationCenter:re}}handleFlyTo(n,l){const _=l.zoom!==void 0,y=n.zoom,S=n.getConstrained(a.Q.convert(l.center||l.locationAtOffset),_?+l.zoom:y),M=S.center,O=S.zoom;Va(n,M);const N=ns(n.worldSize,l.locationAtOffset),j=ns(n.worldSize,M).sub(N),Z=j.mag(),Y=a.ac(O-y);let G;if(l.minZoom!==void 0){const re=Math.min(+l.minZoom,y,O),ne=n.getConstrained(M,re).zoom;G=a.ac(ne-y)}return{easeFunc:(re,ne,be,ye)=>{n.setZoom(re===1?O:y+a.ah(ne));const ve=re===1?M:Ks(n.worldSize,N.add(j.mult(be)).mult(ne));n.setLocationAtPoint(n.renderWorldCopies?ve.wrap():ve,ye)},scaleOfZoom:Y,targetCenter:M,scaleOfMinZoom:G,pixelPathLength:Z}}}class mr{constructor(n,l,_){this.blendFunction=n,this.blendColor=l,this.mask=_}}mr.Replace=[1,0],mr.disabled=new mr(mr.Replace,a.b7.transparent,[!1,!1,!1,!1]),mr.unblended=new mr(mr.Replace,a.b7.transparent,[!0,!0,!0,!0]),mr.alphaBlended=new mr([1,771],a.b7.transparent,[!0,!0,!0,!0]);const Vr=2305;class nr{constructor(n,l,_){this.enable=n,this.mode=l,this.frontFace=_}}nr.disabled=new nr(!1,1029,Vr),nr.backCCW=new nr(!0,1029,Vr),nr.frontCCW=new nr(!0,1028,Vr);class Ui{constructor(n,l,_){this.func=n,this.mask=l,this.range=_}}Ui.ReadOnly=!1,Ui.ReadWrite=!0,Ui.disabled=new Ui(519,Ui.ReadOnly,[0,1]);const ra=7680;class Gi{constructor(n,l,_,y,S,M){this.test=n,this.ref=l,this.mask=_,this.fail=y,this.depthFail=S,this.pass=M}}Gi.disabled=new Gi({func:519,mask:0},0,0,ra,ra,ra);const Gl=new WeakMap;function Dn(T){var n;if(Gl.has(T))return Gl.get(T);{const l=(n=T.getParameter(T.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return Gl.set(T,l),l}}class Xc{get awaitingQuery(){return!!this._readbackQueue}constructor(n){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=n;const l=n.context,_=l.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const y=new a.aI;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const S=new a.aK;S.emplaceBack(0,1,2),this._fullscreenTriangle=new Ua(l.createVertexBuffer(y,$n.members),l.createIndexBuffer(S),a.aJ.simpleSegment(0,0,y.length,S.length)),this._resultBuffer=new Uint8Array(4),l.activeTexture.set(_.TEXTURE1);const M=_.createTexture();_.bindTexture(_.TEXTURE_2D,M),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=l.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(M),Dn(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const n=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),n.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(n,l){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(n,l),this._updateCount++,this._measuredError}_bindFramebuffer(){const n=this._cachedRenderContext.context,l=n.gl;n.activeTexture.set(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this._fbo.colorAttachment.get()),n.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(n,l){const _=this._cachedRenderContext.context,y=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:a.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,y.TRIANGLES,Ui.disabled,Gi.disabled,mr.unblended,nr.disabled,((S,M)=>({u_input:S,u_output_expected:M}))(n,l),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Dn(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const S=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const n=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Dn(n)){const l=n.clientWaitSync(this._readbackQueue.sync,0,0);if(l===n.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(l===n.TIMEOUT_EXPIRED)return;n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Xc._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(n){let l=0;return l+=n[0]/256,l+=n[1]/65536,l+=n[2]/16777216,n[3]<127&&(l=-l),l/128}}const An=a.Z/128;function Ws(T,n){const l=T.granularity!==void 0?Math.max(T.granularity,1):1,_=l+(T.generateBorders?2:0),y=l+(T.extendToNorthPole||T.generateBorders?1:0)+(T.extendToSouthPole||T.generateBorders?1:0),S=_+1,M=y+1,O=T.generateBorders?-1:0,N=T.generateBorders||T.extendToNorthPole?-1:0,j=l+(T.generateBorders?1:0),Z=l+(T.generateBorders||T.extendToSouthPole?1:0),Y=S*M,G=_*y*6,re=S*M>65536;if(re&&n==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ne=re||n==="32bit",be=new Int16Array(2*Y);let ye=0;for(let Le=N;Le<=Z;Le++)for(let Oe=O;Oe<=j;Oe++){let ze=Oe/l*a.Z;Oe===-1&&(ze=-64),Oe===l+1&&(ze=a.Z+An);let Xe=Le/l*a.Z;Le===-1&&(Xe=T.extendToNorthPole?a.b9:-64),Le===l+1&&(Xe=T.extendToSouthPole?a.ba:a.Z+An),be[ye++]=ze,be[ye++]=Xe}const ve=ne?new Uint32Array(G):new Uint16Array(G);let Re=0;for(let Le=0;Le<y;Le++)for(let Oe=0;Oe<_;Oe++){const ze=Oe+1+Le*S,Xe=Oe+(Le+1)*S,Ve=Oe+1+(Le+1)*S;ve[Re++]=Oe+Le*S,ve[Re++]=Xe,ve[Re++]=ze,ve[Re++]=ze,ve[Re++]=Xe,ve[Re++]=Ve}return{vertices:be.buffer.slice(0),indices:ve.buffer.slice(0),uses32bitIndices:ne}}const sn=new a.aH({fill:new a.bb(128,2),line:new a.bb(512,0),tile:new a.bb(128,32),stencil:new a.bb(128,1),circle:3});class na{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return kn.projectionGlobe}get vertexShaderPreludeCode(){return kn.projectionMercator.vertexSource}get subdivisionGranularity(){return sn}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(n){this._errorMeasurement||(this._errorMeasurement=new Xc(n));const l=a.S(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-l*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(l,_),S=V.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=S);const M=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bd(M))}_getMeshKey(n){return`${n.granularity.toString(36)}_${n.generateBorders?"b":""}${n.extendToNorthPole?"n":""}${n.extendToSouthPole?"s":""}`}getMeshFromTileID(n,l,_,y,S){const M=(S==="stencil"?sn.stencil:sn.tile).getGranularityForZoomLevel(l.z);return this._getMesh(n,{granularity:M,generateBorders:_,extendToNorthPole:l.y===0&&y,extendToSouthPole:l.y===(1<<l.z)-1&&y})}_getMesh(n,l){const _=this._getMeshKey(l);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const y=function(S,M){const O=Ws(M,"16bit"),N=a.aI.deserialize({arrayBuffer:O.vertices,length:O.vertices.byteLength/2/2}),j=a.aK.deserialize({arrayBuffer:O.indices,length:O.indices.byteLength/2/3});return new Ua(S.createVertexBuffer(N,$n.members),S.createIndexBuffer(j),a.aJ.simpleSegment(0,0,N.length,j.length))}(n,l);return this._tileMeshCache[_]=y,y}recalculate(n){}hasTransition(){const n=V.now();let l=!1;return l=l||(n-this._errorMeasurementLastChangeTime)/1e3<.7,l=l||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,l}setErrorQueryLatitudeDegrees(n){this._errorQueryLatitudeDegrees=n}}const Yl=new a.r({type:new a.D(a.v.projection.type)});class sa extends a.E{constructor(n){super(),this._transitionable=new a.T(Yl),this.setProjection(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0)),this._mercatorProjection=new ja,this._verticalPerspectiveProjection=new na}get transitionState(){const n=this.properties.get("type");if(typeof n=="string"&&n==="mercator")return 0;if(typeof n=="string"&&n==="vertical-perspective")return 1;if(n instanceof a.be){if(n.from==="vertical-perspective"&&n.to==="mercator")return 1-n.transition;if(n.from==="mercator"&&n.to==="vertical-perspective")return n.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(n){this._mercatorProjection.updateGPUdependent(n),this._verticalPerspectiveProjection.updateGPUdependent(n)}getMeshFromTileID(n,l,_,y,S){return this.currentProjection.getMeshFromTileID(n,l,_,y,S)}setProjection(n){this._transitionable.setValue("type",(n==null?void 0:n.type)||"mercator")}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}setErrorQueryLatitudeDegrees(n){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(n),this._mercatorProjection.setErrorQueryLatitudeDegrees(n)}}function ml(T){const n=ko(T.worldSize,T.center.lat);return 2*Math.PI*n}function oa(T,n,l,_,y){const S=1/(1<<y),M=n/a.Z*S+_*S,O=a.bg((T/a.Z*S+l*S)*Math.PI*2+Math.PI,2*Math.PI),N=2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI,j=Math.cos(N),Z=new Float64Array(3);return Z[0]=Math.sin(O)*j,Z[1]=Math.sin(N),Z[2]=Math.cos(O)*j,Z}function dn(T){return function(n,l){const _=Math.cos(l),y=new Float64Array(3);return y[0]=Math.sin(n)*_,y[1]=Math.sin(l),y[2]=Math.cos(n)*_,y}(T.lng*Math.PI/180,T.lat*Math.PI/180)}function ko(T,n){return T/(2*Math.PI)/Math.cos(n*Math.PI/180)}function Do(T){const n=Math.asin(T[1])/Math.PI*180,l=Math.sqrt(T[0]*T[0]+T[2]*T[2]);if(l>1e-6){const _=T[0]/l,y=Math.acos(T[2]/l),S=(_>0?y:-y)/Math.PI*180;return new a.Q(a.aL(S,-180,180),n)}return new a.Q(0,n)}function ls(T){return Math.cos(T*Math.PI/180)}function ln(T,n){const l=ls(T),_=ls(n);return a.ah(_/l)}function _l(T,n){const l=T.rotate(n.bearingInRadians),_=n.zoom+ln(n.center.lat,0),y=a.bc(1/ls(n.center.lat),1/ls(Math.min(Math.abs(n.center.lat),60)),a.bf(_,7,3,0,1)),S=360/ml({worldSize:n.worldSize,center:{lat:n.center.lat}});return new a.Q(n.center.lng-l.x*S*y,a.ae(n.center.lat+l.y*S,-85.051129,a.af))}function aa(T){const n=.5*T,l=Math.sin(n),_=Math.cos(n);return Math.log(l+_)-Math.log(_-l)}function Bo(T,n,l,_){const y=T.lat+l*_;if(Math.abs(l)>1){const S=(Math.sign(T.lat+l)!==Math.sign(T.lat)?-Math.abs(T.lat):Math.abs(T.lat))*Math.PI/180,M=Math.abs(T.lat+l)*Math.PI/180,O=aa(S+_*(M-S)),N=aa(S),j=aa(M);return new a.Q(T.lng+n*((O-N)/(j-N)),y)}return new a.Q(T.lng+n*_,y)}class Oo{constructor(n){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=n}recalculateCache(){if(!this._hadAnyChanges)return;const n=this._cachePrevious;this._cachePrevious=this._cache,this._cache=n,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(n,l,_,y){const S=`${n.z}_${n.x}_${n.y}`,M=this._cache.get(S);if(M)return M;const O=this._cachePrevious.get(S);if(O)return this._cache.set(S,O),O;const N=this._aabbFactory(n,l,_,y);return this._cache.set(S,N),this._hadAnyChanges=!0,N}}function Cn(T,n,l){const _=T-n;return _<0?-_:Math.max(0,_-l)}function Ha(T,n,l,_,y){const S=T-l;let M;return M=S<0?Math.min(-S,1+S-y):S>1?Math.min(Math.max(S-y,0),1-S):0,Math.max(M,Cn(n,_,y))}class Bs{constructor(){this._aabbCache=new Oo(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(n,l,_,y){const S=1<<_.z,M=1/S,O=_.x/S,N=_.y/S;let j=2;return j=Math.min(j,Ha(n,l,O,N,M)),j=Math.min(j,Ha(n,l,O+.5,-N-M,M)),j=Math.min(j,Ha(n,l,O+.5,2-N-M,M)),j}getWrap(n,l,_){const y=1<<l.z,S=1/y,M=l.x/y,O=Cn(n.x,M,S),N=Cn(n.x,M-1,S),j=Cn(n.x,M+1,S),Z=Math.min(O,N,j);return Z===j?1:Z===N?-1:0}allowVariableZoom(n,l){return ut(n,l)>4}allowWorldCopies(){return!1}getTileAABB(n,l,_,y){return this._aabbCache.getTileAABB(n,l,_,y)}_computeTileAABB(n,l,_,y){if(n.z<=0)return new jr([-1,-1,-1],[1,1,1]);if(n.z===1)return new jr([n.x===0?-1:0,n.y===0?0:-1,-1],[n.x===0?0:1,n.y===0?1:0,1]);{const S=[oa(0,0,n.x,n.y,n.z),oa(a.Z,0,n.x,n.y,n.z),oa(a.Z,a.Z,n.x,n.y,n.z),oa(0,a.Z,n.x,n.y,n.z)],M=[1,1,1],O=[-1,-1,-1];for(const N of S)for(let j=0;j<3;j++)M[j]=Math.min(M[j],N[j]),O[j]=Math.max(O[j],N[j]);if(n.y===0||n.y===(1<<n.z)-1){const N=[0,n.y===0?1:-1,0];for(let j=0;j<3;j++)M[j]=Math.min(M[j],N[j]),O[j]=Math.max(O[j],N[j])}return new jr(M,O)}}}class la{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,l,_){return this._helper.interpolatePadding(n,l,_)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,l){this._helper.resize(n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,l){this._helper.overrideNearFarZ(n,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n){}constructor(){this._cachedClippingPlane=a.bk(),this._projectionMatrix=a.b1(),this._globeViewProjMatrix32f=a.b0(),this._globeViewProjMatrixNoCorrection=a.b1(),this._globeViewProjMatrixNoCorrectionInverted=a.b1(),this._globeProjMatrixInverted=a.b1(),this._cameraPosition=a.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new fn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,l)=>this.getConstrained(n,l)}),this._coveringTilesDetailsProvider=new Bs}clone(){const n=new la;return n.apply(this),n}apply(n,l){this._globeLatitudeErrorCorrectionRadians=l||0,this._helper.apply(n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const n=a.bh();return n[0]=this._cameraPosition[0],n[1]=this._cameraPosition[1],n[2]=this._cameraPosition[2],n}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(n){const{overscaledTileID:l,applyGlobeMatrix:_}=n,y=this._helper.getMercatorTileCoordinates(l);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(n){const l=this.pitchInRadians,_=this.cameraToCenterDistance/n,y=Math.sin(l)*_,S=Math.cos(l)*_+1,M=1/Math.sqrt(y*y+S*S)*1;let O=-y,N=S;const j=Math.sqrt(O*O+N*N);O/=j,N/=j;const Z=[0,O,N];a.bl(Z,Z,[0,0,0],-this.bearingInRadians),a.bm(Z,Z,[0,0,0],-1*this.center.lat*Math.PI/180),a.bn(Z,Z,[0,0,0],this.center.lng*Math.PI/180);const Y=1/a.bo(Z);return a.aO(Z,Z,Y),[...Z,-M*Y]}isLocationOccluded(n){return!this.isSurfacePointVisible(dn(n))}transformLightDirection(n){const l=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,y=Math.cos(_),S=[Math.sin(l)*y,Math.sin(_),Math.cos(l)*y],M=[S[2],0,-S[0]],O=[0,0,0];a.aU(O,M,S),a.aT(M,M),a.aT(O,O);const N=[0,0,0];return a.aT(N,[M[0]*n[0]+O[0]*n[1]+S[0]*n[2],M[1]*n[0]+O[1]*n[1]+S[1]*n[2],M[2]*n[0]+O[2]*n[1]+S[2]*n[2]]),N}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(n,l,_){const y=function(O,N,j){const Z=1/(1<<j.z);return new a.$(O/a.Z*Z+j.x*Z,N/a.Z*Z+j.y*Z)}(n,l,_.canonical),S=(M=y.y,[a.bg(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI]);var M;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(n,l,_,y){const S=_.canonical,M=oa(n,l,S.x,S.y,S.z),O=1+(y?y(n,l):0)/a.bu,N=[M[0]*O,M[1]*O,M[2]*O,1];a.at(N,N,this._globeViewProjMatrixNoCorrection);const j=this._cachedClippingPlane,Z=j[0]*M[0]+j[1]*M[1]+j[2]*M[2]+j[3]<0;return{point:new a.P(N[0]/N[3],N[1]/N[3]),signedDistanceFromCamera:N[3],isOccluded:Z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const n=ko(this.worldSize,this.center.lat),l=a.b2(),_=a.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*n),a.aY(l,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;l[8]=2*-y.x/this._helper._width,l[9]=2*y.y/this._helper._height,this._projectionMatrix=a.aZ(l),this._globeProjMatrixInverted=a.b2(),a.an(this._globeProjMatrixInverted,l),a.L(l,l,[0,0,-this.cameraToCenterDistance]),a.a_(l,l,this.rollInRadians),a.a$(l,l,-this.pitchInRadians),a.a_(l,l,this.bearingInRadians),a.L(l,l,[0,0,-n]);const S=a.bh();S[0]=n,S[1]=n,S[2]=n,a.a$(_,l,this.center.lat*Math.PI/180),a.bp(_,_,-this.center.lng*Math.PI/180),a.M(_,_,S),this._globeViewProjMatrixNoCorrection=_,a.a$(l,l,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bp(l,l,-this.center.lng*Math.PI/180),a.M(l,l,S),this._globeViewProjMatrix32f=new Float32Array(l),this._globeViewProjMatrixNoCorrectionInverted=a.b2(),a.an(this._globeViewProjMatrixNoCorrectionInverted,_);const M=a.bh();this._cameraPosition=a.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/n,a.bl(this._cameraPosition,this._cameraPosition,M,-this.rollInRadians),a.bm(this._cameraPosition,this._cameraPosition,M,this.pitchInRadians),a.bl(this._cameraPosition,this._cameraPosition,M,-this.bearingInRadians),a.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bm(this._cameraPosition,this._cameraPosition,M,-this.center.lat*Math.PI/180),a.bn(this._cameraPosition,this._cameraPosition,M,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(n);const O=a.aZ(this._globeViewProjMatrixNoCorrectionInverted);a.M(O,O,[1,1,-1]),this._cachedFrustum=Mr.fromInvProjectionMatrix(O)}calculateFogMatrix(n){a.w("calculateFogMatrix is not supported on globe projection.");const l=a.b2();return a.ad(l),l}getVisibleUnwrappedCoordinates(n){return[new a.aW(0,n)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){n&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,l){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=dn(n);a.aO(_,_,1+l/a.bu);const y=a.bk();return a.at(y,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(n){}getBounds(){const n=.5*this.width,l=.5*this.height,_=[new a.P(0,0),new a.P(n,0),new a.P(this.width,0),new a.P(this.width,l),new a.P(this.width,this.height),new a.P(n,this.height),new a.P(0,this.height),new a.P(0,l)],y=[];for(const Y of _)y.push(this.unprojectScreenPoint(Y));let S=0,M=0,O=0,N=0;const j=this.center;for(const Y of y){const G=a.bq(j.lng,Y.lng),re=a.bq(j.lat,Y.lat);G<M&&(M=G),G>S&&(S=G),re<N&&(N=re),re>O&&(O=re)}const Z=[j.lng+M,j.lat+N,j.lng+S,j.lat+O];return this.isSurfacePointOnScreen([0,1,0])&&(Z[3]=90,Z[0]=-180,Z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(Z[1]=-90,Z[0]=-180,Z[2]=180),new ur(Z)}getConstrained(n,l){const _=a.ae(n.lat,-85.051129,a.af),y=a.ae(+l,this.minZoom+ln(0,_),this.maxZoom);return{center:new a.Q(n.lng,_),zoom:y}}calculateCenterFromCameraLngLatAlt(n,l,_,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,l,_,y)}setLocationAtPoint(n,l){const _=dn(this.unprojectScreenPoint(l)),y=dn(n),S=a.bh();a.br(S);const M=a.bh();a.bn(M,_,S,-this.center.lng*Math.PI/180),a.bm(M,M,S,this.center.lat*Math.PI/180);const O=y[0]*y[0]+y[2]*y[2],N=M[0]*M[0];if(O<N)return;const j=Math.sqrt(O-N),Z=-j,Y=a.bs(y[0],y[2],M[0],j),G=a.bs(y[0],y[2],M[0],Z),re=a.bh();a.bn(re,y,S,-Y);const ne=a.bs(re[1],re[2],M[1],M[2]),be=a.bh();a.bn(be,y,S,-G);const ye=a.bs(be[1],be[2],M[1],M[2]),ve=.5*Math.PI,Re=ne>=-ve&&ne<=ve,Le=ye>=-ve&&ye<=ve;let Oe,ze;if(Re&&Le){const St=this.center.lng*Math.PI/180,yt=this.center.lat*Math.PI/180;a.bv(Y,St)+a.bv(ne,yt)<a.bv(G,St)+a.bv(ye,yt)?(Oe=Y,ze=ne):(Oe=G,ze=ye)}else if(Re)Oe=Y,ze=ne;else{if(!Le)return;Oe=G,ze=ye}const Xe=Oe/Math.PI*180,Ve=ze/Math.PI*180,ct=this.center.lat;this.setCenter(new a.Q(Xe,a.ae(Ve,-90,90))),this.setZoom(this.zoom+ln(ct,this.center.lat))}locationToScreenPoint(n,l){const _=dn(n);if(l){const y=l.getElevationForLngLatZoom(n,this._helper._tileZoom);a.aO(_,_,1+y/a.bu)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(n){const l=a.bk();return a.at(l,[...n,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],new a.P((.5*l[0]+.5)*this.width,(.5*-l[1]+.5)*this.height)}screenPointToMercatorCoordinate(n,l){if(l){const _=l.pointCoordinate(n);if(_)return _}return a.$.fromLngLat(this.unprojectScreenPoint(n))}screenPointToLocation(n,l){var _;return(_=this.screenPointToMercatorCoordinate(n,l))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(n,l){const _=this._cameraPosition,y=this.getRayDirectionFromPixel(n);return!!this.rayPlanetIntersection(_,y)}getRayDirectionFromPixel(n){const l=a.bk();l[0]=n.x/this.width*2-1,l[1]=-1*(n.y/this.height*2-1),l[2]=1,l[3]=1,a.at(l,l,this._globeViewProjMatrixNoCorrectionInverted),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3];const _=a.bh();_[0]=l[0]-this._cameraPosition[0],_[1]=l[1]-this._cameraPosition[1],_[2]=l[2]-this._cameraPosition[2];const y=a.bh();return a.aT(y,_),y}isSurfacePointVisible(n){const l=this._cachedClippingPlane;return l[0]*n[0]+l[1]*n[1]+l[2]*n[2]+l[3]>=0}isSurfacePointOnScreen(n){if(!this.isSurfacePointVisible(n))return!1;const l=a.bk();return a.at(l,[...n,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3],l[0]>-1&&l[0]<1&&l[1]>-1&&l[1]<1&&l[2]>-1&&l[2]<1}rayPlanetIntersection(n,l){const _=a.aV(n,l),y=a.bh(),S=a.bh();a.aO(S,l,_),a.aS(y,n,S);const M=1-a.aV(y,y);if(M<0)return null;const O=a.aV(n,n)-1,N=-_+(_<0?1:-1)*Math.sqrt(M),j=O/N,Z=N;return{tMin:Math.min(j,Z),tMax:Math.max(j,Z)}}unprojectScreenPoint(n){const l=this._cameraPosition,_=this.getRayDirectionFromPixel(n),y=this.rayPlanetIntersection(l,_);if(y){const Z=a.bh();a.aP(Z,l,[_[0]*y.tMin,_[1]*y.tMin,_[2]*y.tMin]);const Y=a.bh();return a.aT(Y,Z),Do(Y)}const S=this._cachedClippingPlane,M=S[0]*_[0]+S[1]*_[1]+S[2]*_[2],O=-a.bt(S,l)/M,N=a.bh();if(O>0)a.aP(N,l,[_[0]*O,_[1]*O,_[2]*O]);else{const Z=a.bh();a.aP(Z,l,[2*_[0],2*_[1],2*_[2]]);const Y=a.bt(this._cachedClippingPlane,Z);a.aS(N,Z,[this._cachedClippingPlane[0]*Y,this._cachedClippingPlane[1]*Y,this._cachedClippingPlane[2]*Y])}const j=function(Z){const Y=a.bh();return Y[0]=Z[0]*-Z[3],Y[1]=Z[1]*-Z[3],Y[2]=Z[2]*-Z[3],{center:Y,radius:Math.sqrt(1-Z[3]*Z[3])}}(S);return Do(function(Z,Y,G){const re=a.bh();a.aS(re,G,Z);const ne=a.bh();return a.bi(ne,Z,re,Y/a.bj(re)),ne}(j.center,j.radius,N))}getMatrixForModel(n,l){const _=a.Q.convert(n),y=1/a.bu,S=a.b1();return a.bp(S,S,_.lng/180*Math.PI),a.a$(S,S,-_.lat/180*Math.PI),a.L(S,S,[0,0,1+l/a.bu]),a.a$(S,S,.5*Math.PI),a.M(S,S,[y,y,y]),S}getProjectionDataForCustomLayer(n=!0){const l=this.getProjectionData({overscaledTileID:new a.Y(0,0,0,0,0),applyGlobeMatrix:n});return l.tileMercatorCoords=[0,0,1,1],l}getFastPathSimpleProjectionMatrix(n){}}class yl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,l,_){return this._helper.interpolatePadding(n,l,_)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,l,_=!0){this._helper.resize(n,l,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,l){this._helper.overrideNearFarZ(n,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(n,l){this._globeness=n,this._globeLatitudeErrorCorrectionRadians=l,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new fn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,l)=>this.getConstrained(n,l)}),this._globeness=1,this._mercatorTransform=new Wa,this._verticalPerspectiveTransform=new la}clone(){const n=new yl;return n._globeness=this._globeness,n._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,n.apply(this),n}apply(n){this._helper.apply(n),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(n){const l=this._mercatorTransform.getProjectionData(n),_=this._verticalPerspectiveTransform.getProjectionData(n);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:l.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:n.applyGlobeMatrix?this._globeness:0,fallbackMatrix:l.fallbackMatrix}}isLocationOccluded(n){return this.currentTransform.isLocationOccluded(n)}transformLightDirection(n){return this.currentTransform.transformLightDirection(n)}getPixelScale(){return a.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(n,l,_){const y=this._mercatorTransform.getPitchedTextCorrection(n,l,_),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(n,l,_);return a.bc(y,S,this._globeness)}projectTileCoordinates(n,l,_,y){return this.currentTransform.projectTileCoordinates(n,l,_,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(n){return this.currentTransform.calculateFogMatrix(n)}getVisibleUnwrappedCoordinates(n){return this.currentTransform.getVisibleUnwrappedCoordinates(n)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(n){this._mercatorTransform.recalculateZoomAndCenter(n),this._verticalPerspectiveTransform.recalculateZoomAndCenter(n)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,l){return this.currentTransform.lngLatToCameraDepth(n,l)}populateCache(n){this._mercatorTransform.populateCache(n),this._verticalPerspectiveTransform.populateCache(n)}getBounds(){return this.currentTransform.getBounds()}getConstrained(n,l){return this.currentTransform.getConstrained(n,l)}calculateCenterFromCameraLngLatAlt(n,l,_,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,l,_,y)}setLocationAtPoint(n,l){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(n,l),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(n,l),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(n,l){return this.currentTransform.locationToScreenPoint(n,l)}screenPointToMercatorCoordinate(n,l){return this.currentTransform.screenPointToMercatorCoordinate(n,l)}screenPointToLocation(n,l){return this.currentTransform.screenPointToLocation(n,l)}isPointOnMapSurface(n,l){return this.currentTransform.isPointOnMapSurface(n,l)}getRayDirectionFromPixel(n){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(n)}getMatrixForModel(n,l){return this.currentTransform.getMatrixForModel(n,l)}getProjectionDataForCustomLayer(n=!0){const l=this._mercatorTransform.getProjectionDataForCustomLayer(n);if(!this.isGlobeRendering)return l;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(n);return _.fallbackMatrix=l.mainMatrix,_}getFastPathSimpleProjectionMatrix(n){return this.currentTransform.getFastPathSimpleProjectionMatrix(n)}}class bs{get useGlobeControls(){return!0}handlePanInertia(n,l){const _=_l(n,l);return Math.abs(_.lng-l.center.lng)>180&&(_.lng=l.center.lng+179.5*Math.sign(_.lng-l.center.lng)),{easingCenter:_,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(n,l){const _=n.around,y=l.screenPointToLocation(_);n.bearingDelta&&l.setBearing(l.bearing+n.bearingDelta),n.pitchDelta&&l.setPitch(l.pitch+n.pitchDelta),n.rollDelta&&l.setRoll(l.roll+n.rollDelta);const S=l.zoom;n.zoomDelta&&l.setZoom(l.zoom+n.zoomDelta);const M=l.zoom-S;if(M===0)return;const O=a.bq(l.center.lng,y.lng),N=O/(Math.abs(O/180)+1),j=a.bq(l.center.lat,y.lat),Z=l.getRayDirectionFromPixel(_),Y=l.cameraPosition,G=-1*a.aV(Y,Z),re=a.bh();a.aP(re,Y,[Z[0]*G,Z[1]*G,Z[2]*G]);const ne=a.bo(re)-1,be=Math.exp(.5*-Math.max(ne-.3,0)),ye=ko(l.worldSize,l.center.lat)/Math.min(l.width,l.height),ve=a.bf(ye,.9,.5,1,.25),Re=(1-a.ac(-M))*Math.min(be,ve),Le=l.center.lat,Oe=l.zoom,ze=new a.Q(l.center.lng+N*Re,a.ae(l.center.lat+j*Re,-85.051129,a.af));l.setLocationAtPoint(y,_);const Xe=l.center,Ve=a.bf(Math.abs(O),45,85,0,1),ct=a.bf(ye,.75,.35,0,1),St=Math.pow(Math.max(Ve,ct),.25),yt=a.bq(Xe.lng,ze.lng),bt=a.bq(Xe.lat,ze.lat);l.setCenter(new a.Q(Xe.lng+yt*St,Xe.lat+bt*St).wrap()),l.setZoom(Oe+ln(Le,l.center.lat))}handleMapControlsPan(n,l,_){if(!n.panDelta)return;const y=l.center.lat,S=l.zoom;l.setCenter(_l(n.panDelta,l).wrap()),l.setZoom(S+ln(y,l.center.lat))}cameraForBoxAndBearing(n,l,_,y,S){const M=as(n,l,_,y,S),O=l.left/S.width*2-1,N=(S.width-l.right)/S.width*2-1,j=l.top/S.height*-2+1,Z=(S.height-l.bottom)/S.height*-2+1,Y=a.bq(_.getWest(),_.getEast())<0,G=Y?_.getEast():_.getWest(),re=Y?_.getWest():_.getEast(),ne=Math.max(_.getNorth(),_.getSouth()),be=Math.min(_.getNorth(),_.getSouth()),ye=G+.5*a.bq(G,re),ve=ne+.5*a.bq(ne,be),Re=S.clone();Re.setCenter(M.center),Re.setBearing(M.bearing),Re.setPitch(0),Re.setRoll(0),Re.setZoom(M.zoom);const Le=Re.modelViewProjectionMatrix,Oe=[dn(_.getNorthWest()),dn(_.getNorthEast()),dn(_.getSouthWest()),dn(_.getSouthEast()),dn(new a.Q(re,ve)),dn(new a.Q(G,ve)),dn(new a.Q(ye,ne)),dn(new a.Q(ye,be))],ze=dn(M.center);let Xe=Number.POSITIVE_INFINITY;for(const Ve of Oe)O<0&&(Xe=bs.getLesserNonNegativeNonNull(Xe,bs.solveVectorScale(Ve,ze,Le,"x",O))),N>0&&(Xe=bs.getLesserNonNegativeNonNull(Xe,bs.solveVectorScale(Ve,ze,Le,"x",N))),j>0&&(Xe=bs.getLesserNonNegativeNonNull(Xe,bs.solveVectorScale(Ve,ze,Le,"y",j))),Z<0&&(Xe=bs.getLesserNonNegativeNonNull(Xe,bs.solveVectorScale(Ve,ze,Le,"y",Z)));if(Number.isFinite(Xe)&&Xe!==0)return M.zoom=Re.zoom+a.ah(Xe),M;Zn()}handleJumpToCenterZoom(n,l){const _=n.center.lat,y=n.getConstrained(l.center?a.Q.convert(l.center):n.center,n.zoom).center;n.setCenter(y.wrap());const S=l.zoom!==void 0?+l.zoom:n.zoom+ln(_,y.lat);n.zoom!==S&&n.setZoom(S)}handleEaseTo(n,l){const _=n.zoom,y=n.center,S=n.padding,M={roll:n.roll,pitch:n.pitch,bearing:n.bearing},O={roll:l.roll===void 0?n.roll:l.roll,pitch:l.pitch===void 0?n.pitch:l.pitch,bearing:l.bearing===void 0?n.bearing:l.bearing},N=l.zoom!==void 0,j=!n.isPaddingEqual(l.padding);let Z=!1;const Y=l.center?a.Q.convert(l.center):y,G=n.getConstrained(Y,_).center;Va(n,G);const re=n.clone();re.setCenter(G),re.setZoom(N?+l.zoom:_+ln(y.lat,Y.lat)),re.setBearing(l.bearing);const ne=new a.P(a.ae(n.centerPoint.x+l.offsetAsPoint.x,0,n.width),a.ae(n.centerPoint.y+l.offsetAsPoint.y,0,n.height));re.setLocationAtPoint(G,ne);const be=(l.offset&&l.offsetAsPoint.mag())>0?re.center:G,ye=N?+l.zoom:_+ln(y.lat,be.lat),ve=_+ln(y.lat,0),Re=ye+ln(be.lat,0),Le=a.bq(y.lng,be.lng),Oe=a.bq(y.lat,be.lat),ze=a.ac(Re-ve);return Z=ye!==_,{easeFunc:Xe=>{if(a.b6(M,O)||os({startEulerAngles:M,endEulerAngles:O,tr:n,k:Xe,useSlerp:M.roll!=O.roll}),j&&n.interpolatePadding(S,l.padding,Xe),l.around)a.w("Easing around a point is not supported under globe projection."),n.setLocationAtPoint(l.around,l.aroundPoint);else{const Ve=Re>ve?Math.min(2,ze):Math.max(.5,ze),ct=Math.pow(Ve,1-Xe),St=Bo(y,Le,Oe,Xe*ct);n.setCenter(St.wrap())}if(Z){const Ve=a.B.number(ve,Re,Xe)+ln(0,n.center.lat);n.setZoom(Ve)}},isZooming:Z,elevationCenter:be}}handleFlyTo(n,l){const _=l.zoom!==void 0,y=n.center,S=n.zoom,M=n.padding,O=!n.isPaddingEqual(l.padding),N=n.getConstrained(a.Q.convert(l.center||l.locationAtOffset),S).center,j=_?+l.zoom:n.zoom+ln(n.center.lat,N.lat),Z=n.clone();Z.setCenter(N),Z.setZoom(j),Z.setBearing(l.bearing);const Y=new a.P(a.ae(n.centerPoint.x+l.offsetAsPoint.x,0,n.width),a.ae(n.centerPoint.y+l.offsetAsPoint.y,0,n.height));Z.setLocationAtPoint(N,Y);const G=Z.center;Va(n,G);const re=function(Oe,ze,Xe){const Ve=dn(ze),ct=dn(Xe),St=a.aV(Ve,ct),yt=Math.acos(St),bt=ml(Oe);return yt/(2*Math.PI)*bt}(n,y,G),ne=S+ln(y.lat,0),be=j+ln(G.lat,0),ye=a.ac(be-ne);let ve;if(typeof l.minZoom=="number"){const Oe=+l.minZoom+ln(G.lat,0),ze=Math.min(Oe,ne,be)+ln(0,G.lat),Xe=n.getConstrained(G,ze).zoom+ln(G.lat,0);ve=a.ac(Xe-ne)}const Re=a.bq(y.lng,G.lng),Le=a.bq(y.lat,G.lat);return{easeFunc:(Oe,ze,Xe,Ve)=>{const ct=Bo(y,Re,Le,Xe);O&&n.interpolatePadding(M,l.padding,Oe);const St=Oe===1?G:ct;n.setCenter(St.wrap());const yt=ne+a.ah(ze);n.setZoom(Oe===1?j:yt+ln(0,St.lat))},scaleOfZoom:ye,targetCenter:G,scaleOfMinZoom:ve,pixelPathLength:re}}static solveVectorScale(n,l,_,y,S){const M=y==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],O=[_[3],_[7],_[11],_[15]],N=n[0]*M[0]+n[1]*M[1]+n[2]*M[2],j=n[0]*O[0]+n[1]*O[1]+n[2]*O[2],Z=l[0]*M[0]+l[1]*M[1]+l[2]*M[2],Y=l[0]*O[0]+l[1]*O[1]+l[2]*O[2];return Z+S*j===N+S*Y||O[3]*(N-Z)+M[3]*(Y-j)+N*Y==Z*j?null:(Z+M[3]-S*Y-S*O[3])/(Z-N-S*Y+S*j)}static getLesserNonNegativeNonNull(n,l){return l!==null&&l>=0&&l<n?l:n}}class ca{constructor(n){this._globe=n,this._mercatorCameraHelper=new ia,this._verticalPerspectiveCameraHelper=new bs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(n,l){return this.currentHelper.handlePanInertia(n,l)}handleMapControlsRollPitchBearingZoom(n,l){return this.currentHelper.handleMapControlsRollPitchBearingZoom(n,l)}handleMapControlsPan(n,l,_){this.currentHelper.handleMapControlsPan(n,l,_)}cameraForBoxAndBearing(n,l,_,y,S){return this.currentHelper.cameraForBoxAndBearing(n,l,_,y,S)}handleJumpToCenterZoom(n,l){this.currentHelper.handleJumpToCenterZoom(n,l)}handleEaseTo(n,l){return this.currentHelper.handleEaseTo(n,l)}handleFlyTo(n,l){return this.currentHelper.handleFlyTo(n,l)}}const Ql=(T,n)=>a.x(T,n&&n.filter(l=>l.identifier!=="source.canvas")),Tf=a.bw();class Gc extends a.E{constructor(n,l={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const y=this.sourceCaches[_].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[_].reload()}},this.map=n,this.dispatcher=new Oi(Zi(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,y)=>this.getGlyphs(_,y)),this.dispatcher.registerMessageHandler("GI",(_,y)=>this.getImages(_,y)),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new Jt(n._requestManager,l.localIdeographFontFamily),this.lineAtlas=new vt(256,512),this.crossTileSymbolIndex=new pl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.by()),Qs().on(js,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.sourceCaches[_.sourceId];if(!y)return;const S=y.getSource();if(S&&S.vectorLayerIds)for(const M in this._layers){const O=this._layers[M];O.source===S.id&&this._validateLayer(O)}})}loadURL(n,l={},_){this.fire(new a.l("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const y=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;a.j(y,this._loadStyleRequest).then(M=>{this._loadStyleRequest=null,this._load(M.data,l,_)}).catch(M=>{this._loadStyleRequest=null,M&&!S.signal.aborted&&this.fire(new a.k(M))})}loadJSON(n,l={},_){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,V.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,l.validate=l.validate!==!1,this._load(n,l,_)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Tf,{validate:!1})}_load(n,l,_){var y,S;const M=l.transformStyle?l.transformStyle(_,n):n;if(!l.validate||!Ql(this,a.y(M))){this._loaded=!0,this.stylesheet=M;for(const O in M.sources)this.addSource(O,M.sources[O],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new tt(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new dt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const n=a.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",n),this._order=n.map(l=>l.id),this._layers={},this._serializedLayers=null;for(const l of n){const _=a.bA(l);_.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=_}}_loadSprite(n,l=!1,_=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,M,O,N){return a._(this,void 0,void 0,function*(){const j=Ke(S),Z=O>1?"@2x":"",Y={},G={};for(const{id:re,url:ne}of j){const be=M.transformRequest(kt(ne,Z,".json"),"SpriteJSON");Y[re]=a.j(be,N);const ye=M.transformRequest(kt(ne,Z,".png"),"SpriteImage");G[re]=De.getImage(ye,N)}return yield Promise.all([...Object.values(Y),...Object.values(G)]),function(re,ne){return a._(this,void 0,void 0,function*(){const be={};for(const ye in re){be[ye]={};const ve=V.getImageCanvasContext((yield ne[ye]).data),Re=(yield re[ye]).data;for(const Le in Re){const{width:Oe,height:ze,x:Xe,y:Ve,sdf:ct,pixelRatio:St,stretchX:yt,stretchY:bt,content:xt,textFitWidth:ti,textFitHeight:Kt}=Re[Le];be[ye][Le]={data:null,pixelRatio:St,sdf:ct,stretchX:yt,stretchY:bt,content:xt,textFitWidth:ti,textFitHeight:Kt,spriteData:{width:Oe,height:ze,x:Xe,y:Ve,context:ve}}}}return be})}(Y,G)})}(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const M in S){this._spritesImagesIds[M]=[];const O=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(N=>!(N in S)):[];for(const N of O)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in S[M]){const j=M==="default"?N:`${M}:${N}`;this._spritesImagesIds[M].push(j),j in this.imageManager.images?this.imageManager.updateImage(j,S[M][N],!1):this.imageManager.addImage(j,S[M][N]),l&&(this._changedImages[j]=!0)}}}).catch(S=>{this._spriteRequest=null,y=S,this.fire(new a.k(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),_&&_(y)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(n){const l=this.sourceCaches[n.source];if(!l)return;const _=n.sourceLayer;if(!_)return;const y=l.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.k(new Error(`Source layer "${_}" does not exist on source "${y.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,l=!1){const _=this._serializedAllLayers();if(!n||n.length===0)return Object.values(l?a.bB(_):_);const y=[];for(const S of n)if(_[S]){const M=l?a.bB(_[S]):_[S];y.push(M)}return y}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const l=Object.keys(this._layers);for(const _ of l){const y=this._layers[_];y.type!=="custom"&&(n[_]=y.serialize())}return n}hasTransitions(){var n,l,_;if(!((n=this.light)===null||n===void 0)&&n.hasTransition()||!((l=this.sky)===null||l===void 0)&&l.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const l=this._changed;if(l){const y=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(y.length||S.length)&&this._updateWorkerLayers(y,S);for(const M in this._updatedSources){const O=this._updatedSources[M];if(O==="reload")this._reloadSource(M);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const _={};for(const y in this.sourceCaches){const S=this.sourceCaches[y];_[y]=S.used,S.used=!1}for(const y of this._order){const S=this._layers[y];S.recalculate(n,this._availableImages),!S.isHidden(n.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const y in _){const S=this.sourceCaches[y];!!_[y]!=!!S.used&&S.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(n),this.sky.recalculate(n),this.projection.recalculate(n),this.z=n.zoom,l&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,l={}){var _;this._checkLoaded();const y=this.serialize();if(n=l.transformStyle?l.transformStyle(y,n):n,((_=l.validate)===null||_===void 0||_)&&Ql(this,a.y(n)))return!1;(n=a.bB(n)).layers=a.bz(n.layers);const S=a.bC(y,n),M=this._getOperationsToPerform(S);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const O of M.operations)O();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const l=[],_=[];for(const y of n)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":l.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":l.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":l.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":l.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":l.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":l.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":l.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":l.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":l.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":l.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":l.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":l.push(()=>this.setSprite.apply(this,y.args));break;case"setTerrain":l.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setSky":l.push(()=>this.setSky.apply(this,y.args));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setTransition":l.push(()=>{});break;default:_.push(y.command)}return{operations:l,unimplemented:_}}addImage(n,l){if(this.getImage(n))return this.fire(new a.k(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,l),this._afterImageUpdated(n)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new a.k(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,l,_={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.y.source,`sources.${n}`,l,null,_))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=this.sourceCaches[n]=new ot(n,l,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:n})),y.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new a.k(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));const l=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],l.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,l){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const _=this.sourceCaches[n].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(l),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,l,_={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new a.k(new Error(`Layer "${y}" already exists on this map.`)));let S;if(n.type==="custom"){if(Ql(this,a.bD(n)))return;S=a.bA(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(y,n.source),n=a.bB(n),n=a.e(n,{source:y})),this._validate(a.y.layer,`layers.${y}`,n,{arrayIndex:-1},_))return;S=a.bA(n),this._validateLayer(S),S.setEventedParent(this,{layer:{id:y}})}const M=l?this._order.indexOf(l):this._order.length;if(l&&M===-1)this.fire(new a.k(new Error(`Cannot add layer "${y}" before non-existing layer "${l}".`)));else{if(this._order.splice(M,0,y),this._layerOrderChanged=!0,this._layers[y]=S,this._removedLayers[y]&&S.source&&S.type!=="custom"){const O=this._removedLayers[y];delete this._removedLayers[y],O.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.k(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const _=this._order.indexOf(n);this._order.splice(_,1);const y=l?this._order.indexOf(l):this._order.length;l&&y===-1?this.fire(new a.k(new Error(`Cannot move layer "${n}" before non-existing layer "${l}".`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${n}".`)));l.setEventedParent(null);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,l,_){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===l&&y.maxzoom===_||(l!=null&&(y.minzoom=l),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,l,_={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!a.bE(y.filter,l))return l==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.y.filter,`layers.${y.id}.filter`,l,null,_)||(y.filter=a.bB(l),this._updateLayer(y)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return a.bB(this.getLayer(n).filter)}setLayoutProperty(n,l,_,y={}){this._checkLoaded();const S=this.getLayer(n);S?a.bE(S.getLayoutProperty(l),_)||(S.setLayoutProperty(l,_,y),this._updateLayer(S)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,l){const _=this.getLayer(n);if(_)return _.getLayoutProperty(l);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,l,_,y={}){this._checkLoaded();const S=this.getLayer(n);S?a.bE(S.getPaintProperty(l),_)||(S.setPaintProperty(l,_,y)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[n]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,l){return this.getLayer(n).getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const _=n.source,y=n.sourceLayer,S=this.sourceCaches[_];if(S===void 0)return void this.fire(new a.k(new Error(`The source '${_}' does not exist in the map's style.`)));const M=S.getSource().type;M==="geojson"&&y?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||y?(n.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(y,n.id,l)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,l){this._checkLoaded();const _=n.source,y=this.sourceCaches[_];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${_}' does not exist in the map's style.`)));const S=y.getSource().type,M=S==="vector"?n.sourceLayer:void 0;S!=="vector"||M?l&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(M,n.id,l):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const l=n.source,_=n.sourceLayer,y=this.sourceCaches[l];if(y!==void 0)return y.getSource().type!=="vector"||_?(n.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.getFeatureState(_,n.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=a.bF(this.sourceCaches,S=>S.serialize()),l=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,y=this.stylesheet;return a.bG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:n,layers:l,terrain:_},S=>S!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const l=M=>this._layers[M].type==="fill-extrusion",_={},y=[];for(let M=this._order.length-1;M>=0;M--){const O=this._order[M];if(l(O)){_[O]=M;for(const N of n){const j=N[O];if(j)for(const Z of j)y.push(Z)}}}y.sort((M,O)=>O.intersectionZ-M.intersectionZ);const S=[];for(let M=this._order.length-1;M>=0;M--){const O=this._order[M];if(l(O))for(let N=y.length-1;N>=0;N--){const j=y[N].feature;if(_[j.layer.id]<M)break;S.push(j),y.pop()}else for(const N of n){const j=N[O];if(j)for(const Z of j)S.push(Z.feature)}}return S}queryRenderedFeatures(n,l,_){l&&l.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",l.filter,null,l);const y={};if(l&&l.layers){if(!(Array.isArray(l.layers)||l.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const j of l.layers){const Z=this._layers[j];if(!Z)return this.fire(new a.k(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];y[Z.source]=!0}}const S=[];l.availableImages=this._availableImages;const M=this._serializedAllLayers(),O=l.layers instanceof Set?l.layers:Array.isArray(l.layers)?new Set(l.layers):null,N=Object.assign(Object.assign({},l),{layers:O});for(const j in this.sourceCaches)l.layers&&!y[j]||S.push(Yi(this.sourceCaches[j],this._layers,M,n,N,_,this.map.terrain?(Z,Y,G)=>this.map.terrain.getElevation(Z,Y,G):void 0));return this.placement&&S.push(function(j,Z,Y,G,re,ne,be){const ye={},ve=ne.queryRenderedSymbols(G),Re=[];for(const Le of Object.keys(ve).map(Number))Re.push(be[Le]);Re.sort(Fi);for(const Le of Re){const Oe=Le.featureIndex.lookupSymbolFeatures(ve[Le.bucketInstanceId],Z,Le.bucketIndex,Le.sourceLayerIndex,re.filter,re.layers,re.availableImages,j);for(const ze in Oe){const Xe=ye[ze]=ye[ze]||[],Ve=Oe[ze];Ve.sort((ct,St)=>{const yt=Le.featureSortOrder;if(yt){const bt=yt.indexOf(ct.featureIndex);return yt.indexOf(St.featureIndex)-bt}return St.featureIndex-ct.featureIndex});for(const ct of Ve)Xe.push(ct)}}return function(Le,Oe,ze){for(const Xe in Le)for(const Ve of Le[Xe])wr(Ve,ze[Oe[Xe].source]);return Le}(ye,j,Y)}(this._layers,M,this.sourceCaches,n,N,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(n,l){l&&l.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",l.filter,null,l);const _=this.sourceCaches[n];return _?function(y,S){const M=y.getRenderableIds().map(j=>y.getTileByID(j)),O=[],N={};for(let j=0;j<M.length;j++){const Z=M[j],Y=Z.tileID.canonical.key;N[Y]||(N[Y]=!0,Z.querySourceFeatures(O,S))}return O}(_,l):[]}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const M in n)if(!a.bE(n[M],_[M])){y=!0;break}if(!y)return;const S={now:V.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,l),this.light.updateTransitions(S)}getProjection(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.projection}setProjection(n){if(this._checkLoaded(),this.projection){if(this.projection.name===n.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=n,this._setProjectionInternal(n.type)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,l={}){this._checkLoaded();const _=this.getSky();let y=!1;if(!n&&!_)return;if(n&&!_)y=!0;else if(!n&&_)y=!0;else for(const M in n)if(!a.bE(n[M],_[M])){y=!0;break}if(!y)return;const S={now:V.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,l),this.sky.updateTransitions(S)}_setProjectionInternal(n){const l=function(_){if(Array.isArray(_)){const y=new sa({type:_});return{projection:y,transform:new yl,cameraHelper:new ca(y)}}switch(_){case"mercator":return{projection:new ja,transform:new Wa,cameraHelper:new ia};case"globe":{const y=new sa({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new yl,cameraHelper:new ca(y)}}case"vertical-perspective":return{projection:new na,transform:new la,cameraHelper:new bs};default:return a.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new ja,transform:new Wa,cameraHelper:new ia}}}(n);this.projection=l.projection,this.map.migrateProjection(l.transform,l.cameraHelper);for(const _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(n,l,_,y,S={}){return(!S||S.validate!==!1)&&Ql(this,n.call(a.y,a.e({key:l,style:this.serialize(),value:_,styleSpec:a.v},y)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Qs().off(js,this._rtlPluginLoaded);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const _=this.sourceCaches[l];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const l in this.sourceCaches)this.sourceCaches[l].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,l,_,y,S=!1){let M=!1,O=!1;const N={};for(const j of this._order){const Z=this._layers[j];if(Z.type!=="symbol")continue;if(!N[Z.source]){const G=this.sourceCaches[Z.source];N[Z.source]=G.getRenderableIds(!0).map(re=>G.getTileByID(re)).sort((re,ne)=>ne.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ne.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(Z,N[Z.source],n.center.lng);M=M||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(V.now(),n.zoom))&&(this.pauseablePlacement=new Zc(n,this.map.terrain,this._order,S,l,_,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(V.now()),O=!0),M&&this.pauseablePlacement.placement.setStale()),O||M)for(const j of this._order){const Z=this._layers[j];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,N[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(V.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l){return a._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(l.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[l.source];return y&&y.setDependencies(l.tileID.key,l.type,l.icons),_})}getGlyphs(n,l){return a._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(l.stacks),y=this.sourceCaches[l.source];return y&&y.setDependencies(l.tileID.key,l.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,l={}){this._checkLoaded(),n&&this._validate(a.y.glyphs,"glyphs",n,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,l,_={},y){this._checkLoaded();const S=[{id:n,url:l}],M=[...Ke(this.stylesheet.sprite),...S];this._validate(a.y.sprite,"sprite",M,null,_)||(this.stylesheet.sprite=M,this._loadSprite(S,!0,y))}removeSprite(n){this._checkLoaded();const l=Ke(this.stylesheet.sprite);if(l.find(_=>_.id===n)){if(this._spritesImagesIds[n])for(const _ of this._spritesImagesIds[n])this.imageManager.removeImage(_),this._changedImages[_]=!0;l.splice(l.findIndex(_=>_.id===n),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return Ke(this.stylesheet.sprite)}setSprite(n,l={},_){this._checkLoaded(),n&&this._validate(a.y.sprite,"sprite",n,null,l)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,_):(this._unloadSprite(),_&&_(null)))}}var Sf=a.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ef{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,l,_,y,S,M,O,N,j){this.context=n;let Z=this.boundPaintVertexBuffers.length!==y.length;for(let Y=0;!Z&&Y<y.length;Y++)this.boundPaintVertexBuffers[Y]!==y[Y]&&(Z=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==_||Z||this.boundIndexBuffer!==S||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==O||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==j?this.freshBind(l,_,y,S,M,O,N,j):(n.bindVertexArray.set(this.vao),O&&O.bind(),S&&S.dynamicDraw&&S.bind(),N&&N.bind(),j&&j.bind())}freshBind(n,l,_,y,S,M,O,N){const j=n.numAttributes,Z=this.context,Y=Z.gl;this.vao&&this.destroy(),this.vao=Z.createVertexArray(),Z.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=N,l.enableAttributes(Y,n);for(const G of _)G.enableAttributes(Y,n);M&&M.enableAttributes(Y,n),O&&O.enableAttributes(Y,n),N&&N.enableAttributes(Y,n),l.bind(),l.setVertexAttribPointers(Y,n,S);for(const G of _)G.bind(),G.setVertexAttribPointers(Y,n,S);M&&(M.bind(),M.setVertexAttribPointers(Y,n,S)),y&&y.bind(),O&&(O.bind(),O.setVertexAttribPointers(Y,n,S)),N&&(N.bind(),N.setVertexAttribPointers(Y,n,S)),Z.currentNumAttributes=j}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Cf=(T,n,l,_,y)=>({u_texture:0,u_ele_delta:T,u_fog_matrix:n,u_fog_color:l?l.properties.get("fog-color"):a.b7.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:l?l.calculateFogBlendOpacity(_):0,u_horizon_color:l?l.properties.get("horizon-color"):a.b7.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),Kl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function co(T){const n=[];for(let l=0;l<T.length;l++){if(T[l]===null)continue;const _=T[l].split(" ");n.push(_.pop())}return n}class Jl{constructor(n,l,_,y,S,M,O,N,j=[]){const Z=n.gl;this.program=Z.createProgram();const Y=co(l.staticAttributes),G=_?_.getBinderAttributes():[],re=Y.concat(G),ne=kn.prelude.staticUniforms?co(kn.prelude.staticUniforms):[],be=O.staticUniforms?co(O.staticUniforms):[],ye=l.staticUniforms?co(l.staticUniforms):[],ve=_?_.getBinderUniforms():[],Re=ne.concat(be).concat(ye).concat(ve),Le=[];for(const yt of Re)Le.indexOf(yt)<0&&Le.push(yt);const Oe=_?_.defines():[];Dn(Z)&&Oe.unshift("#version 300 es"),S&&Oe.push("#define OVERDRAW_INSPECTOR;"),M&&Oe.push("#define TERRAIN3D;"),N&&Oe.push(N),j&&Oe.push(...j);let ze=Oe.concat(kn.prelude.fragmentSource,O.fragmentSource,l.fragmentSource).join(`
`),Xe=Oe.concat(kn.prelude.vertexSource,O.vertexSource,l.vertexSource).join(`
`);Dn(Z)||(ze=function(yt){return yt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ze),Xe=function(yt){return yt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Xe));const Ve=Z.createShader(Z.FRAGMENT_SHADER);if(Z.isContextLost())return void(this.failedToCreate=!0);if(Z.shaderSource(Ve,ze),Z.compileShader(Ve),!Z.getShaderParameter(Ve,Z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${Z.getShaderInfoLog(Ve)}`);Z.attachShader(this.program,Ve);const ct=Z.createShader(Z.VERTEX_SHADER);if(Z.isContextLost())return void(this.failedToCreate=!0);if(Z.shaderSource(ct,Xe),Z.compileShader(ct),!Z.getShaderParameter(ct,Z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${Z.getShaderInfoLog(ct)}`);Z.attachShader(this.program,ct),this.attributes={};const St={};this.numAttributes=re.length;for(let yt=0;yt<this.numAttributes;yt++)re[yt]&&(Z.bindAttribLocation(this.program,yt,re[yt]),this.attributes[re[yt]]=yt);if(Z.linkProgram(this.program),!Z.getProgramParameter(this.program,Z.LINK_STATUS))throw new Error(`Program failed to link: ${Z.getProgramInfoLog(this.program)}`);Z.deleteShader(ct),Z.deleteShader(Ve);for(let yt=0;yt<Le.length;yt++){const bt=Le[yt];if(bt&&!St[bt]){const xt=Z.getUniformLocation(this.program,bt);xt&&(St[bt]=xt)}}this.fixedUniforms=y(n,St),this.terrainUniforms=((yt,bt)=>({u_depth:new a.bH(yt,bt.u_depth),u_terrain:new a.bH(yt,bt.u_terrain),u_terrain_dim:new a.b8(yt,bt.u_terrain_dim),u_terrain_matrix:new a.bJ(yt,bt.u_terrain_matrix),u_terrain_unpack:new a.bK(yt,bt.u_terrain_unpack),u_terrain_exaggeration:new a.b8(yt,bt.u_terrain_exaggeration)}))(n,St),this.projectionUniforms=((yt,bt)=>({u_projection_matrix:new a.bJ(yt,bt.u_projection_matrix),u_projection_tile_mercator_coords:new a.bK(yt,bt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bK(yt,bt.u_projection_clipping_plane),u_projection_transition:new a.b8(yt,bt.u_projection_transition),u_projection_fallback_matrix:new a.bJ(yt,bt.u_projection_fallback_matrix)}))(n,St),this.binderUniforms=_?_.getUniforms(n,St):[]}draw(n,l,_,y,S,M,O,N,j,Z,Y,G,re,ne,be,ye,ve,Re,Le){const Oe=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(y),n.setColorMode(S),n.setCullFace(M),N){n.activeTexture.set(Oe.TEXTURE2),Oe.bindTexture(Oe.TEXTURE_2D,N.depthTexture),n.activeTexture.set(Oe.TEXTURE3),Oe.bindTexture(Oe.TEXTURE_2D,N.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(N[Xe])}if(j)for(const Xe in j)this.projectionUniforms[Kl[Xe]].set(j[Xe]);if(O)for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(O[Xe]);ye&&ye.setUniforms(n,this.binderUniforms,ne,{zoom:be});let ze=0;switch(l){case Oe.LINES:ze=2;break;case Oe.TRIANGLES:ze=3;break;case Oe.LINE_STRIP:ze=1}for(const Xe of re.get()){const Ve=Xe.vaos||(Xe.vaos={});(Ve[Z]||(Ve[Z]=new Ef)).bind(n,this,Y,ye?ye.getPaintVertexBuffers():[],G,Xe.vertexOffset,ve,Re,Le),Oe.drawElements(l,Xe.primitiveLength*ze,Oe.UNSIGNED_SHORT,Xe.primitiveOffset*ze*2)}}}function ec(T,n,l){const _=1/a.az(l,1,n.transform.tileZoom),y=Math.pow(2,l.tileID.overscaledZ),S=l.tileSize*Math.pow(2,n.transform.tileZoom)/y,M=S*(l.tileID.canonical.x+l.tileID.wrap*y),O=S*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[_,T.fromScale,T.toScale],u_fade:T.t,u_pixel_coord_upper:[M>>16,O>>16],u_pixel_coord_lower:[65535&M,65535&O]}}const tc=(T,n,l,_)=>{const y=T.style.light,S=y.properties.get("position"),M=[S.x,S.y,S.z],O=a.bN();y.properties.get("anchor")==="viewport"&&a.bO(O,T.transform.bearingInRadians),a.bP(M,M,O);const N=T.transform.transformLightDirection(M),j=y.properties.get("color");return{u_lightpos:M,u_lightpos_globe:N,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+n,u_opacity:l,u_fill_translate:_}},cs=(T,n,l,_,y,S,M)=>a.e(tc(T,n,l,_),ec(S,T,M),{u_height_factor:-Math.pow(2,y.overscaledZ)/M.tileSize/8}),th=(T,n,l,_)=>a.e(ec(n,T,l),{u_fill_translate:_}),bl=(T,n)=>({u_world:T,u_fill_translate:n}),$a=(T,n,l,_,y)=>a.e(th(T,n,l,y),{u_world:_}),eo=(T,n,l,_,y)=>{const S=T.transform;let M,O,N=0;if(l.paint.get("circle-pitch-alignment")==="map"){const j=a.az(n,1,S.zoom);M=!0,O=[j,j],N=j/(a.Z*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*y}else M=!1,O=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+M,u_device_pixel_ratio:T.pixelRatio,u_extrude_scale:O,u_globe_extrude_scale:N,u_translate:_}},If=T=>({u_pixel_extrude_scale:[1/T.width,1/T.height]}),Za=T=>({u_viewport_size:[T.width,T.height]}),Yc=(T,n=1)=>({u_color:T,u_overlay:0,u_overlay_scale:n}),ua=(T,n,l,_)=>{const y=a.az(T,1,n)/(a.Z*Math.pow(2,T.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:a.az(T,1,n),u_intensity:l,u_globe_extrude_scale:y}},Qc=(T,n,l,_)=>{const y=a.K();a.bQ(y,0,T.width,T.height,0,0,1);const S=T.context.gl;return{u_matrix:y,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:l,u_color_ramp:_,u_opacity:n.paint.get("heatmap-opacity")}},ic=(T,n,l)=>{const _=l.paint.get("hillshade-accent-color");let y;switch(l.paint.get("hillshade-method")){case"basic":y=4;break;case"combined":y=1;break;case"igor":y=2;break;case"multidirectional":y=3;break;default:y=0}const S=l.getIlluminationProperties();for(let M=0;M<S.directionRadians.length;M++)l.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[M]+=T.transform.bearingInRadians);return{u_image:0,u_latrange:rc(0,n.tileID),u_exaggeration:l.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:_,u_method:y,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},Kc=(T,n)=>{const l=n.stride,_=a.K();return a.bQ(_,0,a.Z,-8192,0,0,1),a.L(_,_,[0,-8192,0]),{u_matrix:_,u_image:1,u_dimension:[l,l],u_zoom:T.overscaledZ,u_unpack:n.getUnpackVector()}};function rc(T,n){const l=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new a.$(0,_/l).toLngLat().lat,new a.$(0,(_+1)/l).toLngLat().lat]}const uo=(T,n,l,_)=>{const y=T.transform;return{u_translation:Lo(T,n,l),u_ratio:_/a.az(n,1,y.zoom),u_device_pixel_ratio:T.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Ir=(T,n,l,_,y)=>a.e(uo(T,n,l,_),{u_image:0,u_image_height:y}),ih=(T,n,l,_,y)=>{const S=T.transform,M=nc(n,S);return{u_translation:Lo(T,n,l),u_texsize:n.imageAtlasTexture.size,u_ratio:_/a.az(n,1,S.zoom),u_device_pixel_ratio:T.pixelRatio,u_image:0,u_scale:[M,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Jc=(T,n,l,_,y,S)=>{const M=T.lineAtlas,O=nc(n,T.transform),N=l.layout.get("line-cap")==="round",j=M.getDash(y.from,N),Z=M.getDash(y.to,N),Y=j.width*S.fromScale,G=Z.width*S.toScale;return a.e(uo(T,n,l,_),{u_patternscale_a:[O/Y,-j.height/2],u_patternscale_b:[O/G,-Z.height/2],u_sdfgamma:M.width/(256*Math.min(Y,G)*T.pixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:Z.y,u_mix:S.t})};function nc(T,n){return 1/a.az(T,1,n.tileZoom)}function Lo(T,n,l){return a.aA(T.transform,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const rh=(T,n,l,_,y)=>{return{u_tl_parent:T,u_scale_parent:n,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(M=_.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(S=_.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:nh(_.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var S,M};function nh(T){T*=Math.PI/180;const n=Math.sin(T),l=Math.cos(T);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const qa=(T,n,l,_,y,S,M,O,N,j,Z,Y,G)=>{const re=M.transform;return{u_is_size_zoom_constant:+(T==="constant"||T==="source"),u_is_size_feature_constant:+(T==="constant"||T==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_pitch:re.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:re.width/re.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_label_plane_matrix:O,u_coord_matrix:N,u_is_text:+Z,u_pitch_with_map:+_,u_is_along_line:y,u_is_variable_anchor:S,u_texsize:Y,u_texture:0,u_translation:j,u_pitched_scale:G}},qn=(T,n,l,_,y,S,M,O,N,j,Z,Y,G,re)=>{const ne=M.transform;return a.e(qa(T,n,l,_,y,S,M,O,N,j,Z,Y,re),{u_gamma_scale:_?Math.cos(ne.pitch*Math.PI/180)*ne.cameraToCenterDistance:1,u_device_pixel_ratio:M.pixelRatio,u_is_halo:1})},Xa=(T,n,l,_,y,S,M,O,N,j,Z,Y,G)=>a.e(qn(T,n,l,_,y,S,M,O,N,j,!0,Z,0,G),{u_texsize_icon:Y,u_texture_icon:1}),ha=(T,n)=>({u_opacity:T,u_color:n}),Pf=(T,n,l,_,y)=>a.e(function(S,M,O,N){const j=O.imageManager.getPattern(S.from.toString()),Z=O.imageManager.getPattern(S.to.toString()),{width:Y,height:G}=O.imageManager.getPixelSize(),re=Math.pow(2,N.tileID.overscaledZ),ne=N.tileSize*Math.pow(2,O.transform.tileZoom)/re,be=ne*(N.tileID.canonical.x+N.tileID.wrap*re),ye=ne*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[Y,G],u_mix:M.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/a.az(N,1,O.transform.tileZoom),u_pixel_coord_upper:[be>>16,ye>>16],u_pixel_coord_lower:[65535&be,65535&ye]}}(l,y,n,_),{u_opacity:T}),vl=(T,n)=>{},sh={fillExtrusion:(T,n)=>({u_lightpos:new a.bL(T,n.u_lightpos),u_lightpos_globe:new a.bL(T,n.u_lightpos_globe),u_lightintensity:new a.b8(T,n.u_lightintensity),u_lightcolor:new a.bL(T,n.u_lightcolor),u_vertical_gradient:new a.b8(T,n.u_vertical_gradient),u_opacity:new a.b8(T,n.u_opacity),u_fill_translate:new a.bM(T,n.u_fill_translate)}),fillExtrusionPattern:(T,n)=>({u_lightpos:new a.bL(T,n.u_lightpos),u_lightpos_globe:new a.bL(T,n.u_lightpos_globe),u_lightintensity:new a.b8(T,n.u_lightintensity),u_lightcolor:new a.bL(T,n.u_lightcolor),u_vertical_gradient:new a.b8(T,n.u_vertical_gradient),u_height_factor:new a.b8(T,n.u_height_factor),u_opacity:new a.b8(T,n.u_opacity),u_fill_translate:new a.bM(T,n.u_fill_translate),u_image:new a.bH(T,n.u_image),u_texsize:new a.bM(T,n.u_texsize),u_pixel_coord_upper:new a.bM(T,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(T,n.u_pixel_coord_lower),u_scale:new a.bL(T,n.u_scale),u_fade:new a.b8(T,n.u_fade)}),fill:(T,n)=>({u_fill_translate:new a.bM(T,n.u_fill_translate)}),fillPattern:(T,n)=>({u_image:new a.bH(T,n.u_image),u_texsize:new a.bM(T,n.u_texsize),u_pixel_coord_upper:new a.bM(T,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(T,n.u_pixel_coord_lower),u_scale:new a.bL(T,n.u_scale),u_fade:new a.b8(T,n.u_fade),u_fill_translate:new a.bM(T,n.u_fill_translate)}),fillOutline:(T,n)=>({u_world:new a.bM(T,n.u_world),u_fill_translate:new a.bM(T,n.u_fill_translate)}),fillOutlinePattern:(T,n)=>({u_world:new a.bM(T,n.u_world),u_image:new a.bH(T,n.u_image),u_texsize:new a.bM(T,n.u_texsize),u_pixel_coord_upper:new a.bM(T,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(T,n.u_pixel_coord_lower),u_scale:new a.bL(T,n.u_scale),u_fade:new a.b8(T,n.u_fade),u_fill_translate:new a.bM(T,n.u_fill_translate)}),circle:(T,n)=>({u_camera_to_center_distance:new a.b8(T,n.u_camera_to_center_distance),u_scale_with_map:new a.bH(T,n.u_scale_with_map),u_pitch_with_map:new a.bH(T,n.u_pitch_with_map),u_extrude_scale:new a.bM(T,n.u_extrude_scale),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_globe_extrude_scale:new a.b8(T,n.u_globe_extrude_scale),u_translate:new a.bM(T,n.u_translate)}),collisionBox:(T,n)=>({u_pixel_extrude_scale:new a.bM(T,n.u_pixel_extrude_scale)}),collisionCircle:(T,n)=>({u_viewport_size:new a.bM(T,n.u_viewport_size)}),debug:(T,n)=>({u_color:new a.bI(T,n.u_color),u_overlay:new a.bH(T,n.u_overlay),u_overlay_scale:new a.b8(T,n.u_overlay_scale)}),depth:vl,clippingMask:vl,heatmap:(T,n)=>({u_extrude_scale:new a.b8(T,n.u_extrude_scale),u_intensity:new a.b8(T,n.u_intensity),u_globe_extrude_scale:new a.b8(T,n.u_globe_extrude_scale)}),heatmapTexture:(T,n)=>({u_matrix:new a.bJ(T,n.u_matrix),u_world:new a.bM(T,n.u_world),u_image:new a.bH(T,n.u_image),u_color_ramp:new a.bH(T,n.u_color_ramp),u_opacity:new a.b8(T,n.u_opacity)}),hillshade:(T,n)=>({u_image:new a.bH(T,n.u_image),u_latrange:new a.bM(T,n.u_latrange),u_exaggeration:new a.b8(T,n.u_exaggeration),u_altitudes:new a.bS(T,n.u_altitudes),u_azimuths:new a.bS(T,n.u_azimuths),u_accent:new a.bI(T,n.u_accent),u_method:new a.bH(T,n.u_method),u_shadows:new a.bR(T,n.u_shadows),u_highlights:new a.bR(T,n.u_highlights)}),hillshadePrepare:(T,n)=>({u_matrix:new a.bJ(T,n.u_matrix),u_image:new a.bH(T,n.u_image),u_dimension:new a.bM(T,n.u_dimension),u_zoom:new a.b8(T,n.u_zoom),u_unpack:new a.bK(T,n.u_unpack)}),line:(T,n)=>({u_translation:new a.bM(T,n.u_translation),u_ratio:new a.b8(T,n.u_ratio),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_units_to_pixels:new a.bM(T,n.u_units_to_pixels)}),lineGradient:(T,n)=>({u_translation:new a.bM(T,n.u_translation),u_ratio:new a.b8(T,n.u_ratio),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_units_to_pixels:new a.bM(T,n.u_units_to_pixels),u_image:new a.bH(T,n.u_image),u_image_height:new a.b8(T,n.u_image_height)}),linePattern:(T,n)=>({u_translation:new a.bM(T,n.u_translation),u_texsize:new a.bM(T,n.u_texsize),u_ratio:new a.b8(T,n.u_ratio),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_image:new a.bH(T,n.u_image),u_units_to_pixels:new a.bM(T,n.u_units_to_pixels),u_scale:new a.bL(T,n.u_scale),u_fade:new a.b8(T,n.u_fade)}),lineSDF:(T,n)=>({u_translation:new a.bM(T,n.u_translation),u_ratio:new a.b8(T,n.u_ratio),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_units_to_pixels:new a.bM(T,n.u_units_to_pixels),u_patternscale_a:new a.bM(T,n.u_patternscale_a),u_patternscale_b:new a.bM(T,n.u_patternscale_b),u_sdfgamma:new a.b8(T,n.u_sdfgamma),u_image:new a.bH(T,n.u_image),u_tex_y_a:new a.b8(T,n.u_tex_y_a),u_tex_y_b:new a.b8(T,n.u_tex_y_b),u_mix:new a.b8(T,n.u_mix)}),raster:(T,n)=>({u_tl_parent:new a.bM(T,n.u_tl_parent),u_scale_parent:new a.b8(T,n.u_scale_parent),u_buffer_scale:new a.b8(T,n.u_buffer_scale),u_fade_t:new a.b8(T,n.u_fade_t),u_opacity:new a.b8(T,n.u_opacity),u_image0:new a.bH(T,n.u_image0),u_image1:new a.bH(T,n.u_image1),u_brightness_low:new a.b8(T,n.u_brightness_low),u_brightness_high:new a.b8(T,n.u_brightness_high),u_saturation_factor:new a.b8(T,n.u_saturation_factor),u_contrast_factor:new a.b8(T,n.u_contrast_factor),u_spin_weights:new a.bL(T,n.u_spin_weights),u_coords_top:new a.bK(T,n.u_coords_top),u_coords_bottom:new a.bK(T,n.u_coords_bottom)}),symbolIcon:(T,n)=>({u_is_size_zoom_constant:new a.bH(T,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(T,n.u_is_size_feature_constant),u_size_t:new a.b8(T,n.u_size_t),u_size:new a.b8(T,n.u_size),u_camera_to_center_distance:new a.b8(T,n.u_camera_to_center_distance),u_pitch:new a.b8(T,n.u_pitch),u_rotate_symbol:new a.bH(T,n.u_rotate_symbol),u_aspect_ratio:new a.b8(T,n.u_aspect_ratio),u_fade_change:new a.b8(T,n.u_fade_change),u_label_plane_matrix:new a.bJ(T,n.u_label_plane_matrix),u_coord_matrix:new a.bJ(T,n.u_coord_matrix),u_is_text:new a.bH(T,n.u_is_text),u_pitch_with_map:new a.bH(T,n.u_pitch_with_map),u_is_along_line:new a.bH(T,n.u_is_along_line),u_is_variable_anchor:new a.bH(T,n.u_is_variable_anchor),u_texsize:new a.bM(T,n.u_texsize),u_texture:new a.bH(T,n.u_texture),u_translation:new a.bM(T,n.u_translation),u_pitched_scale:new a.b8(T,n.u_pitched_scale)}),symbolSDF:(T,n)=>({u_is_size_zoom_constant:new a.bH(T,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(T,n.u_is_size_feature_constant),u_size_t:new a.b8(T,n.u_size_t),u_size:new a.b8(T,n.u_size),u_camera_to_center_distance:new a.b8(T,n.u_camera_to_center_distance),u_pitch:new a.b8(T,n.u_pitch),u_rotate_symbol:new a.bH(T,n.u_rotate_symbol),u_aspect_ratio:new a.b8(T,n.u_aspect_ratio),u_fade_change:new a.b8(T,n.u_fade_change),u_label_plane_matrix:new a.bJ(T,n.u_label_plane_matrix),u_coord_matrix:new a.bJ(T,n.u_coord_matrix),u_is_text:new a.bH(T,n.u_is_text),u_pitch_with_map:new a.bH(T,n.u_pitch_with_map),u_is_along_line:new a.bH(T,n.u_is_along_line),u_is_variable_anchor:new a.bH(T,n.u_is_variable_anchor),u_texsize:new a.bM(T,n.u_texsize),u_texture:new a.bH(T,n.u_texture),u_gamma_scale:new a.b8(T,n.u_gamma_scale),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_is_halo:new a.bH(T,n.u_is_halo),u_translation:new a.bM(T,n.u_translation),u_pitched_scale:new a.b8(T,n.u_pitched_scale)}),symbolTextAndIcon:(T,n)=>({u_is_size_zoom_constant:new a.bH(T,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bH(T,n.u_is_size_feature_constant),u_size_t:new a.b8(T,n.u_size_t),u_size:new a.b8(T,n.u_size),u_camera_to_center_distance:new a.b8(T,n.u_camera_to_center_distance),u_pitch:new a.b8(T,n.u_pitch),u_rotate_symbol:new a.bH(T,n.u_rotate_symbol),u_aspect_ratio:new a.b8(T,n.u_aspect_ratio),u_fade_change:new a.b8(T,n.u_fade_change),u_label_plane_matrix:new a.bJ(T,n.u_label_plane_matrix),u_coord_matrix:new a.bJ(T,n.u_coord_matrix),u_is_text:new a.bH(T,n.u_is_text),u_pitch_with_map:new a.bH(T,n.u_pitch_with_map),u_is_along_line:new a.bH(T,n.u_is_along_line),u_is_variable_anchor:new a.bH(T,n.u_is_variable_anchor),u_texsize:new a.bM(T,n.u_texsize),u_texsize_icon:new a.bM(T,n.u_texsize_icon),u_texture:new a.bH(T,n.u_texture),u_texture_icon:new a.bH(T,n.u_texture_icon),u_gamma_scale:new a.b8(T,n.u_gamma_scale),u_device_pixel_ratio:new a.b8(T,n.u_device_pixel_ratio),u_is_halo:new a.bH(T,n.u_is_halo),u_translation:new a.bM(T,n.u_translation),u_pitched_scale:new a.b8(T,n.u_pitched_scale)}),background:(T,n)=>({u_opacity:new a.b8(T,n.u_opacity),u_color:new a.bI(T,n.u_color)}),backgroundPattern:(T,n)=>({u_opacity:new a.b8(T,n.u_opacity),u_image:new a.bH(T,n.u_image),u_pattern_tl_a:new a.bM(T,n.u_pattern_tl_a),u_pattern_br_a:new a.bM(T,n.u_pattern_br_a),u_pattern_tl_b:new a.bM(T,n.u_pattern_tl_b),u_pattern_br_b:new a.bM(T,n.u_pattern_br_b),u_texsize:new a.bM(T,n.u_texsize),u_mix:new a.b8(T,n.u_mix),u_pattern_size_a:new a.bM(T,n.u_pattern_size_a),u_pattern_size_b:new a.bM(T,n.u_pattern_size_b),u_scale_a:new a.b8(T,n.u_scale_a),u_scale_b:new a.b8(T,n.u_scale_b),u_pixel_coord_upper:new a.bM(T,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bM(T,n.u_pixel_coord_lower),u_tile_units_to_pixels:new a.b8(T,n.u_tile_units_to_pixels)}),terrain:(T,n)=>({u_texture:new a.bH(T,n.u_texture),u_ele_delta:new a.b8(T,n.u_ele_delta),u_fog_matrix:new a.bJ(T,n.u_fog_matrix),u_fog_color:new a.bI(T,n.u_fog_color),u_fog_ground_blend:new a.b8(T,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.b8(T,n.u_fog_ground_blend_opacity),u_horizon_color:new a.bI(T,n.u_horizon_color),u_horizon_fog_blend:new a.b8(T,n.u_horizon_fog_blend),u_is_globe_mode:new a.b8(T,n.u_is_globe_mode)}),terrainDepth:(T,n)=>({u_ele_delta:new a.b8(T,n.u_ele_delta)}),terrainCoords:(T,n)=>({u_texture:new a.bH(T,n.u_texture),u_terrain_coords_id:new a.b8(T,n.u_terrain_coords_id),u_ele_delta:new a.b8(T,n.u_ele_delta)}),projectionErrorMeasurement:(T,n)=>({u_input:new a.b8(T,n.u_input),u_output_expected:new a.b8(T,n.u_output_expected)}),atmosphere:(T,n)=>({u_sun_pos:new a.bL(T,n.u_sun_pos),u_atmosphere_blend:new a.b8(T,n.u_atmosphere_blend),u_globe_position:new a.bL(T,n.u_globe_position),u_globe_radius:new a.b8(T,n.u_globe_radius),u_inv_proj_matrix:new a.bJ(T,n.u_inv_proj_matrix)}),sky:(T,n)=>({u_sky_color:new a.bI(T,n.u_sky_color),u_horizon_color:new a.bI(T,n.u_horizon_color),u_horizon:new a.bM(T,n.u_horizon),u_horizon_normal:new a.bM(T,n.u_horizon_normal),u_sky_horizon_blend:new a.b8(T,n.u_sky_horizon_blend),u_sky_blend:new a.b8(T,n.u_sky_blend)})};class vs{constructor(n,l,_){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sc{constructor(n,l,_,y){this.length=l.length,this.attributes=_,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.context=n;const S=n.gl;this.buffer=S.createBuffer(),n.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let _=0;_<this.attributes.length;_++){const y=l.attributes[this.attributes[_].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,l,_){for(let y=0;y<this.attributes.length;y++){const S=this.attributes[y],M=l.attributes[S.name];M!==void 0&&n.vertexAttribPointer(M,S.components,n[xl[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rr{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xn extends rr{getDefault(){return a.b7.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Fo extends rr{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class eu extends rr{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class oc extends rr{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class oh extends rr{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class wl extends rr{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class fa extends rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class tu extends rr{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class iu extends rr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class ah extends rr{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ru extends rr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class Tl extends rr{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Aa extends rr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class xs extends rr{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class lh extends rr{getDefault(){return a.b7.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class No extends rr{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class ac extends rr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class lc extends rr{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class nu extends rr{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class zo extends rr{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class cc extends rr{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Ga extends rr{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Os extends rr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class uc extends rr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class su extends rr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Sl extends rr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class da extends rr{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class hc extends rr{getDefault(){return null}set(n){var l;if(n===this.current&&!this.dirty)return;const _=this.gl;Dn(_)?_.bindVertexArray(n):(l=_.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class fc extends rr{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class El extends rr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Ac extends rr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class dc extends rr{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class Ya extends dc{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class pa extends dc{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ch extends dc{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}const Cl="Framebuffer is not complete";class ji{constructor(n,l,_,y,S){this.context=n,this.width=l,this.height=_;const M=n.gl,O=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new Ya(n,O),y)this.depthAttachment=S?new ch(n,O):new pa(n,O);else if(S)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error(Cl)}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class Il{constructor(n){var l,_;if(this.gl=n,this.clearColor=new Xn(this),this.clearDepth=new Fo(this),this.clearStencil=new eu(this),this.colorMask=new oc(this),this.depthMask=new oh(this),this.stencilMask=new wl(this),this.stencilFunc=new fa(this),this.stencilOp=new tu(this),this.stencilTest=new iu(this),this.depthRange=new ah(this),this.depthTest=new ru(this),this.depthFunc=new Tl(this),this.blend=new Aa(this),this.blendFunc=new xs(this),this.blendColor=new lh(this),this.blendEquation=new No(this),this.cullFace=new ac(this),this.cullFaceSide=new lc(this),this.frontFace=new nu(this),this.program=new zo(this),this.activeTexture=new cc(this),this.viewport=new Ga(this),this.bindFramebuffer=new Os(this),this.bindRenderbuffer=new uc(this),this.bindTexture=new su(this),this.bindVertexBuffer=new Sl(this),this.bindElementBuffer=new da(this),this.bindVertexArray=new hc(this),this.pixelStoreUnpack=new fc(this),this.pixelStoreUnpackPremultiplyAlpha=new El(this),this.pixelStoreUnpackFlipY=new Ac(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),Dn(n)){this.HALF_FLOAT=n.HALF_FLOAT;const y=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=n.RGBA16F)!==null&&l!==void 0?l:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(_=n.RGB16F)!==null&&_!==void 0?_:y==null?void 0:y.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const y=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new vs(this,n,l)}createVertexBuffer(n,l,_){return new sc(this,n,l,_)}createRenderbuffer(n,l,_){const y=this.gl,S=y.createRenderbuffer();return this.bindRenderbuffer.set(S),y.renderbufferStorage(y.RENDERBUFFER,n,l,_),this.bindRenderbuffer.set(null),S}createFramebuffer(n,l,_,y){return new ji(this,n,l,_,y)}clear({color:n,depth:l,stencil:_}){const y=this.gl;let S=0;n&&(S|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(S|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),_!==void 0&&(S|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(S)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){a.bE(n.blendFunction,mr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return Dn(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var l;return Dn(this.gl)?this.gl.deleteVertexArray(n):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}let pc;function ou(T,n,l,_,y){const S=T.context,M=T.transform,O=S.gl,N=T.useProgram("collisionBox"),j=[];let Z=0,Y=0;for(let ve=0;ve<_.length;ve++){const Re=_[ve],Le=n.getTile(Re).getBucket(l);if(!Le)continue;const Oe=y?Le.textCollisionBox:Le.iconCollisionBox,ze=Le.collisionCircleArray;ze.length>0&&(j.push({circleArray:ze,circleOffset:Y,coord:Re}),Z+=ze.length/4,Y=Z),Oe&&N.draw(S,O.LINES,Ui.disabled,Gi.disabled,T.colorModeForRenderPass(),nr.disabled,If(T.transform),T.style.map.terrain&&T.style.map.terrain.getTerrainData(Re),M.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),l.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,T.transform.zoom,null,null,Oe.collisionVertexBuffer)}if(!y||!j.length)return;const G=T.useProgram("collisionCircle"),re=new a.bT;re.resize(4*Z),re._trim();let ne=0;for(const ve of j)for(let Re=0;Re<ve.circleArray.length/4;Re++){const Le=4*Re,Oe=ve.circleArray[Le+0],ze=ve.circleArray[Le+1],Xe=ve.circleArray[Le+2],Ve=ve.circleArray[Le+3];re.emplace(ne++,Oe,ze,Xe,Ve,0),re.emplace(ne++,Oe,ze,Xe,Ve,1),re.emplace(ne++,Oe,ze,Xe,Ve,2),re.emplace(ne++,Oe,ze,Xe,Ve,3)}(!pc||pc.length<2*Z)&&(pc=function(ve){const Re=2*ve,Le=new a.bV;Le.resize(Re),Le._trim();for(let Oe=0;Oe<Re;Oe++){const ze=6*Oe;Le.uint16[ze+0]=4*Oe+0,Le.uint16[ze+1]=4*Oe+1,Le.uint16[ze+2]=4*Oe+2,Le.uint16[ze+3]=4*Oe+2,Le.uint16[ze+4]=4*Oe+3,Le.uint16[ze+5]=4*Oe+0}return Le}(Z));const be=S.createIndexBuffer(pc,!0),ye=S.createVertexBuffer(re,a.bU.members,!0);for(const ve of j){const Re=Za(T.transform);G.draw(S,O.TRIANGLES,Ui.disabled,Gi.disabled,T.colorModeForRenderPass(),nr.disabled,Re,T.style.map.terrain&&T.style.map.terrain.getTerrainData(ve.coord),null,l.id,ye,be,a.aJ.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,T.transform.zoom,null,null,null)}ye.destroy(),be.destroy()}const Pl=a.ad(new Float32Array(16));function Mf(T,n,l,_,y,S){const{horizontalAlign:M,verticalAlign:O}=a.aE(T);return new a.P((-(M-.5)*n/y+_[0])*S,(-(O-.5)*l/y+_[1])*S)}function Rf(T,n,l,_,y,S){const M=n.tileAnchorPoint.add(new a.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let O=_.mult(S);l||(O=O.rotate(-y));const N=M.add(O);return We(N.x,N.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(l){const O=Tr(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(T),N=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0);return T.add(_.rotate(N))}return T.add(_)}function ho(T,n,l,_,y,S,M,O,N,j,Z,Y){const G=T.text.placedSymbolArray,re=T.text.dynamicLayoutVertexArray,ne=T.icon.dynamicLayoutVertexArray,be={};re.clear();for(let ye=0;ye<G.length;ye++){const ve=G.get(ye),Re=ve.hidden||!ve.crossTileID||T.allowVerticalPlacement&&!ve.placedOrientation?null:_[ve.crossTileID];if(Re){const Le=new a.P(ve.anchorX,ve.anchorY),Oe={getElevation:Y,width:y.width,height:y.height,pitchedLabelPlaneMatrix:S,pitchWithMap:l,transform:y,tileAnchorPoint:Le,translation:j,unwrappedTileID:Z},ze=l?si(Le.x,Le.y,Oe):Tr(Le.x,Le.y,Oe),Xe=Tt(y.cameraToCenterDistance,ze.signedDistanceFromCamera);let Ve=a.am(T.textSizeData,O,ve)*Xe/a.ay;l&&(Ve*=T.tilePixelRatio/M);const{width:ct,height:St,anchor:yt,textOffset:bt,textBoxScale:xt}=Re,ti=Mf(yt,ct,St,bt,xt,Ve),Kt=y.getPitchedTextCorrection(Le.x+j[0],Le.y+j[1],Z),Ot=Rf(ze.point,Oe,n,ti,-y.bearingInRadians,Kt),di=T.allowVerticalPlacement&&ve.placedOrientation===a.al.vertical?Math.PI/2:0;for(let er=0;er<ve.numGlyphs;er++)a.as(re,Ot,di);N&&ve.associatedIconIndex>=0&&(be[ve.associatedIconIndex]={shiftedAnchor:Ot,angle:di})}else nn(ve.numGlyphs,re)}if(N){ne.clear();const ye=T.icon.placedSymbolArray;for(let ve=0;ve<ye.length;ve++){const Re=ye.get(ve);if(Re.hidden)nn(Re.numGlyphs,ne);else{const Le=be[ve];if(Le)for(let Oe=0;Oe<Re.numGlyphs;Oe++)a.as(ne,Le.shiftedAnchor,Le.angle);else nn(Re.numGlyphs,ne)}}T.icon.dynamicLayoutVertexBuffer.updateData(ne)}T.text.dynamicLayoutVertexBuffer.updateData(re)}function au(T,n,l){return l.iconsInText&&n?"symbolTextAndIcon":T?"symbolSDF":"symbolIcon"}function gc(T,n,l,_,y,S,M,O,N,j,Z,Y,G){const re=T.context,ne=re.gl,be=T.transform,ye=O==="map",ve=N==="map",Re=O!=="viewport"&&l.layout.get("symbol-placement")!=="point",Le=ye&&!ve&&!Re,Oe=!l.layout.get("symbol-sort-key").isConstant();let ze=!1;const Xe=T.getDepthModeForSublayer(0,Ui.ReadOnly),Ve=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ct=[],St=be.getCircleRadiusCorrection();for(const yt of _){const bt=n.getTile(yt),xt=bt.getBucket(l);if(!xt)continue;const ti=y?xt.text:xt.icon;if(!ti||!ti.segments.get().length||!ti.hasVisibleVertices)continue;const Kt=ti.programConfigurations.get(l.id),Ot=y||xt.sdfIcons,di=y?xt.textSizeData:xt.iconSizeData,er=ve||be.pitch!==0,cr=T.useProgram(au(Ot,y,xt),Kt),Gr=a.ak(di,be.zoom),kr=T.style.map.terrain&&T.style.map.terrain.getTerrainData(yt);let Yr,Qr,Or,yr,In=[0,0],Bn=null;if(y)Qr=bt.glyphAtlasTexture,Or=ne.LINEAR,Yr=bt.glyphAtlasTexture.size,xt.iconsInText&&(In=bt.imageAtlasTexture.size,Bn=bt.imageAtlasTexture,yr=er||T.options.rotating||T.options.zooming||di.kind==="composite"||di.kind==="camera"?ne.LINEAR:ne.NEAREST);else{const mn=l.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Qr=bt.imageAtlasTexture,Or=Ot||T.options.rotating||T.options.zooming||mn||er?ne.LINEAR:ne.NEAREST,Yr=bt.imageAtlasTexture.size}const Qn=a.az(bt,1,T.transform.zoom),br=gi(ye,T.transform,Qn),tl=a.K();a.an(tl,br);const jo=Qe(ve,ye,T.transform,Qn),il=a.aA(be,bt,S,M),Ll=be.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),bu=Ve&&xt.hasTextData(),rl=l.layout.get("icon-text-fit")!=="none"&&bu&&xt.hasIconData();if(Re){const mn=T.style.map.terrain?(Ss,Nr)=>T.style.map.terrain.getElevation(yt,Ss,Nr):null,_n=l.layout.get("text-rotation-alignment")==="map";ie(xt,T,y,br,tl,ve,j,_n,yt.toUnwrapped(),be.width,be.height,il,mn)}const Fl=y&&Ve||rl,$s=Re||Fl?Pl:ve?br:T.transform.clipSpaceToPixelsMatrix,nl=Ot&&l.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xa;xa=Ot?xt.iconsInText?Xa(di.kind,Gr,Le,ve,Re,Fl,T,$s,jo,il,Yr,In,St):qn(di.kind,Gr,Le,ve,Re,Fl,T,$s,jo,il,y,Yr,0,St):qa(di.kind,Gr,Le,ve,Re,Fl,T,$s,jo,il,y,Yr,St);const sl={program:cr,buffers:ti,uniformValues:xa,projectionData:Ll,atlasTexture:Qr,atlasTextureIcon:Bn,atlasInterpolation:Or,atlasInterpolationIcon:yr,isSDF:Ot,hasHalo:nl};if(Oe&&xt.canOverlap){ze=!0;const mn=ti.segments.get();for(const _n of mn)ct.push({segments:new a.aJ([_n]),sortKey:_n.sortKey,state:sl,terrainData:kr})}else ct.push({segments:ti.segments,sortKey:0,state:sl,terrainData:kr})}ze&&ct.sort((yt,bt)=>yt.sortKey-bt.sortKey);for(const yt of ct){const bt=yt.state;if(re.activeTexture.set(ne.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,ne.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(re.activeTexture.set(ne.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),bt.isSDF){const xt=bt.uniformValues;bt.hasHalo&&(xt.u_is_halo=1,Uo(bt.buffers,yt.segments,l,T,bt.program,Xe,Z,Y,xt,bt.projectionData,yt.terrainData)),xt.u_is_halo=0}Uo(bt.buffers,yt.segments,l,T,bt.program,Xe,Z,Y,bt.uniformValues,bt.projectionData,yt.terrainData)}}function Uo(T,n,l,_,y,S,M,O,N,j,Z){const Y=_.context;y.draw(Y,Y.gl.TRIANGLES,S,M,O,nr.backCCW,N,Z,j,l.id,T.layoutVertexBuffer,T.indexBuffer,n,l.paint,_.transform.zoom,T.programConfigurations.get(l.id),T.dynamicLayoutVertexBuffer,T.opacityVertexBuffer)}function Ml(T,n,l,_,y){const S=T.context,M=S.gl,O=Gi.disabled,N=new mr([M.ONE,M.ONE],a.b7.transparent,[!0,!0,!0,!0]),j=n.getBucket(l);if(!j)return;const Z=_.key;let Y=l.heatmapFbos.get(Z);Y||(Y=mc(S,n.tileSize,n.tileSize),l.heatmapFbos.set(Z,Y)),S.bindFramebuffer.set(Y.framebuffer),S.viewport.set([0,0,n.tileSize,n.tileSize]),S.clear({color:a.b7.transparent});const G=j.programConfigurations.get(l.id),re=T.useProgram("heatmap",G,!y),ne=T.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),be=T.style.map.terrain.getTerrainData(_);re.draw(S,M.TRIANGLES,Ui.disabled,O,N,nr.disabled,ua(n,T.transform.zoom,l.paint.get("heatmap-intensity"),1),be,ne,l.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,l.paint,T.transform.zoom,G)}function lu(T,n,l,_,y){const S=T.context,M=S.gl,O=T.transform;S.setColorMode(T.colorModeForRenderPass());const N=ga(S,n),j=l.key,Z=n.heatmapFbos.get(j);if(!Z)return;S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,Z.colorAttachment.get()),S.activeTexture.set(M.TEXTURE1),N.bind(M.LINEAR,M.CLAMP_TO_EDGE);const Y=O.getProjectionData({overscaledTileID:l,applyTerrainMatrix:y,applyGlobeMatrix:!_});T.useProgram("heatmapTexture").draw(S,M.TRIANGLES,Ui.disabled,Gi.disabled,T.colorModeForRenderPass(),nr.disabled,Qc(T,n,0,1),null,Y,n.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments,n.paint,O.zoom),Z.destroy(),n.heatmapFbos.delete(j)}function mc(T,n,l){var _,y;const S=T.gl,M=S.createTexture();S.bindTexture(S.TEXTURE_2D,M),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const O=(_=T.HALF_FLOAT)!==null&&_!==void 0?_:S.UNSIGNED_BYTE,N=(y=T.RGBA16F)!==null&&y!==void 0?y:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,N,n,l,0,S.RGBA,O,null);const j=T.createFramebuffer(n,l,!1,!1);return j.colorAttachment.set(M),j}function ga(T,n){return n.colorRampTexture||(n.colorRampTexture=new It(T,n.colorRamp,T.gl.RGBA)),n.colorRampTexture}function Qa(T,n,l,_,y){if(!l||!_||!_.imageAtlas)return;const S=_.imageAtlas.patternPositions;let M=S[l.to.toString()],O=S[l.from.toString()];if(!M&&O&&(M=O),!O&&M&&(O=M),!M||!O){const N=y.getPaintProperty(n);M=S[N],O=S[N]}M&&O&&T.setConstantPatternPositions(M,O)}function fo(T,n,l,_,y,S,M,O){const N=T.context.gl,j="fill-pattern",Z=l.paint.get(j),Y=Z&&Z.constantOr(1),G=l.getCrossfadeParameters();let re,ne,be,ye,ve;const Re=T.transform,Le=l.paint.get("fill-translate"),Oe=l.paint.get("fill-translate-anchor");M?(ne=Y&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",re=N.LINES):(ne=Y?"fillPattern":"fill",re=N.TRIANGLES);const ze=Z.constantOr(null);for(const Xe of _){const Ve=n.getTile(Xe);if(Y&&!Ve.patternsLoaded())continue;const ct=Ve.getBucket(l);if(!ct)continue;const St=ct.programConfigurations.get(l.id),yt=T.useProgram(ne,St),bt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Xe);Y&&(T.context.activeTexture.set(N.TEXTURE0),Ve.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),St.updatePaintBuffers(G)),Qa(St,j,ze,Ve,l);const xt=Re.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),ti=a.aA(Re,Ve,Le,Oe);if(M){ye=ct.indexBuffer2,ve=ct.segments2;const Ot=[N.drawingBufferWidth,N.drawingBufferHeight];be=ne==="fillOutlinePattern"&&Y?$a(T,G,Ve,Ot,ti):bl(Ot,ti)}else ye=ct.indexBuffer,ve=ct.segments,be=Y?th(T,G,Ve,ti):{u_fill_translate:ti};const Kt=T.stencilModeForClipping(Xe);yt.draw(T.context,re,y,Kt,S,nr.backCCW,be,bt,xt,l.id,ct.layoutVertexBuffer,ye,ve,l.paint,T.transform.zoom,St)}}function ma(T,n,l,_,y,S,M,O){const N=T.context,j=N.gl,Z="fill-extrusion-pattern",Y=l.paint.get(Z),G=Y.constantOr(1),re=l.getCrossfadeParameters(),ne=l.paint.get("fill-extrusion-opacity"),be=Y.constantOr(null),ye=T.transform;for(const ve of _){const Re=n.getTile(ve),Le=Re.getBucket(l);if(!Le)continue;const Oe=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ve),ze=Le.programConfigurations.get(l.id),Xe=T.useProgram(G?"fillExtrusionPattern":"fillExtrusion",ze);G&&(T.context.activeTexture.set(j.TEXTURE0),Re.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ze.updatePaintBuffers(re));const Ve=ye.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!O,applyTerrainMatrix:!0});Qa(ze,Z,be,Re,l);const ct=a.aA(ye,Re,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),St=l.paint.get("fill-extrusion-vertical-gradient"),yt=G?cs(T,St,ne,ct,ve,re,Re):tc(T,St,ne,ct);Xe.draw(N,N.gl.TRIANGLES,y,S,M,nr.backCCW,yt,Oe,Ve,l.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,l.paint,T.transform.zoom,ze,T.style.map.terrain&&Le.centroidVertexBuffer)}}function Rl(T,n,l,_,y,S,M,O,N){var j;const Z=T.style.projection,Y=T.context,G=T.transform,re=Y.gl,ne=[`#define NUM_ILLUMINATION_SOURCES ${l.paint.get("hillshade-highlight-color").values.length}`],be=T.useProgram("hillshade",null,!1,ne),ye=!T.options.moving;for(const ve of _){const Re=n.getTile(ve),Le=Re.fbo;if(!Le)continue;const Oe=Z.getMeshFromTileID(Y,ve.canonical,O,!0,"raster"),ze=(j=T.style.map.terrain)===null||j===void 0?void 0:j.getTerrainData(ve);Y.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,Le.colorAttachment.get());const Xe=G.getProjectionData({overscaledTileID:ve,aligned:ye,applyGlobeMatrix:!N,applyTerrainMatrix:!0});be.draw(Y,re.TRIANGLES,S,y[ve.overscaledZ],M,nr.backCCW,ic(T,Re,l),ze,Xe,l.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}}const Ka=[new a.P(0,0),new a.P(a.Z,0),new a.P(a.Z,a.Z),new a.P(0,a.Z)];function _a(T,n,l,_,y,S,M,O,N=!1,j=!1){const Z=_[_.length-1].overscaledZ,Y=T.context,G=Y.gl,re=T.useProgram("raster"),ne=T.transform,be=T.style.projection,ye=T.colorModeForRenderPass(),ve=!T.options.moving;for(const Re of _){const Le=T.getDepthModeForSublayer(Re.overscaledZ-Z,l.paint.get("raster-opacity")===1?Ui.ReadWrite:Ui.ReadOnly,G.LESS),Oe=n.getTile(Re);Oe.registerFadeDuration(l.paint.get("raster-fade-duration"));const ze=n.findLoadedParent(Re,0),Xe=n.findLoadedSibling(Re),Ve=cu(Oe,ze||Xe||null,n,l,T.transform,T.style.map.terrain);let ct,St;const yt=l.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR;Y.activeTexture.set(G.TEXTURE0),Oe.texture.bind(yt,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),Y.activeTexture.set(G.TEXTURE1),ze?(ze.texture.bind(yt,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),ct=Math.pow(2,ze.tileID.overscaledZ-Oe.tileID.overscaledZ),St=[Oe.tileID.canonical.x*ct%1,Oe.tileID.canonical.y*ct%1]):Oe.texture.bind(yt,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),Oe.texture.useMipmap&&Y.extTextureFilterAnisotropic&&T.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const bt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Re),xt=ne.getProjectionData({overscaledTileID:Re,aligned:ve,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),ti=rh(St||[0,0],ct||1,Ve,l,O),Kt=be.getMeshFromTileID(Y,Re.canonical,S,M,"raster");re.draw(Y,G.TRIANGLES,Le,y?y[Re.overscaledZ]:Gi.disabled,ye,N?nr.frontCCW:nr.backCCW,ti,bt,xt,l.id,Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}}function cu(T,n,l,_,y,S){const M=_.paint.get("raster-fade-duration");if(!S&&M>0){const O=V.now(),N=(O-T.timeAdded)/M,j=n?(O-n.timeAdded)/M:-1,Z=l.getSource(),Y=ut(y,{tileSize:Z.tileSize,roundZoom:Z.roundZoom}),G=!n||Math.abs(n.tileID.overscaledZ-Y)>Math.abs(T.tileID.overscaledZ-Y),re=G&&T.refreshedUponExpiration?1:a.ae(G?N:1-j,0,1);return T.refreshedUponExpiration&&N>=1&&(T.refreshedUponExpiration=!1),n?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const _c=new a.b7(1,0,0,1),uu=new a.b7(0,1,0,1),uh=new a.b7(0,0,1,1),hh=new a.b7(1,0,1,1),yc=new a.b7(0,1,1,1);function bc(T,n,l,_){kl(T,0,n+l/2,T.transform.width,l,_)}function fh(T,n,l,_){kl(T,n-l/2,0,l,T.transform.height,_)}function kl(T,n,l,_,y,S){const M=T.context,O=M.gl;O.enable(O.SCISSOR_TEST),O.scissor(n*T.pixelRatio,l*T.pixelRatio,_*T.pixelRatio,y*T.pixelRatio),M.clear({color:S}),O.disable(O.SCISSOR_TEST)}function $r(T,n,l){const _=T.context,y=_.gl,S=T.useProgram("debug"),M=Ui.disabled,O=Gi.disabled,N=T.colorModeForRenderPass(),j="$debug",Z=T.style.map.terrain&&T.style.map.terrain.getTerrainData(l);_.activeTexture.set(y.TEXTURE0);const Y=n.getTileByID(l.key).latestRawTileData,G=Math.floor((Y&&Y.byteLength||0)/1024),re=n.getTile(l).tileSize,ne=512/Math.min(re,512)*(l.overscaledZ/T.transform.zoom)*.5;let be=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(be+=` => ${l.overscaledZ}`),function(ve,Re){ve.initDebugOverlayCanvas();const Le=ve.debugOverlayCanvas,Oe=ve.context.gl,ze=ve.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,Le.width,Le.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(Re,5,5),ze.strokeText(Re,5,5),ve.debugOverlayTexture.update(Le),ve.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(T,`${be} ${G}kB`);const ye=T.transform.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(_,y.TRIANGLES,M,O,mr.alphaBlended,nr.disabled,Yc(a.b7.transparent,ne),null,ye,j,T.debugBuffer,T.quadTriangleIndexBuffer,T.debugSegments),S.draw(_,y.LINE_STRIP,M,O,N,nr.disabled,Yc(a.b7.red),Z,ye,j,T.debugBuffer,T.tileBorderIndexBuffer,T.debugSegments)}function Ao(T,n,l,_){const{isRenderingGlobe:y}=_,S=T.context,M=S.gl,O=T.transform,N=T.colorModeForRenderPass(),j=T.getDepthModeFor3D(),Z=T.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,T.width,T.height]);for(const Y of l){const G=n.getTerrainMesh(Y.tileID),re=T.renderToTexture.getTexture(Y),ne=n.getTerrainData(Y.tileID);S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,re.texture);const be=n.getMeshFrameDelta(O.zoom),ye=O.calculateFogMatrix(Y.tileID.toUnwrapped()),ve=Cf(be,ye,T.style.sky,O.pitch,y),Re=O.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(S,M.TRIANGLES,j,Gi.disabled,N,nr.backCCW,ve,ne,Re,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function us(T,n){if(!n.mesh){const l=new a.aI;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(1,1),l.emplaceBack(-1,1);const _=new a.aK;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),n.mesh=new Ua(T.createVertexBuffer(l,$n.members),T.createIndexBuffer(_),a.aJ.simpleSegment(0,0,l.length,_.length))}return n.mesh}class Zr{constructor(n,l){this.context=new Il(n),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ot.maxUnderzooming+ot.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pl}resize(n,l,_){if(this.width=Math.floor(n*_),this.height=Math.floor(l*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const n=this.context,l=new a.aI;l.emplaceBack(0,0),l.emplaceBack(a.Z,0),l.emplaceBack(0,a.Z),l.emplaceBack(a.Z,a.Z),this.tileExtentBuffer=n.createVertexBuffer(l,$n.members),this.tileExtentSegments=a.aJ.simpleSegment(0,0,4,2);const _=new a.aI;_.emplaceBack(0,0),_.emplaceBack(a.Z,0),_.emplaceBack(0,a.Z),_.emplaceBack(a.Z,a.Z),this.debugBuffer=n.createVertexBuffer(_,$n.members),this.debugSegments=a.aJ.simpleSegment(0,0,4,5);const y=new a.b_;y.emplaceBack(0,0,0,0),y.emplaceBack(a.Z,0,a.Z,0),y.emplaceBack(0,a.Z,0,a.Z),y.emplaceBack(a.Z,a.Z,a.Z,a.Z),this.rasterBoundsBuffer=n.createVertexBuffer(y,Sf.members),this.rasterBoundsSegments=a.aJ.simpleSegment(0,0,4,2);const S=new a.aI;S.emplaceBack(0,0),S.emplaceBack(a.Z,0),S.emplaceBack(0,a.Z),S.emplaceBack(a.Z,a.Z),this.rasterBoundsBufferPosOnly=n.createVertexBuffer(S,$n.members),this.rasterBoundsSegmentsPosOnly=a.aJ.simpleSegment(0,0,4,5);const M=new a.aI;M.emplaceBack(0,0),M.emplaceBack(1,0),M.emplaceBack(0,1),M.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(M,$n.members),this.viewportSegments=a.aJ.simpleSegment(0,0,4,2);const O=new a.b$;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(O);const N=new a.aK;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(N);const j=this.context.gl;this.stencilClearMode=new Gi({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.tileExtentMesh=new Ua(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=a.K();a.bQ(_,0,this.width,this.height,0,0,1),a.M(_,_,[l.drawingBufferWidth,l.drawingBufferHeight,0]);const y={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(n,l.TRIANGLES,Ui.disabled,this.stencilClearMode,mr.disabled,nr.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,l,_){if(this.currentStencilSource===n.source||!n.isTileClipped()||!l||!l.length)return;this.currentStencilSource=n.source,this.nextStencilID+l.length>256&&this.clearStencil();const y=this.context;y.setColorMode(mr.disabled),y.setDepthMode(Ui.disabled);const S={};for(const M of l)S[M.key]=this.nextStencilID++;this._renderTileMasks(S,l,_,!0),this._renderTileMasks(S,l,_,!1),this._tileClippingMaskIDs=S}_renderTileMasks(n,l,_,y){const S=this.context,M=S.gl,O=this.style.projection,N=this.transform,j=this.useProgram("clippingMask");for(const Z of l){const Y=n[Z.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Z),re=O.getMeshFromTileID(this.context,Z.canonical,y,!0,"stencil"),ne=N.getProjectionData({overscaledTileID:Z,applyGlobeMatrix:!_,applyTerrainMatrix:!0});j.draw(S,M.TRIANGLES,Ui.disabled,new Gi({func:M.ALWAYS,mask:0},Y,255,M.KEEP,M.KEEP,M.REPLACE),mr.disabled,_?nr.disabled:nr.backCCW,null,G,ne,"$clipping",re.vertexBuffer,re.indexBuffer,re.segments)}}_renderTilesDepthBuffer(){const n=this.context,l=n.gl,_=this.style.projection,y=this.transform,S=this.useProgram("depth"),M=this.getDepthModeFor3D(),O=Ge(y,{tileSize:y.tileSize});for(const N of O){const j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),Z=_.getMeshFromTileID(this.context,N.canonical,!0,!0,"raster"),Y=y.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(n,l.TRIANGLES,M,Gi.disabled,mr.disabled,nr.backCCW,null,j,Y,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new Gi({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){const l=this.context.gl;return new Gi({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(n){const l=this.context.gl,_=n.sort((M,O)=>O.overscaledZ-M.overscaledZ),y=_[_.length-1].overscaledZ,S=_[0].overscaledZ-y+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const M={};for(let O=0;O<S;O++)M[O+y]=new Gi({func:l.GEQUAL,mask:255},O+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=S,[M,_]}return[{[y]:Gi.disabled},_]}stencilConfigForOverlapTwoPass(n){const l=this.context.gl,_=n.sort((M,O)=>O.overscaledZ-M.overscaledZ),y=_[_.length-1].overscaledZ,S=_[0].overscaledZ-y+1;if(this.clearStencil(),S>1){const M={},O={};for(let N=0;N<S;N++)M[N+y]=new Gi({func:l.GREATER,mask:255},S+1+N,255,l.KEEP,l.KEEP,l.REPLACE),O[N+y]=new Gi({func:l.GREATER,mask:255},1+N,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID=2*S+1,[M,O,_]}return this.nextStencilID=3,[{[y]:new Gi({func:l.GREATER,mask:255},2,255,l.KEEP,l.KEEP,l.REPLACE)},{[y]:new Gi({func:l.GREATER,mask:255},1,255,l.KEEP,l.KEEP,l.REPLACE)},_]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new mr([n.CONSTANT_COLOR,n.ONE],new a.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mr.unblended:mr.alphaBlended}getDepthModeForSublayer(n,l,_){if(!this.opaquePassEnabledForLayer())return Ui.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Ui(_||this.context.gl.LEQUAL,l,[y,y])}getDepthModeFor3D(){return new Ui(this.context.gl.LEQUAL,Ui.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){var _,y;this.style=n,this.options=l,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(V.now()),this.imageManager.beginFrame();const S=this.style._order,M=this.style.sourceCaches,O={},N={},j={},Z={isRenderingToTexture:!1,isRenderingGlobe:((_=n.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const G in M){const re=M[G];re.used&&re.prepare(this.context),O[G]=re.getVisibleCoordinates(!1),N[G]=O[G].slice().reverse(),j[G]=re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<S.length;G++)if(this.style._layers[S[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of S){const re=this.style._layers[G];if(!re.hasOffscreenPass()||re.isHidden(this.transform.zoom))continue;const ne=N[re.source];(re.type==="custom"||ne.length)&&this.renderLayer(this,M[re.source],re,ne,Z)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?a.b7.black:a.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(G,re){const ne=G.context,be=ne.gl,ye=((Xe,Ve,ct)=>{const St=Math.cos(Ve.rollInRadians),yt=Math.sin(Ve.rollInRadians),bt=rt(Ve),xt=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Xe.properties.get("sky-color"),u_horizon_color:Xe.properties.get("horizon-color"),u_horizon:[(Ve.width/2-bt*yt)*ct,(Ve.height/2+bt*St)*ct],u_horizon_normal:[-yt,St],u_sky_horizon_blend:Xe.properties.get("sky-horizon-blend")*Ve.height/2*ct,u_sky_blend:xt}})(re,G.style.map.transform,G.pixelRatio),ve=new Ui(be.LEQUAL,Ui.ReadWrite,[0,1]),Re=Gi.disabled,Le=G.colorModeForRenderPass(),Oe=G.useProgram("sky"),ze=us(ne,re);Oe.draw(ne,be.TRIANGLES,ve,Re,Le,nr.disabled,ye,null,void 0,"sky",ze.vertexBuffer,ze.indexBuffer,ze.segments)}(this,this.style.sky),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[S[this.currentLayer]],re=M[G.source],ne=O[G.source];this._renderTileClippingMasks(G,ne,!1),this.renderLayer(this,re,G,ne,Z)}this.renderPass="translucent";let Y=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const G=this.style._layers[S[this.currentLayer]],re=M[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,Z))continue;this.opaquePassEnabledForLayer()||Y||(Y=!0,Z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ne=(G.type==="symbol"?j:N)[G.source];this._renderTileClippingMasks(G,O[G.source],!!this.renderToTexture),this.renderLayer(this,re,G,ne,Z)}if(Z.isRenderingGlobe&&function(G,re,ne){const be=G.context,ye=be.gl,ve=G.useProgram("atmosphere"),Re=new Ui(ye.LEQUAL,Ui.ReadOnly,[0,1]),Le=G.transform,Oe=function(xt,ti){const Kt=xt.properties.get("position"),Ot=[-Kt.x,-Kt.y,-Kt.z],di=a.ad(new Float64Array(16));return xt.properties.get("anchor")==="map"&&(a.a_(di,di,ti.rollInRadians),a.a$(di,di,-ti.pitchInRadians),a.a_(di,di,ti.bearingInRadians),a.a$(di,di,ti.center.lat*Math.PI/180),a.bp(di,di,-ti.center.lng*Math.PI/180)),a.bZ(Ot,Ot,di),Ot}(ne,G.transform),ze=Le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Xe=re.properties.get("atmosphere-blend")*ze.projectionTransition;if(Xe===0)return;const Ve=ko(Le.worldSize,Le.center.lat),ct=Le.inverseProjectionMatrix,St=new Float64Array(4);St[3]=1,a.at(St,St,Le.modelViewProjectionMatrix),St[0]/=St[3],St[1]/=St[3],St[2]/=St[3],St[3]=1,a.at(St,St,ct),St[0]/=St[3],St[1]/=St[3],St[2]/=St[3],St[3]=1;const yt=((xt,ti,Kt,Ot,di)=>({u_sun_pos:xt,u_atmosphere_blend:ti,u_globe_position:Kt,u_globe_radius:Ot,u_inv_proj_matrix:di}))(Oe,Xe,[St[0],St[1],St[2]],Ve,ct),bt=us(be,re);ve.draw(be,ye.TRIANGLES,Re,Gi.disabled,mr.alphaBlended,nr.disabled,yt,null,null,"atmosphere",bt.vertexBuffer,bt.indexBuffer,bt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=function(re,ne){let be=null;const ye=Object.values(re._layers).flatMap(Oe=>Oe.source&&!Oe.isHidden(ne)?[re.sourceCaches[Oe.source]]:[]),ve=ye.filter(Oe=>Oe.getSource().type==="vector"),Re=ye.filter(Oe=>Oe.getSource().type!=="vector"),Le=Oe=>{(!be||be.getSource().maxzoom<Oe.getSource().maxzoom)&&(be=Oe)};return ve.forEach(Oe=>Le(Oe)),be||Re.forEach(Oe=>Le(Oe)),be}(this.style,this.transform.zoom);G&&function(re,ne,be){for(let ye=0;ye<be.length;ye++)$r(re,ne,be[ye])}(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const re=G.transform.padding;bc(G,G.transform.height-(re.top||0),3,_c),bc(G,re.bottom||0,3,uu),fh(G,re.left||0,3,uh),fh(G,G.transform.width-(re.right||0),3,hh);const ne=G.transform.centerPoint;(function(be,ye,ve,Re){kl(be,ye-1,ve-10,2,20,Re),kl(be,ye-10,ve-1,20,2,Re)})(G,ne.x,G.transform.height-ne.y,yc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const l=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=n?!a.c0(l,_):!a.c1(l,_)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(a.c2(l,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,M){const O=S.context,N=O.gl,j=S.transform,Z=mr.unblended,Y=new Ui(N.LEQUAL,Ui.ReadWrite,[0,1]),G=M.sourceCache.getRenderableTiles(),re=S.useProgram("terrainDepth");O.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:a.b7.transparent,depth:1});for(const ne of G){const be=M.getTerrainMesh(ne.tileID),ye=M.getTerrainData(ne.tileID),ve=j.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Re={u_ele_delta:M.getMeshFrameDelta(j.zoom)};re.draw(O,N.TRIANGLES,Y,Gi.disabled,Z,nr.backCCW,Re,ye,ve,"terrain",be.vertexBuffer,be.indexBuffer,be.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,M){const O=S.context,N=O.gl,j=S.transform,Z=mr.unblended,Y=new Ui(N.LEQUAL,Ui.ReadWrite,[0,1]),G=M.getCoordsTexture(),re=M.sourceCache.getRenderableTiles(),ne=S.useProgram("terrainCoords");O.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:a.b7.transparent,depth:1}),M.coordsIndex=[];for(const be of re){const ye=M.getTerrainMesh(be.tileID),ve=M.getTerrainData(be.tileID);O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.texture);const Re={u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(j.zoom)},Le=j.getProjectionData({overscaledTileID:be.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ne.draw(O,N.TRIANGLES,Y,Gi.disabled,Z,nr.backCCW,Re,ve,Le,"terrain",ye.vertexBuffer,ye.indexBuffer,ye.segments),M.coordsIndex.push(be.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(n,l,_,y,S){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(y||[]).length)&&(this.id=_.id,a.c3(_)?function(M,O,N,j,Z,Y){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:G}=Y,re=Gi.disabled,ne=M.colorModeForRenderPass();(N._unevaluatedLayout.hasValue("text-variable-anchor")||N._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(be,ye,ve,Re,Le,Oe,ze,Xe,Ve){const ct=ye.transform,St=ye.style.map.terrain,yt=Le==="map",bt=Oe==="map";for(const xt of be){const ti=Re.getTile(xt),Kt=ti.getBucket(ve);if(!Kt||!Kt.text||!Kt.text.segments.get().length)continue;const Ot=a.ak(Kt.textSizeData,ct.zoom),di=a.az(ti,1,ye.transform.zoom),er=gi(yt,ye.transform,di),cr=ve.layout.get("icon-text-fit")!=="none"&&Kt.hasIconData();if(Ot){const Gr=Math.pow(2,ct.zoom-ti.tileID.overscaledZ),kr=St?(Yr,Qr)=>St.getElevation(xt,Yr,Qr):null;ho(Kt,yt,bt,Ve,ct,er,Gr,Ot,cr,a.aA(ct,ti,ze,Xe),xt.toUnwrapped(),kr)}}}(j,M,N,O,N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),Z),N.paint.get("icon-opacity").constantOr(1)!==0&&gc(M,O,N,j,!1,N.paint.get("icon-translate"),N.paint.get("icon-translate-anchor"),N.layout.get("icon-rotation-alignment"),N.layout.get("icon-pitch-alignment"),N.layout.get("icon-keep-upright"),re,ne,G),N.paint.get("text-opacity").constantOr(1)!==0&&gc(M,O,N,j,!0,N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.layout.get("text-keep-upright"),re,ne,G),O.map.showCollisionBoxes&&(ou(M,O,N,j,!0),ou(M,O,N,j,!1))}(n,l,_,y,this.style.placement.variableOffsets,S):a.c4(_)?function(M,O,N,j,Z){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:Y}=Z,G=N.paint.get("circle-opacity"),re=N.paint.get("circle-stroke-width"),ne=N.paint.get("circle-stroke-opacity"),be=!N.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(re.constantOr(1)===0||ne.constantOr(1)===0))return;const ye=M.context,ve=ye.gl,Re=M.transform,Le=M.getDepthModeForSublayer(0,Ui.ReadOnly),Oe=Gi.disabled,ze=M.colorModeForRenderPass(),Xe=[],Ve=Re.getCircleRadiusCorrection();for(let ct=0;ct<j.length;ct++){const St=j[ct],yt=O.getTile(St),bt=yt.getBucket(N);if(!bt)continue;const xt=N.paint.get("circle-translate"),ti=N.paint.get("circle-translate-anchor"),Kt=a.aA(Re,yt,xt,ti),Ot=bt.programConfigurations.get(N.id),di=M.useProgram("circle",Ot),er=bt.layoutVertexBuffer,cr=bt.indexBuffer,Gr=M.style.map.terrain&&M.style.map.terrain.getTerrainData(St),kr={programConfiguration:Ot,program:di,layoutVertexBuffer:er,indexBuffer:cr,uniformValues:eo(M,yt,N,Kt,Ve),terrainData:Gr,projectionData:Re.getProjectionData({overscaledTileID:St,applyGlobeMatrix:!Y,applyTerrainMatrix:!0})};if(be){const Yr=bt.segments.get();for(const Qr of Yr)Xe.push({segments:new a.aJ([Qr]),sortKey:Qr.sortKey,state:kr})}else Xe.push({segments:bt.segments,sortKey:0,state:kr})}be&&Xe.sort((ct,St)=>ct.sortKey-St.sortKey);for(const ct of Xe){const{programConfiguration:St,program:yt,layoutVertexBuffer:bt,indexBuffer:xt,uniformValues:ti,terrainData:Kt,projectionData:Ot}=ct.state;yt.draw(ye,ve.TRIANGLES,Le,Oe,ze,nr.backCCW,ti,Kt,Ot,N.id,bt,xt,ct.segments,N.paint,M.transform.zoom,St)}}(n,l,_,y,S):a.c5(_)?function(M,O,N,j,Z){if(N.paint.get("heatmap-opacity")===0)return;const Y=M.context,{isRenderingToTexture:G,isRenderingGlobe:re}=Z;if(M.style.map.terrain){for(const ne of j){const be=O.getTile(ne);O.hasRenderableParent(ne)||(M.renderPass==="offscreen"?Ml(M,be,N,ne,re):M.renderPass==="translucent"&&lu(M,N,ne,G,re))}Y.viewport.set([0,0,M.width,M.height])}else M.renderPass==="offscreen"?function(ne,be,ye,ve){const Re=ne.context,Le=Re.gl,Oe=ne.transform,ze=Gi.disabled,Xe=new mr([Le.ONE,Le.ONE],a.b7.transparent,[!0,!0,!0,!0]);(function(Ve,ct,St){const yt=Ve.gl;Ve.activeTexture.set(yt.TEXTURE1),Ve.viewport.set([0,0,ct.width/4,ct.height/4]);let bt=St.heatmapFbos.get(a.bW);bt?(yt.bindTexture(yt.TEXTURE_2D,bt.colorAttachment.get()),Ve.bindFramebuffer.set(bt.framebuffer)):(bt=mc(Ve,ct.width/4,ct.height/4),St.heatmapFbos.set(a.bW,bt))})(Re,ne,ye),Re.clear({color:a.b7.transparent});for(let Ve=0;Ve<ve.length;Ve++){const ct=ve[Ve];if(be.hasRenderableParent(ct))continue;const St=be.getTile(ct),yt=St.getBucket(ye);if(!yt)continue;const bt=yt.programConfigurations.get(ye.id),xt=ne.useProgram("heatmap",bt),ti=Oe.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Kt=Oe.getCircleRadiusCorrection();xt.draw(Re,Le.TRIANGLES,Ui.disabled,ze,Xe,nr.backCCW,ua(St,Oe.zoom,ye.paint.get("heatmap-intensity"),Kt),null,ti,ye.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,ye.paint,Oe.zoom,bt)}Re.viewport.set([0,0,ne.width,ne.height])}(M,O,N,j):M.renderPass==="translucent"&&function(ne,be){const ye=ne.context,ve=ye.gl;ye.setColorMode(ne.colorModeForRenderPass());const Re=be.heatmapFbos.get(a.bW);Re&&(ye.activeTexture.set(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_2D,Re.colorAttachment.get()),ye.activeTexture.set(ve.TEXTURE1),ga(ye,be).bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ne.useProgram("heatmapTexture").draw(ye,ve.TRIANGLES,Ui.disabled,Gi.disabled,ne.colorModeForRenderPass(),nr.disabled,Qc(ne,be,0,1),null,null,be.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments,be.paint,ne.transform.zoom))}(M,N)}(n,l,_,y,S):a.c6(_)?function(M,O,N,j,Z){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:Y}=Z,G=N.paint.get("line-opacity"),re=N.paint.get("line-width");if(G.constantOr(1)===0||re.constantOr(1)===0)return;const ne=M.getDepthModeForSublayer(0,Ui.ReadOnly),be=M.colorModeForRenderPass(),ye=N.paint.get("line-dasharray"),ve=N.paint.get("line-pattern"),Re=ve.constantOr(1),Le=N.paint.get("line-gradient"),Oe=N.getCrossfadeParameters(),ze=Re?"linePattern":ye?"lineSDF":Le?"lineGradient":"line",Xe=M.context,Ve=Xe.gl,ct=M.transform;let St=!0;for(const yt of j){const bt=O.getTile(yt);if(Re&&!bt.patternsLoaded())continue;const xt=bt.getBucket(N);if(!xt)continue;const ti=xt.programConfigurations.get(N.id),Kt=M.context.program.get(),Ot=M.useProgram(ze,ti),di=St||Ot.program!==Kt,er=M.style.map.terrain&&M.style.map.terrain.getTerrainData(yt),cr=ve.constantOr(null);if(cr&&bt.imageAtlas){const Or=bt.imageAtlas,yr=Or.patternPositions[cr.to.toString()],In=Or.patternPositions[cr.from.toString()];yr&&In&&ti.setConstantPatternPositions(yr,In)}const Gr=ct.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),kr=ct.getPixelScale(),Yr=Re?ih(M,bt,N,kr,Oe):ye?Jc(M,bt,N,kr,ye,Oe):Le?Ir(M,bt,N,kr,xt.lineClipsArray.length):uo(M,bt,N,kr);if(Re)Xe.activeTexture.set(Ve.TEXTURE0),bt.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),ti.updatePaintBuffers(Oe);else if(ye&&(di||M.lineAtlas.dirty))Xe.activeTexture.set(Ve.TEXTURE0),M.lineAtlas.bind(Xe);else if(Le){const Or=xt.gradients[N.id];let yr=Or.texture;if(N.gradientVersion!==Or.version){let In=256;if(N.stepInterpolant){const Bn=O.getSource().maxzoom,Qn=yt.canonical.z===Bn?Math.ceil(1<<M.transform.maxZoom-yt.canonical.z):1;In=a.ae(a.bX(xt.maxLineLength/a.Z*1024*Qn),256,Xe.maxTextureSize)}Or.gradient=a.bY({expression:N.gradientExpression(),evaluationKey:"lineProgress",resolution:In,image:Or.gradient||void 0,clips:xt.lineClipsArray}),Or.texture?Or.texture.update(Or.gradient):Or.texture=new It(Xe,Or.gradient,Ve.RGBA),Or.version=N.gradientVersion,yr=Or.texture}Xe.activeTexture.set(Ve.TEXTURE0),yr.bind(N.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}const Qr=M.stencilModeForClipping(yt);Ot.draw(Xe,Ve.TRIANGLES,ne,Qr,be,nr.disabled,Yr,er,Gr,N.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,N.paint,M.transform.zoom,ti,xt.layoutVertexBuffer2),St=!1}}(n,l,_,y,S):a.c7(_)?function(M,O,N,j,Z){const Y=N.paint.get("fill-color"),G=N.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:re}=Z,ne=M.colorModeForRenderPass(),be=N.paint.get("fill-pattern"),ye=M.opaquePassEnabledForLayer()&&!be.constantOr(1)&&Y.constantOr(a.b7.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(M.renderPass===ye){const ve=M.getDepthModeForSublayer(1,M.renderPass==="opaque"?Ui.ReadWrite:Ui.ReadOnly);fo(M,O,N,j,ve,ne,!1,re)}if(M.renderPass==="translucent"&&N.paint.get("fill-antialias")){const ve=M.getDepthModeForSublayer(N.getPaintProperty("fill-outline-color")?2:0,Ui.ReadOnly);fo(M,O,N,j,ve,ne,!0,re)}}(n,l,_,y,S):a.c8(_)?function(M,O,N,j,Z){const Y=N.paint.get("fill-extrusion-opacity");if(Y===0)return;const{isRenderingToTexture:G}=Z;if(M.renderPass==="translucent"){const re=new Ui(M.context.gl.LEQUAL,Ui.ReadWrite,M.depthRangeFor3D);if(Y!==1||N.paint.get("fill-extrusion-pattern").constantOr(1))ma(M,O,N,j,re,Gi.disabled,mr.disabled,G),ma(M,O,N,j,re,M.stencilModeFor3D(),M.colorModeForRenderPass(),G);else{const ne=M.colorModeForRenderPass();ma(M,O,N,j,re,Gi.disabled,ne,G)}}}(n,l,_,y,S):a.c9(_)?function(M,O,N,j,Z){if(M.renderPass!=="offscreen"&&M.renderPass!=="translucent")return;const{isRenderingToTexture:Y}=Z,G=M.context,re=M.style.projection.useSubdivision,ne=M.getDepthModeForSublayer(0,Ui.ReadOnly),be=M.colorModeForRenderPass();if(M.renderPass==="offscreen")(function(ye,ve,Re,Le,Oe,ze,Xe){const Ve=ye.context,ct=Ve.gl;for(const St of Re){const yt=ve.getTile(St),bt=yt.dem;if(!bt||!bt.data||!yt.needsHillshadePrepare)continue;const xt=bt.dim,ti=bt.stride,Kt=bt.getPixels();if(Ve.activeTexture.set(ct.TEXTURE1),Ve.pixelStoreUnpackPremultiplyAlpha.set(!1),yt.demTexture=yt.demTexture||ye.getTileTexture(ti),yt.demTexture){const di=yt.demTexture;di.update(Kt,{premultiply:!1}),di.bind(ct.NEAREST,ct.CLAMP_TO_EDGE)}else yt.demTexture=new It(Ve,Kt,ct.RGBA,{premultiply:!1}),yt.demTexture.bind(ct.NEAREST,ct.CLAMP_TO_EDGE);Ve.activeTexture.set(ct.TEXTURE0);let Ot=yt.fbo;if(!Ot){const di=new It(Ve,{width:xt,height:xt,data:null},ct.RGBA);di.bind(ct.LINEAR,ct.CLAMP_TO_EDGE),Ot=yt.fbo=Ve.createFramebuffer(xt,xt,!0,!1),Ot.colorAttachment.set(di.texture)}Ve.bindFramebuffer.set(Ot.framebuffer),Ve.viewport.set([0,0,xt,xt]),ye.useProgram("hillshadePrepare").draw(Ve,ct.TRIANGLES,Oe,ze,Xe,nr.disabled,Kc(yt.tileID,bt),null,null,Le.id,ye.rasterBoundsBuffer,ye.quadTriangleIndexBuffer,ye.rasterBoundsSegments),yt.needsHillshadePrepare=!1}})(M,O,j,N,ne,Gi.disabled,be),G.viewport.set([0,0,M.width,M.height]);else if(M.renderPass==="translucent")if(re){const[ye,ve,Re]=M.stencilConfigForOverlapTwoPass(j);Rl(M,O,N,Re,ye,ne,be,!1,Y),Rl(M,O,N,Re,ve,ne,be,!0,Y)}else{const[ye,ve]=M.getStencilConfigForOverlapAndUpdateStencilID(j);Rl(M,O,N,ve,ye,ne,be,!1,Y)}}(n,l,_,y,S):a.ca(_)?function(M,O,N,j,Z){if(M.renderPass!=="translucent"||N.paint.get("raster-opacity")===0||!j.length)return;const{isRenderingToTexture:Y}=Z,G=O.getSource(),re=M.style.projection.useSubdivision;if(G instanceof tr)_a(M,O,N,j,null,!1,!1,G.tileCoords,G.flippedWindingOrder,Y);else if(re){const[ne,be,ye]=M.stencilConfigForOverlapTwoPass(j);_a(M,O,N,ye,ne,!1,!0,Ka,!1,Y),_a(M,O,N,ye,be,!0,!0,Ka,!1,Y)}else{const[ne,be]=M.getStencilConfigForOverlapAndUpdateStencilID(j);_a(M,O,N,be,ne,!1,!0,Ka,!1,Y)}}(n,l,_,y,S):a.cb(_)?function(M,O,N,j,Z){const Y=N.paint.get("background-color"),G=N.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:re}=Z,ne=M.context,be=ne.gl,ye=M.style.projection,ve=M.transform,Re=ve.tileSize,Le=N.paint.get("background-pattern");if(M.isPatternMissing(Le))return;const Oe=!Le&&Y.a===1&&G===1&&M.opaquePassEnabledForLayer()?"opaque":"translucent";if(M.renderPass!==Oe)return;const ze=Gi.disabled,Xe=M.getDepthModeForSublayer(0,Oe==="opaque"?Ui.ReadWrite:Ui.ReadOnly),Ve=M.colorModeForRenderPass(),ct=M.useProgram(Le?"backgroundPattern":"background"),St=j||Ge(ve,{tileSize:Re,terrain:M.style.map.terrain});Le&&(ne.activeTexture.set(be.TEXTURE0),M.imageManager.bind(M.context));const yt=N.getCrossfadeParameters();for(const bt of St){const xt=ve.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!re,applyTerrainMatrix:!0}),ti=Le?Pf(G,M,Le,{tileID:bt,tileSize:Re},yt):ha(G,Y),Kt=M.style.map.terrain&&M.style.map.terrain.getTerrainData(bt),Ot=ye.getMeshFromTileID(ne,bt.canonical,!1,!0,"raster");ct.draw(ne,be.TRIANGLES,Xe,ze,Ve,nr.backCCW,ti,Kt,xt,N.id,Ot.vertexBuffer,Ot.indexBuffer,Ot.segments)}}(n,0,_,y,S):a.cc(_)&&function(M,O,N,j){const{isRenderingGlobe:Z}=j,Y=M.context,G=N.implementation,re=M.style.projection,ne=M.transform,be=ne.getProjectionDataForCustomLayer(Z),ye={farZ:ne.farZ,nearZ:ne.nearZ,fov:ne.fov*Math.PI/180,modelViewProjectionMatrix:ne.modelViewProjectionMatrix,projectionMatrix:ne.projectionMatrix,shaderData:{variantName:re.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${re.shaderPreludeCode.vertexSource}`,define:re.shaderDefine},defaultProjectionData:be},ve=G.renderingMode?G.renderingMode:"2d";if(M.renderPass==="offscreen"){const Re=G.prerender;Re&&(M.setCustomLayerDefaults(),Y.setColorMode(M.colorModeForRenderPass()),Re.call(G,Y.gl,ye),Y.setDirty(),M.setBaseState())}else if(M.renderPass==="translucent"){M.setCustomLayerDefaults(),Y.setColorMode(M.colorModeForRenderPass()),Y.setStencilMode(Gi.disabled);const Re=ve==="3d"?M.getDepthModeFor3D():M.getDepthModeForSublayer(0,Ui.ReadOnly);Y.setDepthMode(Re),G.render(Y.gl,ye),Y.setDirty(),M.setBaseState(),Y.bindFramebuffer.set(null)}}(n,0,_,S))}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const l=this.imageManager.getPattern(n.from.toString()),_=this.imageManager.getPattern(n.to.toString());return!l||!_}useProgram(n,l,_=!1,y=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,M=this.style.projection,O=_?kn.projectionMercator:M.shaderPreludeCode,N=_?gr:M.shaderDefine,j=n+(l?l.cacheKey:"")+`/${_?ir:M.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(y?`/${y.join("/")}`:"");return this.cache[j]||(this.cache[j]=new Jl(this.context,kn[n],l,sh[n],this._showOverdrawInspector,S,O,N,y)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new It(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:l}=this.context.gl;return this.width!==n||this.height!==l}}function Dl(T,n){let l,_=!1,y=null,S=null;const M=()=>{y=null,_&&(T.apply(S,l),y=setTimeout(M,n),_=!1)};return(...O)=>(_=!0,S=this,l=O,y||M(),y)}class hu{constructor(n){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let _;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(_=y)}),(_&&_[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(!this._isValidHash(l))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:_,pitch:+(l[4]||0)}),!0},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,l)},this._removeHash=()=>{const l=this._getCurrentHash();if(l.length===0)return;const _=l.join("/");let y=_;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${_}`);let S=window.location.hash.replace(y,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let M=window.location.href.replace(/(#.+)?$/,S);M=M.replace("&&","&"),window.history.replaceState(window.history.state,null,M)},this._updateHash=Dl(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const l=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,y),M=Math.round(l.lng*S)/S,O=Math.round(l.lat*S)/S,N=this._map.getBearing(),j=this._map.getPitch();let Z="";if(Z+=n?`/${M}/${O}/${_}`:`${_}/${O}/${M}`,(N||j)&&(Z+="/"+Math.round(10*N)/10),j&&(Z+=`/${Math.round(j)}`),this._hashName){const Y=this._hashName;let G=!1;const re=window.location.hash.slice(1).split("&").map(ne=>{const be=ne.split("=")[0];return be===Y?(G=!0,`${be}=${Z}`):ne}).filter(ne=>ne);return G||re.push(`${Y}=${Z}`),`#${re.join("&")}`}return`#${Z}`}_isValidHash(n){if(n.length<3||n.some(isNaN))return!1;try{new a.Q(+n[2],+n[1])}catch{return!1}const l=+n[0],_=+(n[3]||0),y=+(n[4]||0);return l>=this._map.getMinZoom()&&l<=this._map.getMaxZoom()&&_>=-180&&_<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const hs={linearity:.3,easing:a.cd(0,0,.3,1)},fs=a.e({deceleration:2500,maxSpeed:1400},hs),Bl=a.e({deceleration:20,maxSpeed:1400},hs),fu=a.e({deceleration:1e3,maxSpeed:360},hs),Ah=a.e({deceleration:1e3,maxSpeed:90},hs),Au=a.e({deceleration:1e3,maxSpeed:360},hs);class du{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:V.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=V.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)l.zoom+=S.zoomDelta||0,l.bearing+=S.bearingDelta||0,l.pitch+=S.pitchDelta||0,l.roll+=S.rollDelta||0,S.panDelta&&l.pan._add(S.panDelta),S.around&&(l.around=S.around),S.pinchAround&&(l.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const S=ba(l.pan.mag(),_,a.e({},fs,n||{})),M=l.pan.mult(S.amount/l.pan.mag()),O=this._map.cameraHelper.handlePanInertia(M,this._map.transform);y.center=O.easingCenter,y.offset=O.easingOffset,ya(y,S)}if(l.zoom){const S=ba(l.zoom,_,Bl);y.zoom=this._map.transform.zoom+S.amount,ya(y,S)}if(l.bearing){const S=ba(l.bearing,_,fu);y.bearing=this._map.transform.bearing+a.ae(S.amount,-179,179),ya(y,S)}if(l.pitch){const S=ba(l.pitch,_,Ah);y.pitch=this._map.transform.pitch+S.amount,ya(y,S)}if(l.roll){const S=ba(l.roll,_,Au);y.roll=this._map.transform.roll+a.ae(S.amount,-179,179),ya(y,S)}if(y.zoom||y.bearing){const S=l.pinchAround===void 0?l.around:l.pinchAround;y.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function ya(T,n){(!T.duration||T.duration<n.duration)&&(T.duration=n.duration,T.easing=n.easing)}function ba(T,n,l){const{maxSpeed:_,linearity:y,deceleration:S}=l,M=a.ae(T*y/(n/1e3),-_,_),O=Math.abs(M)/(S*y);return{easing:l.easing,duration:1e3*O,amount:M*(O/2)}}class cn extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,_,y={}){_=_ instanceof MouseEvent?_:new MouseEvent(n,_);const S=W.mousePos(l.getCanvas(),_),M=l.unproject(S);super(n,a.e({point:S,lngLat:M,originalEvent:_},y)),this._defaultPrevented=!1,this.target=l}}class Ja extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,_){const y=n==="touchend"?_.changedTouches:_.touches,S=W.touchPos(l.getCanvasContainer(),y),M=S.map(N=>l.unproject(N)),O=S.reduce((N,j,Z,Y)=>N.add(j.div(Y.length)),new a.P(0,0));super(n,{points:S,point:O,lngLats:M,lngLat:l.unproject(O),originalEvent:_}),this._defaultPrevented=!1}}class pu extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class dh{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new pu(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new cn(n.type,this._map,n))}mouseup(n){this._map.fire(new cn(n.type,this._map,n))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new cn(n.type,this._map,n))}dblclick(n){return this._firePreventable(new cn(n.type,this._map,n))}mouseover(n){this._map.fire(new cn(n.type,this._map,n))}mouseout(n){this._map.fire(new cn(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ja(n.type,this._map,n))}touchmove(n){this._map.fire(new Ja(n.type,this._map,n))}touchend(n){this._map.fire(new Ja(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ja(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class po{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new cn(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new cn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new cn(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gn{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.screenPointToLocation(a.P.convert(n),this._map.terrain)}}class ki{constructor(n,l){this._map=n,this._tr=new Gn(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(W.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const _=l;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=_,this._box||(this._box=W.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(y.x,_.x),M=Math.max(y.x,_.x),O=Math.min(y.y,_.y),N=Math.max(y.y,_.y);W.setTransform(this._box,`translate(${S}px,${O}px)`),this._box.style.width=M-S+"px",this._box.style.height=N-O+"px"}mouseupWindow(n,l){if(!this._active||n.button!==0)return;const _=this._startPos,y=l;if(this.reset(),W.suppressClick(),_.x!==y.x||_.y!==y.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:n})),{cameraAnimation:S=>S.fitScreenCoordinates(_,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new a.l(n,{originalEvent:l}))}}function Yn(T,n){if(T.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${T.length}, points ${n.length}`);const l={};for(let _=0;_<T.length;_++)l[T[_].identifier]=n[_];return l}class Ci{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,l,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const S=new a.P(0,0);for(const M of y)S._add(M);return S.div(y.length)}(l),this.touches=Yn(_,l)))}touchmove(n,l,_){if(this.aborted||!this.centroid)return;const y=Yn(_,l);for(const S in this.touches){const M=y[S];(!M||M.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(n,l,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class qr{constructor(n){this.singleTap=new Ci(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,l,_){this.singleTap.touchstart(n,l,_)}touchmove(n,l,_){this.singleTap.touchmove(n,l,_)}touchend(n,l,_){const y=this.singleTap.touchend(n,l,_);if(y){const S=n.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(y)<30;if(S&&M||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class gu{constructor(n){this._tr=new Gn(n),this._zoomIn=new qr({numTouches:1,numTaps:2}),this._zoomOut=new qr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,_){this._zoomIn.touchstart(n,l,_),this._zoomOut.touchstart(n,l,_)}touchmove(n,l,_){this._zoomIn.touchmove(n,l,_),this._zoomOut.touchmove(n,l,_)}touchend(n,l,_){const y=this._zoomIn.touchend(n,l,_),S=this._zoomOut.touchend(n,l,_),M=this._tr;return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(y)},{originalEvent:n})}):S?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(S)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pn{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const l=this._moveFunction(...n);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(n,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=Array.isArray(l)?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,l){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const y=Array.isArray(l)?l[0]:l;return!this._moved&&y.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(_,y))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&W.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gn={0:1,2:2};class el{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const l=W.mouseButton(n);this._eventButton=l}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(l,_){const y=gn[_];return l.buttons===void 0||(l.buttons&y)!==y}(n,this._eventButton)}isValidEndEvent(n){return W.mouseButton(n)===this._eventButton}}class Rr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}class Hs{constructor(n=new el({checkCorrectEvent:()=>!0}),l=new Rr){this.mouseMoveStateManager=n,this.oneFingerTouchMoveStateManager=l}_executeRelevantHandler(n,l,_){return n instanceof MouseEvent?l(n):typeof TouchEvent<"u"&&n instanceof TouchEvent?_(n):void 0}startMove(n){this._executeRelevantHandler(n,l=>this.mouseMoveStateManager.startMove(l),l=>this.oneFingerTouchMoveStateManager.startMove(l))}endMove(n){this._executeRelevantHandler(n,l=>this.mouseMoveStateManager.endMove(l),l=>this.oneFingerTouchMoveStateManager.endMove(l))}isValidStartEvent(n){return this._executeRelevantHandler(n,l=>this.mouseMoveStateManager.isValidStartEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidStartEvent(l))}isValidMoveEvent(n){return this._executeRelevantHandler(n,l=>this.mouseMoveStateManager.isValidMoveEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(l))}isValidEndEvent(n){return this._executeRelevantHandler(n,l=>this.mouseMoveStateManager.isValidEndEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidEndEvent(l))}}const go=T=>{T.mousedown=T.dragStart,T.mousemoveWindow=T.dragMove,T.mouseup=T.dragEnd,T.contextmenu=n=>{n.preventDefault()}};class ph{constructor(n,l){this._clickTolerance=n.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,l,_){return this._calculateTransform(n,l,_)}touchmove(n,l,_){if(this._active){if(!this._shouldBePrevented(_.length))return n.preventDefault(),this._calculateTransform(n,l,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,l,_){this._calculateTransform(n,l,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,_){_.length>0&&(this._active=!0);const y=Yn(_,l),S=new a.P(0,0),M=new a.P(0,0);let O=0;for(const j in y){const Z=y[j],Y=this._touches[j];Y&&(S._add(Z),M._add(Z.sub(Y)),O++,y[j]=Z)}if(this._touches=y,this._shouldBePrevented(O)||!M.mag())return;const N=M.div(O);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(O),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ut{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,l,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,_){if(!this._firstTwoTouches)return;n.preventDefault();const[y,S]=this._firstTwoTouches,M=qt(_,l,y),O=qt(_,l,S);if(!M||!O)return;const N=this._aroundCenter?null:M.add(O).div(2);return this._move([M,O],N,n)}touchend(n,l,_){if(!this._firstTwoTouches)return;const[y,S]=this._firstTwoTouches,M=qt(_,l,y),O=qt(_,l,S);M&&O||(this._active&&W.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function qt(T,n,l){for(let _=0;_<T.length;_++)if(T[_].identifier===l)return n[_]}function vc(T,n){return Math.log(T/n)/Math.LN2}class va extends Ut{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(vc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vc(this._distance,_),pinchAround:l}}}function ws(T,n){return 180*T.angleWith(n)/Math.PI}class li extends Ut{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l,_){const y=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ws(this._vector,y),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,_=ws(n,this._startVector);return Math.abs(_)<l}}function mo(T){return Math.abs(T.y)>Math.abs(T.x)}class to extends Ut{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,l,_){super.touchstart(n,l,_),this._currentTouchCount=_.length}_start(n){this._lastPoints=n,mo(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=n[0].sub(this._lastPoints[0]),S=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,S,_.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(n,l,_){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,S=l.mag()>=2;if(!y&&!S)return;if(!y||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const M=n.y>0==l.y>0;return mo(n)&&mo(l)&&M}}const mu={panStep:100,bearingStep:15,pitchStep:10};class Ts{constructor(n){this._tr=new Gn(n);const l=mu;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,_=0,y=0,S=0,M=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),S=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),S=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),M=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:O=>{const N=this._tr;O.easeTo({duration:300,easeId:"keyboardHandler",easing:d,zoom:l?Math.round(N.zoom)+l*(n.shiftKey?2:1):N.zoom,bearing:N.bearing+_*this._bearingStep,pitch:N.pitch+y*this._pitchStep,offset:[-S*this._panStep,-M*this._panStep],center:N.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function d(T){return T*(2-T)}const p=4.000244140625;class g{constructor(n,l){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=n,this._tr=new Gn(n),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=V.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,l!==0&&l%p==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=W.mousePos(this._map.getCanvas(),n),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(a.Q.convert(_.center)):l,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const O=n.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=O),typeof this._targetZoom=="number"&&(this._targetZoom+=O)}if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>p?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&N!==0&&(N=1/N);const j=typeof this._targetZoom!="number"?n.scale:a.ac(this._targetZoom);this._targetZoom=n.getConstrained(n.getCameraLngLat(),a.ah(j*N)).zoom,this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom!="number"?n.zoom:this._targetZoom,_=this._startZoom,y=this._easing;let S,M=!1;if(this._type==="wheel"&&_&&y){const O=V.now()-this._lastWheelEventTime,N=Math.min((O+5)/200,1),j=y(N);S=a.B.number(_,l,j),N<1?this._frameId||(this._frameId=!0):M=!0}else S=l,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!M,zoomDelta:S-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=a.cf;if(this._prevEase){const _=this._prevEase,y=(V.now()-_.start)/_.duration,S=_.easing(y+.01)-_.easing(y),M=.27/Math.sqrt(S*S+1e-4)*.01,O=Math.sqrt(.0729-M*M);l=a.cd(M,O,.25,1)}return this._prevEase={start:V.now(),duration:n,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class v{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class x{constructor(n){this._tr=new Gn(n),this.reset()}reset(){this._active=!1}dblclick(n,l){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class I{constructor(){this._tap=new qr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,l,_){if(!this._swipePoint)if(this._tapTime){const y=l[0],S=n.timeStamp-this._tapTime<500,M=this._tapPoint.dist(y)<30;S&&M?_.length>0&&(this._swipePoint=y,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(n,l,_)}touchmove(n,l,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=l[0],S=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(n,l,_)}touchend(n,l,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const y=this._tap.touchend(n,l,_);y&&(this._tapTime=n.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class R{constructor(n,l,_){this._el=n,this._mousePan=l,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class B{constructor(n,l,_,y){this._pitchWithRotate=n.pitchWithRotate,this._rollEnabled=n.rollEnabled,this._mouseRotate=l,this._mousePitch=_,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class z{constructor(n,l,_,y){this._el=n,this._touchZoom=l,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ${constructor(n,l){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=l,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=W.create("div","maplibregl-cooperative-gesture-screen",n);let l=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(l=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=l,this._container.appendChild(y);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=_,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(W.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,l){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:n,originalEvent:l})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const X=T=>T.zoom||T.drag||T.roll||T.pitch||T.rotate;class ce extends a.l{}function Te(T){return T.panDelta&&T.panDelta.mag()||T.zoomDelta||T.bearingDelta||T.pitchDelta||T.rollDelta}class xe{constructor(n,l){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,S)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=y.type==="renderFrame"?void 0:y,O={needsRenderFrame:!1},N={},j={};for(const{handlerName:G,handler:re,allowed:ne}of this._handlers){if(!re.isEnabled())continue;let be;if(this._blockedByActive(j,ne,G))re.reset();else if(re[S||y.type]){if(a.cg(y,S||y.type)){const ye=W.mousePos(this._map.getCanvas(),y);be=re[S||y.type](y,ye)}else if(a.ch(y,S||y.type)){const ye=this._getMapTouches(y.touches),ve=W.touchPos(this._map.getCanvas(),ye);be=re[S||y.type](y,ve,ye)}else a.ci(S||y.type)||(be=re[S||y.type](y));this.mergeHandlerResult(O,N,be,G,M),be&&be.needsRenderFrame&&this._triggerRenderFrame()}(be||re.isActive())&&(j[G]=re)}const Z={};for(const G in this._previousActiveHandlers)j[G]||(Z[G]=M);this._previousActiveHandlers=j,(Object.keys(Z).length||Te(O))&&(this._changes.push([O,N,Z]),this._triggerRenderFrame()),(Object.keys(j).length||Te(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Y}=O;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new du(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,S,M]of this._listeners)W.addEventListener(y,S,y===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[n,l,_]of this._listeners)W.removeEventListener(n,l,n===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const l=this._map,_=l.getCanvasContainer();this._add("mapEvent",new dh(l,n));const y=l.boxZoom=new ki(l,n);this._add("boxZoom",y),n.interactive&&n.boxZoom&&y.enable();const S=l.cooperativeGestures=new $(l,n.cooperativeGestures);this._add("cooperativeGestures",S),n.cooperativeGestures&&S.enable();const M=new gu(l),O=new x(l);l.doubleClickZoom=new v(O,M),this._add("tapZoom",M),this._add("clickZoom",O),n.interactive&&n.doubleClickZoom&&l.doubleClickZoom.enable();const N=new I;this._add("tapDragZoom",N);const j=l.touchPitch=new to(l);this._add("touchPitch",j),n.interactive&&n.touchPitch&&l.touchPitch.enable(n.touchPitch);const Z=()=>l.project(l.getCenter()),Y=function({enable:Oe,clickTolerance:ze,aroundCenter:Xe=!0,minPixelCenterThreshold:Ve=100,rotateDegreesPerPixelMoved:ct=.8},St){const yt=new el({checkCorrectEvent:bt=>W.mouseButton(bt)===0&&bt.ctrlKey||W.mouseButton(bt)===2&&!bt.ctrlKey});return new pn({clickTolerance:ze,move:(bt,xt)=>{const ti=St();if(Xe&&Math.abs(ti.y-bt.y)>Ve)return{bearingDelta:a.ce(new a.P(bt.x,xt.y),xt,ti)};let Kt=(xt.x-bt.x)*ct;return Xe&&xt.y<ti.y&&(Kt=-Kt),{bearingDelta:Kt}},moveStateManager:yt,enable:Oe,assignEvents:go})}(n,Z),G=function({enable:Oe,clickTolerance:ze,pitchDegreesPerPixelMoved:Xe=-.5}){const Ve=new el({checkCorrectEvent:ct=>W.mouseButton(ct)===0&&ct.ctrlKey||W.mouseButton(ct)===2});return new pn({clickTolerance:ze,move:(ct,St)=>({pitchDelta:(St.y-ct.y)*Xe}),moveStateManager:Ve,enable:Oe,assignEvents:go})}(n),re=function({enable:Oe,clickTolerance:ze,rollDegreesPerPixelMoved:Xe=.3},Ve){const ct=new el({checkCorrectEvent:St=>W.mouseButton(St)===2&&St.ctrlKey});return new pn({clickTolerance:ze,move:(St,yt)=>{const bt=Ve();let xt=(yt.x-St.x)*Xe;return yt.y<bt.y&&(xt=-xt),{rollDelta:xt}},moveStateManager:ct,enable:Oe,assignEvents:go})}(n,Z);l.dragRotate=new B(n,Y,G,re),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",re,["mousePitch"]),n.interactive&&n.dragRotate&&l.dragRotate.enable();const ne=function({enable:Oe,clickTolerance:ze}){const Xe=new el({checkCorrectEvent:Ve=>W.mouseButton(Ve)===0&&!Ve.ctrlKey});return new pn({clickTolerance:ze,move:(Ve,ct)=>({around:ct,panDelta:ct.sub(Ve)}),activateOnStart:!0,moveStateManager:Xe,enable:Oe,assignEvents:go})}(n),be=new ph(n,l);l.dragPan=new R(_,ne,be),this._add("mousePan",ne),this._add("touchPan",be,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&l.dragPan.enable(n.dragPan);const ye=new li,ve=new va;l.touchZoomRotate=new z(_,ve,ye,N),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",ve,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&l.touchZoomRotate.enable(n.touchZoomRotate);const Re=l.scrollZoom=new g(l,()=>this._triggerRenderFrame());this._add("scrollZoom",Re,["mousePan"]),n.interactive&&n.scrollZoom&&l.scrollZoom.enable(n.scrollZoom);const Le=l.keyboard=new Ts(l);this._add("keyboard",Le),n.interactive&&n.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new po(l))}_add(n,l,_){this._handlers.push({handlerName:n,handler:l,allowed:_}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!X(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,l,_){for(const y in n)if(y!==_&&(!l||l.indexOf(y)<0))return!0;return!1}_getMapTouches(n){const l=[];for(const _ of n)this._el.contains(_.target)&&l.push(_);return l}mergeHandlerResult(n,l,_,y,S){if(!_)return;a.e(n,_);const M={handlerName:y,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(l.zoom=M),_.panDelta!==void 0&&(l.drag=M),_.rollDelta!==void 0&&(l.roll=M),_.pitchDelta!==void 0&&(l.pitch=M),_.bearingDelta!==void 0&&(l.rotate=M)}_applyChanges(){const n={},l={},_={};for(const[y,S,M]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(n.rollDelta=(n.rollDelta||0)+y.rollDelta),y.around!==void 0&&(n.around=y.around),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),a.e(l,S),a.e(_,M);this._updateMapTransform(n,l,_),this._changes=[]}_updateMapTransform(n,l,_){const y=this._map,S=y._getTransformForUpdate(),M=y.terrain;if(!(Te(n)||M&&this._terrainMovement))return this._fireEvents(l,_,!0);y._stop(!0);let{panDelta:O,zoomDelta:N,bearingDelta:j,pitchDelta:Z,rollDelta:Y,around:G,pinchAround:re}=n;re!==void 0&&(G=re),G=G||y.transform.centerPoint,M&&!S.isPointOnMapSurface(G)&&(G=S.centerPoint);const ne={panDelta:O,zoomDelta:N,rollDelta:Y,pitchDelta:Z,bearingDelta:j,around:G};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(G)&&(G=S.centerPoint);const be=G.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(O?G.sub(O):G);M?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ne,S),this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(O))):this._map.cameraHelper.handleMapControlsPan(ne,S,be):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ne,S,be))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ne,S),this._map.cameraHelper.handleMapControlsPan(ne,S,be)),y._applyUpdatedTransform(S),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,_,!0)}_fireEvents(n,l,_){const y=X(this._eventsInProgress),S=X(n),M={};for(const Y in n){const{originalEvent:G}=n[Y];this._eventsInProgress[Y]||(M[`${Y}start`]=G),this._eventsInProgress[Y]=n[Y]}!y&&S&&this._fireEvent("movestart",S.originalEvent);for(const Y in M)this._fireEvent(Y,M[Y]);S&&this._fireEvent("move",S.originalEvent);for(const Y in n){const{originalEvent:G}=n[Y];this._fireEvent(Y,G)}const O={};let N;for(const Y in this._eventsInProgress){const{handlerName:G,originalEvent:re}=this._eventsInProgress[Y];this._handlersById[G].isActive()||(delete this._eventsInProgress[Y],N=l[G]||re,O[`${Y}end`]=N)}for(const Y in O)this._fireEvent(Y,O[Y]);const j=X(this._eventsInProgress),Z=(y||S)&&!j;if(Z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Y=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Y.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Y)}if(_&&Z){this._updatingCamera=!0;const Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=re=>re!==0&&-this._bearingSnap<re&&re<this._bearingSnap;!Y||!Y.essential&&V.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:N})),G(this._map.getBearing())&&this._map.resetNorth()):(G(Y.bearing||this._map.getBearing())&&(Y.bearing=0),Y.freezeElevation=!0,this._map.easeTo(Y,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new a.l(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new ce("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class we extends a.E{constructor(n,l,_){super(),this._renderFrameCallback=()=>{const y=Math.min((V.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=_.bearingSnap,this.cameraHelper=l,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(n,l){n.apply(this.transform),this.transform=n,this.cameraHelper=l}getCenter(){return new a.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}getCenterElevation(){return this.transform.elevation}setCenterElevation(n,l){return this.jumpTo({elevation:n},l),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(n){this._centerClampedToGround=n}panBy(n,l,_){return n=a.P.convert(n).mult(-1),this.panTo(this.transform.center,a.e({offset:n},l),_)}panTo(n,l,_){return this.easeTo(a.e({center:n},l),_)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,_){return this.easeTo(a.e({zoom:n},l),_)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(n,l){return n!=this.transform.fov&&(this.transform.setFov(n),this.fire(new a.l("movestart",l)).fire(new a.l("move",l)).fire(new a.l("moveend",l))),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,_){return this.easeTo(a.e({bearing:n},l),_)}resetNorth(n,l){return this.rotateTo(0,a.e({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}getRoll(){return this.transform.roll}setRoll(n,l){return this.jumpTo({roll:n},l),this}cameraForBounds(n,l){n=ur.convert(n).adjustAntiMeridian();const _=l&&l.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),_,l)}_cameraForBoxAndBearing(n,l,_,y){const S={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const j=y.padding;y.padding={top:j,bottom:j,right:j,left:j}}const M=a.e(S,y.padding);y.padding=M;const O=this.transform,N=new ur(n,l);return this.cameraHelper.cameraForBoxAndBearing(y,M,N,_,O)}fitBounds(n,l,_){return this._fitInternal(this.cameraForBounds(n,l),l,_)}fitScreenCoordinates(n,l,_,y,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(n)),this.transform.screenPointToLocation(a.P.convert(l)),_,y),y,S)}_fitInternal(n,l,_){return n?(delete(l=a.e(n,l)).padding,l.linear?this.easeTo(l,_):this.flyTo(l,_)):this}jumpTo(n,l){this.stop();const _=this._getTransformForUpdate();let y=!1,S=!1,M=!1;const O=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,n);const N=_.zoom!==O;return"elevation"in n&&_.elevation!==+n.elevation&&_.setElevation(+n.elevation),"bearing"in n&&_.bearing!==+n.bearing&&(y=!0,_.setBearing(+n.bearing)),"pitch"in n&&_.pitch!==+n.pitch&&(S=!0,_.setPitch(+n.pitch)),"roll"in n&&_.roll!==+n.roll&&(M=!0,_.setRoll(+n.roll)),n.padding==null||_.isPaddingEqual(n.padding)||_.setPadding(n.padding),this._applyUpdatedTransform(_),this.fire(new a.l("movestart",l)).fire(new a.l("move",l)),N&&this.fire(new a.l("zoomstart",l)).fire(new a.l("zoom",l)).fire(new a.l("zoomend",l)),y&&this.fire(new a.l("rotatestart",l)).fire(new a.l("rotate",l)).fire(new a.l("rotateend",l)),S&&this.fire(new a.l("pitchstart",l)).fire(new a.l("pitch",l)).fire(new a.l("pitchend",l)),M&&this.fire(new a.l("rollstart",l)).fire(new a.l("roll",l)).fire(new a.l("rollend",l)),this.fire(new a.l("moveend",l))}calculateCameraOptionsFromTo(n,l,_,y=0){const S=a.$.fromLngLat(n,l),M=a.$.fromLngLat(_,y),O=M.x-S.x,N=M.y-S.y,j=M.z-S.z,Z=Math.hypot(O,N,j);if(Z===0)throw new Error("Can't calculate camera options with same From and To");const Y=Math.hypot(O,N),G=a.ah(this.transform.cameraToCenterDistance/Z/this.transform.tileSize),re=180*Math.atan2(O,-N)/Math.PI;let ne=180*Math.acos(Y/Z)/Math.PI;return ne=j<0?90-ne:90+ne,{center:M.toLngLat(),elevation:y,zoom:G,pitch:ne,bearing:re}}calculateCameraOptionsFromCameraLngLatAltRotation(n,l,_,y,S){const M=this.transform.calculateCenterFromCameraLngLatAlt(n,l,_,y);return{center:M.center,elevation:M.elevation,zoom:M.zoom,bearing:_,pitch:y,roll:S}}easeTo(n,l){this._stop(!1,n.easeId),((n=a.e({offset:[0,0],duration:500,easing:a.cf},n)).animate===!1||!n.essential&&V.prefersReducedMotion)&&(n.duration=0);const _=this._getTransformForUpdate(),y=this.getBearing(),S=_.pitch,M=_.roll,O="bearing"in n?this._normalizeBearing(n.bearing,y):y,N="pitch"in n?+n.pitch:S,j="roll"in n?this._normalizeBearing(n.roll,M):M,Z="padding"in n?n.padding:_.padding,Y=a.P.convert(n.offset);let G,re;n.around&&(G=a.Q.convert(n.around),re=_.locationToScreenPoint(G));const ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},be=this.cameraHelper.handleEaseTo(_,{bearing:O,pitch:N,roll:j,padding:Z,around:G,aroundPoint:re,offsetAsPoint:Y,offset:n.offset,zoom:n.zoom,center:n.center});return this._rotating=this._rotating||y!==O,this._pitching=this._pitching||N!==S,this._rolling=this._rolling||j!==M,this._padding=!_.isPaddingEqual(Z),this._zooming=this._zooming||be.isZooming,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,ne),this.terrain&&this._prepareElevation(be.elevationCenter),this._ease(ye=>{be.easeFunc(ye),this.terrain&&!n.freezeElevation&&this._updateElevation(ye),this._applyUpdatedTransform(_),this._fireMoveEvents(l)},ye=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(l,ye)},n),this}_prepareEase(n,l,_={}){this._moving=!0,l||_.moving||this.fire(new a.l("movestart",n)),this._zooming&&!_.zooming&&this.fire(new a.l("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new a.l("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new a.l("pitchstart",n)),this._rolling&&!_.rolling&&this.fire(new a.l("rollstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&l!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(_-(l-(_*n+this._elevationStart))/(1-n)),this._elevationTarget=l}this.transform.setElevation(a.B.number(this._elevationStart,this._elevationTarget,n))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){if(!this.terrain&&n.elevation>=0&&n.pitch<=90)return{};const l=n.getCameraLngLat(),_=n.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(l,n.zoom):0;if(_<y){const S=this.calculateCameraOptionsFromTo(l,y,n.center,n.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(n){const l=[];if(l.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&l.push(y=>this.transformCameraUpdate(y)),!l.length)return;const _=n.clone();for(const y of l){const S=_.clone(),{center:M,zoom:O,roll:N,pitch:j,bearing:Z,elevation:Y}=y(S);M&&S.setCenter(M),Y!==void 0&&S.setElevation(Y),O!==void 0&&S.setZoom(O),N!==void 0&&S.setRoll(N),j!==void 0&&S.setPitch(j),Z!==void 0&&S.setBearing(Z),_.apply(S)}this.transform.apply(_)}_fireMoveEvents(n){this.fire(new a.l("move",n)),this._zooming&&this.fire(new a.l("zoom",n)),this._rotating&&this.fire(new a.l("rotate",n)),this._pitching&&this.fire(new a.l("pitch",n)),this._rolling&&this.fire(new a.l("roll",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const _=this._zooming,y=this._rotating,S=this._pitching,M=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new a.l("zoomend",n)),y&&this.fire(new a.l("rotateend",n)),S&&this.fire(new a.l("pitchend",n)),M&&this.fire(new a.l("rollend",n)),this.fire(new a.l("moveend",n))}flyTo(n,l){if(!n.essential&&V.prefersReducedMotion){const xt=a.O(n,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(xt,l)}this.stop(),n=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cf},n);const _=this._getTransformForUpdate(),y=_.bearing,S=_.pitch,M=_.roll,O=_.padding,N="bearing"in n?this._normalizeBearing(n.bearing,y):y,j="pitch"in n?+n.pitch:S,Z="roll"in n?this._normalizeBearing(n.roll,M):M,Y="padding"in n?n.padding:_.padding,G=a.P.convert(n.offset);let re=_.centerPoint.add(G);const ne=_.screenPointToLocation(re),be=this.cameraHelper.handleFlyTo(_,{bearing:N,pitch:j,roll:Z,padding:Y,locationAtOffset:ne,offsetAsPoint:G,center:n.center,minZoom:n.minZoom,zoom:n.zoom});let ye=n.curve;const ve=Math.max(_.width,_.height),Re=ve/be.scaleOfZoom,Le=be.pixelPathLength;typeof be.scaleOfMinZoom=="number"&&(ye=Math.sqrt(ve/be.scaleOfMinZoom/Le*2));const Oe=ye*ye;function ze(xt){const ti=(Re*Re-ve*ve+(xt?-1:1)*Oe*Oe*Le*Le)/(2*(xt?Re:ve)*Oe*Le);return Math.log(Math.sqrt(ti*ti+1)-ti)}function Xe(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function Ve(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const ct=ze(!1);let St=function(xt){return Ve(ct)/Ve(ct+ye*xt)},yt=function(xt){return ve*((Ve(ct)*(Xe(ti=ct+ye*xt)/Ve(ti))-Xe(ct))/Oe)/Le;var ti},bt=(ze(!0)-ct)/ye;if(Math.abs(Le)<2e-6||!isFinite(bt)){if(Math.abs(ve-Re)<1e-6)return this.easeTo(n,l);const xt=Re<ve?-1:1;bt=Math.abs(Math.log(Re/ve))/ye,yt=()=>0,St=ti=>Math.exp(xt*ye*ti)}return n.duration="duration"in n?+n.duration:1e3*bt/("screenSpeed"in n?+n.screenSpeed/ye:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=y!==N,this._pitching=j!==S,this._rolling=Z!==M,this._padding=!_.isPaddingEqual(Y),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(be.targetCenter),this._ease(xt=>{const ti=xt*bt,Kt=1/St(ti),Ot=yt(ti);this._rotating&&_.setBearing(a.B.number(y,N,xt)),this._pitching&&_.setPitch(a.B.number(S,j,xt)),this._rolling&&_.setRoll(a.B.number(M,Z,xt)),this._padding&&(_.interpolatePadding(O,Y,xt),re=_.centerPoint.add(G)),be.easeFunc(xt,Kt,Ot,re),this.terrain&&!n.freezeElevation&&this._updateElevation(xt),this._applyUpdatedTransform(_),this._fireMoveEvents(l)},()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(l)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,l)}return n||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(n,l,_){_.animate===!1||_.duration===0?(n(1),l()):(this._easeStart=V.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,l){n=a.aL(n,-180,180);const _=Math.abs(n-l);return Math.abs(n-360-l)<_&&(n-=360),Math.abs(n+360-l)<_&&(n+=360),n}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(a.Q.convert(n),this.transform.tileZoom):null}}const je={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ze{constructor(n=je){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=W.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=W.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const _=this._map._getUIString(`AttributionControl.${l}`);n.title=_,n.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style.sourceCaches;for(const y in l){const S=l[y];if(S.used||S.usedForTerrain){const M=S.getSource();M.attribution&&n.indexOf(M.attribution)<0&&n.push(M.attribution)}}n=n.filter(y=>String(y).trim()),n.sort((y,S)=>y.length-S.length),n=n.filter((y,S)=>{for(let M=S+1;M<n.length;M++)if(n[M].indexOf(y)>=0)return!1;return!0});const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=W.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class gt{constructor(n={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const _=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=W.create("div","maplibregl-ctrl");const l=W.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){W.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class at{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,_=l?this._queue.concat(l):this._queue;for(const y of _)if(y.id===n)return void(y.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const _ of l)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var st=a.aG([{name:"a_pos3d",type:"Int16",components:3}]);class qe extends a.E{constructor(n){super(),this._lastTilesetChange=V.now(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=n._source.tileSize*2**this.deltaZoom,n.usedForTerrain=!0,n.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,l){this.sourceCache.update(n,l),this._renderableTilesKeys=[];const _={};for(const y of Ge(n,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),a.bQ(y.terrainRttPosMatrix32f,0,a.Z,a.Z,0,0,1),this._tiles[y.key]=new lo(y,this.tileSize),this._lastTilesetChange=V.now());for(const y in this._tiles)_[y]||delete this._tiles[y]}freeRtt(n){for(const l in this._tiles){const _=this._tiles[l];(!n||_.tileID.equals(n)||_.tileID.isChildOf(n)||n.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n,l){return l?this._getTerrainCoordsForTileRanges(n,l):this._getTerrainCoordsForRegularTile(n)}_getTerrainCoordsForRegularTile(n){const l={};for(const _ of this._renderableTilesKeys){const y=this._tiles[_].tileID,S=n.clone(),M=a.b2();if(y.canonical.equals(n.canonical))a.bQ(M,0,a.Z,a.Z,0,0,1);else if(y.canonical.isChildOf(n.canonical)){const O=y.canonical.z-n.canonical.z,N=y.canonical.x-(y.canonical.x>>O<<O),j=y.canonical.y-(y.canonical.y>>O<<O),Z=a.Z>>O;a.bQ(M,0,Z,Z,0,0,1),a.L(M,M,[-N*Z,-j*Z,0])}else{if(!n.canonical.isChildOf(y.canonical))continue;{const O=n.canonical.z-y.canonical.z,N=n.canonical.x-(n.canonical.x>>O<<O),j=n.canonical.y-(n.canonical.y>>O<<O),Z=a.Z>>O;a.bQ(M,0,a.Z,a.Z,0,0,1),a.L(M,M,[N*Z,j*Z,0]),a.M(M,M,[1/2**O,1/2**O,0])}}S.terrainRttPosMatrix32f=new Float32Array(M),l[_]=S}return l}_getTerrainCoordsForTileRanges(n,l){const _={};for(const y of this._renderableTilesKeys){const S=this._tiles[y].tileID;if(!this._isWithinTileRanges(S,l))continue;const M=n.clone(),O=a.b2();if(S.canonical.z===n.canonical.z){const N=n.canonical.x-S.canonical.x,j=n.canonical.y-S.canonical.y;a.bQ(O,0,a.Z,a.Z,0,0,1),a.L(O,O,[N*a.Z,j*a.Z,0])}else if(S.canonical.z>n.canonical.z){const N=S.canonical.z-n.canonical.z,j=S.canonical.x-(S.canonical.x>>N<<N),Z=S.canonical.y-(S.canonical.y>>N<<N),Y=n.canonical.x-(S.canonical.x>>N),G=n.canonical.y-(S.canonical.y>>N),re=a.Z>>N;a.bQ(O,0,re,re,0,0,1),a.L(O,O,[-j*re+Y*a.Z,-Z*re+G*a.Z,0])}else{const N=n.canonical.z-S.canonical.z,j=n.canonical.x-(n.canonical.x>>N<<N),Z=n.canonical.y-(n.canonical.y>>N<<N),Y=(n.canonical.x>>N)-S.canonical.x,G=(n.canonical.y>>N)-S.canonical.y,re=a.Z<<N;a.bQ(O,0,re,re,0,0,1),a.L(O,O,[j*a.Z+Y*re,Z*a.Z+G*re,0])}M.terrainRttPosMatrix32f=new Float32Array(O),_[y]=M}return _}getSourceTile(n,l){const _=this.sourceCache._source;let y=n.overscaledZ-this.deltaZoom;if(y>_.maxzoom&&(y=_.maxzoom),y<_.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(y).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!S||!S.dem)&&l)for(;y>=_.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(n.scaledTo(y--).key);return S}anyTilesAfterTime(n=Date.now()){return this._lastTilesetChange>=n}_isWithinTileRanges(n,l){return l[n.canonical.z]&&n.canonical.x>=l[n.canonical.z].minTileX&&n.canonical.x<=l[n.canonical.z].maxTileX&&n.canonical.y>=l[n.canonical.z].minTileY&&n.canonical.y<=l[n.canonical.z].maxTileY}}class Zt{constructor(n,l,_){this._meshCache={},this.painter=n,this.sourceCache=new qe(l),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,l,_,y=a.Z){var S;if(!(l>=0&&l<y&&_>=0&&_<y))return 0;const M=this.getTerrainData(n),O=(S=M.tile)===null||S===void 0?void 0:S.dem;if(!O)return 0;const N=a.cj([],[l/y*a.Z,_/y*a.Z],M.u_terrain_matrix),j=[N[0]*O.dim,N[1]*O.dim],Z=Math.floor(j[0]),Y=Math.floor(j[1]),G=j[0]-Z,re=j[1]-Y;return O.get(Z,Y)*(1-G)*(1-re)+O.get(Z+1,Y)*G*(1-re)+O.get(Z,Y+1)*(1-G)*re+O.get(Z+1,Y+1)*G*re}getElevationForLngLatZoom(n,l){if(!a.ck(l,n.wrap()))return 0;const{tileID:_,mercatorX:y,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(n,l);return this.getElevation(_,y%a.Z,S%a.Z,a.Z)}getElevation(n,l,_,y=a.Z){return this.getDEMElevation(n,l,_,y)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const y=this.painter.context,S=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new It(y,S,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new It(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ad([])}const l=this.sourceCache.getSourceTile(n,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const y=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new It(y,l.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),l.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const _=l&&l+l.tileID.key+n.key;if(_&&!this._demMatrixCache[_]){const y=this.sourceCache.sourceCache._source.maxzoom;let S=n.canonical.z-l.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=y?S=n.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=n.canonical.x-(n.canonical.x>>S<<S),O=n.canonical.y-(n.canonical.y>>S<<S),N=a.cl(new Float64Array(16),[1/(a.Z<<S),1/(a.Z<<S),0]);a.L(N,N,[M*a.Z,O*a.Z,0]),this._demMatrixCache[n.key]={matrix:N,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(n){const l=this.painter,_=l.width/devicePixelRatio,y=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new It(l.context,{width:_,height:y,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new It(l.context,{width:_,height:y,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(_,y,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,_,y))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,M=0;S<this._coordsTextureSize;S++)for(let O=0;O<this._coordsTextureSize;O++,M+=4)l[M+0]=255&O,l[M+1]=255&S,l[M+2]=O>>8<<4|S>>8,l[M+3]=0;const _=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),y=new It(n,_,n.gl.RGBA,{premultiply:!1});return y.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const l=new Uint8Array(4),_=this.painter.context,y=_.gl,S=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),O=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(S,O-M-1,1,1,y.RGBA,y.UNSIGNED_BYTE,l),_.bindFramebuffer.set(null);const N=l[0]+(l[2]>>4<<8),j=l[1]+((15&l[2])<<8),Z=this.coordsIndex[255-l[3]],Y=Z&&this.sourceCache.getTileByID(Z);if(!Y)return null;const G=this._coordsTextureSize,re=(1<<Y.tileID.canonical.z)*G;return new a.$((Y.tileID.canonical.x*G+N)/re+Y.tileID.wrap,(Y.tileID.canonical.y*G+j)/re,this.getElevation(Y.tileID,N,j,G))}depthAtPoint(n){const l=new Uint8Array(4),_=this.painter.context,y=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,l),_.bindFramebuffer.set(null),(l[0]/16777216+l[1]/65536+l[2]/256+l[3])/256}getTerrainMesh(n){var l;const _=((l=this.painter.style.projection)===null||l===void 0?void 0:l.transitionState)>0,y=_&&n.canonical.y===0,S=_&&n.canonical.y===(1<<n.canonical.z)-1,M=`m_${y?"n":""}_${S?"s":""}`;if(this._meshCache[M])return this._meshCache[M];const O=this.painter.context,N=new a.cm,j=new a.aK,Z=this.meshSize,Y=a.Z/Z,G=Z*Z;for(let Ve=0;Ve<=Z;Ve++)for(let ct=0;ct<=Z;ct++)N.emplaceBack(ct*Y,Ve*Y,0);for(let Ve=0;Ve<G;Ve+=Z+1)for(let ct=0;ct<Z;ct++)j.emplaceBack(ct+Ve,Z+ct+Ve+1,Z+ct+Ve+2),j.emplaceBack(ct+Ve,Z+ct+Ve+2,ct+Ve+1);const re=N.length,ne=re+(Z+1),be=(Z+1)*Z,ye=y?a.b9:0,ve=y?0:1,Re=S?a.ba:a.Z,Le=S?0:1;for(let Ve=0;Ve<=Z;Ve++)N.emplaceBack(Ve*Y,ye,ve);for(let Ve=0;Ve<=Z;Ve++)N.emplaceBack(Ve*Y,Re,Le);for(let Ve=0;Ve<Z;Ve++)j.emplaceBack(be+Ve,ne+Ve,ne+Ve+1),j.emplaceBack(be+Ve,ne+Ve+1,be+Ve+1),j.emplaceBack(0+Ve,re+Ve+1,re+Ve),j.emplaceBack(0+Ve,0+Ve+1,re+Ve+1);const Oe=N.length,ze=Oe+2*(Z+1);for(const Ve of[0,1])for(let ct=0;ct<=Z;ct++)for(const St of[0,1])N.emplaceBack(Ve*a.Z,ct*Y,St);for(let Ve=0;Ve<2*Z;Ve+=2)j.emplaceBack(Oe+Ve,Oe+Ve+1,Oe+Ve+3),j.emplaceBack(Oe+Ve,Oe+Ve+3,Oe+Ve+2),j.emplaceBack(ze+Ve,ze+Ve+3,ze+Ve+1),j.emplaceBack(ze+Ve,ze+Ve+2,ze+Ve+3);const Xe=new Ua(O.createVertexBuffer(N,st.members),O.createIndexBuffer(j),a.aJ.simpleSegment(0,0,N.length,j.length));return this._meshCache[M]=Xe,Xe}getMeshFrameDelta(n){return 2*Math.PI*a.bu/Math.pow(2,Math.max(n,0))/5}getMinTileElevationForLngLatZoom(n,l){var _;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(n,l);return(_=this.getMinMaxElevation(y).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(n){const l=this.getTerrainData(n).tile,_={minElevation:null,maxElevation:null};return l&&l.dem&&(_.minElevation=l.dem.min*this.exaggeration,_.maxElevation=l.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(n,l){const _=a.$.fromLngLat(n.wrap()),y=(1<<l)*a.Z,S=_.x*y,M=_.y*y,O=Math.floor(S/a.Z),N=Math.floor(M/a.Z);return{tileID:new a.Y(l,0,l,O,N),mercatorX:S,mercatorY:M}}}class yi{constructor(n,l,_){this._context=n,this._size=l,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new It(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(_.texture),{id:n,fbo:l,texture:_,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>n.id!==l),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const ai={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ni{constructor(n,l){this.painter=n,this.terrain=l,this.pool=new yi(n.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(_=>!n._layers[_].isHidden(l)),this._coordsAscending={};for(const _ in n.sourceCaches){this._coordsAscending[_]={};const y=n.sourceCaches[_].getVisibleCoordinates(),S=n.sourceCaches[_].getSource(),M=S instanceof tr?S.terrainTileRanges:null;for(const O of y){const N=this.terrain.sourceCache.getTerrainCoords(O,M);for(const j in N)this._coordsAscending[_][j]||(this._coordsAscending[_][j]=[]),this._coordsAscending[_][j].push(N[j])}}this._coordsAscendingStr={};for(const _ of n._order){const y=n._layers[_],S=y.source;if(ai[y.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const M in this._coordsAscending[S])this._coordsAscendingStr[S][M]=this._coordsAscending[S][M].map(O=>O.key).sort().join()}}for(const _ of this._renderableTiles)for(const y in this._coordsAscendingStr){const S=this._coordsAscendingStr[y][_.tileID.key];S&&S!==_.rttCoords[y]&&(_.rtt=[])}}renderLayer(n,l){if(n.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},l),{isRenderingToTexture:!0}),y=n.type,S=this.painter,M=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(ai[y]&&(this._prevType&&ai[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(n.id),!M))return!0;if(ai[this._prevType]||ai[y]&&M){this._prevType=y;const O=this._stacks.length-1,N=this._stacks[O]||[];for(const j of this._renderableTiles){if(this.pool.isFull()&&(Ao(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(j),j.rtt[O]){const Y=this.pool.getObjectForId(j.rtt[O].id);if(Y.stamp===j.rtt[O].stamp){this.pool.useObject(Y);continue}}const Z=this.pool.getOrCreateFreeObject();this.pool.useObject(Z),this.pool.stampObject(Z),j.rtt[O]={id:Z.id,stamp:Z.stamp},S.context.bindFramebuffer.set(Z.fbo.framebuffer),S.context.clear({color:a.b7.transparent,stencil:0}),S.currentStencilSource=void 0;for(let Y=0;Y<N.length;Y++){const G=S.style._layers[N[Y]],re=G.source?this._coordsAscending[G.source][j.tileID.key]:[j.tileID];S.context.viewport.set([0,0,Z.fbo.width,Z.fbo.height]),S._renderTileClippingMasks(G,re,!0),S.renderLayer(S,S.style.sourceCaches[G.source],G,re,_),G.source&&(j.rttCoords[G.source]=this._coordsAscendingStr[G.source][j.tileID.key])}}return Ao(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),ai[y]}return!1}}const Ft={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gt=w,Ri={hash:!1,interactive:!0,bearingSnap:7,attributionControl:je,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},mi={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ht{constructor(n,l,_=!1){this.mousedown=S=>{this.startMove(S,W.mousePos(this.element,S)),W.addEventListener(window,"mousemove",this.mousemove),W.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,W.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHanlder.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),W.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=l;const y=new Hs;this._rotatePitchHanlder=new pn({clickTolerance:3,move:(S,M)=>{const O=l.getBoundingClientRect(),N=new a.P((O.bottom-O.top)/2,(O.right-O.left)/2);return{bearingDelta:a.ce(new a.P(S.x,M.y),M,N),pitchDelta:_?-.5*(M.y-S.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=n,W.addEventListener(l,"mousedown",this.mousedown),W.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(l,"touchcancel",this.reset)}startMove(n,l){this._rotatePitchHanlder.dragStart(n,l),W.disableDrag()}move(n,l){const _=this.map,{bearingDelta:y,pitchDelta:S}=this._rotatePitchHanlder.dragMove(n,l)||{};y&&_.setBearing(_.getBearing()+y),S&&_.setPitch(_.getPitch()+S)}off(){const n=this.element;W.removeEventListener(n,"mousedown",this.mousedown),W.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend),W.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){W.enableDrag(),W.removeEventListener(window,"mousemove",this.mousemove),W.removeEventListener(window,"mouseup",this.mouseup),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend)}}let bi;function _r(T,n,l,_=!1){if(_||!l.getCoveringTilesDetailsProvider().allowWorldCopies())return T==null?void 0:T.wrap();const y=new a.Q(T.lng,T.lat);if(T=new a.Q(T.lng,T.lat),n){const S=new a.Q(T.lng-360,T.lat),M=new a.Q(T.lng+360,T.lat),O=l.locationToScreenPoint(T).distSqr(n);l.locationToScreenPoint(S).distSqr(n)<O?T=S:l.locationToScreenPoint(M).distSqr(n)<O&&(T=M)}for(;Math.abs(T.lng-l.center.lng)>180;){const S=l.locationToScreenPoint(T);if(S.x>=0&&S.y>=0&&S.x<=l.width&&S.y<=l.height)break;T.lng>l.center.lng?T.lng-=360:T.lng+=360}return T.lng!==y.lng&&l.isPointOnMapSurface(l.locationToScreenPoint(T))?T:y}const Ii={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Er(T,n,l){const _=T.classList;for(const y in Ii)_.remove(`maplibregl-${l}-anchor-${y}`);_.add(`maplibregl-${l}-anchor-${n}`)}class Jr extends a.E{constructor(n){if(super(),this._onKeyPress=l=>{const _=l.code,y=l.charCode||l.keyCode;_!=="Space"&&_!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=l=>{const _=l.originalEvent.target,y=this._element;this._popup&&(_===y||y.contains(_))&&this.togglePopup()},this._update=l=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((l==null?void 0:l.type)==="terrain"||(l==null?void 0:l.type)==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=_r(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||l&&l.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,`${Ii[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${y}`),V.frameAsync(new AbortController).then(()=>{this._updateOpacity(l&&l.type==="moveend")}).catch(()=>{})},this._onMove=l=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(n==null?void 0:n.opacity,n==null?void 0:n.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=a.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div");const l=W.createNS("http://www.w3.org/2000/svg","svg"),_=41,y=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${_}px`),l.setAttributeNS(null,"width",`${y}px`),l.setAttributeNS(null,"viewBox",`0 0 ${y} ${_}`);const S=W.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const M=W.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const O=W.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of N){const Re=W.createNS("http://www.w3.org/2000/svg","ellipse");Re.setAttributeNS(null,"opacity","0.04"),Re.setAttributeNS(null,"cx","10.5"),Re.setAttributeNS(null,"cy","5.80029008"),Re.setAttributeNS(null,"rx",ve.rx),Re.setAttributeNS(null,"ry",ve.ry),O.appendChild(Re)}const j=W.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill",this._color);const Z=W.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),j.appendChild(Z);const Y=W.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");const G=W.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(G);const re=W.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),re.setAttributeNS(null,"fill","#FFFFFF");const ne=W.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const be=W.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#000000"),be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962");const ye=W.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),ne.appendChild(be),ne.appendChild(ye),M.appendChild(O),M.appendChild(j),M.appendChild(Y),M.appendChild(re),M.appendChild(ne),l.appendChild(M),l.setAttributeNS(null,"height",_*this._scale+"px"),l.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(l),this._offset=a.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),Er(this._element,this._anchor,"marker"),n&&n.className)for(const l of n.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),n.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.Q.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var l,_;const y=(l=this._map)===null||l===void 0?void 0:l.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!y||S){const re=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==re&&(this._element.style.opacity=re))}if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const M=this._map,O=M.terrain.depthAtPoint(this._pos),N=M.terrain.getElevationForLngLatZoom(this._lngLat,M.transform.tileZoom);if(M.transform.lngLatToCameraDepth(this._lngLat,N)-O<.006)return void(this._element.style.opacity=this._opacity);const j=-this._offset.y/M.transform.pixelsPerMeter,Z=Math.sin(M.getPitch()*Math.PI/180)*j,Y=M.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),G=M.transform.lngLatToCameraDepth(this._lngLat,N+Z)-Y>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=a.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,l){return(this._opacity===void 0||n===void 0&&l===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),l!==void 0&&(this._opacityWhenCovered=l),this._map&&this._updateOpacity(!0),this}}const Fr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Xr=0,xc=!1;const _u={maxWidth:100,unit:"metric"};function yu(T,n,l){const _=l&&l.maxWidth||100,y=T._container.clientHeight/2,S=T._container.clientWidth/2,M=T.unproject([S-_/2,y]),O=T.unproject([S+_/2,y]),N=Math.round(T.project(O).x-T.project(M).x),j=Math.min(_,N,T._container.clientWidth),Z=M.distanceTo(O);if(l&&l.unit==="imperial"){const Y=3.2808*Z;Y>5280?Ol(n,j,Y/5280,T._getUIString("ScaleControl.Miles")):Ol(n,j,Y,T._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Ol(n,j,Z/1852,T._getUIString("ScaleControl.NauticalMiles")):Z>=1e3?Ol(n,j,Z/1e3,T._getUIString("ScaleControl.Kilometers")):Ol(n,j,Z,T._getUIString("ScaleControl.Meters"))}function Ol(T,n,l,_){const y=function(S){const M=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/M;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(N){const j=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*j)/j}(O),M*O}(l);T.style.width=n*(y/l)+"px",T.innerHTML=`${y}&nbsp;${_}`}const kf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Df=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wc(T){if(T){if(typeof T=="number"){const n=Math.round(Math.abs(T)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,T),"top-left":new a.P(n,n),"top-right":new a.P(-n,n),bottom:new a.P(0,-T),"bottom-left":new a.P(n,-n),"bottom-right":new a.P(-n,-n),left:new a.P(T,0),right:new a.P(-T,0)}}if(T instanceof a.P||Array.isArray(T)){const n=a.P.convert(T);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:a.P.convert(T.center||[0,0]),top:a.P.convert(T.top||[0,0]),"top-left":a.P.convert(T["top-left"]||[0,0]),"top-right":a.P.convert(T["top-right"]||[0,0]),bottom:a.P.convert(T.bottom||[0,0]),"bottom-left":a.P.convert(T["bottom-left"]||[0,0]),"bottom-right":a.P.convert(T["bottom-right"]||[0,0]),left:a.P.convert(T.left||[0,0]),right:a.P.convert(T.right||[0,0])}}return wc(new a.P(0,0))}const Bf=w;f.AJAXError=a.cq,f.Event=a.l,f.Evented=a.E,f.LngLat=a.Q,f.MercatorCoordinate=a.$,f.Point=a.P,f.addProtocol=a.cr,f.config=a.a,f.removeProtocol=a.cs,f.AttributionControl=Ze,f.BoxZoomHandler=ki,f.CanvasSource=Tn,f.CooperativeGesturesHandler=$,f.DoubleClickZoomHandler=v,f.DragPanHandler=R,f.DragRotateHandler=B,f.EdgeInsets=gl,f.FullscreenControl=class extends a.E{constructor(T={}){super(),this._onFullscreenChange=()=>{var n;let l=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=l==null?void 0:l.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,T&&T.container&&(T.container instanceof HTMLElement?this._container=T.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(T){return this._map=T,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){W.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const T=this._fullscreenButton=W.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);W.create("span","maplibregl-ctrl-icon",T).setAttribute("aria-hidden","true"),T.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const T=this._getTitle();this._fullscreenButton.setAttribute("aria-label",T),this._fullscreenButton.title=T}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=dr,f.GeolocateControl=class extends a.E{constructor(T){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",n)),this._finish()}},this._updateCamera=n=>{const l=new a.Q(n.coords.longitude,n.coords.latitude),_=n.coords.accuracy,y=this._map.getBearing(),S=a.e({bearing:y},this.options.fitBoundsOptions),M=ur.fromLngLat(l,_);this._map.fitBounds(M,S,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const l=new a.Q(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&xc)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=W.create("button","maplibregl-ctrl-geolocate",this._container),W.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Jr({element:this._dotElement}),this._circleElement=W.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},Fr,T)}onAdd(T){return this._map=T,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(n=!1){if(bi!==void 0&&!n)return bi;if(window.navigator.permissions===void 0)return bi=!!window.navigator.geolocation,bi;try{bi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{bi=!!window.navigator.geolocation}return bi})}().then(n=>this._finishSetupUI(n)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xr=0,xc=!1}_isOutOfMapMaxBounds(T){const n=this._map.getMaxBounds(),l=T.coords;return n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const T=this._map.getBounds(),n=T.getSouthEast(),l=T.getNorthEast(),_=n.distanceTo(l),y=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xr--,xc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let T;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xr++,Xr>1?(T={maximumAge:6e5,timeout:0},xc=!0):(T=this.options.positionOptions,xc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,T)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var T;const n=(T=this._map.getProjection())===null||T===void 0?void 0:T.type;this._map.setProjection(n!=="mercator"&&n?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var T;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((T=this._map.getProjection())===null||T===void 0?void 0:T.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(T){return this._map=T,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=W.create("button","maplibregl-ctrl-globe",this._container),W.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=hu,f.ImageSource=tr,f.KeyboardHandler=Ts,f.LngLatBounds=ur,f.LogoControl=gt,f.Map=class extends we{constructor(T){var n,l;a.cn.mark(a.co.create);const _=Object.assign(Object.assign(Object.assign({},Ri),T),{canvasContextAttributes:Object.assign(Object.assign({},Ri.canvasContextAttributes),T.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new Wa,S=new ia;if(_.minZoom!==void 0&&y.setMinZoom(_.minZoom),_.maxZoom!==void 0&&y.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&y.setMinPitch(_.minPitch),_.maxPitch!==void 0&&y.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&y.setRenderWorldCopies(_.renderWorldCopies),super(y,S,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new at,this._controls=[],this._mapId=a.a4(),this._contextLost=O=>{O.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:O}))},this._contextRestored=O=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:O}))},this._onMapScroll=O=>{if(O.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ft),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=De.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ye(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let O=!1;const N=Dl(j=>{this._trackResize&&!this._removed&&(this.resize(j),this.redraw())},50);this._resizeObserver=new ResizeObserver(j=>{O?N(j):O=!0}),this._resizeObserver.observe(this._container)}this.handlers=new xe(this,_),this._hash=_.hash&&new hu(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,a.e({},_.fitBoundsOptions,{duration:0}))));const M=typeof _.style=="string"||((l=(n=_.style)===null||n===void 0?void 0:n.projection)===null||l===void 0?void 0:l.type)!=="globe";this.resize(null,M),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Ze(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new gt,_.logoPosition),this.on("style.load",()=>{if(M||this._resizeTransform(),this.transform.unmodified){const O=a.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(O)}}),this.on("data",O=>{this._update(O.dataType==="style"),this.fire(new a.l(`${O.dataType}data`,O))}),this.on("dataloading",O=>{this.fire(new a.l(`${O.dataType}dataloading`,O))}),this.on("dataabort",O=>{this.fire(new a.l("sourcedataabort",O))})}_getMapId(){return this._mapId}addControl(T,n){if(n===void 0&&(n=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=T.onAdd(this);this._controls.push(T);const _=this._controlPositions[n];return n.indexOf("bottom")!==-1?_.insertBefore(l,_.firstChild):_.appendChild(l),this}removeControl(T){if(!T||!T.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(T);return n>-1&&this._controls.splice(n,1),T.onRemove(this),this}hasControl(T){return this._controls.indexOf(T)>-1}calculateCameraOptionsFromTo(T,n,l,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(T,n,l,_)}resize(T,n=!0){const[l,_]=this._containerDimensions(),y=this._getClampedPixelRatio(l,_);if(this._resizeCanvas(l,_,y),this.painter.resize(l,_,y),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const O=this._getClampedPixelRatio(l,_);this._resizeCanvas(l,_,O),this.painter.resize(l,_,O)}this._resizeTransform(n);const S=!this._moving;return S&&(this.stop(),this.fire(new a.l("movestart",T)).fire(new a.l("move",T))),this.fire(new a.l("resize",T)),S&&this.fire(new a.l("moveend",T)),this}_resizeTransform(T=!0){var n;const[l,_]=this._containerDimensions();this.transform.resize(l,_,T),(n=this._requestedCameraState)===null||n===void 0||n.resize(l,_,T)}_getClampedPixelRatio(T,n){const{0:l,1:_}=this._maxCanvasSize,y=this.getPixelRatio(),S=T*y,M=n*y;return Math.min(S>l?l/S:1,M>_?_/M:1)*y}getPixelRatio(){var T;return(T=this._overridePixelRatio)!==null&&T!==void 0?T:devicePixelRatio}setPixelRatio(T){this._overridePixelRatio=T,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(T){return this.transform.setMaxBounds(ur.convert(T)),this._update()}setMinZoom(T){if((T=T??-2)>=-2&&T<=this.transform.maxZoom)return this.transform.setMinZoom(T),this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(T){if((T=T??22)>=this.transform.minZoom)return this.transform.setMaxZoom(T),this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(T){if((T=T??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.setMinPitch(T),this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(T){if((T=T??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(T>=this.transform.minPitch)return this.transform.setMaxPitch(T),this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(T){return this.transform.setRenderWorldCopies(T),this._update()}project(T){return this.transform.locationToScreenPoint(a.Q.convert(T),this.style&&this.terrain)}unproject(T){return this.transform.screenPointToLocation(a.P.convert(T),this.terrain)}isMoving(){var T;return this._moving||((T=this.handlers)===null||T===void 0?void 0:T.isMoving())}isZooming(){var T;return this._zooming||((T=this.handlers)===null||T===void 0?void 0:T.isZooming())}isRotating(){var T;return this._rotating||((T=this.handlers)===null||T===void 0?void 0:T.isRotating())}_createDelegatedListener(T,n,l){if(T==="mouseenter"||T==="mouseover"){let _=!1;return{layers:n,listener:l,delegates:{mousemove:S=>{const M=n.filter(N=>this.getLayer(N)),O=M.length!==0?this.queryRenderedFeatures(S.point,{layers:M}):[];O.length?_||(_=!0,l.call(this,new cn(T,this,S.originalEvent,{features:O}))):_=!1},mouseout:()=>{_=!1}}}}if(T==="mouseleave"||T==="mouseout"){let _=!1;return{layers:n,listener:l,delegates:{mousemove:M=>{const O=n.filter(N=>this.getLayer(N));(O.length!==0?this.queryRenderedFeatures(M.point,{layers:O}):[]).length?_=!0:_&&(_=!1,l.call(this,new cn(T,this,M.originalEvent)))},mouseout:M=>{_&&(_=!1,l.call(this,new cn(T,this,M.originalEvent)))}}}}{const _=y=>{const S=n.filter(O=>this.getLayer(O)),M=S.length!==0?this.queryRenderedFeatures(y.point,{layers:S}):[];M.length&&(y.features=M,l.call(this,y),delete y.features)};return{layers:n,listener:l,delegates:{[T]:_}}}}_saveDelegatedListener(T,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(n)}_removeDelegatedListener(T,n,l){if(!this._delegatedListeners||!this._delegatedListeners[T])return;const _=this._delegatedListeners[T];for(let y=0;y<_.length;y++){const S=_[y];if(S.listener===l&&S.layers.length===n.length&&S.layers.every(M=>n.includes(M))){for(const M in S.delegates)this.off(M,S.delegates[M]);return void _.splice(y,1)}}}on(T,n,l){if(l===void 0)return super.on(T,n);const _=typeof n=="string"?[n]:n,y=this._createDelegatedListener(T,_,l);this._saveDelegatedListener(T,y);for(const S in y.delegates)this.on(S,y.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(T,_,l)}}}once(T,n,l){if(l===void 0)return super.once(T,n);const _=typeof n=="string"?[n]:n,y=this._createDelegatedListener(T,_,l);for(const S in y.delegates){const M=y.delegates[S];y.delegates[S]=(...O)=>{this._removeDelegatedListener(T,_,l),M(...O)}}this._saveDelegatedListener(T,y);for(const S in y.delegates)this.once(S,y.delegates[S]);return this}off(T,n,l){return l===void 0?super.off(T,n):(this._removeDelegatedListener(T,typeof n=="string"?[n]:n,l),this)}queryRenderedFeatures(T,n){if(!this.style)return[];let l;const _=T instanceof a.P||Array.isArray(T),y=_?T:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(_?{}:T)||{},y instanceof a.P||typeof y[0]=="number")l=[a.P.convert(y)];else{const S=a.P.convert(y[0]),M=a.P.convert(y[1]);l=[S,new a.P(M.x,S.y),M,new a.P(S.x,M.y),S]}return this.style.queryRenderedFeatures(l,n,this.transform)}querySourceFeatures(T,n){return this.style.querySourceFeatures(T,n)}setStyle(T,n){return(n=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(T,n))}setTransformRequest(T){return this._requestManager.setTransformRequest(T),this}_getUIString(T){const n=this._locale[T];if(n==null)throw new Error(`Missing UI string '${T}'`);return n}_updateStyle(T,n){var l,_;if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(T,n));const y=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!T)),T?(this.style=new Gc(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T,n,y):this.style.loadJSON(T,n,y),this):((_=(l=this.style)===null||l===void 0?void 0:l.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(T,n){if(typeof T=="string"){const l=this._requestManager.transformRequest(T,"Style");a.j(l,new AbortController).then(_=>{this._updateDiff(_.data,n)}).catch(_=>{_&&this.fire(new a.k(_))})}else typeof T=="object"&&this._updateDiff(T,n)}_updateDiff(T,n){try{this.style.setState(T,n)&&this._update(!0)}catch(l){a.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(T,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(T,n){return this._lazyInitEmptyStyle(),this.style.addSource(T,n),this._update(!0)}isSourceLoaded(T){const n=this.style&&this.style.sourceCaches[T];if(n!==void 0)return n.loaded();this.fire(new a.k(new Error(`There is no source with ID '${T}'`)))}setTerrain(T){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),T){const n=this.style.sourceCaches[T.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${T.source}`);this.terrain===null&&n.reload();for(const l in this.style._layers){const _=this.style._layers[l];_.type==="hillshade"&&_.source===T.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Zt(this.painter,n,T),this.painter.renderToTexture=new Ni(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=l=>{var _;l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==T.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=l.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:T})),this}getTerrain(){var T,n;return(n=(T=this.terrain)===null||T===void 0?void 0:T.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const T=this.style&&this.style.sourceCaches;for(const n in T){const l=T[n]._tiles;for(const _ in l){const y=l[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(T){return this.style.removeSource(T),this._update(!0)}getSource(T){return this.style.getSource(T)}setSourceTileLodParams(T,n,l){if(l){const _=this.getSource(l);if(!_)throw new Error(`There is no source with ID "${l}", cannot set LOD parameters`);_.calculateTileZoom=$e(Math.max(1,T),Math.max(1,n))}else for(const _ in this.style.sourceCaches)this.style.sourceCaches[_].getSource().calculateTileZoom=$e(Math.max(1,T),Math.max(1,n));return this._update(!0),this}refreshTiles(T,n){const l=this.style.sourceCaches[T];if(!l)throw new Error(`There is no source cache with ID "${T}", cannot refresh tile`);n===void 0?l.reload():l.refreshTiles(n.map(_=>new a.a1(_.z,_.x,_.y)))}addImage(T,n,l={}){const{pixelRatio:_=1,sdf:y=!1,stretchX:S,stretchY:M,content:O,textFitWidth:N,textFitHeight:j}=l;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||a.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Z,height:Y,data:G}=n,re=n;return this.style.addImage(T,{data:new a.R({width:Z,height:Y},new Uint8Array(G)),pixelRatio:_,stretchX:S,stretchY:M,content:O,textFitWidth:N,textFitHeight:j,sdf:y,version:0,userImage:re}),re.onAdd&&re.onAdd(this,T),this}}{const{width:Z,height:Y,data:G}=V.getImageData(n);this.style.addImage(T,{data:new a.R({width:Z,height:Y},G),pixelRatio:_,stretchX:S,stretchY:M,content:O,textFitWidth:N,textFitHeight:j,sdf:y,version:0})}}updateImage(T,n){const l=this.style.getImage(T);if(!l)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof HTMLImageElement||a.b(n)?V.getImageData(n):n,{width:y,height:S,data:M}=_;if(y===void 0||S===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==l.data.width||S!==l.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(n instanceof HTMLImageElement||a.b(n));return l.data.replace(M,O),this.style.updateImage(T,l),this}getImage(T){return this.style.getImage(T)}hasImage(T){return T?!!this.style.getImage(T):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(T){this.style.removeImage(T)}loadImage(T){return De.getImage(this._requestManager.transformRequest(T,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(T,n){return this._lazyInitEmptyStyle(),this.style.addLayer(T,n),this._update(!0)}moveLayer(T,n){return this.style.moveLayer(T,n),this._update(!0)}removeLayer(T){return this.style.removeLayer(T),this._update(!0)}getLayer(T){return this.style.getLayer(T)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(T,n,l){return this.style.setLayerZoomRange(T,n,l),this._update(!0)}setFilter(T,n,l={}){return this.style.setFilter(T,n,l),this._update(!0)}getFilter(T){return this.style.getFilter(T)}setPaintProperty(T,n,l,_={}){return this.style.setPaintProperty(T,n,l,_),this._update(!0)}getPaintProperty(T,n){return this.style.getPaintProperty(T,n)}setLayoutProperty(T,n,l,_={}){return this.style.setLayoutProperty(T,n,l,_),this._update(!0)}getLayoutProperty(T,n){return this.style.getLayoutProperty(T,n)}setGlyphs(T,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(T,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(T,n,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(T,n,l,_=>{_||this._update(!0)}),this}removeSprite(T){return this._lazyInitEmptyStyle(),this.style.removeSprite(T),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(T,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(T,n,l=>{l||this._update(!0)}),this}setLight(T,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(T,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(T,n={}){return this._lazyInitEmptyStyle(),this.style.setSky(T,n),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(T,n){return this.style.setFeatureState(T,n),this._update()}removeFeatureState(T,n){return this.style.removeFeatureState(T,n),this._update()}getFeatureState(T){return this.style.getFeatureState(T)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let T=0,n=0;return this._container&&(T=this._container.clientWidth||400,n=this._container.clientHeight||300),[T,n]}_setupContainer(){const T=this._container;T.classList.add("maplibregl-map");const n=this._canvasContainer=W.create("div","maplibregl-canvas-container",T);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=W.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),_=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],_);const y=this._controlContainer=W.create("div","maplibregl-control-container",T),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{S[M]=W.create("div",`maplibregl-ctrl-${M} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(T,n,l){this._canvas.width=Math.floor(l*T),this._canvas.height=Math.floor(l*n),this._canvas.style.width=`${T}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const T=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let n=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{n={requestedAttributes:T},_&&(n.statusMessage=_.statusMessage,n.type=_.type)},{once:!0});let l=null;if(l=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,T):this._canvas.getContext("webgl2",T)||this._canvas.getContext("webgl",T),!l){const _="Failed to initialize WebGL";throw n?(n.message=_,new Error(JSON.stringify(n))):new Error(_)}this.painter=new Zr(l,this.transform),ee.testSupport(l)}migrateProjection(T,n){super.migrateProjection(T,n),this.painter.transform=T,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(T){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(T){return this._update(),this._renderTaskQueue.add(T)}_cancelRenderFrame(T){this._renderTaskQueue.remove(T)}_render(T){var n,l,_,y,S;const M=this._idleTriggered?this._fadeDuration:0,O=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),this._removed)return;let N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Y=this.transform.zoom,G=V.now();this.style.zoomHistory.update(Y,G);const re=new a.C(Y,{now:G,fadeDuration:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ne=re.crossFadingFactor();ne===1&&ne===this._crossFadingFactor||(N=!0,this._crossFadingFactor=ne),this.style.update(re)}const j=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0!==O;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||j)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,j),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cn.mark(a.co.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const Z=this._sourcesDirty||this._styleDirty||this._placementDirty;return Z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||Z||(this._fullyLoaded=!0,a.cn.mark(a.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var T;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),De.removeThrottleControl(this._imageQueueHandle),(T=this._resizeObserver)===null||T===void 0||T.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n!=null&&n.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),W.remove(this._canvasContainer),W.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cn.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,V.frame(this._frameRequest,T=>{a.cn.frame(T),this._frameRequest=null;try{this._render(T)}catch(n){if(!a.cp(n)&&!function(l){return l.message===Cl}(n))throw n}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())}get showPadding(){return!!this._showPadding}set showPadding(T){this._showPadding!==T&&(this._showPadding=T,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())}get repaint(){return!!this._repaint}set repaint(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(T){this._vertices=T,this._update()}get version(){return Gt}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(T){return this._lazyInitEmptyStyle(),this.style.setProjection(T),this._update(!0)}},f.MapMouseEvent=cn,f.MapTouchEvent=Ja,f.MapWheelEvent=pu,f.Marker=Jr,f.NavigationControl=class{constructor(T){this._updateZoomButtons=()=>{const n=this._map.getZoom(),l=n===this._map.getMaxZoom(),_=n===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(n,l)=>{const _=this._map._getUIString(`NavigationControl.${l}`);n.title=_,n.setAttribute("aria-label",_)},this.options=a.e({},mi,T),this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),W.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),W.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=W.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(T){return this._map=T,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ht(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(T,n){const l=W.create("button",T,this._container);return l.type="button",l.addEventListener("click",n),l}},f.Popup=class extends a.E{constructor(T){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=W.create("div","maplibregl-popup",this._map.getContainer()),this._tip=W.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=_r(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!n)return;const l=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const y=wc(this.options.offset);if(!_){const M=this._container.offsetWidth,O=this._container.offsetHeight;let N;N=l.y+y.bottom.y<O?["top"]:l.y>this._map.transform.height-O?["bottom"]:[],l.x<M/2?N.push("left"):l.x>this._map.transform.width-M/2&&N.push("right"),_=N.length===0?"bottom":N.join("-")}let S=l.add(y[_]);this.options.subpixelPositioning||(S=S.round()),W.setTransform(this._container,`${Ii[_]} translate(${S.x}px,${S.y}px)`),Er(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(kf),T)}addTo(T){return this._map&&this.remove(),this._map=T,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(T){return this._lngLat=a.Q.convert(T),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(T){return this.setDOMContent(document.createTextNode(T))}setHTML(T){const n=document.createDocumentFragment(),l=document.createElement("body");let _;for(l.innerHTML=T;_=l.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){var T;return(T=this._container)===null||T===void 0?void 0:T.style.maxWidth}setMaxWidth(T){return this.options.maxWidth=T,this._update(),this}setDOMContent(T){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(T),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(T){return this._container&&this._container.classList.add(T),this}removeClassName(T){return this._container&&this._container.classList.remove(T),this}setOffset(T){return this.options.offset=T,this._update(),this}toggleClassName(T){if(this._container)return this._container.classList.toggle(T)}setSubpixelPositioning(T){this.options.subpixelPositioning=T}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const T=this._container.querySelector(Df);T&&T.focus()}},f.RasterDEMTileSource=Pi,f.RasterTileSource=zt,f.ScaleControl=class{constructor(T){this._onMove=()=>{yu(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,yu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_u),T)}getDefaultPosition(){return"bottom-left"}onAdd(T){return this._map=T,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-scale",T.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=g,f.Style=Gc,f.TerrainControl=class{constructor(T){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=T}onAdd(T){return this._map=T,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=W.create("button","maplibregl-ctrl-terrain",this._container),W.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){W.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=to,f.TwoFingersTouchRotateHandler=li,f.TwoFingersTouchZoomHandler=va,f.TwoFingersTouchZoomRotateHandler=z,f.VectorTileSource=Vt,f.VideoSource=or,f.addSourceType=(T,n)=>a._(void 0,void 0,void 0,function*(){if(Sn(T))throw new Error(`A source type called "${T}" already exists.`);((l,_)=>{rs[l]=_})(T,n)}),f.clearPrewarmedResources=function(){const T=Ai;T&&(T.isPreloaded()&&T.numActive()===1?(T.release(Pt),Ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=Ws,f.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Qs().getRTLTextPluginStatus()},f.getVersion=function(){return Bf},f.getWorkerCount=function(){return Ct.workerCount},f.getWorkerUrl=function(){return a.a.WORKER_URL},f.importScriptInWorkers=function(T){return Li().broadcast("IS",T)},f.prewarm=function(){Zi().acquire(Pt)},f.setMaxParallelImageRequests=function(T){a.a.MAX_PARALLEL_IMAGE_REQUESTS=T},f.setRTLTextPlugin=function(T,n){return Qs().setRTLTextPlugin(T,n)},f.setWorkerCount=function(T){Ct.workerCount=T},f.setWorkerUrl=function(T){a.a.WORKER_URL=T}});var c=t;return c})}(Qd)),Qd.exports}var QC=YC();const Wo=Tx(QC);var rA=d_;function d_(i,e){return i===e||i!==i&&e!==e?!0:typeof i!=typeof e||{}.toString.call(i)!={}.toString.call(e)||i!==Object(i)||!i?!1:Array.isArray(i)?c1(i,e):{}.toString.call(i)=="[object Set]"?c1(Array.from(i),Array.from(e)):{}.toString.call(i)=="[object Object]"?JC(i,e):KC(i,e)}function KC(i,e){return i.toString()===e.toString()}function c1(i,e){var t=i.length;if(t!=e.length)return!1;for(var r=0;r<t;r++)if(!d_(i[r],e[r]))return!1;return!0}function JC(i,e){var t=Object.keys(i),r=t.length;if(r!=Object.keys(e).length)return!1;for(var o=0;o<r;o++){var c=t[o];if(!(e.hasOwnProperty(c)&&d_(i[c],e[c])))return!1}return!0}const{LngLatBounds:eI,LngLat:tI}=Wo;function Td(i,e){return Math.abs(i-e)<1e-6}function iI(i,e){let t=eI.convert(i);if(!e)return{equal:!1,bounds:t};let r=t.getNorthEast(),o=e.getNorthEast();if(!Td(r.lat,o.lat)||!Td(r.wrap().lng,o.wrap().lng))return{equal:!1,bounds:t};let c=t.getSouthWest(),f=e.getSouthWest();return!Td(c.lat,f.lat)||!Td(c.wrap().lng,f.wrap().lng)?{equal:!1,bounds:t}:{equal:!0,bounds:t}}function rI(i,e){const t=i.getSouthWest(),r=i.getNorthEast();if(Array.isArray(e)){if(e.length===4)return[t.lng,t.lat,r.lng,r.lat];if(e.length===2)return e[0]instanceof tI?[t,r]:[[t.lng,t.lat],[r.lng,r.lat]]}return i}function nI(i,e){Go(e,!0);const t=fr(ff),r=fr(()=>Ue(t).map),o=fr(()=>Ue(t).loaded);let c=Yt(e,"position",3,"top-left"),f=Yt(e,"showCompass",3,!0),a=Yt(e,"showZoom",3,!0),w=Yt(e,"visualizePitch",3,!1),P=xr(void 0);Vn(()=>{Ue(r)&&!Ue(P)&&(Bi(P,new Wo.NavigationControl({showCompass:f(),showZoom:a(),visualizePitch:w()}),!0),Ue(r).addControl(Ue(P),c()))}),Gu(()=>{Ue(o)&&Ue(P)&&Ue(r).removeControl(Ue(P))}),Yo()}function sI(i,e){Go(e,!0);const t=fr(ff),r=fr(()=>Ue(t).map),o=fr(()=>Ue(t).loaded);let c=Yt(e,"position",3,"top-left"),f=Yt(e,"positionOptions",3,void 0),a=Yt(e,"fitBoundsOptions",3,void 0),w=Yt(e,"trackUserLocation",3,!1),P=Yt(e,"showAccuracyCircle",3,!0),k=Yt(e,"showUserLocation",3,!0),F=Yt(e,"control",15);Vn(()=>{Ue(r)&&!F()&&(F(new Wo.GeolocateControl({positionOptions:f(),fitBoundsOptions:a(),trackUserLocation:w(),showAccuracyCircle:P(),showUserLocation:k()})),Ue(r).addControl(F(),c()))}),Gu(()=>{Ue(o)&&F()&&Ue(r).removeControl(F())}),Yo()}function oI(i,e){Go(e,!0);const t=fr(ff),r=fr(()=>Ue(t).map),o=fr(()=>Ue(t).loaded);let c=Yt(e,"position",3,"top-left"),f=Yt(e,"container",3,void 0),a=xr(void 0),w=fr(()=>typeof f()=="string"?document.querySelector(f())??void 0:f());Vn(()=>{Ue(a)||(Ue(w)?Bi(a,new Wo.FullscreenControl({container:Ue(w)}),!0):Bi(a,new Wo.FullscreenControl,!0),Ue(r).addControl(Ue(a),c()))}),Gu(()=>{Ue(o)&&Ue(a)&&Ue(r).removeControl(Ue(a))}),Yo()}function aI(i,e){Go(e,!0);const t=fr(ff),r=fr(()=>Ue(t).map),o=fr(()=>Ue(t).loaded);let c=Yt(e,"position",3,"bottom-left"),f=Yt(e,"maxWidth",3,void 0),a=Yt(e,"unit",3,"metric"),w=xr(void 0);Vn(()=>{Ue(r)&&!Ue(w)&&(Bi(w,new Wo.ScaleControl({maxWidth:f(),unit:a()}),!0),Ue(r).addControl(Ue(w),c()))}),Gu(()=>{Ue(o)&&Ue(w)&&Ue(r).removeControl(Ue(w))}),Yo()}var lI=Ms("<!> <!> <!> <!>",1),cI=Ms("<!> <!>",1),uI=Ms('<div data-testid="map-container"><!></div>');function hI(i,e){Go(e,!0);let t=Yt(e,"map",15,void 0),r=Yt(e,"mapContainer",15,void 0),o=Yt(e,"class",3,void 0),c=Yt(e,"diffStyleUpdates",3,!1),f=Yt(e,"center",15,void 0),a=Yt(e,"zoom",15,void 0),w=Yt(e,"pitch",15,0),P=Yt(e,"bearing",15,0),k=Yt(e,"bearingSnap",3,7),F=Yt(e,"bounds",15,void 0),V=Yt(e,"hash",3,!1),W=Yt(e,"projection",3,void 0),ee=Yt(e,"updateHash",3,zt=>{window.history.replaceState(window.history.state,"",zt)}),he=Yt(e,"loaded",15,!1),Ie=Yt(e,"minZoom",3,0),Ee=Yt(e,"maxZoom",3,22),Ne=Yt(e,"minPitch",3,0),Ce=Yt(e,"maxPitch",3,60),De=Yt(e,"renderWorldCopies",3,void 0),Ye=Yt(e,"dragPan",3,void 0),Ke=Yt(e,"dragRotate",3,void 0),kt=Yt(e,"pitchWithRotate",3,void 0),It=Yt(e,"antialias",3,void 0),jt=Yt(e,"zoomOnDoubleClick",3,!0),Lt=Yt(e,"locale",3,void 0),Mt=Yt(e,"interactive",3,!0),vi=Yt(e,"attributionControl",3,void 0),Xt=Yt(e,"cooperativeGestures",3,!1),Jt=Yt(e,"preserveDrawingBuffer",3,!1),zi=Yt(e,"maxBounds",3,void 0),Fe=Yt(e,"images",19,()=>[]),tt=Yt(e,"standardControls",3,!1),Me=Yt(e,"filterLayers",3,void 0),dt=Yt(e,"transformRequest",3,void 0),vt=fr(()=>typeof tt()=="boolean"?void 0:tt());const Pt=WC();yx(new fp(void 0));let Ct=xr(pm(new Set));async function ei(zt,Pi=!1){var dr;if(t()&&!(!((dr=t())!=null&&dr.loaded())&&!Pi))if("url"in zt){Ue(Ct).add(zt.id);try{let tr=await t().loadImage(zt.url);t().addImage(zt.id,tr.data,zt.options),Pt.loadedImages.add(zt.id)}catch(tr){e.onerror?e.onerror({error:tr}):console.error(tr)}finally{Ue(Ct).delete(zt.id)}}else t().addImage(zt.id,zt.data,zt.options),Pt.loadedImages.add(zt.id)}Vn(()=>{var zt;if(he()&&((zt=t())!=null&&zt.loaded()))for(let Pi of Fe())!Pt.loadedImages.has(Pi.id)&&!Ue(Ct).has(Pi.id)&&!t().hasImage(Pi.id)&&ei(Pi)});let Ai=fr(()=>Fe().every(zt=>Pt.loadedImages.has(zt.id))),oi=xr(void 0),Zi=xr(void 0),Oi=xr(void 0),Li=xr(void 0);function Ar(zt){e.onerror?e.onerror(zt):zt.error.name!=="AbortError"&&console.error(zt.error)}function Yi(zt){return wr(),t(Pt.map=new Wo.Map(MC({container:zt,style:e.style,locale:Lt(),center:f(),zoom:a(),pitch:w(),bearing:P(),bearingSnap:k(),minZoom:Ie(),maxZoom:Ee(),minPitch:Ne(),maxPitch:Ce(),renderWorldCopies:De(),dragPan:Ye(),dragRotate:Ke(),pitchWithRotate:kt(),antialias:It(),interactive:Mt(),preserveDrawingBuffer:Jt(),maxBounds:zi(),bounds:F(),attributionControl:vi(),transformRequest:dt(),cooperativeGestures:Xt()}))),t().on("load",Pi=>{Pi.target.getContainer().setAttribute("data-testid","map"),Pi.target.getCanvas().setAttribute("data-testid","map-canvas"),e.onload&&e.onload(t()),Pt.loaded=!0,he(!0)}),t().on("error",Ar),e.onmovestart&&t().on("movestart",e.onmovestart),t().on("moveend",Pi=>{var dr;if(f(Pi.target.getCenter()),a(Pi.target.getZoom()),w(Pi.target.getPitch()),P(Pi.target.getBearing()),F(rI(Pi.target.getBounds(),F())),(dr=e.onmoveend)==null||dr.call(e,Pi),V()){let tr=new URL(window.location.href.replace(/(#.+)?$/,qC(Pi.target)));ee()(tr)}}),e.onclick&&t().on("click",e.onclick),e.ondblclick&&t().on("dblclick",e.ondblclick),e.oncontextmenu&&t().on("contextmenu",e.oncontextmenu),e.onmousemove&&t().on("mousemove",e.onmousemove),e.onzoomstart&&t().on("zoomstart",e.onzoomstart),e.onzoom&&t().on("zoom",e.onzoom),e.onzoomend&&t().on("zoomend",e.onzoomend),e.onpitch&&t().on("pitch",e.onpitch),e.onrotate&&t().on("rotate",e.onrotate),e.onwheel&&t().on("wheel",e.onwheel),e.ondata&&t().on("data",e.ondata),e.onidle&&t().on("idle",e.onidle),t().on("style.load",Pi=>{var dr;if(t()){W()&&t().setProjection(W()),Pt.loaded=!0,he(!0);const tr=t().getStyle();if(Bi(oi,tr.layers.map(or=>or.id),!0),Bi(Zi,Object.keys(tr.sources),!0),Ue(Li))for(const[or,Tn]of Object.entries(Ue(Li)))t().addSource(or,Tn);if(Ue(Oi))for(const or of Ue(Oi))t().addLayer(or);for(const or of Fe())ei(or,!0);(dr=e.onstyleload)==null||dr.call(e,Pi)}}),t().on("styledata",Pi=>{var dr;if(t()&&Me()){const tr=t().getStyle().layers;if(tr)for(let or of tr)Me()(or)||t().setLayoutProperty(or.id,"visibility","none")}(dr=e.onstyledata)==null||dr.call(e,Pi)}),{destroy(){var Pi;he(!1),Pt.loaded=!1,(Pi=t())==null||Pi.remove()}}}let Fi=xr(pm(e.style));Vn(()=>{if(t()&&!rA(e.style,Ue(Fi))){const zt=t().getStyle();if(Ue(oi)&&Bi(Oi,zt.layers.filter(Pi=>!Ue(oi).includes(Pi.id)),!0),Ue(Zi)){const Pi=Object.keys(zt.sources).filter(dr=>!Ue(Zi).includes(dr));Bi(Li,{},!0);for(const dr of Pi)Ue(Li)[dr]=zt.sources[dr]}Bi(Fi,e.style,!0),t().setStyle(e.style,{diff:c()}),Pt.loadedImages.clear(),Bi(Ct,new Set,!0)}}),Vn(()=>{if(t()){let zt={};f()!=null&&!rA(f(),t().getCenter())&&(zt.center=f()),a()!=null&&!rA(a(),t().getZoom())&&(zt.zoom=a()),P()!=null&&!rA(P(),t().getBearing())&&(zt.bearing=P()),w()!=null&&!rA(w(),t().getPitch())&&(zt.pitch=w()),Object.keys(zt).length&&t().easeTo(zt)}}),Vn(()=>{var zt;W()&&he()&&((zt=t())==null||zt.setProjection(W()))}),Vn(()=>{var zt,Pi;if(F()){const{equal:dr,bounds:tr}=iI(F(),(zt=t())==null?void 0:zt.getBounds());dr||(Pi=t())==null||Pi.fitBounds(tr)}}),Vn(()=>{var zt,Pi;jt()?(zt=t())==null||zt.doubleClickZoom.enable():(Pi=t())==null||Pi.doubleClickZoom.disable()});function wr(){if(V()){let zt=XC(window.location.hash);zt.length>=3&&(a(zt[0]),f([zt[2],zt[1]])),zt.length==5&&(P(zt[3]),w(zt[4]))}}var sr=uI();dC("hashchange",iC,wr);let ur;var qi=Hi(sr);{var Vt=zt=>{var Pi=cI(),dr=qo(Pi);{var tr=Tn=>{var rs=lI(),Sn=qo(rs);nI(Sn,{get position(){return Ue(vt)}});var js=Ti(Sn,2);sI(js,{get position(){return Ue(vt)},fitBoundsOptions:{maxZoom:12}});var ao=Ti(js,2);oI(ao,{get position(){return Ue(vt)}});var Io=Ti(ao,2);aI(Io,{get position(){return Ue(vt)}}),pr(Tn,rs)};ms(dr,Tn=>{tt()&&Tn(tr)})}var or=Ti(dr,2);hf(or,()=>e.children??uf,()=>({map:t(),loaded:he(),loadedImages:Pt.loadedImages,allImagesLoaded:Ue(Ai)})),pr(zt,Pi)};ms(qi,zt=>{t()&&zt(Vt)})}Vi(sr),cx(sr,zt=>r(zt),()=>r()),wC(sr,zt=>Yi==null?void 0:Yi(zt)),so(zt=>ur=Oc(sr,1,f_(o()),"svelte-p00lfq",ur,zt),[()=>({"expand-map":!o()})]),pr(i,sr),Yo()}function Rh(i,e){Go(e,!0);let t=Yt(e,"id",19,()=>BC("deckgl-layer")),r=Yt(e,"interleaved",3,!1),o=Yt(e,"minzoom",3,void 0),c=Yt(e,"maxzoom",3,void 0),f=Yt(e,"visible",3,!0),a=Yt(e,"interactive",3,!0),w=Yt(e,"hovered",15),P=Yt(e,"beforeId",3,void 0),k=Yt(e,"onclick",3,void 0),F=Yt(e,"onmousemove",3,void 0),V=Yt(e,"onmouseleave",3,void 0),W=lC(e,["$$slots","$$events","$$legacy","id","interleaved","minzoom","maxzoom","visible","interactive","hovered","type","data","beforeId","children","onclick","onmousemove","onmouseleave"]);const ee=ff(),he=fr(()=>ee.map),Ie=fr(()=>ee.loaded),Ee=fr(()=>ee.minzoom),Ne=fr(()=>ee.maxzoom);let Ce=xr(void 0);h_(async()=>{Bi(Ce,await aC(()=>import("./Czij_WAs.js"),[],import.meta.url),!0)});const{layer:De,layerEvent:Ye}=HC();De.value=t(),NC(new fp(void 0));let Ke=xr(pm(ee.map.getZoom()??1));function kt(){Bi(Ke,Ue(he).getZoom(),!0)}function It(Me){var dt;a()&&((dt=k())==null||dt(Me),Ye.value={...Me,layerType:"deckgl",type:"click"})}function jt(Me){if(!a())return;const dt=Me.index!==-1?"mousemove":"mouseleave";w(Me.object??void 0);const vt=dt==="mousemove"?F():V();vt==null||vt(Me),Ye.value={...Me,layerType:"deckgl",type:dt}}let Lt=xr(void 0);Gu(()=>{Ue(Ie)&&Ue(Lt)&&(Ue(he).removeControl(Ue(Lt)),Ue(he).off("zoom",kt),Ue(he).off("zoomend",kt))}),Vn(()=>{De.value=t()});let Mt=fr(()=>o()??Ue(Ee)),vi=fr(()=>c()??Ue(Ne)),Xt=fr(()=>f()&&Ue(Ke)>=Ue(Mt)&&Ue(Ke)<=Ue(vi)),Jt=fr(()=>({...W,beforeId:P(),visible:Ue(Xt),data:e.data,pickable:a(),onClick:It,onHover:jt}));Vn(()=>{Ue(Ie)&&Ue(he)&&Ue(Ce)&&!Ue(Lt)&&(Ue(he).on("zoom",kt),Ue(he).on("zoomend",kt),kt(),Bi(Lt,new(Ue(Ce)).MapboxOverlay({id:t(),interleaved:r(),layers:[new e.type(Ue(Jt))]}),!0),Ue(he).addControl(Ue(Lt)))}),Vn(()=>{var Me;(Me=Ue(Lt))==null||Me.setProps({layers:[new e.type(Ue(Jt))]})});var zi=Vc(),Fe=qo(zi);{var tt=Me=>{var dt=Vc(),vt=qo(dt);hf(vt,()=>e.children??uf),pr(Me,dt)};ms(Fe,Me=>{Ue(Lt)&&Me(tt)})}pr(i,zi),Yo()}function u1(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const Ex=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),h1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);h1&&parseFloat(h1[1]);const Sd=globalThis,kh=globalThis.process||{},fI=globalThis.navigator||{};function Cx(i){var r,o;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((o=process.versions)!=null&&o.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Af(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||Cx()}function AI(i){return Af()?Cx()?"Electron":(fI.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Ix="4.1.0";function dI(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class pI{constructor(e,t,r="sessionStorage"){this.storage=dI(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function gI(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function mI(i,e=8){const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}var Ap;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ap||(Ap={}));const _I=10;function f1(i){return typeof i!="string"?i:(i=i.toUpperCase(),Ap[i]||Ap.WHITE)}function yI(i,e,t){return!Af&&typeof i=="string"&&(e&&(i=`\x1B[${f1(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${f1(t)+_I}m${i}\x1B[49m`)),i}function bI(i,e=["constructor"]){const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),o=i;for(const c of r){const f=o[c];typeof f=="function"&&(e.find(a=>c===a)||(o[c]=f.bind(i)))}}function p_(i,e){if(!i)throw new Error("Assertion failed")}function Dh(){var e,t,r;let i;if(Af()&&Sd.performance)i=(t=(e=Sd==null?void 0:Sd.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in kh){const o=(r=kh==null?void 0:kh.hrtime)==null?void 0:r.call(kh);i=o[0]*1e3+o[1]/1e6}else i=Date.now();return i}const Bh={debug:Af()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},vI={enabled:!0,level:0};function Oh(){}const A1={},d1={once:!0};class td{constructor({id:e}={id:""}){this.VERSION=Ix,this._startTs=Dh(),this._deltaTs=Dh(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new pI(`__probe-${this.id}__`,vI),this.timeStamp(`${this.id} started`),bI(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Dh()-this._startTs).toPrecision(10))}getDelta(){return Number((Dh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Bh.warn,arguments,d1)}error(e){return this._getLogFunction(0,e,Bh.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Bh.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Bh.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Bh.debug||Bh.info,arguments,d1)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Oh,r&&[r],{tag:wI(t)}):Oh}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Oh)}group(e,t,r={collapsed:!1}){const o=p1({logLevel:e,message:t,opts:r}),{collapsed:c}=r;return o.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Oh)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Px(e)}_getLogFunction(e,t,r,o,c){if(this._shouldLog(e)){c=p1({logLevel:e,message:t,args:o,opts:c}),r=r||c.method,p_(r),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Dh();const f=c.tag||c.message;if(c.once&&f)if(!A1[f])A1[f]=Dh();else return Oh;return t=xI(this.id,c.message,c),r.bind(console,t,...c.args)}return Oh}}td.VERSION=Ix;function Px(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return p_(Number.isFinite(e)&&e>=0),e}function p1(i){const{logLevel:e,message:t}=i;i.logLevel=Px(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const o=typeof i.message;return p_(o==="string"||o==="object"),Object.assign(i,{args:r},i.opts)}function xI(i,e,t){if(typeof e=="string"){const r=t.time?mI(gI(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=yI(e,t.color,t.background)}return e}function wI(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const xg="4.3.2",TI=xg[0]>="0"&&xg[0]<="9"?`v${xg}`:"";function SI(){const i=new td({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=TI,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const EI=SI();function CI(i,e){return Mx(i||{},e)}function Mx(i,e,t=0){if(t>3)return e;const r={...i};for(const[o,c]of Object.entries(e))c&&typeof c=="object"&&!Array.isArray(c)?r[o]=Mx(r[o]||{},e[o],t+1):r[o]=e[o];return r}const II="latest";function PI(){var i;return(i=globalThis._loadersgl_)!=null&&i.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const MI=PI();function Wc(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const Fu=typeof process!="object"||String(process)!=="[object process]"||process.browser,RI=typeof window<"u"&&typeof window.orientation<"u",g1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);g1&&parseFloat(g1[1]);class kI{constructor(e,t){de(this,"name");de(this,"workerThread");de(this,"isRunning",!0);de(this,"result");de(this,"_resolve",()=>{});de(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Wc(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Wc(this.isRunning),this.isRunning=!1,this._reject(e)}}class wg{terminate(){}}const Tg=new Map;function DI(i){Wc(i.source&&!i.url||!i.source&&i.url);let e=Tg.get(i.source||i.url);return e||(i.url&&(e=BI(i.url),Tg.set(i.url,e)),i.source&&(e=Rx(i.source),Tg.set(i.source,e))),Wc(e),e}function BI(i){if(!i.startsWith("http"))return i;const e=OI(i);return Rx(e)}function Rx(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function OI(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function kx(i,e=!0,t){const r=t||new Set;if(i){if(m1(i))r.add(i);else if(m1(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const o in i)kx(i[o],e,r)}}return t===void 0?Array.from(r):[]}function m1(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const Sg=()=>{};class _m{constructor(e){de(this,"name");de(this,"source");de(this,"url");de(this,"terminated",!1);de(this,"worker");de(this,"onMessage");de(this,"onError");de(this,"_loadableURL","");const{name:t,source:r,url:o}=e;Wc(r||o),this.name=t,this.source=r,this.url=o,this.onMessage=Sg,this.onError=c=>console.log(c),this.worker=Fu?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Fu||typeof wg<"u"&&!Fu}destroy(){this.onMessage=Sg,this.onError=Sg,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||kx(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=DI({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new wg(r,{eval:!1})}else if(this.source)e=new wg(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class LI{constructor(e){de(this,"name","unnamed");de(this,"source");de(this,"url");de(this,"maxConcurrency",1);de(this,"maxMobileConcurrency",1);de(this,"onDebug",()=>{});de(this,"reuseWorkers",!0);de(this,"props",{});de(this,"jobQueue",[]);de(this,"idleQueue",[]);de(this,"count",0);de(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return _m.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(o,c,f)=>o.done(f),r=(o,c)=>o.error(c)){const o=new Promise(c=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:c}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new kI(t.name,e);e.onMessage=o=>t.onMessage(r,o.type,o.payload),e.onError=o=>t.onError(r,o),t.onStart(r);try{await r.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Fu||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new _m({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return RI?this.maxMobileConcurrency:this.maxConcurrency}}const FI={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},kc=class kc{constructor(e){de(this,"props");de(this,"workerPools",new Map);this.props={...FI},this.setProps(e),this.workerPools=new Map}static isSupported(){return _m.isSupported()}static getWorkerFarm(e={}){return kc._workerFarm=kc._workerFarm||new kc({}),kc._workerFarm.setProps(e),kc._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:o}=e;let c=this.workerPools.get(t);return c||(c=new LI({name:t,source:r,url:o}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};de(kc,"_workerFarm");let dp=kc;function NI(i,e={}){const t=e[i.id]||{},r=Fu?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let o=t.workerUrl;if(!o&&i.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(Fu?o=`modules/${i.module}/dist/${r}`:o=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!o){let c=i.version;c==="latest"&&(c=II);const f=c?`@${c}`:"";o=`https://unpkg.com/@loaders.gl/${i.module}${f}/dist/${r}`}return Wc(o),o}function zI(i,e=MI){Wc(i,"no worker provided");const t=i.version;return!(!e||!t)}function UI(i,e){return!dp.isSupported()||!Fu&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function jI(i,e,t,r,o){const c=i.id,f=NI(i,t),w=dp.getWorkerFarm(t).getWorkerPool({name:c,url:f});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const P=await w.startJob("process-on-worker",VI.bind(null,o));return P.postMessage("process",{input:e,options:t,context:r}),await(await P.result).result}async function VI(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:c,options:f}=r;try{const a=await i(c,f);e.postMessage("done",{id:o,result:a})}catch(a){const w=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:o,error:w})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function WI(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),o=new Uint8Array(e);for(let c=0;c<r.length;++c)if(r[c]!==o[c])return!1;return!0}function HI(...i){return $I(i)}function $I(i){const e=i.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),t=e.reduce((c,f)=>c+f.byteLength,0),r=new Uint8Array(t);let o=0;for(const c of e)r.set(c,o),o+=c.byteLength;return r.buffer}async function ZI(i){const e=[];for await(const t of i)e.push(t);return HI(...e)}function _1(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class y1{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=_1(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(_1()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Dx{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let o=this.stats[t];return o||(e instanceof y1?o=e:o=new y1(t,r),this.stats[t]=o),o}}const qI="Queued Requests",XI="Active Requests",GI="Cancelled Requests",YI="Queued Requests Ever",QI="Active Requests Ever",KI={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class JI{constructor(e={}){de(this,"props");de(this,"stats");de(this,"activeRequestCount",0);de(this,"requestQueue",[]);de(this,"requestMap",new Map);de(this,"updateTimer",null);this.props={...KI,...e},this.stats=new Dx({id:this.props.id}),this.stats.get(qI),this.stats.get(XI),this.stats.get(GI),this.stats.get(YI),this.stats.get(QI)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},o=new Promise(c=>(r.resolve=c,r));return this.requestQueue.push(r),this.requestMap.set(e,o),this._issueNewRequests(),o}_issueRequest(e){const{handle:t,resolve:r}=e;let o=!1;const c=()=>{o||(o=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:c}):Promise.resolve({done:c})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let eP="";const b1={};function tP(i){for(const e in b1)if(i.startsWith(e)){const t=b1[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${eP}${i}`),i}function iP(i){return i&&typeof i=="object"&&i.isBuffer}function Bx(i){if(iP(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function Ox(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function rP(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const nP=i=>typeof i=="boolean",TA=i=>typeof i=="function",id=i=>i!==null&&typeof i=="object",v1=i=>id(i)&&i.constructor==={}.constructor,sP=i=>!!i&&typeof i[Symbol.iterator]=="function",oP=i=>i&&typeof i[Symbol.asyncIterator]=="function",Yu=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Qu=i=>typeof Blob<"u"&&i instanceof Blob,aP=i=>i&&typeof i=="object"&&i.isBuffer,lP=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||id(i)&&TA(i.tee)&&TA(i.cancel)&&TA(i.getReader),cP=i=>id(i)&&TA(i.read)&&TA(i.pipe)&&nP(i.readable),Lx=i=>lP(i)||cP(i);class uP extends Error{constructor(t,r){super(t);de(this,"reason");de(this,"url");de(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const hP=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,fP=/^([-\w.]+\/[-\w.+]+)/;function x1(i,e){return i.toLowerCase()===e.toLowerCase()}function AP(i){const e=fP.exec(i);return e?e[1]:i}function w1(i){const e=hP.exec(i);return e?e[1]:""}const Fx=/\?.*/;function dP(i){const e=i.match(Fx);return e&&e[0]}function g_(i){return i.replace(Fx,"")}function pP(i){if(i.length<50)return i;const e=i.slice(i.length-15);return`${i.substr(0,32)}...${e}`}function u0(i){return Yu(i)?i.url:Qu(i)?i.name||"":typeof i=="string"?i:""}function m_(i){if(Yu(i)){const e=i,t=e.headers.get("content-type")||"",r=g_(e.url);return AP(t)||w1(r)}return Qu(i)?i.type||"":typeof i=="string"?w1(i):""}function gP(i){return Yu(i)?i.headers["content-length"]||-1:Qu(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function Nx(i){if(Yu(i))return i;const e={},t=gP(i);t>=0&&(e["content-length"]=String(t));const r=u0(i),o=m_(i);o&&(e["content-type"]=o);const c=await yP(i);c&&(e["x-first-bytes"]=c),typeof i=="string"&&(i=new TextEncoder().encode(i));const f=new Response(i,{headers:e});return Object.defineProperty(f,"url",{value:r}),f}async function mP(i){if(!i.ok)throw await _P(i)}async function _P(i){const e=pP(i.url);let t=`Failed to fetch resource (${i.status}) ${i.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:i.statusText,url:i.url,response:i};try{const o=i.headers.get("Content-Type");r.reason=!i.bodyUsed&&(o!=null&&o.includes("application/json"))?await i.json():await i.text()}catch{}return new uP(t,r)}async function yP(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=c=>{var f;return r((f=c==null?void 0:c.target)==null?void 0:f.result)},o.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5);return`data:base64,${bP(t)}`}return null}function bP(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function vP(i){return!xP(i)&&!wP(i)}function xP(i){return i.startsWith("http:")||i.startsWith("https:")}function wP(i){return i.startsWith("data:")}async function T1(i,e){var t,r;if(typeof i=="string"){const o=tP(i);return vP(o)&&(t=globalThis.loaders)!=null&&t.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(o,e):await fetch(o,e)}return await Nx(i)}const S1=new td({id:"loaders.gl"});class TP{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class SP{constructor(){de(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const zx={fetch:null,mimeType:void 0,nothrow:!1,log:new SP,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ex,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},EP={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ux(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function jx(){const i=Ux();return i.globalOptions=i.globalOptions||{...zx},i.globalOptions}function CP(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],IP(i,t),MP(e,i,r)}function IP(i,e){E1(i,null,zx,EP,e);for(const t of e){const r=i&&i[t.id]||{},o=t.options&&t.options[t.id]||{},c=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};E1(r,t.id,o,c,e)}}function E1(i,e,t,r,o){const c=e||"Top level",f=e?`${e}.`:"";for(const a in i){const w=!e&&id(i[a]),P=a==="baseUri"&&!e,k=a==="workerUrl"&&e;if(!(a in t)&&!P&&!k){if(a in r)S1.warn(`${c} loader option '${f}${a}' no longer supported, use '${r[a]}'`)();else if(!w){const F=PP(a,o);S1.warn(`${c} loader option '${f}${a}' not recognized. ${F}`)()}}}}function PP(i,e){const t=i.toLowerCase();let r="";for(const o of e)for(const c in o.options){if(i===c)return`Did you mean '${o.id}.${c}'?`;const f=c.toLowerCase();(t.startsWith(f)||f.startsWith(t))&&(r=r||`Did you mean '${o.id}.${c}'?`)}return r}function MP(i,e,t){const o={...i.options||{}};return RP(o,t),o.log===null&&(o.log=new TP),C1(o,jx()),C1(o,e),o}function C1(i,e){for(const t in e)if(t in e){const r=e[t];v1(r)&&v1(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function RP(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function __(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i==null?void 0:i.extensions)):!1}function y_(i){u1(i,"null loader"),u1(__(i),"invalid loader");let e;return Array.isArray(i)&&(e=i[1],i=i[0],i={...i,options:{...i.options,...e}}),(i!=null&&i.parseTextSync||i!=null&&i.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const Vx=()=>{const i=Ux();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function uU(i){const e=Vx();i=Array.isArray(i)?i:[i];for(const t of i){const r=y_(t);e.find(o=>r===o)||e.unshift(r)}}function kP(){return Vx()}const DP=/\.([^.]+)$/;async function BP(i,e=[],t,r){if(!Wx(i))return null;let o=I1(i,e,{...t,nothrow:!0},r);if(o)return o;if(Qu(i)&&(i=await i.slice(0,10).arrayBuffer(),o=I1(i,e,t,r)),!o&&!(t!=null&&t.nothrow))throw new Error(Hx(i));return o}function I1(i,e=[],t,r){if(!Wx(i))return null;if(e&&!Array.isArray(e))return y_(e);let o=[];e&&(o=o.concat(e)),t!=null&&t.ignoreRegisteredLoaders||o.push(...kP()),LP(o);const c=OP(i,o,t,r);if(!c&&!(t!=null&&t.nothrow))throw new Error(Hx(i));return c}function OP(i,e,t,r){const o=u0(i),c=m_(i),f=g_(o)||(r==null?void 0:r.url);let a=null,w="";return t!=null&&t.mimeType&&(a=Eg(e,t==null?void 0:t.mimeType),w=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),a=a||FP(e,f),w=w||(a?`matched url ${f}`:""),a=a||Eg(e,c),w=w||(a?`matched MIME type ${c}`:""),a=a||zP(e,i),w=w||(a?`matched initial data ${$x(i)}`:""),t!=null&&t.fallbackMimeType&&(a=a||Eg(e,t==null?void 0:t.fallbackMimeType),w=w||(a?`matched fallback MIME type ${c}`:"")),w&&EI.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${w}.`),a}function Wx(i){return!(i instanceof Response&&i.status===204)}function Hx(i){const e=u0(i),t=m_(i);let r="No valid loader found (";r+=e?`${Ox(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const o=i?$x(i):"";return r+=o?` first bytes: "${o}"`:"first bytes: not available",r+=")",r}function LP(i){for(const e of i)y_(e)}function FP(i,e){const t=e&&DP.exec(e),r=t&&t[1];return r?NP(i,r):null}function NP(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Eg(i,e){var t;for(const r of i)if((t=r.mimeTypes)!=null&&t.some(o=>x1(e,o))||x1(e,`application/x.${r.id}`))return r;return null}function zP(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(UP(e,t))return t}else if(ArrayBuffer.isView(e)){if(P1(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&P1(e,0,t))return t;return null}function UP(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function P1(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(o=>jP(i,e,t,o))}function jP(i,e,t,r){if(r instanceof ArrayBuffer)return WI(r,i,r.byteLength);switch(typeof r){case"function":return r(i);case"string":const o=ym(i,e,r.length);return r===o;default:return!1}}function $x(i,e=5){return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?ym(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?ym(i,0,e):""}function ym(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let o="";for(let c=0;c<t;c++)o+=String.fromCharCode(r.getUint8(e+c));return o}const VP=256*1024;function*WP(i,e){const t=(e==null?void 0:e.chunkSize)||VP;let r=0;const o=new TextEncoder;for(;r<i.length;){const c=Math.min(i.length-r,t),f=i.slice(r,r+c);r+=c,yield o.encode(f)}}const HP=256*1024;function*$P(i,e={}){const{chunkSize:t=HP}=e;let r=0;for(;r<i.byteLength;){const o=Math.min(i.byteLength-r,t),c=new ArrayBuffer(o),f=new Uint8Array(i,r,o);new Uint8Array(c).set(f),r+=o,yield c}}const ZP=1024*1024;async function*qP(i,e){const t=(e==null?void 0:e.chunkSize)||ZP;let r=0;for(;r<i.size;){const o=r+t,c=await i.slice(r,o).arrayBuffer();r=o,yield c}}function M1(i,e){return Ex?XP(i,e):GP(i)}async function*XP(i,e){const t=i.getReader();let r;try{for(;;){const o=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:c,value:f}=await o;if(c)return;yield Bx(f)}}catch{t.releaseLock()}}async function*GP(i,e){for await(const t of i)yield Bx(t)}function YP(i,e){if(typeof i=="string")return WP(i,e);if(i instanceof ArrayBuffer)return $P(i,e);if(Qu(i))return qP(i,e);if(Lx(i))return M1(i,e);if(Yu(i))return M1(i.body,e);throw new Error("makeIterator")}const Zx="Cannot convert supplied data type";function QP(i,e,t){if(e.text&&typeof i=="string")return i;if(aP(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const o=i.byteLength||i.length;return(i.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+o)),r}throw new Error(Zx)}async function KP(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return QP(i,e);if(Qu(i)&&(i=await Nx(i)),Yu(i)){const o=i;return await mP(o),e.binary?await o.arrayBuffer():await o.text()}if(Lx(i)&&(i=YP(i,t)),sP(i)||oP(i))return ZI(i);throw new Error(Zx)}function qx(i,e){const t=jx(),r=i||t;return typeof r.fetch=="function"?r.fetch:id(r.fetch)?o=>T1(o,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:T1}function JP(i,e,t){if(t)return t;const r={fetch:qx(e,i),...i};if(r.url){const o=g_(r.url);r.baseUrl=o,r.queryString=dP(r.url),r.filename=Ox(o),r.baseUrl=rP(o)}return Array.isArray(r.loaders)||(r.loaders=null),r}function eM(i,e){if(i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function pp(i,e,t,r){e&&!Array.isArray(e)&&!__(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const o=u0(i),f=eM(e,r),a=await BP(i,f,t);return a?(t=CP(t,a,f,o),r=JP({url:o,_parse:pp,loaders:f},t,r||null),await tM(a,i,t,r)):null}async function tM(i,e,t,r){if(zI(i),t=CI(i.options,t),Yu(e)){const c=e,{ok:f,redirected:a,status:w,statusText:P,type:k,url:F}=c,V=Object.fromEntries(c.headers.entries());r.response={headers:V,ok:f,redirected:a,status:w,statusText:P,type:k,url:F}}e=await KP(e,i,t);const o=i;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,t,r);if(UI(i,t))return await jI(i,e,t,r,pp);if(o.parseText&&typeof e=="string")return await o.parseText(e,t,r);if(o.parse)return await o.parse(e,t,r);throw Wc(!o.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}async function bm(i,e,t,r){let o,c;!Array.isArray(e)&&!__(e)?(o=[],c=e):(o=e,c=t);const f=qx(c);let a=i;return typeof i=="string"&&(a=await f(i)),Qu(i)&&(a=await f(i)),Array.isArray(o)?await pp(a,o,c):await pp(a,o,c)}const rn=new td({id:"deck"});let vm={};function hU(i){vm=i}function To(i,e,t,r){rn.level>0&&vm[i]&&vm[i].call(null,e,t,r)}function b_(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const Cg={number:{type:"number",validate(i,e){return Number.isFinite(i)&&typeof e=="object"&&(e.max===void 0||i<=e.max)&&(e.min===void 0||i>=e.min)}},array:{type:"array",validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function iM(i){const e={};for(const[t,r]of Object.entries(i))e[t]=rM(r);return e}function rM(i){let e=R1(i);if(e!=="object")return{value:i,...Cg[e],type:e};if(typeof i=="object")return i?i.type!==void 0?{...i,...Cg[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(e=R1(i.value),{...i,...Cg[e],type:e}):{type:"object",value:null};throw new Error("props")}function R1(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const nM=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,sM=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,oM={vertex:nM,fragment:sM},k1=/void\s+main\s*\([^)]*\)\s*\{\n?/,D1=/}\n?[^{}]*$/,Ig=[],Kd="__LUMA_INJECT_DECLARATIONS__";function aM(i){const e={vertex:{},fragment:{}};for(const t in i){let r=i[t];const o=lM(t);typeof r=="string"&&(r={order:0,injection:r}),e[o][t]=r}return e}function lM(i){const e=i.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function gp(i,e,t,r=!1){const o=e==="vertex";for(const c in t){const f=t[c];f.sort((w,P)=>w.order-P.order),Ig.length=f.length;for(let w=0,P=f.length;w<P;++w)Ig[w]=f[w].injection;const a=`${Ig.join(`
`)}
`;switch(c){case"vs:#decl":o&&(i=i.replace(Kd,a));break;case"vs:#main-start":o&&(i=i.replace(k1,w=>w+a));break;case"vs:#main-end":o&&(i=i.replace(D1,w=>a+w));break;case"fs:#decl":o||(i=i.replace(Kd,a));break;case"fs:#main-start":o||(i=i.replace(k1,w=>w+a));break;case"fs:#main-end":o||(i=i.replace(D1,w=>a+w));break;default:i=i.replace(c,w=>w+a)}}return i=i.replace(Kd,""),r&&(i=i.replace(/\}\s*$/,c=>c+oM[e])),i}function mp(i){i.map(e=>cM(e))}function cM(i){if(i.instance)return;mp(i.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=i,o={normalizedInjections:aM(r),parsedDeprecations:uM(t)};e&&(o.propValidators=iM(e)),i.instance=o;let c={};e&&(c=Object.entries(e).reduce((f,[a,w])=>{const P=w==null?void 0:w.value;return P&&(f[a]=P),f},{})),i.defaultUniforms={...i.defaultUniforms,...c}}function Xx(i,e,t){var r;(r=i.deprecations)==null||r.forEach(o=>{var c;(c=o.regex)!=null&&c.test(e)&&(o.deprecated?t.deprecated(o.old,o.new)():t.removed(o.old,o.new)())})}function uM(i){return i.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),i}function v_(i){mp(i);const e={},t={};Gx({modules:i,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((o,c)=>t[c]-t[o]).map(o=>e[o]);return mp(r),r}function Gx(i){const{modules:e,level:t,moduleMap:r,moduleDepth:o}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)r[c.name]=c,(o[c.name]===void 0||o[c.name]<t)&&(o[c.name]=t);for(const c of e)c.dependencies&&Gx({modules:c.dependencies,level:t+1,moduleMap:r,moduleDepth:o})}function hM(i){switch(i==null?void 0:i.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function fM(i,e){var r;if(Number(((r=i.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return i=B1(i,AM),i;case"fragment":return i=B1(i,dM),i;default:throw new Error(e)}}const Yx=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],AM=[...Yx,[xm("attribute"),"in $1"],[xm("varying"),"out $1"]],dM=[...Yx,[xm("varying"),"in $1"]];function B1(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function xm(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Qx(i,e){let t="";for(const r in i){const o=i[r];if(t+=`void ${o.signature} {
`,o.header&&(t+=`  ${o.header}`),e[r]){const c=e[r];c.sort((f,a)=>f.order-a.order);for(const f of c)t+=`  ${f.injection}
`}o.footer&&(t+=`  ${o.footer}`),t+=`}
`}return t}function Kx(i){const e={vertex:{},fragment:{}};for(const t of i){let r,o;typeof t!="string"?(r=t,o=r.hook):(r={},o=t),o=o.trim();const[c,f]=o.split(":"),a=o.replace(/\(.+/,""),w=Object.assign(r,{signature:f});switch(c){case"vs":e.vertex[a]=w;break;case"fs":e.fragment[a]=w;break;default:throw new Error(c)}}return e}function pM(i,e){return{name:gM(i,e),language:"glsl",version:mM(i)}}function gM(i,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return r?r[1]:e}function mM(i){let e=100;const t=i.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Jx=`

${Kd}
`,_M=`precision highp float;
`;function yM(i){const e=v_(i.modules||[]);return{source:vM(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:e}),getUniforms:ew(e)}}function bM(i){const{vs:e,fs:t}=i,r=v_(i.modules||[]);return{vs:O1(i.platformInfo,{...i,source:e,stage:"vertex",modules:r}),fs:O1(i.platformInfo,{...i,source:t,stage:"fragment",modules:r}),getUniforms:ew(r)}}function vM(i,e){var he;const{source:t,stage:r,modules:o,hookFunctions:c=[],inject:f={},log:a}=e;b_(typeof t=="string","shader source must be a string");const w=t;let P="";const k=Kx(c),F={},V={},W={};for(const Ie in f){const Ee=typeof f[Ie]=="string"?{injection:f[Ie],order:0}:f[Ie],Ne=/^(v|f)s:(#)?([\w-]+)$/.exec(Ie);if(Ne){const Ce=Ne[2],De=Ne[3];Ce?De==="decl"?V[Ie]=[Ee]:W[Ie]=[Ee]:F[Ie]=[Ee]}else W[Ie]=[Ee]}const ee=o;for(const Ie of ee){a&&Xx(Ie,w,a);const Ee=tw(Ie,"wgsl");P+=Ee;const Ne=((he=Ie.injections)==null?void 0:he[r])||{};for(const Ce in Ne){const De=/^(v|f)s:#([\w-]+)$/.exec(Ce);if(De){const Ke=De[2]==="decl"?V:W;Ke[Ce]=Ke[Ce]||[],Ke[Ce].push(Ne[Ce])}else F[Ce]=F[Ce]||[],F[Ce].push(Ne[Ce])}}return P+=Jx,P=gp(P,r,V),P+=Qx(k[r],F),P+=w,P=gp(P,r,W),P}function O1(i,e){var kt;const{id:t,source:r,stage:o,language:c="glsl",modules:f,defines:a={},hookFunctions:w=[],inject:P={},prologue:k=!0,log:F}=e;b_(typeof r=="string","shader source must be a string");const V=c==="glsl"?pM(r).version:-1,W=i.shaderLanguageVersion,ee=V===100?"#version 100":"#version 300 es",Ie=r.split(`
`).slice(1).join(`
`),Ee={};f.forEach(It=>{Object.assign(Ee,It.defines)}),Object.assign(Ee,a);let Ne="";switch(c){case"wgsl":break;case"glsl":Ne=k?`${ee}

// ----- PROLOGUE -------------------------
${xM({id:t,source:r,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}

${hM(i)}
${o==="fragment"?_M:""}

// ----- APPLICATION DEFINES -------------------------

${wM(Ee)}

`:`${ee}
`;break}const Ce=Kx(w),De={},Ye={},Ke={};for(const It in P){const jt=typeof P[It]=="string"?{injection:P[It],order:0}:P[It],Lt=/^(v|f)s:(#)?([\w-]+)$/.exec(It);if(Lt){const Mt=Lt[2],vi=Lt[3];Mt?vi==="decl"?Ye[It]=[jt]:Ke[It]=[jt]:De[It]=[jt]}else Ke[It]=[jt]}for(const It of f){F&&Xx(It,Ie,F);const jt=tw(It,o);Ne+=jt;const Lt=((kt=It.instance)==null?void 0:kt.normalizedInjections[o])||{};for(const Mt in Lt){const vi=/^(v|f)s:#([\w-]+)$/.exec(Mt);if(vi){const Jt=vi[2]==="decl"?Ye:Ke;Jt[Mt]=Jt[Mt]||[],Jt[Mt].push(Lt[Mt])}else De[Mt]=De[Mt]||[],De[Mt].push(Lt[Mt])}}return Ne+="// ----- MAIN SHADER SOURCE -------------------------",Ne+=Jx,Ne=gp(Ne,o,Ye),Ne+=Qx(Ce[o],De),Ne+=Ie,Ne=gp(Ne,o,Ke),c==="glsl"&&V!==W&&(Ne=fM(Ne,o)),Ne.trim()}function ew(i){return function(t){var o;const r={};for(const c of i){const f=(o=c.getUniforms)==null?void 0:o.call(c,t,r);Object.assign(r,f)}return r}}function xM(i){const{id:e,source:t,stage:r}=i;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function wM(i={}){let e="";for(const t in i){const r=i[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${i[t]}
`)}return e}function tw(i,e){let t;switch(e){case"vertex":t=i.vs||"";break;case"fragment":t=i.fs||"";break;case"wgsl":t=i.source||"";break;default:b_(!1)}if(!i.name)throw new Error("Shader module must have a name");const r=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let o=`// ----- MODULE ${i.name} ---------------

`;return e!=="wgsl"&&(o+=`#define MODULE_${r}
`),o+=`${t}
`,o}const TM=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,SM=/^\s*\#\s*endif\s*$/;function EM(i,e){var f;const t=i.split(`
`),r=[];let o=!0,c=null;for(const a of t){const w=a.match(TM),P=a.match(SM);w?(c=w[1],o=!!((f=e==null?void 0:e.defines)!=null&&f[c])):P?o=!0:o&&r.push(a)}return r.join(`
`)}const Bu=class Bu{constructor(){de(this,"_hookFunctions",[]);de(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Bu.defaultShaderAssembler=Bu.defaultShaderAssembler||new Bu,Bu.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:o,getUniforms:c}=yM({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?EM(o):o,getUniforms:c,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...bM({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let o=0;for(let c=0,f=this._defaultModules.length;c<f;++c){const a=this._defaultModules[c],w=a.name;t[o++]=a,r[w]=!0}for(let c=0,f=e.length;c<f;++c){const a=e[c],w=a.name;r[w]||(t[o++]=a,r[w]=!0)}return t.length=o,mp(t),t}};de(Bu,"defaultShaderAssembler");let wm=Bu;const CM=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,IM=`#version 300 es
${CM}`;function PM(i){const{input:e,inputChannels:t,output:r}={};if(!e)return IM;if(!t)throw new Error("inputChannels");const o=MM(t),c=RM(e,t);return`#version 300 es
in ${o} ${e};
out vec4 ${r};
void main() {
  ${r} = ${c};
}`}function MM(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function RM(i,e){switch(e){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${e}`)}}class kM{constructor(){de(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Dx({id:e})),this.stats.get(e)}}const DM=new kM,ci=new td({id:"luma.gl"}),Pg={};function h0(i="id"){Pg[i]=Pg[i]||1;const e=Pg[i]++;return`${i}-${e}`}class Lr{constructor(e,t,r){de(this,"id");de(this,"props");de(this,"userData",{});de(this,"_device");de(this,"destroyed",!1);de(this,"allocatedBytes",0);de(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=BM(t,r);const o=this.props.id!=="undefined"?this.props.id:h0(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}de(Lr,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});function BM(i,e){const t={...e};for(const r in i)i[r]!==void 0&&(t[r]=i[r]);return t}const Cs=class Cs extends Lr{constructor(t,r){const o={...r};(r.usage||0)&Cs.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?o.indexType="uint32":r.data instanceof Uint16Array&&(o.indexType="uint16")),delete o.data;super(t,o,Cs.defaultProps);de(this,"usage");de(this,"indexType");de(this,"updateTimestamp");de(this,"debugData",new ArrayBuffer(0));this.usage=o.usage||0,this.indexType=o.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}_setDebugData(t,r,o){const c=ArrayBuffer.isView(t)?t.buffer:t,f=Math.min(t?t.byteLength:o,Cs.DEBUG_DATA_MAX_LENGTH);c===null?this.debugData=new ArrayBuffer(f):r===0&&o===c.byteLength?this.debugData=c.slice(0,f):this.debugData=c.slice(r,r+f)}};de(Cs,"defaultProps",{...Lr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),de(Cs,"MAP_READ",1),de(Cs,"MAP_WRITE",2),de(Cs,"COPY_SRC",4),de(Cs,"COPY_DST",8),de(Cs,"INDEX",16),de(Cs,"VERTEX",32),de(Cs,"UNIFORM",64),de(Cs,"STORAGE",128),de(Cs,"INDIRECT",256),de(Cs,"QUERY_RESOLVE",512),de(Cs,"DEBUG_DATA_MAX_LENGTH",32);let tn=Cs;function iw(i){const e=L1[i],t=OM(e),r=i.includes("norm"),o=!r&&!i.startsWith("float"),c=i.startsWith("s");return{dataType:L1[i],byteLength:t,integer:o,signed:c,normalized:r}}function OM(i){return LM[i]}const L1={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},LM={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Fs="texture-compression-bc",Ur="texture-compression-astc",cl="texture-compression-etc2",FM="texture-compression-etc1-webgl",Ed="texture-compression-pvrtc-webgl",Mg="texture-compression-atc-webgl",Cd="float32-renderable-webgl",Rg="float16-renderable-webgl",NM="rgb9e5ufloat-renderable-webgl",kg="snorm8-renderable-webgl",nA="norm16-renderable-webgl",Dg="snorm16-renderable-webgl",Id="float32-filterable",F1="float16-filterable-webgl";function rw(i){const e=zM[i];if(!e)throw new Error(`Unsupported texture format ${i}`);return e}const zM={r8unorm:{},r8snorm:{render:kg},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:kg},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Rg,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:nA},"r16snorm-webgl":{f:Dg},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:kg},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Rg,filter:F1},"rg16unorm-webgl":{render:nA},"rg16snorm-webgl":{render:Dg},r32uint:{},r32sint:{},r32float:{render:Cd,filter:Id},rgb9e5ufloat:{channels:"rgb",packed:!0,render:NM},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Cd},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:nA},"rgb16snorm-webgl":{f:nA},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Id},rgba16uint:{},rgba16sint:{},rgba16float:{render:Rg,filter:F1},"rgba16unorm-webgl":{render:nA},"rgba16snorm-webgl":{render:Dg},"rgb32float-webgl":{render:Cd,filter:Id},rgba32uint:{},rgba32sint:{},rgba32float:{render:Cd,filter:Id},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Fs},"bc1-rgb-unorm-srgb-webgl":{f:Fs},"bc1-rgba-unorm":{f:Fs},"bc1-rgba-unorm-srgb":{f:Fs},"bc2-rgba-unorm":{f:Fs},"bc2-rgba-unorm-srgb":{f:Fs},"bc3-rgba-unorm":{f:Fs},"bc3-rgba-unorm-srgb":{f:Fs},"bc4-r-unorm":{f:Fs},"bc4-r-snorm":{f:Fs},"bc5-rg-unorm":{f:Fs},"bc5-rg-snorm":{f:Fs},"bc6h-rgb-ufloat":{f:Fs},"bc6h-rgb-float":{f:Fs},"bc7-rgba-unorm":{f:Fs},"bc7-rgba-unorm-srgb":{f:Fs},"etc2-rgb8unorm":{f:cl},"etc2-rgb8unorm-srgb":{f:cl},"etc2-rgb8a1unorm":{f:cl},"etc2-rgb8a1unorm-srgb":{f:cl},"etc2-rgba8unorm":{f:cl},"etc2-rgba8unorm-srgb":{f:cl},"eac-r11unorm":{f:cl},"eac-r11snorm":{f:cl},"eac-rg11unorm":{f:cl},"eac-rg11snorm":{f:cl},"astc-4x4-unorm":{f:Ur},"astc-4x4-unorm-srgb":{f:Ur},"astc-5x4-unorm":{f:Ur},"astc-5x4-unorm-srgb":{f:Ur},"astc-5x5-unorm":{f:Ur},"astc-5x5-unorm-srgb":{f:Ur},"astc-6x5-unorm":{f:Ur},"astc-6x5-unorm-srgb":{f:Ur},"astc-6x6-unorm":{f:Ur},"astc-6x6-unorm-srgb":{f:Ur},"astc-8x5-unorm":{f:Ur},"astc-8x5-unorm-srgb":{f:Ur},"astc-8x6-unorm":{f:Ur},"astc-8x6-unorm-srgb":{f:Ur},"astc-8x8-unorm":{f:Ur},"astc-8x8-unorm-srgb":{f:Ur},"astc-10x5-unorm":{f:Ur},"astc-10x5-unorm-srgb":{f:Ur},"astc-10x6-unorm":{f:Ur},"astc-10x6-unorm-srgb":{f:Ur},"astc-10x8-unorm":{f:Ur},"astc-10x8-unorm-srgb":{f:Ur},"astc-10x10-unorm":{f:Ur},"astc-10x10-unorm-srgb":{f:Ur},"astc-12x10-unorm":{f:Ur},"astc-12x10-unorm-srgb":{f:Ur},"astc-12x12-unorm":{f:Ur},"astc-12x12-unorm-srgb":{f:Ur},"pvrtc-rgb4unorm-webgl":{f:Ed},"pvrtc-rgba4unorm-webgl":{f:Ed},"pvrtc-rbg2unorm-webgl":{f:Ed},"pvrtc-rgba2unorm-webgl":{f:Ed},"etc1-rbg-unorm-webgl":{f:FM},"atc-rgb-unorm-webgl":{f:Mg},"atc-rgba-unorm-webgl":{f:Mg},"atc-rgbai-unorm-webgl":{f:Mg}},UM=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],jM=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function nw(i){return UM.some(e=>i.startsWith(e))}function x_(i){let e=VM(i);if(nw(i)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=WM(i);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=jM.exec(i);if(t){const[,r,o,c,f,a]=t,w=`${c}${o}`,P=iw(w),k=P.byteLength*8,F=r.length,V=[k,F>=2?k:0,F>=3?k:0,F>=4?k:0];e={format:i,attachment:e.attachment,dataType:P.dataType,components:F,channels:r,integer:P.integer,signed:P.signed,normalized:P.normalized,bitsPerChannel:V,bytesPerPixel:P.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),f==="-srgb"&&(e.srgb=!0)}return i.endsWith("-webgl")&&(e.webgl=!0),i.endsWith("-srgb")&&(e.srgb=!0),e}function VM(i){var c;const e=rw(i),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:i,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((c=e.channels)==null?void 0:c.length)||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function WM(i){const t=/.*-(\d+)x(\d+)-.*/.exec(i);if(t){const[,r,o]=t;return{blockWidth:Number(r),blockHeight:Number(o)}}return null}function HM(i){const e=rw(i),t={format:i,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=x_(i),o=i.startsWith("depth")||i.startsWith("stencil"),c=r==null?void 0:r.signed,f=r==null?void 0:r.integer,a=r==null?void 0:r.webgl;return t.render&&(t.render=!c),t.filter&&(t.filter=!o&&!c&&!f&&!a),t}class $M{}class ZM{constructor(e=[],t){de(this,"features");de(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Xp=class Xp{constructor(e){de(this,"id");de(this,"props");de(this,"userData",{});de(this,"statsManager",DM);de(this,"timestamp",0);de(this,"_reused",!1);de(this,"_lumaData",{});this.props={...Xp.defaultProps,...e},this.id=this.props.id||h0(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=HM(e),r=f=>(typeof f=="string"?this.features.has(f):f)??!0,o=r(t.create),c={format:e,create:o,render:o&&r(t.render),filter:o&&r(t.filter),blend:o&&r(t.blend),store:o&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(c)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return nw(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&tn.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ci.warn("indices buffer content must be of integer type")()),t}};de(Xp,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ci.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ci.get("debug")||void 0,debugShaders:ci.get("debug-shaders")||void 0,debugFramebuffers:!!ci.get("debug-framebuffers"),debugWebGL:!!ci.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let _p=Xp;const Gp=class Gp{constructor(e){de(this,"id");de(this,"props");de(this,"canvas");de(this,"htmlCanvas");de(this,"offscreenCanvas");de(this,"type");de(this,"width",1);de(this,"height",1);de(this,"resizeObserver");de(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Gp.defaultProps,...e},e=this.props,!Af()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=XM(e.canvas):this.canvas=e.canvas;else{const t=GM(e),r=qM((e==null?void 0:e.container)||null);r.insertBefore(t,r.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?t/r:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[o,c]=this.getDrawingBufferSize();return YM(e,r,o,c,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,o="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!o)&&(ci.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);const c=this._canvasSizeInfo;if(c.clientWidth!==r||c.clientHeight!==o||c.devicePixelRatio!==e){let f=e;const a=Math.floor(r*f),w=Math.floor(o*f);if(this.htmlCanvas.width=a,this.htmlCanvas.height=w,this.device.gl){const[k,F]=this.getDrawingBufferSize();(k!==a||F!==w)&&(f=Math.min(k/r,F/o),this.htmlCanvas.width=Math.floor(r*f),this.htmlCanvas.height=Math.floor(o*f),ci.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};de(Gp,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Tm=Gp;function qM(i){if(typeof i=="string"){const e=document.getElementById(i);if(!e)throw new Error(`${i} is not an HTML element`);return e}else if(i)return i;return document.body}function XM(i){const e=document.getElementById(i);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function GM(i){const{width:e,height:t}=i,r=document.createElement("canvas");return r.id=h0("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function YM(i,e,t,r,o){const c=i,f=N1(c[0],e,t);let a=z1(c[1],e,r,o),w=N1(c[0]+1,e,t);const P=w===t-1?w:w-1;w=z1(c[1]+1,e,r,o);let k;return o?(w=w===0?w:w+1,k=a,a=w):k=w===r-1?w:w-1,{x:f,y:a,width:Math.max(P-f+1,1),height:Math.max(k-a+1,1)}}function N1(i,e,t){return Math.min(Math.round(i*e),t-1)}function z1(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const Is=class Is extends Lr{constructor(t,r){r=Is.normalizeProps(t,r);super(t,r,Is.defaultProps);de(this,"dimension");de(this,"format");de(this,"width");de(this,"height");de(this,"depth");de(this,"mipLevels");de(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const o=Is.getTextureDataSize(this.props.data);this.width=(o==null?void 0:o.width)||1,this.height=(o==null?void 0:o.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Is.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const r=t==null?void 0:t.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Is.getTextureDataSize(t[0]);if(Is.isExternalImage(t))return Is.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const o=Object.values(t)[0];return{width:o.width,height:o.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let o;return ArrayBuffer.isView(t)?o=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?o=t:o=[t],o}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,r){var w,P;const o={...r},c=((P=(w=t==null?void 0:t.props)==null?void 0:w._resourceDefaults)==null?void 0:P.texture)||{};Object.assign(o,c);const{width:f,height:a}=o;return typeof f=="number"&&(o.width=Math.max(1,Math.ceil(f))),typeof a=="number"&&(o.height=Math.max(1,Math.ceil(a))),o}};de(Is,"COPY_SRC",1),de(Is,"COPY_DST",2),de(Is,"TEXTURE",4),de(Is,"STORAGE",8),de(Is,"RENDER_ATTACHMENT",16),de(Is,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),de(Is,"defaultProps",{...Lr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),de(Is,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let vn=Is;const Yp=class Yp extends Lr{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Yp.defaultProps)}};de(Yp,"defaultProps",{...Lr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let yp=Yp;function QM(i,e,t){let r="";const o=e.split(/\r?\n/),c=i.slice().sort((f,a)=>f.lineNum-a.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let f=0;for(let a=1;a<=o.length;a++)for(r+=sw(o[a-1],a,t);c.length>f&&c[f].lineNum===a;){const w=c[f++];r+=U1(w,o,w.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const a of i)r+=U1(a,o,a.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return r}}function U1(i,e,t,r){if(r!=null&&r.inlineSource){const c=KM(e,t),f=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${c}${f}${i.type.toUpperCase()}: ${i.message}

`}const o=i.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${o};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function KM(i,e,t){let r="";for(let o=e-2;o<=e;o++){const c=i[o-1];c!==void 0&&(r+=sw(c,e,t))}return r}function sw(i,e,t){const r=t!=null&&t.html?e4(i):i;return`${JM(String(e),4)}: ${r}${t!=null&&t.html?"<br/>":`
`}`}function JM(i,e){let t="";for(let r=i.length;r<e;++r)t+=" ";return t+i}function e4(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Qp=class Qp extends Lr{constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"};super(t,{id:t4(r),...r},Qp.defaultProps);de(this,"stage");de(this,"source");de(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(t){var P;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=ow(this.source),o=`${this.stage} ${r}`;let c=QM(t,this.source,{showSourceCode:"all",html:!0});const f=this.getTranslatedSource();f&&(c+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${f}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${o}</h1><br /><br />
<code style="user-select:text;"><pre>
${c}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(P=document.getElementsByClassName("luma-compiler-log-error")[0])==null||P.scrollIntoView(),a.onclick=()=>{const k=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(k)}}};de(Qp,"defaultProps",{...Lr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let bp=Qp;function t4(i){return ow(i.source)||i.id||h0(`unnamed ${i.stage}-shader`)}function ow(i,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return r?r[1]:e}const BA=class BA extends Lr{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=BA.normalizeProps(e,t),super(e,t,BA.defaultProps)}static normalizeProps(e,t){var c,f;const r=((f=(c=e==null?void 0:e.props)==null?void 0:c._resourceDefaults)==null?void 0:f.sampler)||{};return{...t,...r}}};de(BA,"defaultProps",{...Lr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let vp=BA;const Kp=class Kp extends Lr{constructor(t,r={}){super(t,r,Kp.defaultProps);de(this,"width");de(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const r=this.colorAttachments.map(c=>c.texture.clone(t)),o=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:o})}resize(t){let r=!t;if(t){const[o,c]=Array.isArray(t)?t:[t.width,t.height];r=r||c!==this.height||o!==this.width,this.width=o,this.height=c}r&&(ci.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,o)=>{if(typeof r=="string"){const c=this.createColorTexture(r,o);return this.attachResource(c),c.view}return r instanceof vn?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof vn?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:vn.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:vn.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let o=0;o<this.colorAttachments.length;++o)if(this.colorAttachments[o]){const c=this.colorAttachments[o].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[o]),this.colorAttachments[o]=c.view,this.attachResource(c.view)}if(this.depthStencilAttachment){const o=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=o.view,this.attachResource(o)}this.updateAttachments()}};de(Kp,"defaultProps",{...Lr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let xp=Kp;const Jp=class Jp extends Lr{constructor(t,r){super(t,r,Jp.defaultProps);de(this,"shaderLayout");de(this,"bufferLayout");de(this,"linkStatus","pending");de(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};de(Jp,"defaultProps",{...Lr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let ef=Jp;const Ra=class Ra extends Lr{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Ra.normalizeProps(e,t),super(e,t,Ra.defaultProps)}static normalizeProps(e,t){var c;return{...(c=e.props._resourceDefaults)==null?void 0:c.renderPass,...t}}};de(Ra,"defaultClearColor",[0,0,0,1]),de(Ra,"defaultClearDepth",1),de(Ra,"defaultClearStencil",0),de(Ra,"defaultProps",{...Lr.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ra.defaultClearColor,clearColors:void 0,clearDepth:Ra.defaultClearDepth,clearStencil:Ra.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Sm=Ra;const e0=class e0 extends Lr{constructor(t,r){super(t,r,e0.defaultProps);de(this,"hash","");de(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};de(e0,"defaultProps",{...Lr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let wp=e0;const t0=class t0 extends Lr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,t0.defaultProps)}};de(t0,"defaultProps",{...Lr.defaultProps,measureExecutionTime:void 0});let Em=t0;const i0=class i0 extends Lr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,i0.defaultProps)}};de(i0,"defaultProps",{...Lr.defaultProps});let Cm=i0;function i4(i){const[e,t]=n4[i],r=e==="i32"||e==="u32",o=e!=="u32",c=s4[e]*t,f=r4(e,t);return{dataType:e,components:t,defaultVertexFormat:f,byteLength:c,integer:r,signed:o}}function r4(i,e){let t;switch(i){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const n4={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},s4={f32:4,f16:2,i32:4,u32:4};function aw(i){let e;i.endsWith("-webgl")&&(i.replace("-webgl",""),e=!0);const[t,r]=i.split("x"),o=t,c=r?parseInt(r):1,f=iw(o),a={type:o,components:c,byteLength:f.byteLength*c,integer:f.integer,signed:f.signed,normalized:f.normalized};return e&&(a.webglOnly=!0),a}function lw(i,e){const t={};for(const r of i.attributes){const o=a4(i,e,r.name);o&&(t[r.name]=o)}return t}function o4(i,e,t=16){const r=lw(i,e),o=new Array(t).fill(null);for(const c of Object.values(r))o[c.location]=c;return o}function a4(i,e,t){const r=l4(i,t),o=c4(e,t);if(!r)return null;const c=i4(r.type),f=(o==null?void 0:o.vertexFormat)||c.defaultVertexFormat,a=aw(f);return{attributeName:(o==null?void 0:o.attributeName)||r.name,bufferName:(o==null?void 0:o.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:f,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:c.integer,stepMode:(o==null?void 0:o.stepMode)||r.stepMode||"vertex",byteOffset:(o==null?void 0:o.byteOffset)||0,byteStride:(o==null?void 0:o.byteStride)||0}}function l4(i,e){const t=i.attributes.find(r=>r.name===e);return t||ci.warn(`shader layout attribute "${e}" not present in shader`),t||null}function c4(i,e){u4(i);let t=h4(i,e);return t||(t=f4(i,e),t)?t:(ci.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function u4(i){for(const e of i)(e.attributes&&e.format||!e.attributes&&!e.format)&&ci.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function h4(i,e){for(const t of i)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function f4(i,e){var t;for(const r of i){let o=r.byteStride;if(typeof r.byteStride!="number")for(const f of r.attributes||[]){const a=aw(f.format);o+=a.byteLength}const c=(t=r.attributes)==null?void 0:t.find(f=>f.attribute===e);if(c)return{attributeName:c.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:c.format,byteOffset:c.byteOffset,byteStride:o}}return null}const r0=class r0 extends Lr{constructor(t,r){super(t,r,r0.defaultProps);de(this,"maxVertexAttributes");de(this,"attributeInfos");de(this,"indexBuffer",null);de(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:o,bufferLayout:c}=r.renderPipeline||{};if(!o||!c)throw new Error("VertexArray");this.attributeInfos=o4(o,c,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}};de(r0,"defaultProps",{...Lr.defaultProps,renderPipeline:null});let Im=r0;const n0=class n0 extends Lr{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,n0.defaultProps)}};de(n0,"defaultProps",{...Lr.defaultProps,layout:void 0,buffers:{}});let Pm=n0;const s0=class s0 extends Lr{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,s0.defaultProps)}};de(s0,"defaultProps",{...Lr.defaultProps,type:void 0,count:void 0});let Mm=s0;const A4={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function d4(i){return A4[i]}function p4(i,e){switch(e){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}let Pd;function cw(i){return(!Pd||Pd.byteLength<i)&&(Pd=new ArrayBuffer(i)),Pd}function g4(i,e){const t=cw(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function m4(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Tp(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":m4(i)}const j1=1024;class _4{constructor(e){de(this,"layout",{});de(this,"byteLength");let t=0;for(const[o,c]of Object.entries(e)){const f=d4(c),{type:a,components:w}=f;t=p4(t,w);const P=t;t+=w,this.layout[o]={type:a,size:w,offset:P}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,j1)}getData(e){const t=Math.max(this.byteLength,j1),r=cw(t),o={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[c,f]of Object.entries(e)){const a=this.layout[c];if(!a){ci.warn(`Supplied uniform value ${c} not present in uniform block layout`)();continue}const{type:w,size:P,offset:k}=a,F=o[w];if(P===1){if(typeof f!="number"&&typeof f!="boolean"){ci.warn(`Supplied value for single component uniform ${c} is not a number: ${f}`)();continue}F[k]=Number(f)}else{if(!Tp(f)){ci.warn(`Supplied value for multi component / array uniform ${c} is not a numeric array: ${f}`)();continue}F.set(f,k)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function y4(i,e,t=16){if(i!==e)return!1;const r=i,o=e;if(!Tp(r))return!1;if(Tp(o)&&r.length===o.length){for(let c=0;c<r.length;++c)if(o[c]!==r[c])return!1}return!0}function b4(i){return Tp(i)?i.slice():i}class v4{constructor(e){de(this,"name");de(this,"uniforms",{});de(this,"modifiedUniforms",{});de(this,"modified",!0);de(this,"bindingLayout",{});de(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(c=>c.type==="uniform"&&c.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const o=r;for(const c of o.uniforms||[])this.bindingLayout[c.name]=c}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){y4(this.uniforms[e],t)||(this.uniforms[e]=b4(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class x4{constructor(e){de(this,"uniformBlocks",new Map);de(this,"uniformBufferLayouts",new Map);de(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const o=t,c=new _4(r.uniformTypes||{});this.uniformBufferLayouts.set(o,c);const f=new v4({name:t});f.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(o,f)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[r,o]of Object.entries(e))(t=this.uniformBlocks.get(r))==null||t.setUniforms(o);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var r,o;const t=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(o=this.uniformBufferLayouts.get(e))==null?void 0:o.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const o=this.getUniformBufferByteLength(t),c=e.createBuffer({usage:tn.UNIFORM|tn.COPY_DST,byteLength:o}),f=this.getUniformBufferData(t);return c.write(f),c}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:tn.UNIFORM|tn.COPY_DST,byteLength:r});this.uniformBuffers.set(t,o)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&ci.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var c;const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),o=!1;if(r&&(t!=null&&t.needsRedraw)){o||(o=t.needsRedraw);const f=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(f);const a=(c=this.uniformBlocks.get(e))==null?void 0:c.getAllUniforms();ci.log(4,`Writing to uniform buffer ${String(e)}`,f,a)()}return o}}function uw(i){const e=ArrayBuffer.isView(i)?i.constructor:i;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function hw(i){switch(i){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(i)}}function w4(i,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let o=uw(i);if(o==="uint8"&&t&&r===1)return"unorm8-webgl";if(o==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(o==="uint8"||o==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(o=o.replace("int","norm")),`${o}x${r}`}if(o==="uint16"||o==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(o=o.replace("int","norm")),`${o}x${r}`}return r===1?o:`${o}x${r}`}class Bg{constructor(e){de(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const o of t){const c=r.findIndex(f=>f.name===o.name);c<0?r.push(o):r[c]=o}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&ci.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function T4(i,e){const t=Object.fromEntries(i.attributes.map(o=>[o.name,o.location])),r=e.slice();return r.sort((o,c)=>{const f=o.attributes?o.attributes.map(k=>k.attribute):[o.name],a=c.attributes?c.attributes.map(k=>k.attribute):[c.name],w=Math.min(...f.map(k=>t[k])),P=Math.min(...a.map(k=>t[k]));return w-P}),r}class $o{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class V1{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Lc extends $o{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class zc extends $o{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Rm extends $o{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class ju extends $o{constructor(e,t,r,o){super(e,r),this.format=t,this.access=o}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Rc;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(Rc||(Rc={}));class Md{constructor(e,t,r,o,c,f,a){this.name=e,this.type=t,this.group=r,this.binding=o,this.attributes=c,this.resourceType=f,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class S4{constructor(e,t){this.name=e,this.type=t}}class E4{constructor(e,t,r,o){this.name=e,this.type=t,this.locationType=r,this.location=o,this.interpolation=null}}class W1{constructor(e,t,r,o){this.name=e,this.type=t,this.locationType=r,this.location=o}}class C4{constructor(e,t,r,o){this.name=e,this.type=t,this.attributes=r,this.id=o}}class I4{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class P4{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class M4{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const fw=new Float32Array(1),R4=new Int32Array(fw.buffer),Ns=new Uint16Array(1);function k4(i){fw[0]=i;const e=R4[0],t=e>>31&1;let r=e>>23&255,o=8388607&e;if(r===255)return Ns[0]=t<<15|31744|(o!==0?512:0),Ns[0];if(r===0){if(o===0)return Ns[0]=t<<15,Ns[0];o|=8388608;let c=113;for(;!(8388608&o);)o<<=1,c--;return r=127-c,o&=8388607,r>0?(o=(o>>126-r)+(o>>127-r&1),Ns[0]=t<<15|r<<10|o>>13,Ns[0]):(Ns[0]=t<<15,Ns[0])}return r=r-127+15,r>=31?(Ns[0]=t<<15|31744,Ns[0]):r<=0?r<-10?(Ns[0]=t<<15,Ns[0]):(o=(8388608|o)>>1-r,Ns[0]=t<<15|o>>13,Ns[0]):(o>>=13,Ns[0]=t<<15|r<<10|o,Ns[0])}const w_=new Uint32Array(1),Aw=new Float32Array(w_.buffer,0,1);function H1(i){const e=112+(i>>6&31)<<23|(63&i)<<17;return w_[0]=e,Aw[0]}function D4(i,e,t,r,o,c,f,a,w){const P=r*(f>>=o)*(c>>=o)+t*f+e*a;switch(w){case"r8unorm":return[Pr(i,P,"8unorm",1)[0]];case"r8snorm":return[Pr(i,P,"8snorm",1)[0]];case"r8uint":return[Pr(i,P,"8uint",1)[0]];case"r8sint":return[Pr(i,P,"8sint",1)[0]];case"rg8unorm":{const k=Pr(i,P,"8unorm",2);return[k[0],k[1]]}case"rg8snorm":{const k=Pr(i,P,"8snorm",2);return[k[0],k[1]]}case"rg8uint":{const k=Pr(i,P,"8uint",2);return[k[0],k[1]]}case"rg8sint":{const k=Pr(i,P,"8sint",2);return[k[0],k[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const k=Pr(i,P,"8unorm",4);return[k[0],k[1],k[2],k[3]]}case"rgba8snorm":{const k=Pr(i,P,"8snorm",4);return[k[0],k[1],k[2],k[3]]}case"rgba8uint":{const k=Pr(i,P,"8uint",4);return[k[0],k[1],k[2],k[3]]}case"rgba8sint":{const k=Pr(i,P,"8sint",4);return[k[0],k[1],k[2],k[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const k=Pr(i,P,"8unorm",4);return[k[2],k[1],k[0],k[3]]}case"r16uint":return[Pr(i,P,"16uint",1)[0]];case"r16sint":return[Pr(i,P,"16sint",1)[0]];case"r16float":return[Pr(i,P,"16float",1)[0]];case"rg16uint":{const k=Pr(i,P,"16uint",2);return[k[0],k[1]]}case"rg16sint":{const k=Pr(i,P,"16sint",2);return[k[0],k[1]]}case"rg16float":{const k=Pr(i,P,"16float",2);return[k[0],k[1]]}case"rgba16uint":{const k=Pr(i,P,"16uint",4);return[k[0],k[1],k[2],k[3]]}case"rgba16sint":{const k=Pr(i,P,"16sint",4);return[k[0],k[1],k[2],k[3]]}case"rgba16float":{const k=Pr(i,P,"16float",4);return[k[0],k[1],k[2],k[3]]}case"r32uint":return[Pr(i,P,"32uint",1)[0]];case"r32sint":return[Pr(i,P,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Pr(i,P,"32float",1)[0]];case"rg32uint":{const k=Pr(i,P,"32uint",2);return[k[0],k[1]]}case"rg32sint":{const k=Pr(i,P,"32sint",2);return[k[0],k[1]]}case"rg32float":{const k=Pr(i,P,"32float",2);return[k[0],k[1]]}case"rgba32uint":{const k=Pr(i,P,"32uint",4);return[k[0],k[1],k[2],k[3]]}case"rgba32sint":{const k=Pr(i,P,"32sint",4);return[k[0],k[1],k[2],k[3]]}case"rgba32float":{const k=Pr(i,P,"32float",4);return[k[0],k[1],k[2],k[3]]}case"rg11b10ufloat":{const k=new Uint32Array(i.buffer,P,1)[0],F=(4192256&k)>>11,V=(4290772992&k)>>22;return[H1(2047&k),H1(F),function(W){const ee=112+(W>>5&31)<<23|(31&W)<<18;return w_[0]=ee,Aw[0]}(V),1]}}return null}function Pr(i,e,t,r){const o=[0,0,0,0];for(let P=0;P<r;++P)switch(t){case"8unorm":o[P]=i[e]/255,e++;break;case"8snorm":o[P]=i[e]/255*2-1,e++;break;case"8uint":o[P]=i[e],e++;break;case"8sint":o[P]=i[e]-127,e++;break;case"16uint":o[P]=i[e]|i[e+1]<<8,e+=2;break;case"16sint":o[P]=(i[e]|i[e+1]<<8)-32768,e+=2;break;case"16float":o[P]=(c=i[e]|i[e+1]<<8,f=void 0,a=void 0,w=void 0,f=(32768&c)>>15,w=1023&c,(a=(31744&c)>>10)==0?(f?-1:1)*Math.pow(2,-14)*(w/Math.pow(2,10)):a==31?w?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,a-15)*(1+w/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":o[P]=i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24,e+=4;break;case"32float":o[P]=new Float32Array(i.buffer,e,1)[0],e+=4}var c,f,a,w;return o}function Dr(i,e,t,r,o){for(let c=0;c<r;++c)switch(t){case"8unorm":i[e]=255*o[c],e++;break;case"8snorm":i[e]=.5*(o[c]+1)*255,e++;break;case"8uint":i[e]=o[c],e++;break;case"8sint":i[e]=o[c]+127,e++;break;case"16uint":new Uint16Array(i.buffer,e,1)[0]=o[c],e+=2;break;case"16sint":new Int16Array(i.buffer,e,1)[0]=o[c],e+=2;break;case"16float":{const f=k4(o[c]);new Uint16Array(i.buffer,e,1)[0]=f,e+=2;break}case"32uint":new Uint32Array(i.buffer,e,1)[0]=o[c],e+=4;break;case"32sint":new Int32Array(i.buffer,e,1)[0]=o[c],e+=4;break;case"32float":new Float32Array(i.buffer,e,1)[0]=o[c],e+=4}return o}const Og={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Qo{constructor(){this.id=Qo._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Sp.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(Ep.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Qo._id=0;class Sp extends Qo{}Sp.instance=new Sp;class Ep extends Qo{}Ep.instance=new Ep;const dw=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class on extends Qo{constructor(){super()}}class FA extends on{constructor(e,t,r,o,c,f){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=o,this.startLine=c,this.endLine=f}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class B4 extends on{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class pw extends on{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class km extends on{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class gw extends on{constructor(e,t,r,o){super(),this.init=e,this.condition=t,this.increment=r,this.body=o}get astNodeType(){return"for"}search(e){var t,r,o;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class Wl extends on{constructor(e,t,r,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=c}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class T_ extends on{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class SA extends on{constructor(e,t,r,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=c}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Jd extends on{constructor(e,t,r,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=c}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Uh,gA,At,et;(i=>{i.increment="++",i.decrement="--"})(Uh||(Uh={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return i[t]}})(Uh||(Uh={}));class mw extends on{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(gA||(gA={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(gA||(gA={}));class _w extends on{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class S_ extends on{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return dw.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class yw extends on{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class bw extends on{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class vw extends on{constructor(e,t,r,o){super(),this.condition=e,this.body=t,this.elseif=r,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class xw extends on{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class O4 extends on{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class L4 extends on{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ww extends on{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class E_ extends on{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class F4 extends on{constructor(){super()}get astNodeType(){return"discard"}}class Tw extends on{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Sw extends on{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Nt extends on{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const o=Nt._priority.get(t.name);Nt._priority.get(e[r].name)<o&&(t=e[r])}return t.name==="x32"?Nt.i32:t}getTypeName(){return this.name}}Nt.x32=new Nt("x32"),Nt.f32=new Nt("f32"),Nt.i32=new Nt("i32"),Nt.u32=new Nt("u32"),Nt.f16=new Nt("f16"),Nt.bool=new Nt("bool"),Nt.void=new Nt("void"),Nt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class $1 extends Nt{constructor(e){super(e)}}class Ul extends Nt{constructor(e,t,r,o){super(e),this.members=t,this.startLine=r,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class lt extends Nt{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}lt.vec2f=new lt("vec2",Nt.f32,null),lt.vec3f=new lt("vec3",Nt.f32,null),lt.vec4f=new lt("vec4",Nt.f32,null),lt.vec2i=new lt("vec2",Nt.i32,null),lt.vec3i=new lt("vec3",Nt.i32,null),lt.vec4i=new lt("vec4",Nt.i32,null),lt.vec2u=new lt("vec2",Nt.u32,null),lt.vec3u=new lt("vec3",Nt.u32,null),lt.vec4u=new lt("vec4",Nt.u32,null),lt.vec2h=new lt("vec2",Nt.f16,null),lt.vec3h=new lt("vec3",Nt.f16,null),lt.vec4h=new lt("vec4",Nt.f16,null),lt.vec2b=new lt("vec2",Nt.bool,null),lt.vec3b=new lt("vec3",Nt.bool,null),lt.vec4b=new lt("vec4",Nt.bool,null),lt.mat2x2f=new lt("mat2x2",Nt.f32,null),lt.mat2x3f=new lt("mat2x3",Nt.f32,null),lt.mat2x4f=new lt("mat2x4",Nt.f32,null),lt.mat3x2f=new lt("mat3x2",Nt.f32,null),lt.mat3x3f=new lt("mat3x3",Nt.f32,null),lt.mat3x4f=new lt("mat3x4",Nt.f32,null),lt.mat4x2f=new lt("mat4x2",Nt.f32,null),lt.mat4x3f=new lt("mat4x3",Nt.f32,null),lt.mat4x4f=new lt("mat4x4",Nt.f32,null),lt.mat2x2h=new lt("mat2x2",Nt.f16,null),lt.mat2x3h=new lt("mat2x3",Nt.f16,null),lt.mat2x4h=new lt("mat2x4",Nt.f16,null),lt.mat3x2h=new lt("mat3x2",Nt.f16,null),lt.mat3x3h=new lt("mat3x3",Nt.f16,null),lt.mat3x4h=new lt("mat3x4",Nt.f16,null),lt.mat4x2h=new lt("mat4x2",Nt.f16,null),lt.mat4x3h=new lt("mat4x3",Nt.f16,null),lt.mat4x4h=new lt("mat4x4",Nt.f16,null),lt.mat2x2i=new lt("mat2x2",Nt.i32,null),lt.mat2x3i=new lt("mat2x3",Nt.i32,null),lt.mat2x4i=new lt("mat2x4",Nt.i32,null),lt.mat3x2i=new lt("mat3x2",Nt.i32,null),lt.mat3x3i=new lt("mat3x3",Nt.i32,null),lt.mat3x4i=new lt("mat3x4",Nt.i32,null),lt.mat4x2i=new lt("mat4x2",Nt.i32,null),lt.mat4x3i=new lt("mat4x3",Nt.i32,null),lt.mat4x4i=new lt("mat4x4",Nt.i32,null),lt.mat2x2u=new lt("mat2x2",Nt.u32,null),lt.mat2x3u=new lt("mat2x3",Nt.u32,null),lt.mat2x4u=new lt("mat2x4",Nt.u32,null),lt.mat3x2u=new lt("mat3x2",Nt.u32,null),lt.mat3x3u=new lt("mat3x3",Nt.u32,null),lt.mat3x4u=new lt("mat3x4",Nt.u32,null),lt.mat4x2u=new lt("mat4x2",Nt.u32,null),lt.mat4x3u=new lt("mat4x3",Nt.u32,null),lt.mat4x4u=new lt("mat4x4",Nt.u32,null);class ep extends Nt{constructor(e,t,r,o){super(e),this.storage=t,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class EA extends Nt{constructor(e,t,r,o){super(e),this.attributes=t,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class mA extends Nt{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Fa extends Qo{constructor(){super(),this.postfix=null}}class Vu extends Fa{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class fl extends Fa{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class C_ extends Fa{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return dw.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class So extends Fa{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Ew extends Fa{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class ts extends Fa{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Je}get isVector(){return this.value instanceof Pe||this.value instanceof $i}get scalarValue(){return this.value instanceof Je?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Pe||this.value instanceof $i?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Cw extends Fa{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class tf extends Fa{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Iw extends Fa{constructor(){super()}}class Un extends Iw{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Pa extends Iw{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Nt.f32:e.name==="u32"||t.name==="u32"?Nt.u32:Nt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Pw extends Qo{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class tp extends Fa{constructor(){super()}get astNodeType(){return"default"}}class Mw extends Pw{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Rw extends Pw{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Z1 extends Qo{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class N4 extends Qo{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class q1 extends Qo{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class kw extends Qo{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Xo{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Xo._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,o){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Xo._id=0;class Dm extends Xo{constructor(){super(new $o("void",null),null)}toString(){return"void"}}Dm.void=new Dm;class Lh extends Xo{constructor(e){super(new Rm("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,o){this.reference.setDataValue(e,t,r,o)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class Je extends Xo{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Je(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Je(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Je(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,o){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof Je))return void console.error("SetDataValue: Invalid value",t);let c=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?c=Math.floor(c):this.typeInfo.name==="bool"&&(c=c?1:0),this.data[0]=c}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function z4(i,e,t){const r=e.length;return r===2?t==="f32"?new Pe(new Float32Array(e),i.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new Pe(new Int32Array(e),i.getTypeInfo("vec2i")):t==="u32"?new Pe(new Uint32Array(e),i.getTypeInfo("vec2u")):t==="f16"?new Pe(new Float32Array(e),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new Pe(new Float32Array(e),i.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new Pe(new Int32Array(e),i.getTypeInfo("vec3i")):t==="u32"?new Pe(new Uint32Array(e),i.getTypeInfo("vec3u")):t==="f16"?new Pe(new Float32Array(e),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new Pe(new Float32Array(e),i.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new Pe(new Int32Array(e),i.getTypeInfo("vec4i")):t==="u32"?new Pe(new Uint32Array(e),i.getTypeInfo("vec4u")):t==="f16"?new Pe(new Float32Array(e),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Pe extends Xo{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?this.data=new Float32Array(e):o==="vec2i"||o==="vec3i"||o==="vec4i"?this.data=new Int32Array(e):o==="vec2u"||o==="vec3u"||o==="vec4u"?this.data=new Uint32Array(e):o==="vec2h"||o==="vec3h"||o==="vec4h"?this.data=new Float32Array(e):o==="vec2b"||o==="vec3b"||o==="vec4b"?this.data=new Int32Array(e):o==="vec2"||o==="vec3"||o==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${o}`)}}clone(){if(this.data instanceof Float32Array)return new Pe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Pe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Pe(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,o){r instanceof Vu?console.error("TODO: Set vector postfix"):t instanceof Pe?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let o=e.getTypeInfo("f32");if(this.typeInfo instanceof ju)o=this.typeInfo.format||o;else{const f=this.typeInfo.name;f==="vec2f"||f==="vec3f"||f==="vec4f"?o=e.getTypeInfo("f32"):f==="vec2i"||f==="vec3i"||f==="vec4i"?o=e.getTypeInfo("i32"):f==="vec2b"||f==="vec3b"||f==="vec4b"?o=e.getTypeInfo("bool"):f==="vec2u"||f==="vec3u"||f==="vec4u"?o=e.getTypeInfo("u32"):f==="vec2h"||f==="vec3h"||f==="vec4h"?o=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${f}`)}let c=this;for(;t!==null&&c!==null;){if(t instanceof tf){const f=t.index;let a=-1;if(f instanceof ts){if(!(f.value instanceof Je))return console.error(`GetSubData: Invalid array index ${f.value}`),null;a=f.value.value}else{const w=e.evalExpression(f,r);if(!(w instanceof Je))return console.error("GetSubData: Unknown index type",f),null;a=w.value}if(a<0||a>=c.data.length)return console.error("GetSubData: Index out of range",a),null;if(c.data instanceof Float32Array){const w=new Float32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Je(w,o)}if(c.data instanceof Int32Array){const w=new Int32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Je(w,o)}if(c.data instanceof Uint32Array){const w=new Uint32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Je(w,o)}throw"GetSubData: Invalid data type"}if(!(t instanceof Vu))return console.error("GetSubData: Unknown postfix",t),null;{const f=t.value.toLowerCase();if(f.length===1){let w=0;if(f==="x"||f==="r")w=0;else if(f==="y"||f==="g")w=1;else if(f==="z"||f==="b")w=2;else{if(f!=="w"&&f!=="a")return console.error(`GetSubData: Unknown member ${f}`),null;w=3}if(this.data instanceof Float32Array){let P=new Float32Array(this.data.buffer,this.data.byteOffset+4*w,1);return new Je(P,o,this)}if(this.data instanceof Int32Array){let P=new Int32Array(this.data.buffer,this.data.byteOffset+4*w,1);return new Je(P,o,this)}if(this.data instanceof Uint32Array){let P=new Uint32Array(this.data.buffer,this.data.byteOffset+4*w,1);return new Je(P,o,this)}}const a=[];for(const w of f)w==="x"||w==="r"?a.push(this.data[0]):w==="y"||w==="g"?a.push(this.data[1]):w==="z"||w==="b"?a.push(this.data[2]):w==="w"||w==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${w}`);c=z4(e,a,o.name)}t=t.postfix}return c}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class $i extends Xo{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new $i(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,o){r instanceof Vu?console.error("TODO: Set matrix postfix"):t instanceof $i?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const o=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof ju)this.typeInfo.format;else if(o.endsWith("f"))e.getTypeInfo("f32");else if(o.endsWith("i"))e.getTypeInfo("i32");else if(o.endsWith("u"))e.getTypeInfo("u32");else{if(!o.endsWith("h"))return console.error(`GetDataValue: Unknown type ${o}`),null;e.getTypeInfo("f16")}if(t instanceof tf){const c=t.index;let f=-1;if(c instanceof ts){if(!(c.value instanceof Je))return console.error(`GetDataValue: Invalid array index ${c.value}`),null;f=c.value.value}else{const P=e.evalExpression(c,r);if(!(P instanceof Je))return console.error("GetDataValue: Unknown index type",c),null;f=P.value}if(f<0||f>=this.data.length)return console.error("GetDataValue: Index out of range",f),null;const a=o.endsWith("h")?"h":"f";let w;if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h"||o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h")w=new Pe(new Float32Array(this.data.buffer,this.data.byteOffset+2*f*4,2),e.getTypeInfo(`vec2${a}`));else if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h"||o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h")w=new Pe(new Float32Array(this.data.buffer,this.data.byteOffset+3*f*4,3),e.getTypeInfo(`vec3${a}`));else{if(o!=="mat2x4"&&o!=="mat2x4f"&&o!=="mat2x4h"&&o!=="mat3x4"&&o!=="mat3x4f"&&o!=="mat3x4h"&&o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${o}`),null;w=new Pe(new Float32Array(this.data.buffer,this.data.byteOffset+4*f*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?w.getSubData(e,t.postfix,r):w}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class xn extends Xo{constructor(e,t,r=0,o=null){super(t,o),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new xn(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,o){if(t===null)return void console.log("setDataValue: NULL data.");let c=this.offset,f=this.typeInfo;for(;r;){if(r instanceof tf)if(f instanceof zc){const a=r.index;if(a instanceof ts){if(!(a.value instanceof Je))return void console.error(`SetDataValue: Invalid index type ${a.value}`);c+=a.value.value*f.stride}else{const w=e.evalExpression(a,o);if(!(w instanceof Je))return void console.error("SetDataValue: Unknown index type",a);c+=w.value*f.stride}f=f.format}else console.error(`SetDataValue: Type ${f.getTypeName()} is not an array`);else{if(!(r instanceof Vu))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(f instanceof Lc){let w=!1;for(const P of f.members)if(P.name===a){c+=P.offset,f=P.type,w=!0;break}if(!w)return void console.error(`SetDataValue: Member ${a} not found`)}else if(f instanceof $o){const w=f.getTypeName();let P=0;if(a==="x"||a==="r")P=0;else if(a==="y"||a==="g")P=1;else if(a==="z"||a==="b")P=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);P=3}if(!(t instanceof Je))return void console.error("SetDataValue: Invalid value",t);const k=t.value;return w==="vec2f"?void(new Float32Array(this.buffer,c,2)[P]=k):w==="vec3f"?void(new Float32Array(this.buffer,c,3)[P]=k):w==="vec4f"?void(new Float32Array(this.buffer,c,4)[P]=k):w==="vec2i"?void(new Int32Array(this.buffer,c,2)[P]=k):w==="vec3i"?void(new Int32Array(this.buffer,c,3)[P]=k):w==="vec4i"?void(new Int32Array(this.buffer,c,4)[P]=k):w==="vec2u"?void(new Uint32Array(this.buffer,c,2)[P]=k):w==="vec3u"?void(new Uint32Array(this.buffer,c,3)[P]=k):w==="vec4u"?void(new Uint32Array(this.buffer,c,4)[P]=k):void console.error(`SetDataValue: Type ${w} is not a struct`)}}}r=r.postfix}this.setData(e,t,f,c,o)}setData(e,t,r,o,c){const f=r.getTypeName();if(f!=="f32"&&f!=="f16")if(f!=="i32"&&f!=="atomic<i32>"&&f!=="x32")if(f!=="u32"&&f!=="atomic<u32>")if(f!=="bool")if(f!=="vec2f"&&f!=="vec2h")if(f!=="vec3f"&&f!=="vec3h")if(f!=="vec4f"&&f!=="vec4h")if(f!=="vec2i")if(f!=="vec3i")if(f!=="vec4i")if(f!=="vec2u")if(f!=="vec3u")if(f!=="vec4u")if(f!=="vec2b")if(f!=="vec3b")if(f!=="vec4b")if(f!=="mat2x2f"&&f!=="mat2x2h")if(f!=="mat2x3f"&&f!=="mat2x3h")if(f!=="mat2x4f"&&f!=="mat2x4h")if(f!=="mat3x2f"&&f!=="mat3x2h")if(f!=="mat3x3f"&&f!=="mat3x3h")if(f!=="mat3x4f"&&f!=="mat3x4h")if(f!=="mat4x2f"&&f!=="mat4x2h")if(f!=="mat4x3f"&&f!=="mat4x3h")if(f!=="mat4x4f"&&f!=="mat4x4h")if(t instanceof xn){if(r===t.typeInfo)return void new Uint8Array(this.buffer,o,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",f,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${f}`);else{const a=new Float32Array(this.buffer,o,16);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15])}else{const a=new Float32Array(this.buffer,o,12);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,o,8);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,o,12);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,o,9);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8])}else{const a=new Float32Array(this.buffer,o,6);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,o,8);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,o,6);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,o,4);t instanceof $i?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,o,4);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,o,3);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,o,2);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Uint32Array(this.buffer,o,4);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,o,3);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,o,2);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Int32Array(this.buffer,o,4);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Int32Array(this.buffer,o,3);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Int32Array(this.buffer,o,2);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Float32Array(this.buffer,o,4);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Float32Array(this.buffer,o,3);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Float32Array(this.buffer,o,2);t instanceof Pe?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else t instanceof Je&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof Je&&(new Uint32Array(this.buffer,o,1)[0]=t.value);else t instanceof Je&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof Je&&(new Float32Array(this.buffer,o,1)[0]=t.value)}getSubData(e,t,r){var o,c,f;if(t===null)return this;let a=this.offset,w=this.typeInfo;for(;t;){if(t instanceof tf){const k=t.index,F=k instanceof Fa?e.evalExpression(k,r):k;let V=0;if(F instanceof Je?V=F.value:typeof F=="number"?V=F:console.error("GetDataValue: Invalid index type",k),w instanceof zc)a+=V*w.stride,w=w.format;else{const W=w.getTypeName();W==="mat4x4"||W==="mat4x4f"||W==="mat4x4h"?(a+=16*V,w=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${w.getTypeName()} is not an array`)}}else{if(!(t instanceof Vu))return console.error("GetDataValue: Unknown postfix type",t),null;{const k=t.value;if(w instanceof Lc){let F=!1;for(const V of w.members)if(V.name===k){a+=V.offset,w=V.type,F=!0;break}if(!F)return console.error(`GetDataValue: Member ${k} not found`),null}else if(w instanceof $o){const F=w.getTypeName();if(F==="vec2f"||F==="vec3f"||F==="vec4f"||F==="vec2i"||F==="vec3i"||F==="vec4i"||F==="vec2u"||F==="vec3u"||F==="vec4u"||F==="vec2b"||F==="vec3b"||F==="vec4b"||F==="vec2h"||F==="vec3h"||F==="vec4h"||F==="vec2"||F==="vec3"||F==="vec4"){if(k.length>0&&k.length<5){let V="f";const W=[];for(let ee=0;ee<k.length;++ee){const he=k[ee].toLowerCase();let Ie=0;if(he==="x"||he==="r")Ie=0;else if(he==="y"||he==="g")Ie=1;else if(he==="z"||he==="b")Ie=2;else{if(he!=="w"&&he!=="a")return console.error(`Unknown member ${k}`),null;Ie=3}if(k.length===1){if(F.endsWith("f"))return this.buffer.byteLength<a+4*Ie+4?(console.log("Insufficient buffer data"),null):new Je(new Float32Array(this.buffer,a+4*Ie,1),e.getTypeInfo("f32"),this);if(F.endsWith("h"))return new Je(new Float32Array(this.buffer,a+4*Ie,1),e.getTypeInfo("f16"),this);if(F.endsWith("i"))return new Je(new Int32Array(this.buffer,a+4*Ie,1),e.getTypeInfo("i32"),this);if(F.endsWith("b"))return new Je(new Int32Array(this.buffer,a+4*Ie,1),e.getTypeInfo("bool"),this);if(F.endsWith("u"))return new Je(new Uint32Array(this.buffer,a+4*Ie,1),e.getTypeInfo("i32"),this)}if(F==="vec2f")W.push(new Float32Array(this.buffer,a,2)[Ie]);else if(F==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const Ee=new Float32Array(this.buffer,a,3);W.push(Ee[Ie])}else if(F==="vec4f")W.push(new Float32Array(this.buffer,a,4)[Ie]);else if(F==="vec2i")V="i",W.push(new Int32Array(this.buffer,a,2)[Ie]);else if(F==="vec3i")V="i",W.push(new Int32Array(this.buffer,a,3)[Ie]);else if(F==="vec4i")V="i",W.push(new Int32Array(this.buffer,a,4)[Ie]);else if(F==="vec2u"){V="u";const Ee=new Uint32Array(this.buffer,a,2);W.push(Ee[Ie])}else F==="vec3u"?(V="u",W.push(new Uint32Array(this.buffer,a,3)[Ie])):F==="vec4u"&&(V="u",W.push(new Uint32Array(this.buffer,a,4)[Ie]))}return W.length===2?w=e.getTypeInfo(`vec2${V}`):W.length===3?w=e.getTypeInfo(`vec3${V}`):W.length===4?w=e.getTypeInfo(`vec4${V}`):console.error(`GetDataValue: Invalid vector length ${W.length}`),new Pe(W,w,null)}return console.error(`GetDataValue: Unknown member ${k}`),null}return console.error(`GetDataValue: Type ${F} is not a struct`),null}}}t=t.postfix}const P=w.getTypeName();return P==="f32"?new Je(new Float32Array(this.buffer,a,1),w,this):P==="i32"?new Je(new Int32Array(this.buffer,a,1),w,this):P==="u32"?new Je(new Uint32Array(this.buffer,a,1),w,this):P==="vec2f"?new Pe(new Float32Array(this.buffer,a,2),w,this):P==="vec3f"?new Pe(new Float32Array(this.buffer,a,3),w,this):P==="vec4f"?new Pe(new Float32Array(this.buffer,a,4),w,this):P==="vec2i"?new Pe(new Int32Array(this.buffer,a,2),w,this):P==="vec3i"?new Pe(new Int32Array(this.buffer,a,3),w,this):P==="vec4i"?new Pe(new Int32Array(this.buffer,a,4),w,this):P==="vec2u"?new Pe(new Uint32Array(this.buffer,a,2),w,this):P==="vec3u"?new Pe(new Uint32Array(this.buffer,a,3),w,this):P==="vec4u"?new Pe(new Uint32Array(this.buffer,a,4),w,this):w instanceof ju&&w.name==="atomic"?((o=w.format)===null||o===void 0?void 0:o.name)==="u32"?new Je(new Uint32Array(this.buffer,a,1)[0],w.format,this):((c=w.format)===null||c===void 0?void 0:c.name)==="i32"?new Je(new Int32Array(this.buffer,a,1)[0],w.format,this):(console.error(`GetDataValue: Invalid atomic format ${(f=w.format)===null||f===void 0?void 0:f.name}`),null):new xn(this.buffer,w,a,this)}toString(){let e="";if(this.typeInfo instanceof zc)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Lc?e+="{...}":e="[...]";return e}}class jl extends Xo{constructor(e,t,r,o){super(t,null),this.data=e,this.descriptor=r,this.view=o}clone(){return new jl(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=Og[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Og[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Og[e],r=this.width;if(!e||r<=0||!t)return-1;const o=this.height,c=this.depthOrArrayLayers,f=this.dimension;return r/t.blockWidth*(f==="1d"?1:o/t.blockHeight)*t.bytesPerBlock*c}getPixel(e,t,r=0,o=0){const c=this.texelByteSize,f=this.bytesPerRow,a=this.height,w=this.data[o];return D4(new Uint8Array(w),e,t,r,o,a,f,c,this.format)}setPixel(e,t,r,o,c){const f=this.texelByteSize,a=this.bytesPerRow,w=this.height,P=this.data[o];(function(k,F,V,W,ee,he,Ie,Ee,Ne,Ce){const De=W*(Ie>>=ee)*(he>>=ee)+V*Ie+F*Ee;switch(Ne){case"r8unorm":return void Dr(k,De,"8unorm",1,Ce);case"r8snorm":return void Dr(k,De,"8snorm",1,Ce);case"r8uint":return void Dr(k,De,"8uint",1,Ce);case"r8sint":return void Dr(k,De,"8sint",1,Ce);case"rg8unorm":return void Dr(k,De,"8unorm",2,Ce);case"rg8snorm":return void Dr(k,De,"8snorm",2,Ce);case"rg8uint":return void Dr(k,De,"8uint",2,Ce);case"rg8sint":return void Dr(k,De,"8sint",2,Ce);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Dr(k,De,"8unorm",4,Ce);case"rgba8snorm":return void Dr(k,De,"8snorm",4,Ce);case"rgba8uint":return void Dr(k,De,"8uint",4,Ce);case"rgba8sint":return void Dr(k,De,"8sint",4,Ce);case"r16uint":return void Dr(k,De,"16uint",1,Ce);case"r16sint":return void Dr(k,De,"16sint",1,Ce);case"r16float":return void Dr(k,De,"16float",1,Ce);case"rg16uint":return void Dr(k,De,"16uint",2,Ce);case"rg16sint":return void Dr(k,De,"16sint",2,Ce);case"rg16float":return void Dr(k,De,"16float",2,Ce);case"rgba16uint":return void Dr(k,De,"16uint",4,Ce);case"rgba16sint":return void Dr(k,De,"16sint",4,Ce);case"rgba16float":return void Dr(k,De,"16float",4,Ce);case"r32uint":return void Dr(k,De,"32uint",1,Ce);case"r32sint":return void Dr(k,De,"32sint",1,Ce);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Dr(k,De,"32float",1,Ce);case"rg32uint":return void Dr(k,De,"32uint",2,Ce);case"rg32sint":return void Dr(k,De,"32sint",2,Ce);case"rg32float":return void Dr(k,De,"32float",2,Ce);case"rgba32uint":return void Dr(k,De,"32uint",4,Ce);case"rgba32sint":return void Dr(k,De,"32sint",4,Ce);case"rgba32float":return void Dr(k,De,"32float",4,Ce);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(P),e,t,r,o,w,a,f,this.format,c)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(et||(et={}));class it{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class _e{}At=_e,_e.none=new it("",et.reserved,""),_e.eof=new it("EOF",et.token,""),_e.reserved={asm:new it("asm",et.reserved,"asm"),bf16:new it("bf16",et.reserved,"bf16"),do:new it("do",et.reserved,"do"),enum:new it("enum",et.reserved,"enum"),f16:new it("f16",et.reserved,"f16"),f64:new it("f64",et.reserved,"f64"),handle:new it("handle",et.reserved,"handle"),i8:new it("i8",et.reserved,"i8"),i16:new it("i16",et.reserved,"i16"),i64:new it("i64",et.reserved,"i64"),mat:new it("mat",et.reserved,"mat"),premerge:new it("premerge",et.reserved,"premerge"),regardless:new it("regardless",et.reserved,"regardless"),typedef:new it("typedef",et.reserved,"typedef"),u8:new it("u8",et.reserved,"u8"),u16:new it("u16",et.reserved,"u16"),u64:new it("u64",et.reserved,"u64"),unless:new it("unless",et.reserved,"unless"),using:new it("using",et.reserved,"using"),vec:new it("vec",et.reserved,"vec"),void:new it("void",et.reserved,"void")},_e.keywords={array:new it("array",et.keyword,"array"),atomic:new it("atomic",et.keyword,"atomic"),bool:new it("bool",et.keyword,"bool"),f32:new it("f32",et.keyword,"f32"),i32:new it("i32",et.keyword,"i32"),mat2x2:new it("mat2x2",et.keyword,"mat2x2"),mat2x3:new it("mat2x3",et.keyword,"mat2x3"),mat2x4:new it("mat2x4",et.keyword,"mat2x4"),mat3x2:new it("mat3x2",et.keyword,"mat3x2"),mat3x3:new it("mat3x3",et.keyword,"mat3x3"),mat3x4:new it("mat3x4",et.keyword,"mat3x4"),mat4x2:new it("mat4x2",et.keyword,"mat4x2"),mat4x3:new it("mat4x3",et.keyword,"mat4x3"),mat4x4:new it("mat4x4",et.keyword,"mat4x4"),ptr:new it("ptr",et.keyword,"ptr"),sampler:new it("sampler",et.keyword,"sampler"),sampler_comparison:new it("sampler_comparison",et.keyword,"sampler_comparison"),struct:new it("struct",et.keyword,"struct"),texture_1d:new it("texture_1d",et.keyword,"texture_1d"),texture_2d:new it("texture_2d",et.keyword,"texture_2d"),texture_2d_array:new it("texture_2d_array",et.keyword,"texture_2d_array"),texture_3d:new it("texture_3d",et.keyword,"texture_3d"),texture_cube:new it("texture_cube",et.keyword,"texture_cube"),texture_cube_array:new it("texture_cube_array",et.keyword,"texture_cube_array"),texture_multisampled_2d:new it("texture_multisampled_2d",et.keyword,"texture_multisampled_2d"),texture_storage_1d:new it("texture_storage_1d",et.keyword,"texture_storage_1d"),texture_storage_2d:new it("texture_storage_2d",et.keyword,"texture_storage_2d"),texture_storage_2d_array:new it("texture_storage_2d_array",et.keyword,"texture_storage_2d_array"),texture_storage_3d:new it("texture_storage_3d",et.keyword,"texture_storage_3d"),texture_depth_2d:new it("texture_depth_2d",et.keyword,"texture_depth_2d"),texture_depth_2d_array:new it("texture_depth_2d_array",et.keyword,"texture_depth_2d_array"),texture_depth_cube:new it("texture_depth_cube",et.keyword,"texture_depth_cube"),texture_depth_cube_array:new it("texture_depth_cube_array",et.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new it("texture_depth_multisampled_2d",et.keyword,"texture_depth_multisampled_2d"),texture_external:new it("texture_external",et.keyword,"texture_external"),u32:new it("u32",et.keyword,"u32"),vec2:new it("vec2",et.keyword,"vec2"),vec3:new it("vec3",et.keyword,"vec3"),vec4:new it("vec4",et.keyword,"vec4"),bitcast:new it("bitcast",et.keyword,"bitcast"),block:new it("block",et.keyword,"block"),break:new it("break",et.keyword,"break"),case:new it("case",et.keyword,"case"),continue:new it("continue",et.keyword,"continue"),continuing:new it("continuing",et.keyword,"continuing"),default:new it("default",et.keyword,"default"),diagnostic:new it("diagnostic",et.keyword,"diagnostic"),discard:new it("discard",et.keyword,"discard"),else:new it("else",et.keyword,"else"),enable:new it("enable",et.keyword,"enable"),fallthrough:new it("fallthrough",et.keyword,"fallthrough"),false:new it("false",et.keyword,"false"),fn:new it("fn",et.keyword,"fn"),for:new it("for",et.keyword,"for"),function:new it("function",et.keyword,"function"),if:new it("if",et.keyword,"if"),let:new it("let",et.keyword,"let"),const:new it("const",et.keyword,"const"),loop:new it("loop",et.keyword,"loop"),while:new it("while",et.keyword,"while"),private:new it("private",et.keyword,"private"),read:new it("read",et.keyword,"read"),read_write:new it("read_write",et.keyword,"read_write"),return:new it("return",et.keyword,"return"),requires:new it("requires",et.keyword,"requires"),storage:new it("storage",et.keyword,"storage"),switch:new it("switch",et.keyword,"switch"),true:new it("true",et.keyword,"true"),alias:new it("alias",et.keyword,"alias"),type:new it("type",et.keyword,"type"),uniform:new it("uniform",et.keyword,"uniform"),var:new it("var",et.keyword,"var"),override:new it("override",et.keyword,"override"),workgroup:new it("workgroup",et.keyword,"workgroup"),write:new it("write",et.keyword,"write"),r8unorm:new it("r8unorm",et.keyword,"r8unorm"),r8snorm:new it("r8snorm",et.keyword,"r8snorm"),r8uint:new it("r8uint",et.keyword,"r8uint"),r8sint:new it("r8sint",et.keyword,"r8sint"),r16uint:new it("r16uint",et.keyword,"r16uint"),r16sint:new it("r16sint",et.keyword,"r16sint"),r16float:new it("r16float",et.keyword,"r16float"),rg8unorm:new it("rg8unorm",et.keyword,"rg8unorm"),rg8snorm:new it("rg8snorm",et.keyword,"rg8snorm"),rg8uint:new it("rg8uint",et.keyword,"rg8uint"),rg8sint:new it("rg8sint",et.keyword,"rg8sint"),r32uint:new it("r32uint",et.keyword,"r32uint"),r32sint:new it("r32sint",et.keyword,"r32sint"),r32float:new it("r32float",et.keyword,"r32float"),rg16uint:new it("rg16uint",et.keyword,"rg16uint"),rg16sint:new it("rg16sint",et.keyword,"rg16sint"),rg16float:new it("rg16float",et.keyword,"rg16float"),rgba8unorm:new it("rgba8unorm",et.keyword,"rgba8unorm"),rgba8unorm_srgb:new it("rgba8unorm_srgb",et.keyword,"rgba8unorm_srgb"),rgba8snorm:new it("rgba8snorm",et.keyword,"rgba8snorm"),rgba8uint:new it("rgba8uint",et.keyword,"rgba8uint"),rgba8sint:new it("rgba8sint",et.keyword,"rgba8sint"),bgra8unorm:new it("bgra8unorm",et.keyword,"bgra8unorm"),bgra8unorm_srgb:new it("bgra8unorm_srgb",et.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new it("rgb10a2unorm",et.keyword,"rgb10a2unorm"),rg11b10float:new it("rg11b10float",et.keyword,"rg11b10float"),rg32uint:new it("rg32uint",et.keyword,"rg32uint"),rg32sint:new it("rg32sint",et.keyword,"rg32sint"),rg32float:new it("rg32float",et.keyword,"rg32float"),rgba16uint:new it("rgba16uint",et.keyword,"rgba16uint"),rgba16sint:new it("rgba16sint",et.keyword,"rgba16sint"),rgba16float:new it("rgba16float",et.keyword,"rgba16float"),rgba32uint:new it("rgba32uint",et.keyword,"rgba32uint"),rgba32sint:new it("rgba32sint",et.keyword,"rgba32sint"),rgba32float:new it("rgba32float",et.keyword,"rgba32float"),static_assert:new it("static_assert",et.keyword,"static_assert")},_e.tokens={decimal_float_literal:new it("decimal_float_literal",et.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new it("hex_float_literal",et.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new it("int_literal",et.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new it("uint_literal",et.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new it("name",et.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new it("ident",et.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new it("and",et.token,"&"),and_and:new it("and_and",et.token,"&&"),arrow:new it("arrow ",et.token,"->"),attr:new it("attr",et.token,"@"),forward_slash:new it("forward_slash",et.token,"/"),bang:new it("bang",et.token,"!"),bracket_left:new it("bracket_left",et.token,"["),bracket_right:new it("bracket_right",et.token,"]"),brace_left:new it("brace_left",et.token,"{"),brace_right:new it("brace_right",et.token,"}"),colon:new it("colon",et.token,":"),comma:new it("comma",et.token,","),equal:new it("equal",et.token,"="),equal_equal:new it("equal_equal",et.token,"=="),not_equal:new it("not_equal",et.token,"!="),greater_than:new it("greater_than",et.token,">"),greater_than_equal:new it("greater_than_equal",et.token,">="),shift_right:new it("shift_right",et.token,">>"),less_than:new it("less_than",et.token,"<"),less_than_equal:new it("less_than_equal",et.token,"<="),shift_left:new it("shift_left",et.token,"<<"),modulo:new it("modulo",et.token,"%"),minus:new it("minus",et.token,"-"),minus_minus:new it("minus_minus",et.token,"--"),period:new it("period",et.token,"."),plus:new it("plus",et.token,"+"),plus_plus:new it("plus_plus",et.token,"++"),or:new it("or",et.token,"|"),or_or:new it("or_or",et.token,"||"),paren_left:new it("paren_left",et.token,"("),paren_right:new it("paren_right",et.token,")"),semicolon:new it("semicolon",et.token,";"),star:new it("star",et.token,"*"),tilde:new it("tilde",et.token,"~"),underscore:new it("underscore",et.token,"_"),xor:new it("xor",et.token,"^"),plus_equal:new it("plus_equal",et.token,"+="),minus_equal:new it("minus_equal",et.token,"-="),times_equal:new it("times_equal",et.token,"*="),division_equal:new it("division_equal",et.token,"/="),modulo_equal:new it("modulo_equal",et.token,"%="),and_equal:new it("and_equal",et.token,"&="),or_equal:new it("or_equal",et.token,"|="),xor_equal:new it("xor_equal",et.token,"^="),shift_right_equal:new it("shift_right_equal",et.token,">>="),shift_left_equal:new it("shift_left_equal",et.token,"<<=")},_e.simpleTokens={"@":At.tokens.attr,"{":At.tokens.brace_left,"}":At.tokens.brace_right,":":At.tokens.colon,",":At.tokens.comma,"(":At.tokens.paren_left,")":At.tokens.paren_right,";":At.tokens.semicolon},_e.literalTokens={"&":At.tokens.and,"&&":At.tokens.and_and,"->":At.tokens.arrow,"/":At.tokens.forward_slash,"!":At.tokens.bang,"[":At.tokens.bracket_left,"]":At.tokens.bracket_right,"=":At.tokens.equal,"==":At.tokens.equal_equal,"!=":At.tokens.not_equal,">":At.tokens.greater_than,">=":At.tokens.greater_than_equal,">>":At.tokens.shift_right,"<":At.tokens.less_than,"<=":At.tokens.less_than_equal,"<<":At.tokens.shift_left,"%":At.tokens.modulo,"-":At.tokens.minus,"--":At.tokens.minus_minus,".":At.tokens.period,"+":At.tokens.plus,"++":At.tokens.plus_plus,"|":At.tokens.or,"||":At.tokens.or_or,"*":At.tokens.star,"~":At.tokens.tilde,_:At.tokens.underscore,"^":At.tokens.xor,"+=":At.tokens.plus_equal,"-=":At.tokens.minus_equal,"*=":At.tokens.times_equal,"/=":At.tokens.division_equal,"%=":At.tokens.modulo_equal,"&=":At.tokens.and_equal,"|=":At.tokens.or_equal,"^=":At.tokens.xor_equal,">>=":At.tokens.shift_right_equal,"<<=":At.tokens.shift_left_equal},_e.regexTokens={decimal_float_literal:At.tokens.decimal_float_literal,hex_float_literal:At.tokens.hex_float_literal,int_literal:At.tokens.int_literal,uint_literal:At.tokens.uint_literal,ident:At.tokens.ident},_e.storage_class=[At.keywords.function,At.keywords.private,At.keywords.workgroup,At.keywords.uniform,At.keywords.storage],_e.access_mode=[At.keywords.read,At.keywords.write,At.keywords.read_write],_e.sampler_type=[At.keywords.sampler,At.keywords.sampler_comparison],_e.sampled_texture_type=[At.keywords.texture_1d,At.keywords.texture_2d,At.keywords.texture_2d_array,At.keywords.texture_3d,At.keywords.texture_cube,At.keywords.texture_cube_array],_e.multisampled_texture_type=[At.keywords.texture_multisampled_2d],_e.storage_texture_type=[At.keywords.texture_storage_1d,At.keywords.texture_storage_2d,At.keywords.texture_storage_2d_array,At.keywords.texture_storage_3d],_e.depth_texture_type=[At.keywords.texture_depth_2d,At.keywords.texture_depth_2d_array,At.keywords.texture_depth_cube,At.keywords.texture_depth_cube_array,At.keywords.texture_depth_multisampled_2d],_e.texture_external_type=[At.keywords.texture_external],_e.any_texture_type=[...At.sampled_texture_type,...At.multisampled_texture_type,...At.storage_texture_type,...At.depth_texture_type,...At.texture_external_type],_e.texel_format=[At.keywords.r8unorm,At.keywords.r8snorm,At.keywords.r8uint,At.keywords.r8sint,At.keywords.r16uint,At.keywords.r16sint,At.keywords.r16float,At.keywords.rg8unorm,At.keywords.rg8snorm,At.keywords.rg8uint,At.keywords.rg8sint,At.keywords.r32uint,At.keywords.r32sint,At.keywords.r32float,At.keywords.rg16uint,At.keywords.rg16sint,At.keywords.rg16float,At.keywords.rgba8unorm,At.keywords.rgba8unorm_srgb,At.keywords.rgba8snorm,At.keywords.rgba8uint,At.keywords.rgba8sint,At.keywords.bgra8unorm,At.keywords.bgra8unorm_srgb,At.keywords.rgb10a2unorm,At.keywords.rg11b10float,At.keywords.rg32uint,At.keywords.rg32sint,At.keywords.rg32float,At.keywords.rgba16uint,At.keywords.rgba16sint,At.keywords.rgba16float,At.keywords.rgba32uint,At.keywords.rgba32sint,At.keywords.rgba32float],_e.const_literal=[At.tokens.int_literal,At.tokens.uint_literal,At.tokens.decimal_float_literal,At.tokens.hex_float_literal,At.keywords.true,At.keywords.false],_e.literal_or_ident=[At.tokens.ident,At.tokens.int_literal,At.tokens.uint_literal,At.tokens.decimal_float_literal,At.tokens.hex_float_literal,At.tokens.name],_e.element_count_expression=[At.tokens.int_literal,At.tokens.uint_literal,At.tokens.ident],_e.template_types=[At.keywords.vec2,At.keywords.vec3,At.keywords.vec4,At.keywords.mat2x2,At.keywords.mat2x3,At.keywords.mat2x4,At.keywords.mat3x2,At.keywords.mat3x3,At.keywords.mat3x4,At.keywords.mat4x2,At.keywords.mat4x3,At.keywords.mat4x4,At.keywords.atomic,At.keywords.bitcast,...At.any_texture_type],_e.attribute_name=[At.tokens.ident,At.keywords.block,At.keywords.diagnostic],_e.assignment_operators=[At.tokens.equal,At.tokens.plus_equal,At.tokens.minus_equal,At.tokens.times_equal,At.tokens.division_equal,At.tokens.modulo_equal,At.tokens.and_equal,At.tokens.or_equal,At.tokens.xor_equal,At.tokens.shift_right_equal,At.tokens.shift_left_equal],_e.increment_operators=[At.tokens.plus_plus,At.tokens.minus_minus];class X1{constructor(e,t,r,o,c){this.type=e,this.lexeme=t,this.line=r,this.start=o,this.end=c}toString(){return this.lexeme}isTemplateType(){return _e.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==_e.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class U4{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new X1(_e.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let f=1;for(;f>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),f--,f==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),f++)}return!0}}const t=_e.simpleTokens[e];if(t)return this._addToken(t),!0;let r=_e.none;const o=this._isAlpha(e),c=e==="_";if(this._isAlphaNumeric(e)){let f=this._peekAhead();for(;this._isAlphaNumeric(f);)e+=this._advance(),f=this._peekAhead()}if(o){const f=_e.keywords[e];if(f)return this._addToken(f),!0}if(o||c)return this._addToken(_e.tokens.ident),!0;for(;;){let f=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(_e.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(_e.tokens.minus_minus),!0;const w=this._tokens.length-1;if((_e.literal_or_ident.indexOf(this._tokens[w].type)!=-1||this._tokens[w].type==_e.tokens.paren_right)&&a!=">")return this._addToken(f),!0}if(e==">"&&(a==">"||a=="=")){let w=!1,P=this._tokens.length-1;for(let k=0;k<5&&P>=0&&_e.assignment_operators.indexOf(this._tokens[P].type)===-1;++k,--P)if(this._tokens[P].type===_e.tokens.less_than){P>0&&this._tokens[P-1].isArrayOrTemplateType()&&(w=!0);break}if(w)return this._addToken(f),!0}if(f===_e.none){let w=e,P=0;const k=2;for(let F=0;F<k;++F)if(w+=this._peekAhead(F),f=this._findType(w),f!==_e.none){P=F;break}if(f===_e.none)return r!==_e.none&&(this._current--,this._addToken(r),!0);e=w,this._current+=P+1}if(r=f,this._isAtEnd())break;e+=this._advance()}return r!==_e.none&&(this._addToken(r),!0)}_findType(e){for(const r in _e.regexTokens){const o=_e.regexTokens[r];if(this._match(e,o.rule))return o}return _e.literalTokens[e]||_e.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new X1(e,t,this._line,this._start,this._current))}}function hi(i){return Array.isArray(i)||(i==null?void 0:i.buffer)instanceof ArrayBuffer}const Cp=new Float32Array(1),j4=new Uint32Array(Cp.buffer),V4=new Uint32Array(Cp.buffer),Ip=new Int32Array(1),W4=new Float32Array(Ip.buffer),H4=new Uint32Array(Ip.buffer),Pp=new Uint32Array(1),$4=new Float32Array(Pp.buffer),Z4=new Int32Array(Pp.buffer);function G1(i,e,t){if(e===t)return i;if(e==="f32"){if(t==="i32"||t==="x32")return Cp[0]=i,j4[0];if(t==="u32")return Cp[0]=i,V4[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Ip[0]=i,W4[0];if(t==="u32")return Ip[0]=i,H4[0]}else if(e==="u32"){if(t==="f32")return Pp[0]=i,$4[0];if(t==="i32"||t==="x32")return Pp[0]=i,Z4[0]}return console.error(`Unsupported cast from ${e} to ${t}`),i}class q4{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Rd{constructor(e,t){this.align=e,this.size=t}}class dl{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new M4,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof FA&&this._functions.set(t.name,new q4(t));for(const t of e)if(t instanceof Ul){const r=this.getTypeInfo(t,null);r instanceof Lc&&this.structs.push(r)}for(const t of e)if(t instanceof E_)this.aliases.push(this._getAliasInfo(t));else if(t instanceof T_){const r=t,o=this._getAttributeNum(r.attributes,"id",0),c=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new C4(r.name,c,r.attributes,o))}else if(this._isUniformVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),a=new Md(r.name,f,o,c,r.attributes,Rc.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a)}else if(this._isStorageVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(f),w=new Md(r.name,f,o,c,r.attributes,a?Rc.StorageTexture:Rc.Storage,r.access);w.access||(w.access="read"),this.storage.push(w)}else if(this._isTextureVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(f),w=new Md(r.name,f,o,c,r.attributes,a?Rc.StorageTexture:Rc.Texture,r.access);w.access||(w.access="read"),a?this.storage.push(w):this.textures.push(w)}else if(this._isSamplerVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),a=new Md(r.name,f,o,c,r.attributes,Rc.Sampler,r.access);this.samplers.push(a)}for(const t of e)if(t instanceof FA){const r=this._getAttribute(t,"vertex"),o=this._getAttribute(t,"fragment"),c=this._getAttribute(t,"compute"),f=r||o||c,a=new P4(t.name,f==null?void 0:f.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,f&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!f),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[f.name].push(a)),a.arguments=t.args.map(w=>new I4(w.name,this.getTypeInfo(w.type,w.attributes),w.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var o,c,f;if(r instanceof kw){if(r.value)if(hi(r.value))for(const a of r.value)for(const w of this.overrides)a===w.name&&((o=t.info)===null||o===void 0||o.overrides.push(w));else for(const a of this.overrides)r.value===a.name&&((c=t.info)===null||c===void 0||c.overrides.push(a))}else if(r instanceof So)for(const a of this.overrides)r.name===a.name&&((f=t.info)===null||f===void 0||f.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const o of e.calls){const c=(r=this._functions.get(o.name))===null||r===void 0?void 0:r.info;c&&t.add(c)}}findResource(e,t,r){if(r){for(const o of this.entry.compute)if(o.name===r){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}for(const o of this.entry.vertex)if(o.name===r){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}for(const o of this.entry.fragment)if(o.name===r){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}}for(const o of this.uniforms)if(o.group==e&&o.binding==t)return o;for(const o of this.storage)if(o.group==e&&o.binding==t)return o;for(const o of this.textures)if(o.group==e&&o.binding==t)return o;for(const o of this.samplers)if(o.group==e&&o.binding==t)return o;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],o=this,c=[];return e.search(f=>{if(f instanceof Sp)c.push({});else if(f instanceof Ep)c.pop();else if(f instanceof Wl){const a=f;t&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(f instanceof fl){const a=f;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(f instanceof SA){const a=f;t&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(f instanceof So){const a=f;if(c.length>0&&c[c.length-1][a.name])return;const w=o._findResource(a.name);w&&r.push(w)}else if(f instanceof C_){const a=f,w=o._functions.get(a.name);w&&(t&&(w.inUse=!0),e.calls.add(w.node),w.resources===null&&(w.resources=o._findResources(w.node,t)),r.push(...w.resources))}else if(f instanceof S_){const a=f,w=o._functions.get(a.name);w&&(t&&(w.inUse=!0),e.calls.add(w.node),w.resources===null&&(w.resources=o._findResources(w.node,t)),r.push(...w.resources))}}),[...new Map(r.map(f=>[f.name,f])).values()]}getBindGroups(){const e=[];function t(r,o){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),o>=e[r].length&&(e[r].length=o+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Ul)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof Ul)this._getStructOutputs(r.type,t);else{const o=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(o!==null){const c=this.getTypeInfo(r.type,r.type.attributes),f=this._parseInt(o.value),a=new W1(r.name,c,o.name,f);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),o=this._parseInt(t.value);return new W1("",r,t.name,o)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof Ul)this._getStructInputs(r.type,t);else{const o=this._getInputInfo(r);o!==null&&t.push(o)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof Ul)this._getStructInputs(r.type,t);else{const o=this._getInputInfo(r);o!==null&&t.push(o)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),o=this.getTypeInfo(e.type,e.attributes),c=this._parseInt(t.value),f=new E4(e.name,o,t.name,c);return r!==null&&(f.interpolation=this._parseString(r.value)),f}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new S4(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof ep){const o=e.type?this.getTypeInfo(e.type,e.attributes):null,c=new Rm(e.name,o,t);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof EA){const o=e,c=o.format?this.getTypeInfo(o.format,o.attributes):null,f=new zc(o.name,t);return f.format=c,f.count=o.count,this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof Ul){const o=e,c=new Lc(o.name,t);c.startLine=o.startLine,c.endLine=o.endLine;for(const f of o.members){const a=this.getTypeInfo(f.type,f.attributes);c.members.push(new V1(f.name,a,f.attributes))}return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof mA){const o=e,c=o.format instanceof Nt,f=o.format?c?this.getTypeInfo(o.format,null):new $o(o.format,null):null,a=new ju(o.name,f,t,o.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof lt){const o=e,c=o.format?this.getTypeInfo(o.format,null):null,f=new ju(o.name,c,t,o.access);return this._types.set(e,f),this._updateTypeInfo(f),f}const r=new $o(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,o;const c=this._getTypeSize(e);if(e.size=(t=c==null?void 0:c.size)!==null&&t!==void 0?t:0,e instanceof zc&&e.format){const f=this._getTypeSize(e.format);e.stride=Math.max((r=f==null?void 0:f.size)!==null&&r!==void 0?r:0,(o=f==null?void 0:f.align)!==null&&o!==void 0?o:0),this._updateTypeInfo(e.format)}e instanceof Rm&&this._updateTypeInfo(e.format),e instanceof Lc&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,o=0,c=0,f=0;for(let a=0,w=e.members.length;a<w;++a){const P=e.members[a],k=this._getTypeSize(P);if(!k)continue;(t=this._getAlias(P.type.name))!==null&&t!==void 0||P.type;const F=k.align,V=k.size;r=this._roundUp(F,r+o),o=V,c=r,f=Math.max(f,F),P.offset=r,P.size=V,this._updateTypeInfo(P.type)}e.size=this._roundUp(f,c+o),e.align=f}_getTypeSize(e){var t,r;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),c=this._getAttributeNum(e.attributes,"align",0);if(e instanceof V1&&(e=e.type),e instanceof $o){const f=this._getAlias(e.name);f!==null&&(e=f)}{const f=dl._typeInfo[e.name];if(f!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Rd(Math.max(c,f.align/a),Math.max(o,f.size/a))}}{const f=dl._typeInfo[e.name.substring(0,e.name.length-1)];if(f){const a=e.name[e.name.length-1]==="h"?2:1;return new Rd(Math.max(c,f.align/a),Math.max(o,f.size/a))}}if(e instanceof zc){let f=e,a=8,w=8;const P=this._getTypeSize(f.format);return P!==null&&(w=P.size,a=P.align),w=f.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,w)),o&&(w=o),new Rd(Math.max(c,a),Math.max(o,w))}if(e instanceof Lc){let f=0,a=0,w=0,P=0,k=0;for(const F of e.members){const V=this._getTypeSize(F.type);V!==null&&(f=Math.max(V.align,f),w=this._roundUp(V.align,w+P),P=V.size,k=w)}return a=this._roundUp(f,k+P),new Rd(Math.max(c,f),Math.max(o,a))}return null}_isUniformVar(e){return e instanceof Wl&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Wl&&e.storage=="storage"}_isTextureVar(e){return e instanceof Wl&&e.type!==null&&dl._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Wl&&e.type!==null&&dl._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const o=r.attributes;for(let c of o)if(c.name==t)return c;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let o of e)if(o.name==t){let c=o!==null&&o.value!==null?o.value:r;return c instanceof Array&&(c=c[0]),typeof c=="number"?c:typeof c=="string"?parseInt(c):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}dl._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},dl._textureTypes=_e.any_texture_type.map(i=>i.name),dl._samplerTypes=_e.sampler_type.map(i=>i.name);let I_=0;class P_{constructor(e,t,r){this.id=I_++,this.name=e,this.value=t,this.node=r}clone(){return new P_(this.name,this.value,this.node)}}class M_{constructor(e){this.id=I_++,this.name=e.name,this.node=e}clone(){return new M_(this.node)}}class R_{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=I_++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new P_(e,t,r??null))}setVariable(e,t,r){const o=this.getVariable(e);o!==null?o.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r==null?void 0:r.value)!==null&&t!==void 0?t:null}clone(){return new R_(this)}}class X4{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class G4{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let o=!0;if(r instanceof Pe)return r.data.forEach(c=>{c||(o=!1)}),new Je(o?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe){const o=r.data.some(c=>c);return new Je(o?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof Je))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.evalExpression(r,t);if(o instanceof xn&&o.typeInfo.size===0){const c=o.typeInfo,f=o.buffer.byteLength/c.stride;return new Je(f,this.getTypeInfo("u32"))}return new Je(o.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.abs(c)),r.typeInfo);const o=r;return new Je(Math.abs(o.value),o.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.acos(c)),r.typeInfo);const o=r;return new Je(Math.acos(o.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.acosh(c)),r.typeInfo);const o=r;return new Je(Math.acosh(o.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.asin(c)),r.typeInfo);const o=r;return new Je(Math.asin(o.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.asinh(c)),r.typeInfo);const o=r;return new Je(Math.asinh(o.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.atan(c)),r.typeInfo);const o=r;return new Je(Math.atan(o.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.atanh(c)),r.typeInfo);const o=r;return new Je(Math.atanh(o.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe)return new Pe(r.data.map((a,w)=>Math.atan2(a,o.data[w])),r.typeInfo);const c=r,f=o;return new Je(Math.atan2(c.value,f.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.ceil(c)),r.typeInfo);const o=r;return new Je(Math.ceil(o.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof Pe&&o instanceof Pe&&c instanceof Pe)return new Pe(r.data.map((P,k)=>this._clamp(P,o.data[k],c.data[k])),r.typeInfo);const f=r,a=o,w=c;return new Je(this._clamp(f.value,a.value,w.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.cos(c)),r.typeInfo);const o=r;return new Je(Math.cos(o.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.cosh(c)),r.typeInfo);const o=r;return new Je(Math.cos(o.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.clz32(c)),r.typeInfo);const o=r;return new Je(Math.clz32(o.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>this._countOneBits(c)),r.typeInfo);const o=r;return new Je(this._countOneBits(o.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>this._countTrailingZeros(c)),r.typeInfo);const o=r;return new Je(this._countTrailingZeros(o.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe){if(r.data.length!==3||o.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const c=r.data,f=o.data;return new Pe([c[1]*f[2]-f[1]*c[2],c[2]*f[0]-f[2]*c[0],c[0]*f[1]-f[0]*c[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),o=180/Math.PI;return r instanceof Pe?new Pe(r.data.map(c=>c*o),r.typeInfo):new Je(r.value*o,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $i){const o=r.data,c=r.typeInfo.getTypeName(),f=c.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h")return new Je(o[0]*o[3]-o[1]*o[2],f);if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h")return new Je(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),f);if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h")console.error(`TODO: Determinant for ${c}`);else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h")console.error(`TODO: Determinant for ${c}`);else{if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h")return new Je(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),f);c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"||c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"||c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"?console.error(`TODO: Determinant for ${c}`):c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h"||console.error(`TODO: Determinant for ${c}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe){let a=0;for(let w=0;w<r.data.length;++w)a+=(r.data[w]-o.data[w])*(r.data[w]-o.data[w]);return new Je(Math.sqrt(a),this.getTypeInfo("f32"))}const c=r,f=o;return new Je(Math.abs(c.value-f.value),r.typeInfo)}_dot(e,t){let r=0;for(let o=0;o<e.length;++o)r+=t[o]*e[o];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);return r instanceof Pe&&o instanceof Pe?new Je(this._dot(r.data,o.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.exp(c)),r.typeInfo);const o=r;return new Je(Math.exp(o.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.pow(2,c)),r.typeInfo);const o=r;return new Je(Math.pow(2,o.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const f=o.value,a=c.value;if(r instanceof Pe)return new Pe(r.data.map(P=>P>>f&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const w=r.value;return new Je(w>>f&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof Pe&&o instanceof Pe&&c instanceof Pe){const f=this._dot(o.data,c.data);return new Pe(f<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>this._firstLeadingBit(c)),r.typeInfo);const o=r;return new Je(this._firstLeadingBit(o.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>this._firstTrailingBit(c)),r.typeInfo);const o=r;return new Je(this._firstTrailingBit(o.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.floor(c)),r.typeInfo);const o=r;return new Je(Math.floor(o.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof Pe&&o instanceof Pe&&c instanceof Pe)return r.data.length!==o.data.length||r.data.length!==c.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Pe(r.data.map((P,k)=>P*o.data[k]+c.data[k]),r.typeInfo);const f=r,a=o,w=c;return new Je(f.value*a.value+w.value,f.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>c-Math.floor(c)),r.typeInfo);const o=r;return new Je(o.value-Math.floor(o.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t),f=this.exec.evalExpression(e.args[3],t);if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=c.value,w=(1<<f.value)-1<<a,P=~w;if(r instanceof Pe&&o instanceof Pe)return new Pe(r.data.map((V,W)=>V&P|o.data[W]<<a&w),r.typeInfo);const k=r.value,F=o.value;return new Je(k&P|F<<a&w,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>1/Math.sqrt(c)),r.typeInfo);const o=r;return new Je(1/Math.sqrt(o.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe){let c=0;return r.data.forEach(f=>{c+=f*f}),new Je(Math.sqrt(c),this.getTypeInfo("f32"))}const o=r;return new Je(Math.abs(o.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.log(c)),r.typeInfo);const o=r;return new Je(Math.log(o.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.log2(c)),r.typeInfo);const o=r;return new Je(Math.log2(o.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe)return new Pe(r.data.map((a,w)=>Math.max(a,o.data[w])),r.typeInfo);const c=r,f=o;return new Je(Math.max(c.value,f.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe)return new Pe(r.data.map((a,w)=>Math.min(a,o.data[w])),r.typeInfo);const c=r,f=o;return new Je(Math.min(c.value,f.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof Pe&&o instanceof Pe&&c instanceof Pe)return new Pe(r.data.map((w,P)=>r.data[P]*(1-c.data[P])+o.data[P]*c.data[P]),r.typeInfo);const f=o,a=c;return new Je(r.value*(1-a.value)+f.value*a.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe)return new Pe(r.data.map((f,a)=>f%o.data[a]),r.typeInfo);const c=o;return new Je(r.value%c.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe){const o=this.Length(e,t).value;return new Pe(r.data.map(c=>c/o),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe)return new Pe(r.data.map((a,w)=>Math.pow(a,o.data[w])),r.typeInfo);const c=r,f=o;return new Je(Math.pow(c.value,f.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof Pe?new Pe(r.data.map(o=>o),r.typeInfo):new Je(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof Pe?new Pe(r.data.map(o=>o*Math.PI/180),r.typeInfo):new Je(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof Pe&&o instanceof Pe){const c=this._dot(r.data,o.data);return new Pe(r.data.map((f,a)=>f-2*c*o.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof Pe&&o instanceof Pe&&c instanceof Je){const f=this._dot(o.data,r.data);return new Pe(r.data.map((a,w)=>{const P=1-c.value*c.value*(1-f*f);if(P<0)return 0;const k=Math.sqrt(P);return c.value*a-(c.value*f+k)*o.data[w]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.round(c)),r.typeInfo);const o=r;return new Je(Math.round(o.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.min(Math.max(c,0),1)),r.typeInfo);const o=r;return new Je(Math.min(Math.max(o.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.sign(c)),r.typeInfo);const o=r;return new Je(Math.sign(o.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.sin(c)),r.typeInfo);const o=r;return new Je(Math.sin(o.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.sinh(c)),r.typeInfo);const o=r;return new Je(Math.sinh(o.value),r.typeInfo)}_smoothstep(e,t,r){const o=Math.min(Math.max((r-e)/(t-e),0),1);return o*o*(3-2*o)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(c instanceof Pe&&r instanceof Pe&&o instanceof Pe)return new Pe(c.data.map((P,k)=>this._smoothstep(r.data[k],o.data[k],P)),c.typeInfo);const f=r,a=o,w=c;return new Je(this._smoothstep(f.value,a.value,w.value),c.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.sqrt(c)),r.typeInfo);const o=r;return new Je(Math.sqrt(o.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(o instanceof Pe&&r instanceof Pe)return new Pe(o.data.map((f,a)=>f<r.data[a]?0:1),o.typeInfo);const c=r;return new Je(o.value<c.value?0:1,c.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.tan(c)),r.typeInfo);const o=r;return new Je(Math.tan(o.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.tanh(c)),r.typeInfo);const o=r;return new Je(Math.tanh(o.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof $i))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const o=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const c=r.data;return new $i([c[0],c[2],c[1],c[3]],o)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const c=r.data;return new $i([c[0],c[3],c[6],c[1],c[4],c[7]],o)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const c=r.data;return new $i([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13]],o)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const c=r.data;return new $i([c[0],c[3],c[1],c[4],c[2],c[5]],o)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const c=r.data;return new $i([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]],o)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const c=r.data;return new $i([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14]],o)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const c=r.data;return new $i([c[0],c[4],c[1],c[5],c[2],c[6]],o)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const c=r.data;return new $i([c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]],o)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const c=r.data;return new $i([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]],o)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Pe)return new Pe(r.data.map(c=>Math.trunc(c)),r.typeInfo);const o=r;return new Je(Math.trunc(o.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],o=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof So){const c=r.name,f=t.getVariableValue(c);if(f instanceof jl){if(o<0||o>=f.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=f.getMipLevelSize(o),w=f.dimension;return w==="1d"?new Je(a[0],this.getTypeInfo("u32")):w==="3d"?new Pe(a,this.getTypeInfo("vec3u")):w==="2d"?new Pe(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${w} not found. Line ${e.line}`),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],o=this.exec.evalExpression(e.args[1],t),c=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(o instanceof Pe)||o.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof So){const f=r.name,a=t.getVariableValue(f);if(a instanceof jl){const w=Math.floor(o.data[0]),P=Math.floor(o.data[1]);if(w<0||w>=a.width||P<0||P>=a.height)return console.error(`Texture ${f} out of bounds. Line ${e.line}`),null;const k=a.getPixel(w,P,0,c);return k===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Pe(k,this.getTypeInfo("vec4f"))}return console.error(`Texture ${f} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof So){const o=r.name,c=t.getVariableValue(o);return c instanceof jl?new Je(c.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof So){const o=r.name,c=t.getVariableValue(o);return c instanceof jl?new Je(c.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof So){const o=r.name,c=t.getVariableValue(o);return c instanceof jl?new Je(c.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],o=this.exec.evalExpression(e.args[1],t),c=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,f=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(f.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(o instanceof Pe)||o.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof So){const a=r.name,w=t.getVariableValue(a);if(w instanceof jl){const P=w.getMipLevelSize(0),k=Math.floor(o.data[0]),F=Math.floor(o.data[1]);return k<0||k>=P[0]||F<0||F>=P[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(w.setPixel(k,F,0,c,Array.from(f)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t);return t.getVariable(o).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t);return w instanceof Je&&a instanceof Je&&(w.value=a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value+=a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicSub(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value-=a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicMax(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value=Math.max(w.value,a.value)),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicMin(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value=Math.min(w.value,a.value)),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicAnd(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value=w.value&a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicOr(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value=w.value|a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicXor(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value=w.value^a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicExchange(e,t){let r=e.args[0];r instanceof Un&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let f=e.args[1];const a=this.exec.evalExpression(f,t),w=c.value.getSubData(this.exec,r.postfix,t),P=new Je(w.value,w.typeInfo);return w instanceof Je&&a instanceof Je&&(w.value=a.value),c.value instanceof xn&&c.value.setDataValue(this.exec,w,r.postfix,t),P}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Lg={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Gs={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class zs extends X4{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new dl,this.reflection.updateAST(this.ast),this.context=(r=t==null?void 0:t.clone())!==null&&r!==void 0?r:new R_,this.builtins=new G4(this),this.typeInfo={bool:this.getTypeInfo(Nt.bool),i32:this.getTypeInfo(Nt.i32),u32:this.getTypeInfo(Nt.u32),f32:this.getTypeInfo(Nt.f32),f16:this.getTypeInfo(Nt.f16),vec2f:this.getTypeInfo(lt.vec2f),vec2u:this.getTypeInfo(lt.vec2u),vec2i:this.getTypeInfo(lt.vec2i),vec2h:this.getTypeInfo(lt.vec2h),vec3f:this.getTypeInfo(lt.vec3f),vec3u:this.getTypeInfo(lt.vec3u),vec3i:this.getTypeInfo(lt.vec3i),vec3h:this.getTypeInfo(lt.vec3h),vec4f:this.getTypeInfo(lt.vec4f),vec4u:this.getTypeInfo(lt.vec4u),vec4i:this.getTypeInfo(lt.vec4i),vec4h:this.getTypeInfo(lt.vec4h),mat2x2f:this.getTypeInfo(lt.mat2x2f),mat2x3f:this.getTypeInfo(lt.mat2x3f),mat2x4f:this.getTypeInfo(lt.mat2x4f),mat3x2f:this.getTypeInfo(lt.mat3x2f),mat3x3f:this.getTypeInfo(lt.mat3x3f),mat3x4f:this.getTypeInfo(lt.mat3x4f),mat4x2f:this.getTypeInfo(lt.mat4x2f),mat4x3f:this.getTypeInfo(lt.mat4x3f),mat4x4f:this.getTypeInfo(lt.mat4x4f)}}getVariableValue(e){var t,r;const o=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(o===null)return null;if(o instanceof Je)return o.value;if(o instanceof Pe||o instanceof $i)return Array.from(o.data);if(o instanceof xn&&o.typeInfo instanceof zc){if(o.typeInfo.format.name==="u32")return Array.from(new Uint32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="i32")return Array.from(new Int32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="f32")return Array.from(new Float32Array(o.buffer,o.offset,o.typeInfo.count))}return console.error(`Unsupported return variable type ${o.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,o){const c=this.context.clone();(o=o??{}).constants&&this._setOverrides(o.constants,c),this._execStatements(this.ast,c);const f=c.getFunction(e);if(!f)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],w=t[1],P=t[2],k=this.getTypeInfo("vec3u");c.setVariable("@num_workgroups",new Pe(t,k));for(const F in r)for(const V in r[F]){const W=r[F][V];c.variables.forEach(ee=>{var he;const Ie=ee.node;if(Ie!=null&&Ie.attributes){let Ee=null,Ne=null;for(const Ce of Ie.attributes)Ce.name==="binding"?Ee=Ce.value:Ce.name==="group"&&(Ne=Ce.value);if(V==Ee&&F==Ne)if(W.texture!==void 0&&W.descriptor!==void 0){const Ce=new jl(W.texture,this.getTypeInfo(Ie.type),W.descriptor,(he=W.texture.view)!==null&&he!==void 0?he:null);ee.value=Ce}else W.uniform!==void 0?ee.value=new xn(W.uniform,this.getTypeInfo(Ie.type)):ee.value=new xn(W,this.getTypeInfo(Ie.type))}})}for(let F=0;F<P;++F)for(let V=0;V<w;++V)for(let W=0;W<a;++W)c.setVariable("@workgroup_id",new Pe([W,V,F],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(f,[W,V,F],c)}execStatement(e,t){if(e instanceof xw)return this.evalExpression(e.value,t);if(e instanceof Tw){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof Je))throw new Error("Invalid break-if condition");if(!r.value)return null}return zs._breakObj}if(e instanceof Sw)return zs._continueObj;if(e instanceof SA)this._let(e,t);else if(e instanceof Wl)this._var(e,t);else if(e instanceof Jd)this._const(e,t);else if(e instanceof FA)this._function(e,t);else{if(e instanceof vw)return this._if(e,t);if(e instanceof bw)return this._switch(e,t);if(e instanceof gw)return this._for(e,t);if(e instanceof pw)return this._while(e,t);if(e instanceof yw)return this._loop(e,t);if(e instanceof km){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof _w)this._assign(e,t);else if(e instanceof mw)this._increment(e,t);else{if(e instanceof Ul)return null;if(e instanceof T_){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new Je(0,this.getTypeInfo("u32")))}else if(e instanceof S_)this._call(e,t);else{if(e instanceof ww||e instanceof E_)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Pa?this._evalBinaryOp(e,t):e instanceof ts?this._evalLiteral(e,t):e instanceof So?this._evalVariable(e,t):e instanceof C_?this._evalCall(e,t):e instanceof fl?this._evalCreate(e,t):e instanceof Ew?this._evalConst(e,t):e instanceof Cw?this._evalBitcast(e,t):e instanceof Un?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Nt){const o=this.reflection.getTypeInfo(e);if(o!==null)return o}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const o=e[r],c=this.reflection.getOverrideInfo(r);c!==null?(c.type===null&&(c.type=this.getTypeInfo("u32")),c.type.name==="u32"||c.type.name==="i32"||c.type.name==="f32"||c.type.name==="f16"?t.setVariable(r,new Je(o,c.type)):c.type.name==="bool"?t.setVariable(r,new Je(o?1:0,c.type)):c.type.name==="vec2"||c.type.name==="vec3"||c.type.name==="vec4"||c.type.name==="vec2f"||c.type.name==="vec3f"||c.type.name==="vec4f"||c.type.name==="vec2i"||c.type.name==="vec3i"||c.type.name==="vec4i"||c.type.name==="vec2u"||c.type.name==="vec3u"||c.type.name==="vec4u"||c.type.name==="vec2h"||c.type.name==="vec3h"||c.type.name==="vec4h"?t.setVariable(r,new Pe(o,c.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const o=[1,1,1];for(const k of e.node.attributes)if(k.name==="workgroup_size"){if(k.value.length>0){const F=r.getVariableValue(k.value[0]);o[0]=F instanceof Je?F.value:parseInt(k.value[0])}if(k.value.length>1){const F=r.getVariableValue(k.value[1]);o[1]=F instanceof Je?F.value:parseInt(k.value[1])}if(k.value.length>2){const F=r.getVariableValue(k.value[2]);o[2]=F instanceof Je?F.value:parseInt(k.value[2])}}const c=this.getTypeInfo("vec3u"),f=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new Pe(o,c));const a=o[0],w=o[1],P=o[2];for(let k=0,F=0;k<P;++k)for(let V=0;V<w;++V)for(let W=0;W<a;++W,++F){const ee=[W,V,k],he=[W+t[0]*o[0],V+t[1]*o[1],k+t[2]*o[2]];r.setVariable("@local_invocation_id",new Pe(ee,c)),r.setVariable("@global_invocation_id",new Pe(he,c)),r.setVariable("@local_invocation_index",new Je(F,f)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const o of r.attributes)if(o.name==="builtin"){const c=`@${o.value}`,f=t.getVariable(c);f!==void 0&&t.variables.set(r.name,f)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Un;)e=e.right;return e instanceof So?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const c=t.clone(),f=this._execStatements(r,c);if(f)return f;continue}const o=this.execStatement(r,t);if(o)return o}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const o=t.getFunction(e.name);if(o){for(let c=0;c<o.node.args.length;++c){const f=o.node.args[c],a=this.evalExpression(e.args[c],r);r.setVariable(f.name,a,f)}this._execStatements(o.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),o=t.getVariable(r);o?e.operator==="++"?o.value instanceof Je?o.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?o.value instanceof Je?o.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof So){const r=this.getVariableName(e,t),o=t.getVariable(r);return o===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):o.value.getSubData(this,e.postfix,t)}if(e instanceof Un){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof Lh?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new Lh(r)}}return null}_assign(e,t){let r=null,o="<var>",c=null;if(e.variable instanceof Un){const w=this._getVariableData(e.variable,t),P=this.evalExpression(e.value,t),k=e.operator;if(k==="="){if(w instanceof Je||w instanceof Pe||w instanceof $i){if(P instanceof Je||P instanceof Pe||P instanceof $i&&w.data.length===P.data.length)return void w.data.set(P.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(w instanceof xn&&P instanceof xn&&w.buffer.byteLength-w.offset>=P.buffer.byteLength-P.offset)return void(w.buffer.byteLength%4==0?new Uint32Array(w.buffer,w.offset,w.typeInfo.size/4).set(new Uint32Array(P.buffer,P.offset,P.typeInfo.size/4)):new Uint8Array(w.buffer,w.offset,w.typeInfo.size).set(new Uint8Array(P.buffer,P.offset,P.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(k==="+=")return w instanceof Je||w instanceof Pe||w instanceof $i?P instanceof Je||P instanceof Pe||P instanceof $i?void w.data.set(P.data.map((F,V)=>w.data[V]+F)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(k==="-=")return(w instanceof Je||w instanceof Pe||w instanceof $i)&&(P instanceof Je||P instanceof Pe||P instanceof $i)?void w.data.set(P.data.map((F,V)=>w.data[V]-F)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Un){if(e.variable.operator==="*"){o=this.getVariableName(e.variable.right,t);const w=t.getVariable(o);if(!(w&&w.value instanceof Lh))return void console.error(`Variable ${o} is not a pointer. Line ${e.line}`);r=w.value.reference;let P=e.variable.postfix;if(!P){let k=e.variable.right;for(;k instanceof Un;){if(k.postfix){P=k.postfix;break}k=k.right}}P&&(r=r.getSubData(this,P,t))}}else{c=e.variable.postfix,o=this.getVariableName(e.variable,t);const w=t.getVariable(o);if(w===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);r=w.value}if(r instanceof Lh&&(r=r.reference),r===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);const f=this.evalExpression(e.value,t),a=e.operator;if(a==="=")if(r instanceof xn)r.setDataValue(this,f,c,t);else if(c){if(!(r instanceof Pe||r instanceof $i))return void console.error(`Variable ${o} is not a vector or matrix. Line ${e.line}`);if(c instanceof tf){const w=this.evalExpression(c.index,t).value;if(r instanceof Pe){if(!(f instanceof Je))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[w]=f.value}else{if(!(r instanceof $i))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const P=this.evalExpression(c.index,t).value;if(P<0)return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(f instanceof Pe))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const k=r.typeInfo.getTypeName();if(k==="mat2x2"||k==="mat2x2f"||k==="mat2x2h"){if(!(P<2&&f.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*P]=f.data[0],r.data[2*P+1]=f.data[1]}else if(k==="mat2x3"||k==="mat2x3f"||k==="mat2x3h"){if(!(P<2&&f.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*P]=f.data[0],r.data[3*P+1]=f.data[1],r.data[3*P+2]=f.data[2]}else if(k==="mat2x4"||k==="mat2x4f"||k==="mat2x4h"){if(!(P<2&&f.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*P]=f.data[0],r.data[4*P+1]=f.data[1],r.data[4*P+2]=f.data[2],r.data[4*P+3]=f.data[3]}else if(k==="mat3x2"||k==="mat3x2f"||k==="mat3x2h"){if(!(P<3&&f.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*P]=f.data[0],r.data[2*P+1]=f.data[1]}else if(k==="mat3x3"||k==="mat3x3f"||k==="mat3x3h"){if(!(P<3&&f.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*P]=f.data[0],r.data[3*P+1]=f.data[1],r.data[3*P+2]=f.data[2]}else if(k==="mat3x4"||k==="mat3x4f"||k==="mat3x4h"){if(!(P<3&&f.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*P]=f.data[0],r.data[4*P+1]=f.data[1],r.data[4*P+2]=f.data[2],r.data[4*P+3]=f.data[3]}else if(k==="mat4x2"||k==="mat4x2f"||k==="mat4x2h"){if(!(P<4&&f.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*P]=f.data[0],r.data[2*P+1]=f.data[1]}else if(k==="mat4x3"||k==="mat4x3f"||k==="mat4x3h"){if(!(P<4&&f.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*P]=f.data[0],r.data[3*P+1]=f.data[1],r.data[3*P+2]=f.data[2]}else{if(k!=="mat4x4"&&k!=="mat4x4f"&&k!=="mat4x4h")return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(P<4&&f.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*P]=f.data[0],r.data[4*P+1]=f.data[1],r.data[4*P+2]=f.data[2],r.data[4*P+3]=f.data[3]}}}}}else if(c instanceof Vu){const w=c.value;if(!(r instanceof Pe))return void console.error(`Invalid assignment to ${w}. Variable ${o} is not a vector. Line ${e.line}`);if(f instanceof Je){if(w.length>1)return void console.error(`Invalid assignment to ${w} for variable ${o}. Line ${e.line}`);if(w==="x")r.data[0]=f.value;else if(w==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${w} for variable ${o}. Line ${e.line}`);r.data[1]=f.value}else if(w==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${w} for variable ${o}. Line ${e.line}`);r.data[2]=f.value}else if(w==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${w} for variable ${o}. Line ${e.line}`);r.data[3]=f.value}}else{if(!(f instanceof Pe))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(w.length!==f.data.length)return void console.error(`Invalid assignment to ${w} for variable ${o}. Line ${e.line}`);for(let P=0;P<w.length;++P){const k=w[P];if(k==="x"||k==="r")r.data[0]=f.data[P];else if(k==="y"||k==="g"){if(f.data.length<2)return void console.error(`Invalid assignment to ${k} for variable ${o}. Line ${e.line}`);r.data[1]=f.data[P]}else if(k==="z"||k==="b"){if(f.data.length<3)return void console.error(`Invalid assignment to ${k} for variable ${o}. Line ${e.line}`);r.data[2]=f.data[P]}else{if(k!=="w"&&k!=="a")return void console.error(`Invalid assignment to ${k} for variable ${o}. Line ${e.line}`);if(f.data.length<4)return void console.error(`Invalid assignment to ${k} for variable ${o}. Line ${e.line}`);r.data[3]=f.data[P]}}}}}else r instanceof Je&&f instanceof Je?r.value=f.value:r instanceof Pe&&f instanceof Pe||r instanceof $i&&f instanceof $i?r.data.set(f.data):console.error(`Invalid assignment to ${o}. Line ${e.line}`);else{const w=r.getSubData(this,c,t);if(w instanceof Pe&&f instanceof Je){const P=w.data,k=f.value;if(a==="+=")for(let F=0;F<P.length;++F)P[F]+=k;else if(a==="-=")for(let F=0;F<P.length;++F)P[F]-=k;else if(a==="*=")for(let F=0;F<P.length;++F)P[F]*=k;else if(a==="/=")for(let F=0;F<P.length;++F)P[F]/=k;else if(a==="%=")for(let F=0;F<P.length;++F)P[F]%=k;else if(a==="&=")for(let F=0;F<P.length;++F)P[F]&=k;else if(a==="|=")for(let F=0;F<P.length;++F)P[F]|=k;else if(a==="^=")for(let F=0;F<P.length;++F)P[F]^=k;else if(a==="<<=")for(let F=0;F<P.length;++F)P[F]<<=k;else if(a===">>=")for(let F=0;F<P.length;++F)P[F]>>=k;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(w instanceof Pe&&f instanceof Pe){const P=w.data,k=f.data;if(P.length!==k.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let F=0;F<P.length;++F)P[F]+=k[F];else if(a==="-=")for(let F=0;F<P.length;++F)P[F]-=k[F];else if(a==="*=")for(let F=0;F<P.length;++F)P[F]*=k[F];else if(a==="/=")for(let F=0;F<P.length;++F)P[F]/=k[F];else if(a==="%=")for(let F=0;F<P.length;++F)P[F]%=k[F];else if(a==="&=")for(let F=0;F<P.length;++F)P[F]&=k[F];else if(a==="|=")for(let F=0;F<P.length;++F)P[F]|=k[F];else if(a==="^=")for(let F=0;F<P.length;++F)P[F]^=k[F];else if(a==="<<=")for(let F=0;F<P.length;++F)P[F]<<=k[F];else if(a===">>=")for(let F=0;F<P.length;++F)P[F]>>=k[F];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(w instanceof Je&&f instanceof Je))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?w.value+=f.value:a==="-="?w.value-=f.value:a==="*="?w.value*=f.value:a==="/="?w.value/=f.value:a==="%="?w.value%=f.value:a==="&="?w.value&=f.value:a==="|="?w.value|=f.value:a==="^="?w.value^=f.value:a==="<<="?w.value<<=f.value:a===">>="?w.value>>=f.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}r instanceof xn&&r.setDataValue(this,w,c,t)}}_function(e,t){const r=new M_(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Un||(r=r.clone())}else{const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||o==="array"){const c=new fl(e.type,[]);r=this._evalCreate(c,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Un||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||e.type instanceof EA||e.type instanceof Ul||e.type instanceof lt){const c=new fl(e.type,[]);r=this._evalCreate(c,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof Je))return console.error(`Invalid if condition. Line ${e.line}`),null;let o=null;for(const c of e.cases)if(c instanceof Mw)for(const f of c.selectors){if(f instanceof tp){o=c;continue}const a=this.evalExpression(f,t);if(!(a instanceof Je))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(c.body,t)}else c instanceof Rw&&(o=c);return o?this._execStatements(o.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof Je))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const o of e.elseif){const c=this.evalExpression(o.condition,t);if(!(c instanceof Je))return console.error(`Invalid if condition. Line ${e.line}`),null;if(c.value)return this._execStatements(o.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Je?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===zs._breakObj)break;if(r!==null&&r!==zs._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===zs._breakObj)break;if(r===zs._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===zs._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===zs._breakObj)break;if(r!==zs._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),o=e.type;if(r instanceof Je){const c=G1(r.value,r.typeInfo.name,o.name);return new Je(c,this.getTypeInfo(o))}if(r instanceof Pe){const c=r.typeInfo.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;f="f16"}const a=o.getTypeName();let w="";if(a.endsWith("f"))w="f32";else if(a.endsWith("i"))w="i32";else if(a.endsWith("u"))w="u32";else if(a.endsWith("b"))w="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${w}. Line ${e.line}`),null;w="f16"}const P=function(k,F,V){if(F===V)return k;const W=new Array(k.length);for(let ee=0;ee<k.length;ee++)W[ee]=G1(k[ee],F,V);return W}(Array.from(r.data),f,w);return new Pe(P,this.getTypeInfo(o))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof fl){if(e.type===null)return Dm.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const o=e instanceof fl?e.type.name:e.name,c=e instanceof fl?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(c===null)return console.error(`Unknown type ${o}. Line ${e.line}`),null;if(c.size===0)return null;const f=new xn(new ArrayBuffer(c.size),c,0);if(c instanceof Lc){if(e.args)for(let a=0;a<e.args.length;++a){const w=c.members[a],P=e.args[a],k=this.evalExpression(P,t);f.setData(this,k,w.type,w.offset,t)}}else if(c instanceof zc){let a=0;if(e.args)for(let w=0;w<e.args.length;++w){const P=e.args[w],k=this.evalExpression(P,t);c.format===null&&(((r=k.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?c.format=this.getTypeInfo("i32"):c.format=k.typeInfo),f.setData(this,k,c.format,a,t),a+=c.stride}}else console.error(`Unknown type "${o}". Line ${e.line}`);return e instanceof fl?f.getSubData(this,e.postfix,t):f}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),o=r.name;return o==="x32"||o==="u32"||o==="f32"||o==="f16"||o==="i32"||o==="bool"?new Je(e.scalarValue,r):o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"?this._callConstructorVec(e,t):o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const o=zs._priority.get(t.name);zs._priority.get(e[r].name)<o&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new Lh(r);if(e.operator==="*")return r instanceof Lh?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const o=r instanceof Je?r.value:r instanceof Pe?Array.from(r.data):null;switch(e.operator){case"+":{if(hi(o)){const a=o.map((w,P)=>+w);return new Pe(a,r.typeInfo)}const c=o,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Je(+c,f)}case"-":{if(hi(o)){const a=o.map((w,P)=>-w);return new Pe(a,r.typeInfo)}const c=o,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Je(-c,f)}case"!":{if(hi(o)){const a=o.map((w,P)=>w?0:1);return new Pe(a,r.typeInfo)}const c=o,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Je(c?0:1,f)}case"~":{if(hi(o)){const a=o.map((w,P)=>~w);return new Pe(a,r.typeInfo)}const c=o,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Je(~c,f)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),o=this.evalExpression(e.right,t),c=r instanceof Je?r.value:r instanceof Pe||r instanceof $i?Array.from(r.data):null,f=o instanceof Je?o.value:o instanceof Pe||o instanceof $i?Array.from(o.data):null;switch(e.operator){case"+":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W+F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V+k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k+V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a+w,P)}case"-":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W-F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V-k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k-V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a-w,P)}case"*":{if(hi(c)&&hi(f)){const k=c,F=f;if(r instanceof $i&&o instanceof $i){const V=function(Ie,Ee,Ne,Ce){if(Gs[Ee.name]===void 0||Gs[Ce.name]===void 0)return null;const De=Gs[Ee.name][0],Ye=Gs[Ee.name][1],Ke=Gs[Ce.name][0];if(De!==Gs[Ce.name][1])return null;const kt=new Array(Ke*Ye);for(let It=0;It<Ye;It++)for(let jt=0;jt<Ke;jt++){let Lt=0;for(let Mt=0;Mt<De;Mt++)Lt+=Ie[Mt*Ye+It]*Ne[jt*De+Mt];kt[It*Ke+jt]=Lt}return kt}(k,r.typeInfo,F,o.typeInfo);if(V===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const W=Gs[o.typeInfo.name][0],ee=Gs[r.typeInfo.name][1],he=this.getTypeInfo(`mat${W}x${ee}f`);return new $i(V,he)}if(r instanceof $i&&o instanceof Pe){const V=function(W,ee,he,Ie){if(Gs[ee.name]===void 0||Lg[Ie.name]===void 0)return null;const Ee=Gs[ee.name][0],Ne=Gs[ee.name][1];if(Ee!==he.length)return null;const Ce=new Array(Ne);for(let De=0;De<Ne;De++){let Ye=0;for(let Ke=0;Ke<Ee;Ke++)Ye+=W[Ke*Ne+De]*he[Ke];Ce[De]=Ye}return Ce}(k,r.typeInfo,F,o.typeInfo);return V===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Pe(V,o.typeInfo)}if(r instanceof Pe&&o instanceof $i){const V=function(W,ee,he,Ie){if(Lg[ee.name]===void 0||Gs[Ie.name]===void 0)return null;const Ee=Gs[Ie.name][0],Ne=Gs[Ie.name][1];if(Ne!==W.length)return null;const Ce=[];for(let De=0;De<Ee;De++){let Ye=0;for(let Ke=0;Ke<Ne;Ke++)Ye+=W[Ke]*he[Ke*Ee+De];Ce[De]=Ye}return Ce}(k,r.typeInfo,F,o.typeInfo);return V===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Pe(V,r.typeInfo)}{if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W*F[ee]);return new Pe(V,r.typeInfo)}}if(hi(c)){const k=f,F=c.map((V,W)=>V*k);return r instanceof $i?new $i(F,r.typeInfo):new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k*V);return o instanceof $i?new $i(F,o.typeInfo):new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a*w,P)}case"%":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W%F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V%k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k%V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a%w,P)}case"/":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W/F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V/k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k/V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a/w,P)}case"&":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W&F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V&k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k&V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a&w,P)}case"|":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W|F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V|k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k|V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a|w,P)}case"^":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W^F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V^k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k^V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a^w,P)}case"<<":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W<<F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V<<k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k<<V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a<<w,P)}case">>":{if(hi(c)&&hi(f)){const k=c,F=f;if(k.length!==F.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const V=k.map((W,ee)=>W>>F[ee]);return new Pe(V,r.typeInfo)}if(hi(c)){const k=f,F=c.map((V,W)=>V>>k);return new Pe(F,r.typeInfo)}if(hi(f)){const k=c,F=f.map((V,W)=>k>>V);return new Pe(F,o.typeInfo)}const a=c,w=f,P=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new Je(a>>w,P)}case">":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k>w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P>a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a>P?1:0);return new Pe(w,o.typeInfo)}return new Je(c>f?1:0,this.getTypeInfo("bool"));case"<":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k<w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P<a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a<P?1:0);return new Pe(w,o.typeInfo)}return new Je(c<f?1:0,this.getTypeInfo("bool"));case"==":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k===w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P==a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a==P?1:0);return new Pe(w,o.typeInfo)}return new Je(c===f?1:0,this.getTypeInfo("bool"));case"!=":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k!==w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P!==a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a!==P?1:0);return new Pe(w,o.typeInfo)}return new Je(c!==f?1:0,this.getTypeInfo("bool"));case">=":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k>=w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P>=a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a>=P?1:0);return new Pe(w,o.typeInfo)}return new Je(c>=f?1:0,this.getTypeInfo("bool"));case"<=":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k<=w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P<=a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a<=P?1:0);return new Pe(w,o.typeInfo)}return new Je(c<=f?1:0,this.getTypeInfo("bool"));case"&&":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k&&w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P&&a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a&&P?1:0);return new Pe(w,o.typeInfo)}return new Je(c&&f?1:0,this.getTypeInfo("bool"));case"||":if(hi(c)&&hi(f)){const a=c,w=f;if(a.length!==w.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const P=a.map((k,F)=>k||w[F]?1:0);return new Pe(P,r.typeInfo)}if(hi(c)){const a=f,w=c.map((P,k)=>P||a?1:0);return new Pe(w,r.typeInfo)}if(hi(f)){const a=c,w=f.map((P,k)=>a||P?1:0);return new Pe(w,o.typeInfo)}return new Je(c||f?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const o=t.getFunction(e.name);if(!o)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let c=0;c<o.node.args.length;++c){const f=o.node.args[c],a=this.evalExpression(e.args[c],r);r.createVariable(f.name,a,f)}return this._execStatements(o.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const o=t.clone();for(let c=0;c<r.node.args.length;++c){const f=r.node.args[c],a=this.evalExpression(e.args[c],o);o.setVariable(f.name,a,f)}return this._execStatements(r.node.body,o)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new Je(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=Lg[o];if(c===void 0)return console.error(`Invalid vec constructor ${o}. Line ${e.line}`),null;const f=[];if(e instanceof ts)if(e.isVector){const a=e.vectorValue;for(const w of a)f.push(w)}else f.push(e.scalarValue);else if(e.args)for(const a of e.args){const w=this.evalExpression(a,t);if(w instanceof Pe){const P=w.data;for(let k=0;k<P.length;++k){let F=P[k];f.push(F)}}else if(w instanceof Je){let P=w.value;f.push(P)}}if(e.type instanceof lt&&e.type.format===null&&(e.type.format=lt.f32),f.length===0){const a=new Array(c).fill(0);return new Pe(a,r).getSubData(this,e.postfix,t)}if(f.length===1)for(;f.length<c;)f.push(f[0]);return f.length<c?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Pe(f.length>c?f.slice(0,c):f,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=Gs[o];if(c===void 0)return console.error(`Invalid matrix constructor ${o}. Line ${e.line}`),null;const f=[];if(e instanceof ts)if(e.isVector){const a=e.vectorValue;for(const w of a)f.push(w)}else f.push(e.scalarValue);else if(e.args)for(const a of e.args){const w=this.evalExpression(a,t);w instanceof Pe?f.push(...w.data):w instanceof Je?f.push(w.value):w instanceof $i&&f.push(...w.data)}if(r instanceof ju&&r.format===null&&(r.format=this.getTypeInfo("f32")),f.length===0){const a=new Array(c[2]).fill(0);return new $i(a,r).getSubData(this,e.postfix,t)}return f.length!==c[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new $i(f,r).getSubData(this,e.postfix,t)}}zs._breakObj=new Xo(new $o("BREAK",null),null),zs._continueObj=new Xo(new $o("CONTINUE",null),null),zs._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Y4{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Q4{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Y4,this._exec=new zs,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const o=r.arrayType,c=r.countNode;if(c instanceof So){const f=c.name,a=this._context.constants.get(f);if(a)try{const w=a.constEvaluate(this._exec);o.count=w}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(o=>{o instanceof q1||o instanceof ep?o.type=this._forwardType(o.type):o instanceof EA?o.format=this._forwardType(o.format):o instanceof Wl||o instanceof SA||o instanceof Jd?o.type=this._forwardType(o.type):o instanceof FA?o.returnType=this._forwardType(o.returnType):o instanceof Z1&&(o.type=this._forwardType(o.type))});return t}_forwardType(e){if(e instanceof $1){const t=this._getType(e.name);if(t)return t}else e instanceof ep?e.type=this._forwardType(e.type):e instanceof EA&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new U4(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==_e.eof}_match(e){if(e instanceof it)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const o=e[t];if(this._check(o))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let o=!1;for(const c of e){if(r===c)return!0;c===_e.tokens.name&&(o=!0)}if(o){const c=_e.tokens.name.rule.exec(t.lexeme);if(c&&c.index==0&&c[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===_e.tokens.name){const r=_e.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(_e.tokens.semicolon)&&!this._isAtEnd(););if(this._match(_e.keywords.alias)){const t=this._type_alias();return this._consume(_e.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(_e.keywords.diagnostic)){const t=this._diagnostic();return this._consume(_e.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(_e.keywords.requires)){const t=this._requires_directive();return this._consume(_e.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(_e.keywords.enable)){const t=this._enable_directive();return this._consume(_e.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(_e.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(_e.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(_e.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(_e.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(_e.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(_e.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(_e.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(_e.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(_e.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(_e.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(_e.keywords.fn))return null;const e=this._currentLine,t=this._consume(_e.tokens.ident,"Expected function name.").toString();this._consume(_e.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(_e.tokens.paren_right))do{if(this._check(_e.tokens.paren_right))break;const a=this._attribute(),w=this._consume(_e.tokens.name,"Expected argument name.").toString();this._consume(_e.tokens.colon,"Expected ':' for argument type.");const P=this._attribute(),k=this._type_decl();k!=null&&(k.attributes=P,r.push(this._updateNode(new Z1(w,k,a))))}while(this._match(_e.tokens.comma));this._consume(_e.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(_e.tokens.arrow)){const a=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=a)}const c=this._compound_statement(),f=this._currentLine;return this._updateNode(new FA(t,r,o,c,e,f),e)}_compound_statement(){const e=[];for(this._consume(_e.tokens.brace_left,"Expected '{' for block.");!this._check(_e.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(_e.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(_e.tokens.semicolon)&&!this._isAtEnd(););if(this._check(_e.tokens.attr)&&this._attribute(),this._check(_e.keywords.if))return this._if_statement();if(this._check(_e.keywords.switch))return this._switch_statement();if(this._check(_e.keywords.loop))return this._loop_statement();if(this._check(_e.keywords.for))return this._for_statement();if(this._check(_e.keywords.while))return this._while_statement();if(this._check(_e.keywords.continuing))return this._continuing_statement();if(this._check(_e.keywords.static_assert))return this._static_assert_statement();if(this._check(_e.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(_e.keywords.return))e=this._return_statement();else if(this._check([_e.keywords.var,_e.keywords.let,_e.keywords.const]))e=this._variable_statement();else if(this._match(_e.keywords.discard))e=this._updateNode(new F4);else if(this._match(_e.keywords.break)){const t=this._updateNode(new Tw);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(_e.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(_e.keywords.continue)){const t=this._updateNode(new Sw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(_e.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(_e.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new B4(t),e)}_while_statement(){if(!this._match(_e.keywords.while))return null;const e=this._updateNode(new pw(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(_e.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(_e.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new km(r,e),t)}_for_statement(){if(!this._match(_e.keywords.for))return null;this._consume(_e.tokens.paren_left,"Expected '('.");const e=this._updateNode(new gw(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(_e.tokens.semicolon)?null:this._for_init(),this._consume(_e.tokens.semicolon,"Expected ';'."),e.condition=this._check(_e.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(_e.tokens.semicolon,"Expected ';'."),e.increment=this._check(_e.tokens.paren_right)?null:this._for_increment(),this._consume(_e.tokens.paren_right,"Expected ')'."),this._check(_e.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(_e.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(_e.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Wl(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(_e.keywords.let)){const e=this._currentLine,t=this._consume(_e.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(_e.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}this._consume(_e.tokens.equal,"Expected '=' for let.");const o=this._short_circuit_or_expression();return this._updateNode(new SA(t,r,null,null,o),e)}if(this._match(_e.keywords.const)){const e=this._currentLine,t=this._consume(_e.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(_e.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}this._consume(_e.tokens.equal,"Expected '=' for const.");const o=this._short_circuit_or_expression();return r===null&&o instanceof ts&&(r=o.type),this._updateNode(new Jd(t,r,null,null,o),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(_e.increment_operators))return this._current=e,null;const r=this._consume(_e.increment_operators,"Expected increment operator");return this._updateNode(new mw(r.type===_e.tokens.plus_plus?Uh.increment:Uh.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(_e.tokens.brace_right))return null;let r=this._match(_e.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const o=this._consume(_e.assignment_operators,"Expected assignment operator."),c=this._short_circuit_or_expression();return this._updateNode(new _w(gA.parse(o.lexeme),e,c),t)}_func_call_statement(){if(!this._check(_e.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(_e.tokens.ident,"Expected function name."),o=this._argument_expression_list();return o===null?(this._current=t,null):this._updateNode(new S_(r.lexeme,o),e)}_loop_statement(){if(!this._match(_e.keywords.loop))return null;this._check(_e.tokens.attr)&&this._attribute(),this._consume(_e.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new yw([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof km){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(_e.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(_e.keywords.switch))return null;const e=this._updateNode(new bw(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(_e.tokens.attr)&&this._attribute(),this._consume(_e.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(_e.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([_e.keywords.default,_e.keywords.case]);){if(this._match(_e.keywords.case)){const r=this._case_selectors();for(const c of r)if(c instanceof tp){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(_e.tokens.colon),this._check(_e.tokens.attr)&&this._attribute(),this._consume(_e.tokens.brace_left,"Exected '{' for switch case.");const o=this._case_body();this._consume(_e.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Mw(r,o)))}if(this._match(_e.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(_e.tokens.colon),this._check(_e.tokens.attr)&&this._attribute(),this._consume(_e.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(_e.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Rw(r)))}}return e}_case_selectors(){const e=[];for(this._match(_e.keywords.default)?e.push(this._updateNode(new tp)):e.push(this._shift_expression());this._match(_e.tokens.comma);)this._match(_e.keywords.default)?e.push(this._updateNode(new tp)):e.push(this._shift_expression());return e}_case_body(){if(this._match(_e.keywords.fallthrough))return this._consume(_e.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(_e.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(_e.tokens.attr)&&this._attribute();const r=this._compound_statement();let o=[];this._match_elseif()&&(this._check(_e.tokens.attr)&&this._attribute(),o=this._elseif_statement(o));let c=null;return this._match(_e.keywords.else)&&(this._check(_e.tokens.attr)&&this._attribute(),c=this._compound_statement()),this._updateNode(new vw(t,r,o,c),e)}_match_elseif(){return this._tokens[this._current].type===_e.keywords.else&&this._tokens[this._current+1].type===_e.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new N4(t,r))),this._match_elseif()&&(this._check(_e.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(_e.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new xw(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(_e.tokens.or_or);)e=this._updateNode(new Pa(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(_e.tokens.and_and);)e=this._updateNode(new Pa(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(_e.tokens.or);)e=this._updateNode(new Pa(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(_e.tokens.xor);)e=this._updateNode(new Pa(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(_e.tokens.and);)e=this._updateNode(new Pa(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([_e.tokens.equal_equal,_e.tokens.not_equal])?this._updateNode(new Pa(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([_e.tokens.less_than,_e.tokens.greater_than,_e.tokens.less_than_equal,_e.tokens.greater_than_equal]);)e=this._updateNode(new Pa(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([_e.tokens.shift_left,_e.tokens.shift_right]);)e=this._updateNode(new Pa(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([_e.tokens.plus,_e.tokens.minus]);)e=this._updateNode(new Pa(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([_e.tokens.star,_e.tokens.forward_slash,_e.tokens.modulo]);)e=this._updateNode(new Pa(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([_e.tokens.minus,_e.tokens.bang,_e.tokens.tilde,_e.tokens.star,_e.tokens.and])?this._updateNode(new Un(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(_e.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(_e.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new tf(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(_e.tokens.period)){const e=this._consume(_e.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new Vu(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Nt.void;case"bool":return Nt.bool;case"i32":return Nt.i32;case"u32":return Nt.u32;case"f32":return Nt.f32;case"f16":return Nt.f16;case"vec2f":return lt.vec2f;case"vec3f":return lt.vec3f;case"vec4f":return lt.vec4f;case"vec2i":return lt.vec2i;case"vec3i":return lt.vec3i;case"vec4i":return lt.vec4i;case"vec2u":return lt.vec2u;case"vec3u":return lt.vec3u;case"vec4u":return lt.vec4u;case"vec2h":return lt.vec2h;case"vec3h":return lt.vec3h;case"vec4h":return lt.vec4h;case"mat2x2f":return lt.mat2x2f;case"mat2x3f":return lt.mat2x3f;case"mat2x4f":return lt.mat2x4f;case"mat3x2f":return lt.mat3x2f;case"mat3x3f":return lt.mat3x3f;case"mat3x4f":return lt.mat3x4f;case"mat4x2f":return lt.mat4x2f;case"mat4x3f":return lt.mat4x3f;case"mat4x4f":return lt.mat4x4f;case"mat2x2h":return lt.mat2x2h;case"mat2x3h":return lt.mat2x3h;case"mat2x4h":return lt.mat2x4h;case"mat3x2h":return lt.mat3x2h;case"mat3x3h":return lt.mat3x3h;case"mat3x4h":return lt.mat3x4h;case"mat4x2h":return lt.mat4x2h;case"mat4x3h":return lt.mat4x3h;case"mat4x4h":return lt.mat4x4h;case"mat2x2i":return lt.mat2x2i;case"mat2x3i":return lt.mat2x3i;case"mat2x4i":return lt.mat2x4i;case"mat3x2i":return lt.mat3x2i;case"mat3x3i":return lt.mat3x3i;case"mat3x4i":return lt.mat3x4i;case"mat4x2i":return lt.mat4x2i;case"mat4x3i":return lt.mat4x3i;case"mat4x4i":return lt.mat4x4i;case"mat2x2u":return lt.mat2x2u;case"mat2x3u":return lt.mat2x3u;case"mat2x4u":return lt.mat2x4u;case"mat3x2u":return lt.mat3x2u;case"mat3x3u":return lt.mat3x3u;case"mat3x4u":return lt.mat3x4u;case"mat4x2u":return lt.mat4x2u;case"mat4x3u":return lt.mat4x3u;case"mat4x4u":return lt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(_e.tokens.ident)){const r=this._previous().toString();if(this._check(_e.tokens.paren_left)){const o=this._argument_expression_list(),c=this._getType(r);return c!==null?this._updateNode(new fl(c,o)):this._updateNode(new C_(r,o))}if(this._context.constants.has(r)){const o=this._context.constants.get(r);return this._updateNode(new Ew(r,o.value))}return this._updateNode(new So(r))}if(this._match(_e.tokens.int_literal)){const r=this._previous().toString();let o=r.endsWith("i")||r.endsWith("i")?Nt.i32:r.endsWith("u")||r.endsWith("U")?Nt.u32:Nt.x32;const c=parseInt(r);return this._validateTypeRange(c,o),this._updateNode(new ts(new Je(c,this._exec.getTypeInfo(o)),o))}if(this._match(_e.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,Nt.u32),this._updateNode(new ts(new Je(r,this._exec.getTypeInfo(Nt.u32)),Nt.u32))}if(this._match([_e.tokens.decimal_float_literal,_e.tokens.hex_float_literal])){let r=this._previous().toString(),o=r.endsWith("h");o&&(r=r.substring(0,r.length-1));const c=parseFloat(r);this._validateTypeRange(c,o?Nt.f16:Nt.f32);const f=o?Nt.f16:Nt.f32;return this._updateNode(new ts(new Je(c,this._exec.getTypeInfo(f)),f))}if(this._match([_e.keywords.true,_e.keywords.false])){let r=this._previous().toString()===_e.keywords.true.rule;return this._updateNode(new ts(new Je(r?1:0,this._exec.getTypeInfo(Nt.bool)),Nt.bool))}if(this._check(_e.tokens.paren_left))return this._paren_expression();if(this._match(_e.keywords.bitcast)){this._consume(_e.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(_e.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return this._updateNode(new Cw(r,o))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new fl(e,t))}_argument_expression_list(){if(!this._match(_e.tokens.paren_left))return null;const e=[];do{if(this._check(_e.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(_e.tokens.comma));return this._consume(_e.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(_e.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(_e.tokens.paren_right),e}_paren_expression(){this._consume(_e.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(_e.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(_e.keywords.struct))return null;const e=this._currentLine,t=this._consume(_e.tokens.ident,"Expected name for struct.").toString();this._consume(_e.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(_e.tokens.brace_right);){const f=this._attribute(),a=this._consume(_e.tokens.name,"Expected variable name.").toString();this._consume(_e.tokens.colon,"Expected ':' for struct member type.");const w=this._attribute(),P=this._type_decl();P!=null&&(P.attributes=w),this._check(_e.tokens.brace_right)?this._match(_e.tokens.comma):this._consume(_e.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new q1(a,P,f)))}this._consume(_e.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,c=this._updateNode(new Ul(t,r,e,o),e);return this._context.structs.set(t,c),c}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(_e.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof ts){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof ts&&(e.type=e.value.type.name==="x32"?Nt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(_e.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(_e.keywords.const))return null;const t=this._consume(_e.tokens.name,"Expected variable name"),r=this._currentLine;let o=null;if(this._match(_e.tokens.colon)){const w=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=w)}let c=null;this._consume(_e.tokens.equal,"const declarations require an assignment");const f=this._short_circuit_or_expression();try{let w=[Nt.f32],P=f.constEvaluate(this._exec,w);P instanceof Je&&this._validateTypeRange(P.value,w[0]),w[0]instanceof lt&&w[0].format===null&&P.typeInfo instanceof ju&&P.typeInfo.format!==null&&(P.typeInfo.format.name==="f16"?w[0].format=Nt.f16:P.typeInfo.format.name==="f32"?w[0].format=Nt.f32:P.typeInfo.format.name==="i32"?w[0].format=Nt.i32:P.typeInfo.format.name==="u32"?w[0].format=Nt.u32:P.typeInfo.format.name==="bool"?w[0].format=Nt.bool:console.error(`TODO: impelement template format type ${P.typeInfo.format.name}`)),c=this._updateNode(new ts(P,w[0])),this._exec.context.setVariable(t.toString(),P)}catch{c=f}if(o!==null&&c instanceof ts){if(c.type.name!=="x32"&&o.getTypeName()!==c.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${c.type.name} to ${o.name}. Line:${this._currentLine}`);c.type=o,c.isScalar&&this._validateTypeRange(c.scalarValue,c.type)}else o===null&&c instanceof ts&&(o=(e=c==null?void 0:c.type)!==null&&e!==void 0?e:Nt.f32,o===Nt.x32&&(o=Nt.i32));const a=this._updateNode(new Jd(t.toString(),o,"","",c),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(_e.keywords.let))return null;const e=this._currentLine,t=this._consume(_e.tokens.name,"Expected variable name");let r=null;if(this._match(_e.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}let o=null;if(this._match(_e.tokens.equal)&&(o=this._const_expression()),r!==null&&o instanceof ts){if(o.type.name!=="x32"&&r.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${r.name}. Line:${this._currentLine}`);o.type=r}else r===null&&o instanceof ts&&(r=o.type.name==="x32"?Nt.i32:o.type);return o instanceof ts&&o.isScalar&&this._validateTypeRange(o.scalarValue,r),this._updateNode(new SA(t.toString(),r,"","",o),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(_e.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(_e.tokens.less_than)&&(t=this._consume(_e.storage_class,"Expected storage_class.").toString(),this._match(_e.tokens.comma)&&(r=this._consume(_e.access_mode,"Expected access_mode.").toString()),this._consume(_e.tokens.greater_than,"Expected '>'."));const o=this._consume(_e.tokens.name,"Expected variable name");let c=null;if(this._match(_e.tokens.colon)){const f=this._attribute();c=this._type_decl(),c!=null&&(c.attributes=f)}return this._updateNode(new Wl(o.toString(),c,t,r,null),e)}_override_decl(){if(!this._match(_e.keywords.override))return null;const e=this._consume(_e.tokens.name,"Expected variable name");let t=null;if(this._match(_e.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new T_(e.toString(),t,null))}_diagnostic(){this._consume(_e.tokens.paren_left,"Expected '('");const e=this._consume(_e.tokens.ident,"Expected severity control name.");this._consume(_e.tokens.comma,"Expected ','");let t=this._consume(_e.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(_e.tokens.period)&&(t+=`.${this._consume(_e.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(_e.tokens.paren_right,"Expected ')'"),this._updateNode(new ww(e.toString(),t))}_enable_directive(){const e=this._consume(_e.tokens.ident,"identity expected.");return this._updateNode(new O4(e.toString()))}_requires_directive(){const e=[this._consume(_e.tokens.ident,"identity expected.").toString()];for(;this._match(_e.tokens.comma);){const t=this._consume(_e.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new L4(e))}_type_alias(){const e=this._consume(_e.tokens.ident,"identity expected.");this._consume(_e.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new E_(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([_e.tokens.ident,..._e.texel_format,_e.keywords.bool,_e.keywords.f32,_e.keywords.i32,_e.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const o=this._updateNode(new $1(r));return this._forwardTypeCount++,o}return this._updateNode(new Nt(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(_e.template_types)){let r=this._advance().toString(),o=null,c=null;return this._match(_e.tokens.less_than)&&(o=this._type_decl(),c=null,this._match(_e.tokens.comma)&&(c=this._consume(_e.access_mode,"Expected access_mode for pointer").toString()),this._consume(_e.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new lt(r,o,c))}if(this._match(_e.keywords.ptr)){let r=this._previous().toString();this._consume(_e.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(_e.storage_class,"Expected storage_class for pointer");this._consume(_e.tokens.comma,"Expected ',' for pointer.");const c=this._type_decl();let f=null;return this._match(_e.tokens.comma)&&(f=this._consume(_e.access_mode,"Expected access_mode for pointer").toString()),this._consume(_e.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new ep(r,o.toString(),c,f))}const t=this._attribute();if(this._match(_e.keywords.array)){let r=null,o=-1;const c=this._previous();let f=null;if(this._match(_e.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let w="";if(this._match(_e.tokens.comma)){f=this._shift_expression();try{w=f.constEvaluate(this._exec).toString(),f=null}catch{w="1"}}this._consume(_e.tokens.greater_than,"Expected '>' for array."),o=w?parseInt(w):0}const a=this._updateNode(new EA(c.toString(),t,r,o));return f&&this._deferArrayCountEval.push({arrayType:a,countNode:f}),a}return null}_texture_sampler_types(){if(this._match(_e.sampler_type))return this._updateNode(new mA(this._previous().toString(),null,null));if(this._match(_e.depth_texture_type))return this._updateNode(new mA(this._previous().toString(),null,null));if(this._match(_e.sampled_texture_type)||this._match(_e.multisampled_texture_type)){const e=this._previous();this._consume(_e.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(_e.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mA(e.toString(),t,null))}if(this._match(_e.storage_texture_type)){const e=this._previous();this._consume(_e.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(_e.texel_format,"Invalid texel format.").toString();this._consume(_e.tokens.comma,"Expected ',' after texel format.");const r=this._consume(_e.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(_e.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mA(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(_e.tokens.attr);){const t=this._consume(_e.attribute_name,"Expected attribute name"),r=this._updateNode(new kw(t.toString(),null));if(this._match(_e.tokens.paren_left)){if(r.value=this._consume(_e.literal_or_ident,"Expected attribute value").toString(),this._check(_e.tokens.comma)){this._advance();do{const o=this._consume(_e.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(o)}while(this._match(_e.tokens.comma))}this._consume(_e.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class K4 extends dl{constructor(e){super(),e&&this.update(e)}update(e){const t=new Q4().parse(e);this.updateAST(t)}}function J4(i){var c;const e={attributes:[],bindings:[]};let t;try{t=eR(i)}catch(f){return ci.error(f.message)(),e}for(const f of t.uniforms){const a=[];for(const w of((c=f.type)==null?void 0:c.members)||[])a.push({name:w.name,type:Y1(w.type)});e.bindings.push({type:"uniform",name:f.name,group:f.group,location:f.binding,members:a})}for(const f of t.textures)e.bindings.push({type:"texture",name:f.name,group:f.group,location:f.binding});for(const f of t.samplers)e.bindings.push({type:"sampler",name:f.name,group:f.group,location:f.binding});const r=t.entry.vertex[0],o=(r==null?void 0:r.inputs.length)||0;for(let f=0;f<o;f++){const a=r.inputs[f];if(a.locationType==="location"){const w=Y1(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:w})}}return e}function Y1(i){return i.format?`${i.name}<${i.format.name}>`:i.name}function eR(i){try{return new K4(i)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const tR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...tR}};const oo=globalThis.mathgl.config;function iR(i,{precision:e=oo.precision}={}){return i=rR(i),`${parseFloat(i.toPrecision(e))}`}function Wu(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Mp(i,e,t){return sR(i,r=>Math.max(e,Math.min(t,r)))}function rf(i,e,t){return Wu(i)?i.map((r,o)=>rf(r,e[o],t)):t*e+(1-t)*i}function Uc(i,e,t){const r=oo.EPSILON;try{if(i===e)return!0;if(Wu(i)&&Wu(e)){if(i.length!==e.length)return!1;for(let o=0;o<i.length;++o)if(!Uc(i[o],e[o]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=oo.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{oo.EPSILON=r}}function rR(i){return Math.round(i/oo.EPSILON)*oo.EPSILON}function nR(i){return i.clone?i.clone():new Array(i.length)}function sR(i,e,t){if(Wu(i)){const r=i;t=t||nR(r);for(let o=0;o<t.length&&o<r.length;++o){const c=typeof i=="number"?i:i[o];t[o]=e(c,o,t)}return t}return e(i)}class k_ extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Wu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(oo)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+iR(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Uc(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let o=0;o<this.ELEMENTS;++o){const c=e[o],f=typeof t=="number"?t:t[o];this[o]=c+r*(f-c)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(oo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function oR(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function Hr(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function CA(i,e,t=""){if(oo.debug&&!oR(i,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return i}function NA(i,e){if(!i)throw new Error(`math.gl assertion ${e}`)}class Dw extends k_{get x(){return this[0]}set x(e){this[0]=Hr(e)}get y(){return this[1]}set y(e){this[1]=Hr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-e[r];t+=o*o}return Hr(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Hr(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return NA(e>=0&&e<this.ELEMENTS,"index is out of range"),Hr(this[e])}setComponent(e,t){return NA(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const IA=1e-6;let Oa=typeof Float32Array<"u"?Float32Array:Array;function aR(){const i=new Oa(2);return Oa!=Float32Array&&(i[0]=0,i[1]=0),i}function Q1(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function lR(i,e){return i[0]=-e[0],i[1]=-e[1],i}function Bw(i,e,t,r){const o=e[0],c=e[1];return i[0]=o+r*(t[0]-o),i[1]=c+r*(t[1]-c),i}function cR(i,e,t){const r=e[0],o=e[1];return i[0]=t[0]*r+t[3]*o+t[6],i[1]=t[1]*r+t[4]*o+t[7],i}function uR(i,e,t){const r=e[0],o=e[1];return i[0]=t[0]*r+t[4]*o+t[12],i[1]=t[1]*r+t[5]*o+t[13],i}(function(){const i=aR();return function(e,t,r,o,c,f){let a,w;for(t||(t=2),r||(r=0),o?w=Math.min(o*t+r,e.length):w=e.length,a=r;a<w;a+=t)i[0]=e[a],i[1]=e[a+1],c(i,i,f),e[a]=i[0],e[a+1]=i[1];return e}})();function hR(i,e,t){const r=e[0],o=e[1],c=t[3]*r+t[7]*o||1;return i[0]=(t[0]*r+t[4]*o)/c,i[1]=(t[1]*r+t[5]*o)/c,i}function Ow(i,e,t){const r=e[0],o=e[1],c=e[2],f=t[3]*r+t[7]*o+t[11]*c||1;return i[0]=(t[0]*r+t[4]*o+t[8]*c)/f,i[1]=(t[1]*r+t[5]*o+t[9]*c)/f,i[2]=(t[2]*r+t[6]*o+t[10]*c)/f,i}function fR(i,e,t){const r=e[0],o=e[1];return i[0]=t[0]*r+t[2]*o,i[1]=t[1]*r+t[3]*o,i[2]=e[2],i}function AR(i,e,t){const r=e[0],o=e[1];return i[0]=t[0]*r+t[2]*o,i[1]=t[1]*r+t[3]*o,i[2]=e[2],i[3]=e[3],i}function Lw(i,e,t){const r=e[0],o=e[1],c=e[2];return i[0]=t[0]*r+t[3]*o+t[6]*c,i[1]=t[1]*r+t[4]*o+t[7]*c,i[2]=t[2]*r+t[5]*o+t[8]*c,i[3]=e[3],i}function Fw(){const i=new Oa(3);return Oa!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function dR(i){const e=i[0],t=i[1],r=i[2];return Math.sqrt(e*e+t*t+r*r)}function K1(i,e,t){const r=new Oa(3);return r[0]=i,r[1]=e,r[2]=t,r}function pR(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function gR(i){const e=i[0],t=i[1],r=i[2];return e*e+t*t+r*r}function mR(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function _R(i,e){const t=e[0],r=e[1],o=e[2];let c=t*t+r*r+o*o;return c>0&&(c=1/Math.sqrt(c)),i[0]=e[0]*c,i[1]=e[1]*c,i[2]=e[2]*c,i}function Nw(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function ip(i,e,t){const r=e[0],o=e[1],c=e[2],f=t[0],a=t[1],w=t[2];return i[0]=o*w-c*a,i[1]=c*f-r*w,i[2]=r*a-o*f,i}function yR(i,e,t,r){const o=e[0],c=e[1],f=e[2];return i[0]=o+r*(t[0]-o),i[1]=c+r*(t[1]-c),i[2]=f+r*(t[2]-f),i}function D_(i,e,t){const r=e[0],o=e[1],c=e[2];let f=t[3]*r+t[7]*o+t[11]*c+t[15];return f=f||1,i[0]=(t[0]*r+t[4]*o+t[8]*c+t[12])/f,i[1]=(t[1]*r+t[5]*o+t[9]*c+t[13])/f,i[2]=(t[2]*r+t[6]*o+t[10]*c+t[14])/f,i}function zw(i,e,t){const r=e[0],o=e[1],c=e[2];return i[0]=r*t[0]+o*t[3]+c*t[6],i[1]=r*t[1]+o*t[4]+c*t[7],i[2]=r*t[2]+o*t[5]+c*t[8],i}function Uw(i,e,t){const r=t[0],o=t[1],c=t[2],f=t[3],a=e[0],w=e[1],P=e[2];let k=o*P-c*w,F=c*a-r*P,V=r*w-o*a,W=o*V-c*F,ee=c*k-r*V,he=r*F-o*k;const Ie=f*2;return k*=Ie,F*=Ie,V*=Ie,W*=2,ee*=2,he*=2,i[0]=a+k+W,i[1]=w+F+ee,i[2]=P+V+he,i}function bR(i,e,t,r){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[0],c[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),c[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),i[0]=c[0]+t[0],i[1]=c[1]+t[1],i[2]=c[2]+t[2],i}function vR(i,e,t,r){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),c[1]=o[1],c[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),i[0]=c[0]+t[0],i[1]=c[1]+t[1],i[2]=c[2]+t[2],i}function xR(i,e,t,r){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),c[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),c[2]=o[2],i[0]=c[0]+t[0],i[1]=c[1]+t[1],i[2]=c[2]+t[2],i}function wR(i,e){const t=i[0],r=i[1],o=i[2],c=e[0],f=e[1],a=e[2],w=Math.sqrt((t*t+r*r+o*o)*(c*c+f*f+a*a)),P=w&&Nw(i,e)/w;return Math.acos(Math.min(Math.max(P,-1),1))}const jw=pR,Vw=dR,Fg=gR;(function(){const i=Fw();return function(e,t,r,o,c,f){let a,w;for(t||(t=3),r||(r=0),o?w=Math.min(o*t+r,e.length):w=e.length,a=r;a<w;a+=t)i[0]=e[a],i[1]=e[a+1],i[2]=e[a+2],c(i,i,f),e[a]=i[0],e[a+1]=i[1],e[a+2]=i[2];return e}})();const Ng=[0,0,0];let kd;class wi extends Dw{static get ZERO(){return kd||(kd=new wi(0,0,0),Object.freeze(kd)),kd}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Wu(e)?this.copy(e):(oo.debug&&(Hr(e),Hr(t),Hr(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return oo.debug&&(Hr(e.x),Hr(e.y),Hr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Hr(e)}angle(e){return wR(this,e)}cross(e){return ip(this,this,e),this.check()}rotateX({radians:e,origin:t=Ng}){return bR(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Ng}){return vR(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Ng}){return xR(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return D_(this,this,e),this.check()}transformAsVector(e){return Ow(this,this,e),this.check()}transformByMatrix3(e){return zw(this,this,e),this.check()}transformByMatrix2(e){return fR(this,this,e),this.check()}transformByQuaternion(e){return Uw(this,this,e),this.check()}}let Dd;class B_ extends Dw{static get ZERO(){return Dd||(Dd=new B_(0,0,0,0),Object.freeze(Dd)),Dd}constructor(e=0,t=0,r=0,o=0){super(-0,-0,-0,-0),Wu(e)&&arguments.length===1?this.copy(e):(oo.debug&&(Hr(e),Hr(t),Hr(r),Hr(o)),this[0]=e,this[1]=t,this[2]=r,this[3]=o)}set(e,t,r,o){return this[0]=e,this[1]=t,this[2]=r,this[3]=o,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return oo.debug&&(Hr(e.x),Hr(e.y),Hr(e.z),Hr(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Hr(e)}get w(){return this[3]}set w(e){this[3]=Hr(e)}transform(e){return D_(this,this,e),this.check()}transformByMatrix3(e){return Lw(this,this,e),this.check()}transformByMatrix2(e){return AR(this,this,e),this.check()}transformByQuaternion(e){return Uw(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Ww extends k_{toString(){let e="[";if(oo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Hr(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)t[o]=this[r+o];return t}setColumn(e,t){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=t[o];return this}}function TR(){const i=new Oa(9);return Oa!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function SR(i,e){if(i===e){const t=e[1],r=e[2],o=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=r,i[7]=o}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i}function ER(i,e){const t=e[0],r=e[1],o=e[2],c=e[3],f=e[4],a=e[5],w=e[6],P=e[7],k=e[8],F=k*f-a*P,V=-k*c+a*w,W=P*c-f*w;let ee=t*F+r*V+o*W;return ee?(ee=1/ee,i[0]=F*ee,i[1]=(-k*r+o*P)*ee,i[2]=(a*r-o*f)*ee,i[3]=V*ee,i[4]=(k*t-o*w)*ee,i[5]=(-a*t+o*c)*ee,i[6]=W*ee,i[7]=(-P*t+r*w)*ee,i[8]=(f*t-r*c)*ee,i):null}function CR(i){const e=i[0],t=i[1],r=i[2],o=i[3],c=i[4],f=i[5],a=i[6],w=i[7],P=i[8];return e*(P*c-f*w)+t*(-P*o+f*a)+r*(w*o-c*a)}function J1(i,e,t){const r=e[0],o=e[1],c=e[2],f=e[3],a=e[4],w=e[5],P=e[6],k=e[7],F=e[8],V=t[0],W=t[1],ee=t[2],he=t[3],Ie=t[4],Ee=t[5],Ne=t[6],Ce=t[7],De=t[8];return i[0]=V*r+W*f+ee*P,i[1]=V*o+W*a+ee*k,i[2]=V*c+W*w+ee*F,i[3]=he*r+Ie*f+Ee*P,i[4]=he*o+Ie*a+Ee*k,i[5]=he*c+Ie*w+Ee*F,i[6]=Ne*r+Ce*f+De*P,i[7]=Ne*o+Ce*a+De*k,i[8]=Ne*c+Ce*w+De*F,i}function IR(i,e,t){const r=e[0],o=e[1],c=e[2],f=e[3],a=e[4],w=e[5],P=e[6],k=e[7],F=e[8],V=t[0],W=t[1];return i[0]=r,i[1]=o,i[2]=c,i[3]=f,i[4]=a,i[5]=w,i[6]=V*r+W*f+P,i[7]=V*o+W*a+k,i[8]=V*c+W*w+F,i}function PR(i,e,t){const r=e[0],o=e[1],c=e[2],f=e[3],a=e[4],w=e[5],P=e[6],k=e[7],F=e[8],V=Math.sin(t),W=Math.cos(t);return i[0]=W*r+V*f,i[1]=W*o+V*a,i[2]=W*c+V*w,i[3]=W*f-V*r,i[4]=W*a-V*o,i[5]=W*w-V*c,i[6]=P,i[7]=k,i[8]=F,i}function eb(i,e,t){const r=t[0],o=t[1];return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=o*e[3],i[4]=o*e[4],i[5]=o*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function MR(i,e){const t=e[0],r=e[1],o=e[2],c=e[3],f=t+t,a=r+r,w=o+o,P=t*f,k=r*f,F=r*a,V=o*f,W=o*a,ee=o*w,he=c*f,Ie=c*a,Ee=c*w;return i[0]=1-F-ee,i[3]=k-Ee,i[6]=V+Ie,i[1]=k+Ee,i[4]=1-P-ee,i[7]=W-he,i[2]=V-Ie,i[5]=W+he,i[8]=1-P-F,i}var Bm;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(Bm||(Bm={}));const RR=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ps extends Ww{static get IDENTITY(){return DR()}static get ZERO(){return kR()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Bm}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(RR)}fromObject(e){return this.check()}fromQuaternion(e){return MR(this,e),this.check()}set(e,t,r,o,c,f,a,w,P){return this[0]=e,this[1]=t,this[2]=r,this[3]=o,this[4]=c,this[5]=f,this[6]=a,this[7]=w,this[8]=P,this.check()}setRowMajor(e,t,r,o,c,f,a,w,P){return this[0]=e,this[1]=o,this[2]=a,this[3]=t,this[4]=c,this[5]=w,this[6]=r,this[7]=f,this[8]=P,this.check()}determinant(){return CR(this)}transpose(){return SR(this,this),this.check()}invert(){return ER(this,this),this.check()}multiplyLeft(e){return J1(this,e,this),this.check()}multiplyRight(e){return J1(this,this,e),this.check()}rotate(e){return PR(this,this,e),this.check()}scale(e){return Array.isArray(e)?eb(this,this,e):eb(this,this,[e,e]),this.check()}translate(e){return IR(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=cR(t||[-0,-0],e,this);break;case 3:r=zw(t||[-0,-0,-0],e,this);break;case 4:r=Lw(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return CA(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Bd,Od=null;function kR(){return Bd||(Bd=new Ps([0,0,0,0,0,0,0,0,0]),Object.freeze(Bd)),Bd}function DR(){return Od||(Od=new Ps,Object.freeze(Od)),Od}function BR(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function OR(i,e){if(i===e){const t=e[1],r=e[2],o=e[3],c=e[6],f=e[7],a=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=c,i[11]=e[14],i[12]=o,i[13]=f,i[14]=a}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function Om(i,e){const t=e[0],r=e[1],o=e[2],c=e[3],f=e[4],a=e[5],w=e[6],P=e[7],k=e[8],F=e[9],V=e[10],W=e[11],ee=e[12],he=e[13],Ie=e[14],Ee=e[15],Ne=t*a-r*f,Ce=t*w-o*f,De=t*P-c*f,Ye=r*w-o*a,Ke=r*P-c*a,kt=o*P-c*w,It=k*he-F*ee,jt=k*Ie-V*ee,Lt=k*Ee-W*ee,Mt=F*Ie-V*he,vi=F*Ee-W*he,Xt=V*Ee-W*Ie;let Jt=Ne*Xt-Ce*vi+De*Mt+Ye*Lt-Ke*jt+kt*It;return Jt?(Jt=1/Jt,i[0]=(a*Xt-w*vi+P*Mt)*Jt,i[1]=(o*vi-r*Xt-c*Mt)*Jt,i[2]=(he*kt-Ie*Ke+Ee*Ye)*Jt,i[3]=(V*Ke-F*kt-W*Ye)*Jt,i[4]=(w*Lt-f*Xt-P*jt)*Jt,i[5]=(t*Xt-o*Lt+c*jt)*Jt,i[6]=(Ie*De-ee*kt-Ee*Ce)*Jt,i[7]=(k*kt-V*De+W*Ce)*Jt,i[8]=(f*vi-a*Lt+P*It)*Jt,i[9]=(r*Lt-t*vi-c*It)*Jt,i[10]=(ee*Ke-he*De+Ee*Ne)*Jt,i[11]=(F*De-k*Ke-W*Ne)*Jt,i[12]=(a*jt-f*Mt-w*It)*Jt,i[13]=(t*Mt-r*jt+o*It)*Jt,i[14]=(he*Ce-ee*Ye-Ie*Ne)*Jt,i[15]=(k*Ye-F*Ce+V*Ne)*Jt,i):null}function LR(i){const e=i[0],t=i[1],r=i[2],o=i[3],c=i[4],f=i[5],a=i[6],w=i[7],P=i[8],k=i[9],F=i[10],V=i[11],W=i[12],ee=i[13],he=i[14],Ie=i[15],Ee=e*f-t*c,Ne=e*a-r*c,Ce=t*a-r*f,De=P*ee-k*W,Ye=P*he-F*W,Ke=k*he-F*ee,kt=e*Ke-t*Ye+r*De,It=c*Ke-f*Ye+a*De,jt=P*Ce-k*Ne+F*Ee,Lt=W*Ce-ee*Ne+he*Ee;return w*kt-o*It+Ie*jt-V*Lt}function Nu(i,e,t){const r=e[0],o=e[1],c=e[2],f=e[3],a=e[4],w=e[5],P=e[6],k=e[7],F=e[8],V=e[9],W=e[10],ee=e[11],he=e[12],Ie=e[13],Ee=e[14],Ne=e[15];let Ce=t[0],De=t[1],Ye=t[2],Ke=t[3];return i[0]=Ce*r+De*a+Ye*F+Ke*he,i[1]=Ce*o+De*w+Ye*V+Ke*Ie,i[2]=Ce*c+De*P+Ye*W+Ke*Ee,i[3]=Ce*f+De*k+Ye*ee+Ke*Ne,Ce=t[4],De=t[5],Ye=t[6],Ke=t[7],i[4]=Ce*r+De*a+Ye*F+Ke*he,i[5]=Ce*o+De*w+Ye*V+Ke*Ie,i[6]=Ce*c+De*P+Ye*W+Ke*Ee,i[7]=Ce*f+De*k+Ye*ee+Ke*Ne,Ce=t[8],De=t[9],Ye=t[10],Ke=t[11],i[8]=Ce*r+De*a+Ye*F+Ke*he,i[9]=Ce*o+De*w+Ye*V+Ke*Ie,i[10]=Ce*c+De*P+Ye*W+Ke*Ee,i[11]=Ce*f+De*k+Ye*ee+Ke*Ne,Ce=t[12],De=t[13],Ye=t[14],Ke=t[15],i[12]=Ce*r+De*a+Ye*F+Ke*he,i[13]=Ce*o+De*w+Ye*V+Ke*Ie,i[14]=Ce*c+De*P+Ye*W+Ke*Ee,i[15]=Ce*f+De*k+Ye*ee+Ke*Ne,i}function Rp(i,e,t){const r=t[0],o=t[1],c=t[2];let f,a,w,P,k,F,V,W,ee,he,Ie,Ee;return e===i?(i[12]=e[0]*r+e[4]*o+e[8]*c+e[12],i[13]=e[1]*r+e[5]*o+e[9]*c+e[13],i[14]=e[2]*r+e[6]*o+e[10]*c+e[14],i[15]=e[3]*r+e[7]*o+e[11]*c+e[15]):(f=e[0],a=e[1],w=e[2],P=e[3],k=e[4],F=e[5],V=e[6],W=e[7],ee=e[8],he=e[9],Ie=e[10],Ee=e[11],i[0]=f,i[1]=a,i[2]=w,i[3]=P,i[4]=k,i[5]=F,i[6]=V,i[7]=W,i[8]=ee,i[9]=he,i[10]=Ie,i[11]=Ee,i[12]=f*r+k*o+ee*c+e[12],i[13]=a*r+F*o+he*c+e[13],i[14]=w*r+V*o+Ie*c+e[14],i[15]=P*r+W*o+Ee*c+e[15]),i}function O_(i,e,t){const r=t[0],o=t[1],c=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*c,i[9]=e[9]*c,i[10]=e[10]*c,i[11]=e[11]*c,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function FR(i,e,t,r){let o=r[0],c=r[1],f=r[2],a=Math.sqrt(o*o+c*c+f*f),w,P,k,F,V,W,ee,he,Ie,Ee,Ne,Ce,De,Ye,Ke,kt,It,jt,Lt,Mt,vi,Xt,Jt,zi;return a<IA?null:(a=1/a,o*=a,c*=a,f*=a,P=Math.sin(t),w=Math.cos(t),k=1-w,F=e[0],V=e[1],W=e[2],ee=e[3],he=e[4],Ie=e[5],Ee=e[6],Ne=e[7],Ce=e[8],De=e[9],Ye=e[10],Ke=e[11],kt=o*o*k+w,It=c*o*k+f*P,jt=f*o*k-c*P,Lt=o*c*k-f*P,Mt=c*c*k+w,vi=f*c*k+o*P,Xt=o*f*k+c*P,Jt=c*f*k-o*P,zi=f*f*k+w,i[0]=F*kt+he*It+Ce*jt,i[1]=V*kt+Ie*It+De*jt,i[2]=W*kt+Ee*It+Ye*jt,i[3]=ee*kt+Ne*It+Ke*jt,i[4]=F*Lt+he*Mt+Ce*vi,i[5]=V*Lt+Ie*Mt+De*vi,i[6]=W*Lt+Ee*Mt+Ye*vi,i[7]=ee*Lt+Ne*Mt+Ke*vi,i[8]=F*Xt+he*Jt+Ce*zi,i[9]=V*Xt+Ie*Jt+De*zi,i[10]=W*Xt+Ee*Jt+Ye*zi,i[11]=ee*Xt+Ne*Jt+Ke*zi,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function Hw(i,e,t){const r=Math.sin(t),o=Math.cos(t),c=e[4],f=e[5],a=e[6],w=e[7],P=e[8],k=e[9],F=e[10],V=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=c*o+P*r,i[5]=f*o+k*r,i[6]=a*o+F*r,i[7]=w*o+V*r,i[8]=P*o-c*r,i[9]=k*o-f*r,i[10]=F*o-a*r,i[11]=V*o-w*r,i}function NR(i,e,t){const r=Math.sin(t),o=Math.cos(t),c=e[0],f=e[1],a=e[2],w=e[3],P=e[8],k=e[9],F=e[10],V=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*o-P*r,i[1]=f*o-k*r,i[2]=a*o-F*r,i[3]=w*o-V*r,i[8]=c*r+P*o,i[9]=f*r+k*o,i[10]=a*r+F*o,i[11]=w*r+V*o,i}function $w(i,e,t){const r=Math.sin(t),o=Math.cos(t),c=e[0],f=e[1],a=e[2],w=e[3],P=e[4],k=e[5],F=e[6],V=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*o+P*r,i[1]=f*o+k*r,i[2]=a*o+F*r,i[3]=w*o+V*r,i[4]=P*o-c*r,i[5]=k*o-f*r,i[6]=F*o-a*r,i[7]=V*o-w*r,i}function zR(i,e){const t=e[0],r=e[1],o=e[2],c=e[4],f=e[5],a=e[6],w=e[8],P=e[9],k=e[10];return i[0]=Math.sqrt(t*t+r*r+o*o),i[1]=Math.sqrt(c*c+f*f+a*a),i[2]=Math.sqrt(w*w+P*P+k*k),i}function UR(i,e){const t=e[0],r=e[1],o=e[2],c=e[3],f=t+t,a=r+r,w=o+o,P=t*f,k=r*f,F=r*a,V=o*f,W=o*a,ee=o*w,he=c*f,Ie=c*a,Ee=c*w;return i[0]=1-F-ee,i[1]=k+Ee,i[2]=V-Ie,i[3]=0,i[4]=k-Ee,i[5]=1-P-ee,i[6]=W+he,i[7]=0,i[8]=V+Ie,i[9]=W-he,i[10]=1-P-F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function jR(i,e,t,r,o,c,f){const a=1/(t-e),w=1/(o-r),P=1/(c-f);return i[0]=c*2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c*2*w,i[6]=0,i[7]=0,i[8]=(t+e)*a,i[9]=(o+r)*w,i[10]=(f+c)*P,i[11]=-1,i[12]=0,i[13]=0,i[14]=f*c*2*P,i[15]=0,i}function VR(i,e,t,r,o){const c=1/Math.tan(e/2);if(i[0]=c/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0){const f=1/(r-o);i[10]=(o+r)*f,i[14]=2*o*r*f}else i[10]=-1,i[14]=-2*r;return i}const WR=VR;function HR(i,e,t,r,o,c,f){const a=1/(e-t),w=1/(r-o),P=1/(c-f);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(e+t)*a,i[13]=(o+r)*w,i[14]=(f+c)*P,i[15]=1,i}const $R=HR;function ZR(i,e,t,r){let o,c,f,a,w,P,k,F,V,W;const ee=e[0],he=e[1],Ie=e[2],Ee=r[0],Ne=r[1],Ce=r[2],De=t[0],Ye=t[1],Ke=t[2];return Math.abs(ee-De)<IA&&Math.abs(he-Ye)<IA&&Math.abs(Ie-Ke)<IA?BR(i):(F=ee-De,V=he-Ye,W=Ie-Ke,o=1/Math.sqrt(F*F+V*V+W*W),F*=o,V*=o,W*=o,c=Ne*W-Ce*V,f=Ce*F-Ee*W,a=Ee*V-Ne*F,o=Math.sqrt(c*c+f*f+a*a),o?(o=1/o,c*=o,f*=o,a*=o):(c=0,f=0,a=0),w=V*a-W*f,P=W*c-F*a,k=F*f-V*c,o=Math.sqrt(w*w+P*P+k*k),o?(o=1/o,w*=o,P*=o,k*=o):(w=0,P=0,k=0),i[0]=c,i[1]=w,i[2]=F,i[3]=0,i[4]=f,i[5]=P,i[6]=V,i[7]=0,i[8]=a,i[9]=k,i[10]=W,i[11]=0,i[12]=-(c*ee+f*he+a*Ie),i[13]=-(w*ee+P*he+k*Ie),i[14]=-(F*ee+V*he+W*Ie),i[15]=1,i)}function qR(){const i=new Oa(4);return Oa!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function XR(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function L_(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function GR(i){const e=i[0],t=i[1],r=i[2],o=i[3];return Math.sqrt(e*e+t*t+r*r+o*o)}function YR(i){const e=i[0],t=i[1],r=i[2],o=i[3];return e*e+t*t+r*r+o*o}function QR(i,e){const t=e[0],r=e[1],o=e[2],c=e[3];let f=t*t+r*r+o*o+c*c;return f>0&&(f=1/Math.sqrt(f)),i[0]=t*f,i[1]=r*f,i[2]=o*f,i[3]=c*f,i}function KR(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function JR(i,e,t,r){const o=e[0],c=e[1],f=e[2],a=e[3];return i[0]=o+r*(t[0]-o),i[1]=c+r*(t[1]-c),i[2]=f+r*(t[2]-f),i[3]=a+r*(t[3]-a),i}function df(i,e,t){const r=e[0],o=e[1],c=e[2],f=e[3];return i[0]=t[0]*r+t[4]*o+t[8]*c+t[12]*f,i[1]=t[1]*r+t[5]*o+t[9]*c+t[13]*f,i[2]=t[2]*r+t[6]*o+t[10]*c+t[14]*f,i[3]=t[3]*r+t[7]*o+t[11]*c+t[15]*f,i}function ek(i,e,t){const r=e[0],o=e[1],c=e[2],f=t[0],a=t[1],w=t[2],P=t[3],k=P*r+a*c-w*o,F=P*o+w*r-f*c,V=P*c+f*o-a*r,W=-f*r-a*o-w*c;return i[0]=k*P+W*-f+F*-w-V*-a,i[1]=F*P+W*-a+V*-f-k*-w,i[2]=V*P+W*-w+k*-a-F*-f,i[3]=e[3],i}(function(){const i=qR();return function(e,t,r,o,c,f){let a,w;for(t||(t=4),r||(r=0),o?w=Math.min(o*t+r,e.length):w=e.length,a=r;a<w;a+=t)i[0]=e[a],i[1]=e[a+1],i[2]=e[a+2],i[3]=e[a+3],c(i,i,f),e[a]=i[0],e[a+1]=i[1],e[a+2]=i[2],e[a+3]=i[3];return e}})();var Lm;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(Lm||(Lm={}));const tk=45*Math.PI/180,ik=1,zg=.1,Ug=500,rk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Eo extends Ww{static get IDENTITY(){return sk()}static get ZERO(){return nk()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Lm}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,o,c,f,a,w,P,k,F,V,W,ee,he,Ie){return this[0]=e,this[1]=t,this[2]=r,this[3]=o,this[4]=c,this[5]=f,this[6]=a,this[7]=w,this[8]=P,this[9]=k,this[10]=F,this[11]=V,this[12]=W,this[13]=ee,this[14]=he,this[15]=Ie,this.check()}setRowMajor(e,t,r,o,c,f,a,w,P,k,F,V,W,ee,he,Ie){return this[0]=e,this[1]=c,this[2]=P,this[3]=W,this[4]=t,this[5]=f,this[6]=k,this[7]=ee,this[8]=r,this[9]=a,this[10]=F,this[11]=he,this[12]=o,this[13]=w,this[14]=V,this[15]=Ie,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(rk)}fromObject(e){return this.check()}fromQuaternion(e){return UR(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:o,top:c,near:f=zg,far:a=Ug}=e;return a===1/0?ok(this,t,r,o,c,f):jR(this,t,r,o,c,f,a),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:o=[0,1,0]}=e;return ZR(this,t,r,o),this.check()}ortho(e){const{left:t,right:r,bottom:o,top:c,near:f=zg,far:a=Ug}=e;return $R(this,t,r,o,c,f,a),this.check()}orthographic(e){const{fovy:t=tk,aspect:r=ik,focalDistance:o=1,near:c=zg,far:f=Ug}=e;tb(t);const a=t/2,w=o*Math.tan(a),P=w*r;return this.ortho({left:-P,right:P,bottom:-w,top:w,near:c,far:f})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:o=.1,far:c=500}=e;return tb(t),WR(this,t,r,o,c),this.check()}determinant(){return LR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),o=1/r[0],c=1/r[1],f=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*c,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*c,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),o=1/r[0],c=1/r[1],f=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*f,e[3]=this[4]*o,e[4]=this[5]*c,e[5]=this[6]*f,e[6]=this[8]*o,e[7]=this[9]*c,e[8]=this[10]*f,e}transpose(){return OR(this,this),this.check()}invert(){return Om(this,this),this.check()}multiplyLeft(e){return Nu(this,e,this),this.check()}multiplyRight(e){return Nu(this,this,e),this.check()}rotateX(e){return Hw(this,this,e),this.check()}rotateY(e){return NR(this,this,e),this.check()}rotateZ(e){return $w(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return FR(this,this,e,t),this.check()}scale(e){return O_(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Rp(this,this,e),this.check()}transform(e,t){return e.length===4?(t=df(t||[-0,-0,-0,-0],e,this),CA(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let o;switch(r){case 2:o=uR(t||[-0,-0],e,this);break;case 3:o=D_(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return CA(o,e.length),o}transformAsVector(e,t){let r;switch(e.length){case 2:r=hR(t||[-0,-0],e,this);break;case 3:r=Ow(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return CA(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let Ld,Fd;function nk(){return Ld||(Ld=new Eo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ld)),Ld}function sk(){return Fd||(Fd=new Eo,Object.freeze(Fd)),Fd}function tb(i){if(i>Math.PI*2)throw Error("expected radians")}function ok(i,e,t,r,o,c){const f=2*c/(t-e),a=2*c/(o-r),w=(t+e)/(t-e),P=(o+r)/(o-r),k=-1,F=-1,V=-2*c;return i[0]=f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=w,i[9]=P,i[10]=k,i[11]=F,i[12]=0,i[13]=0,i[14]=V,i[15]=0,i}function ib(){const i=new Oa(4);return Oa!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ak(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Zw(i,e,t){t=t*.5;const r=Math.sin(t);return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=Math.cos(t),i}function rb(i,e,t){const r=e[0],o=e[1],c=e[2],f=e[3],a=t[0],w=t[1],P=t[2],k=t[3];return i[0]=r*k+f*a+o*P-c*w,i[1]=o*k+f*w+c*a-r*P,i[2]=c*k+f*P+r*w-o*a,i[3]=f*k-r*a-o*w-c*P,i}function lk(i,e,t){t*=.5;const r=e[0],o=e[1],c=e[2],f=e[3],a=Math.sin(t),w=Math.cos(t);return i[0]=r*w+f*a,i[1]=o*w+c*a,i[2]=c*w-o*a,i[3]=f*w-r*a,i}function ck(i,e,t){t*=.5;const r=e[0],o=e[1],c=e[2],f=e[3],a=Math.sin(t),w=Math.cos(t);return i[0]=r*w-c*a,i[1]=o*w+f*a,i[2]=c*w+r*a,i[3]=f*w-o*a,i}function uk(i,e,t){t*=.5;const r=e[0],o=e[1],c=e[2],f=e[3],a=Math.sin(t),w=Math.cos(t);return i[0]=r*w+o*a,i[1]=o*w-r*a,i[2]=c*w+f*a,i[3]=f*w-c*a,i}function hk(i,e){const t=e[0],r=e[1],o=e[2];return i[0]=t,i[1]=r,i[2]=o,i[3]=Math.sqrt(Math.abs(1-t*t-r*r-o*o)),i}function rp(i,e,t,r){const o=e[0],c=e[1],f=e[2],a=e[3];let w=t[0],P=t[1],k=t[2],F=t[3],V,W,ee,he,Ie;return V=o*w+c*P+f*k+a*F,V<0&&(V=-V,w=-w,P=-P,k=-k,F=-F),1-V>IA?(W=Math.acos(V),Ie=Math.sin(W),ee=Math.sin((1-r)*W)/Ie,he=Math.sin(r*W)/Ie):(ee=1-r,he=r),i[0]=ee*o+he*w,i[1]=ee*c+he*P,i[2]=ee*f+he*k,i[3]=ee*a+he*F,i}function fk(i,e){const t=e[0],r=e[1],o=e[2],c=e[3],f=t*t+r*r+o*o+c*c,a=f?1/f:0;return i[0]=-t*a,i[1]=-r*a,i[2]=-o*a,i[3]=c*a,i}function Ak(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i}function qw(i,e){const t=e[0]+e[4]+e[8];let r;if(t>0)r=Math.sqrt(t+1),i[3]=.5*r,r=.5/r,i[0]=(e[5]-e[7])*r,i[1]=(e[6]-e[2])*r,i[2]=(e[1]-e[3])*r;else{let o=0;e[4]>e[0]&&(o=1),e[8]>e[o*3+o]&&(o=2);const c=(o+1)%3,f=(o+2)%3;r=Math.sqrt(e[o*3+o]-e[c*3+c]-e[f*3+f]+1),i[o]=.5*r,r=.5/r,i[3]=(e[c*3+f]-e[f*3+c])*r,i[c]=(e[c*3+o]+e[o*3+c])*r,i[f]=(e[f*3+o]+e[o*3+f])*r}return i}const dk=XR,pk=L_,gk=KR,mk=JR,_k=GR,yk=YR,Xw=QR,bk=function(){const i=Fw(),e=K1(1,0,0),t=K1(0,1,0);return function(r,o,c){const f=Nw(o,c);return f<-.999999?(ip(i,e,o),Vw(i)<1e-6&&ip(i,t,o),_R(i,i),Zw(r,i,Math.PI),r):f>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ip(i,o,c),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+f,Xw(r,r))}}();(function(){const i=ib(),e=ib();return function(t,r,o,c,f,a){return rp(i,r,f,a),rp(e,o,c,a),rp(t,i,e,2*a*(1-a)),t}})();(function(){const i=TR();return function(e,t,r,o){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=o[0],i[4]=o[1],i[7]=o[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],Xw(e,qw(e,i))}})();const vk=[0,0,0,1];class nb extends k_{constructor(e=0,t=0,r=0,o=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,o)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,o){return this[0]=e,this[1]=t,this[2]=r,this[3]=o,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return qw(this,e),this.check()}fromAxisRotation(e,t){return Zw(this,e,t),this.check()}identity(){return ak(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Hr(e)}get y(){return this[1]}set y(e){this[1]=Hr(e)}get z(){return this[2]}set z(e){this[2]=Hr(e)}get w(){return this[3]}set w(e){this[3]=Hr(e)}len(){return _k(this)}lengthSquared(){return yk(this)}dot(e){return gk(this,e)}rotationTo(e,t){return bk(this,e,t),this.check()}add(e){return dk(this,this,e),this.check()}calculateW(){return hk(this,this),this.check()}conjugate(){return Ak(this,this),this.check()}invert(){return fk(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(mk(this,e,t,r),this.check())}multiplyRight(e){return rb(this,this,e),this.check()}multiplyLeft(e){return rb(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return lk(this,this,e),this.check()}rotateY(e){return ck(this,this,e),this.check()}rotateZ(e){return uk(this,this,e),this.check()}scale(e){return pk(this,this,e),this.check()}slerp(e,t,r){let o,c,f;switch(arguments.length){case 1:({start:o=vk,target:c,ratio:f}=e);break;case 2:o=this,c=e,f=t;break;default:o=e,c=t,f=r}return rp(this,o,c,f),this.check()}transformVector4(e,t=new B_){return ek(t,e,this),CA(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const xk=1e-15,wk=1e-20;function Gw(i,e=[],t=0){const r=Math.fround(i),o=i-r;return e[t]=r,e[t+1]=o,e}function Tk(i){return i-Math.fround(i)}function Sk(i){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const o=t*4+r;Gw(i[r*4+t],e,o*2)}return e}const Ek=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Ck={name:"fp32",vs:Ek},Ik=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,Pk={ONE:1},Mk={name:"fp64arithmetic",vs:Ik,defaultUniforms:Pk,uniformTypes:{ONE:"f32"},fp64ify:Gw,fp64LowPart:Tk,fp64ifyMatrix4:Sk},Rk=[0,1,1,1],kk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Dk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,sb={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Rk},vs:kk,fs:Dk,getUniforms:Bk};function Bk(i={},e){const t={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=i.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(i.highlightColor){const r=Array.from(i.highlightColor,o=>o/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return i.isActive!==void 0&&(t.isActive=!!i.isActive,t.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(t.useFloatColors=!!i.useFloatColors),t}const ob=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,Ok=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,Yw=3,Lk=255;var zA;(function(i){i[i.POINT=0]="POINT",i[i.DIRECTIONAL=1]="DIRECTIONAL"})(zA||(zA={}));const PA={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:Yw},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:zA.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:Ok,vs:ob,fs:ob,getUniforms:Fk};function Fk(i,e={}){if(i=i&&{...i},!i)return{...PA.defaultUniforms};i.lights&&(i={...i,...zk(i.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:o}=i||{};if(!(t||r&&r.length>0||o&&o.length>0))return{...PA.defaultUniforms,enabled:0};const f={...PA.defaultUniforms,...e,...Nk({ambientLight:t,pointLights:r,directionalLights:o})};return i.enabled!==void 0&&(f.enabled=i.enabled?1:0),f}function Nk({ambientLight:i,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=jg(i);let o=0;for(const c of e){r.lightType=zA.POINT;const f=o;r[`lightColor${f}`]=jg(c),r[`lightPosition${f}`]=c.position,r[`lightAttenuation${f}`]=c.attenuation||[1,0,0],o++}for(const c of t){r.lightType=zA.DIRECTIONAL;const f=o;r[`lightColor${f}`]=jg(c),r[`lightDirection${f}`]=c.direction,o++}return o>Yw&&ci.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function zk(i){var t,r;const e={pointLights:[],directionalLights:[]};for(const o of i||[])switch(o.type){case"ambient":e.ambientLight=o;break;case"directional":(t=e.directionalLights)==null||t.push(o);break;case"point":(r=e.pointLights)==null||r.push(o);break}return e}function jg(i={}){const{color:e=[0,0,0],intensity:t=1}=i;return e.map(r=>r*t/Lk)}const Qw=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,Kw=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,Jw=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,F_={props:{},name:"gouraudMaterial",vs:Kw.replace("phongMaterial","gouraudMaterial"),fs:Qw.replace("phongMaterial","gouraudMaterial"),source:Jw.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[PA],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const e={...i};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...F_.defaultUniforms,...e}}},e3={name:"phongMaterial",dependencies:[PA],source:Jw,vs:Qw,fs:Kw,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const e={...i};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...e3.defaultUniforms,...e}}},Uk=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,t3="#define SMOOTH_EDGE_RADIUS 0.5",jk=`${t3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Vk=`${t3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Wk={name:"geometry",source:Uk,vs:jk,fs:Vk},Hk=25;var Wn;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(Wn||(Wn={}));var is;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(is||(is={}));var hr;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(hr||(hr={}));const fU="compute",AU="auto",$k="manipulation",Zk="none",qk="pan-x",Xk="pan-y";function i3(i){return i.trim().split(/\s+/g)}function Vg(i,e,t){if(i)for(const r of i3(e))i.addEventListener(r,t,!1)}function Wg(i,e,t){if(i)for(const r of i3(e))i.removeEventListener(r,t,!1)}function ab(i){return(i.ownerDocument||i).defaultView}function Gk(i,e){let t=i;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function r3(i){const e=i.length;if(e===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let t=0,r=0,o=0;for(;o<e;)t+=i[o].clientX,r+=i[o].clientY,o++;return{x:Math.round(t/e),y:Math.round(r/e)}}function lb(i){const e=[];let t=0;for(;t<i.pointers.length;)e[t]={clientX:Math.round(i.pointers[t].clientX),clientY:Math.round(i.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:r3(e),deltaX:i.deltaX,deltaY:i.deltaY}}function n3(i,e){const t=e.x-i.x,r=e.y-i.y;return Math.sqrt(t*t+r*r)}function cb(i,e){const t=e.clientX-i.clientX,r=e.clientY-i.clientY;return Math.sqrt(t*t+r*r)}function Yk(i,e){const t=e.x-i.x,r=e.y-i.y;return Math.atan2(r,t)*180/Math.PI}function ub(i,e){const t=e.clientX-i.clientX,r=e.clientY-i.clientY;return Math.atan2(r,t)*180/Math.PI}function s3(i,e){return i===e?is.None:Math.abs(i)>=Math.abs(e)?i<0?is.Left:is.Right:e<0?is.Up:is.Down}function Qk(i,e){const t=e.center;let r=i.offsetDelta,o=i.prevDelta;const c=i.prevInput;return(e.eventType===Wn.Start||(c==null?void 0:c.eventType)===Wn.End)&&(o=i.prevDelta={x:(c==null?void 0:c.deltaX)||0,y:(c==null?void 0:c.deltaY)||0},r=i.offsetDelta={x:t.x,y:t.y}),{deltaX:o.x+(t.x-r.x),deltaY:o.y+(t.y-r.y)}}function o3(i,e,t){return{x:e/i||0,y:t/i||0}}function Kk(i,e){return cb(e[0],e[1])/cb(i[0],i[1])}function Jk(i,e){return ub(e[1],e[0])-ub(i[1],i[0])}function e6(i,e){const t=i.lastInterval||e,r=e.timeStamp-t.timeStamp;let o,c,f,a;if(e.eventType!==Wn.Cancel&&(r>Hk||t.velocity===void 0)){const w=e.deltaX-t.deltaX,P=e.deltaY-t.deltaY,k=o3(r,w,P);c=k.x,f=k.y,o=Math.abs(k.x)>Math.abs(k.y)?k.x:k.y,a=s3(w,P),i.lastInterval=e}else o=t.velocity,c=t.velocityX,f=t.velocityY,a=t.direction;e.velocity=o,e.velocityX=c,e.velocityY=f,e.direction=a}function t6(i,e){const{session:t}=i,{pointers:r}=e,{length:o}=r;t.firstInput||(t.firstInput=lb(e)),o>1&&!t.firstMultiple?t.firstMultiple=lb(e):o===1&&(t.firstMultiple=!1);const{firstInput:c,firstMultiple:f}=t,a=f?f.center:c.center,w=e.center=r3(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-c.timeStamp,e.angle=Yk(a,w),e.distance=n3(a,w);const{deltaX:P,deltaY:k}=Qk(t,e);e.deltaX=P,e.deltaY=k,e.offsetDirection=s3(e.deltaX,e.deltaY);const F=o3(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=F.x,e.overallVelocityY=F.y,e.overallVelocity=Math.abs(F.x)>Math.abs(F.y)?F.x:F.y,e.scale=f?Kk(f.pointers,r):1,e.rotation=f?Jk(f.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let V=i.element;return Gk(e.srcEvent.target,V)&&(V=e.srcEvent.target),e.target=V,e6(t,e),e}function i6(i,e,t){const r=t.pointers.length,o=t.changedPointers.length,c=e&Wn.Start&&r-o===0,f=e&(Wn.End|Wn.Cancel)&&r-o===0;t.isFirst=!!c,t.isFinal=!!f,c&&(i.session={}),t.eventType=e;const a=t6(i,t);i.emit("hammer.input",a),i.recognize(a),i.session.prevInput=a}let r6=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){i6(this.manager,e,t)}init(){Vg(this.element,this.evEl,this.domHandler),Vg(this.target,this.evTarget,this.domHandler),Vg(ab(this.element),this.evWin,this.domHandler)}destroy(){Wg(this.element,this.evEl,this.domHandler),Wg(this.target,this.evTarget,this.domHandler),Wg(ab(this.element),this.evWin,this.domHandler)}};const n6={pointerdown:Wn.Start,pointermove:Wn.Move,pointerup:Wn.End,pointercancel:Wn.Cancel,pointerout:Wn.Cancel},s6="pointerdown",o6="pointermove pointerup pointercancel";class pU extends r6{constructor(e){super(e),this.evEl=s6,this.evWin=o6,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const o=n6[e.type],c=e.pointerType,f=c==="touch";let a=t.findIndex(w=>w.pointerId===e.pointerId);o&Wn.Start&&(e.buttons||f)?a<0&&(t.push(e),a=t.length-1):o&(Wn.End|Wn.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(o,{pointers:t,changedPointers:[e],eventType:o,pointerType:c,srcEvent:e}),r&&t.splice(a,1))}}let a6=1;function l6(){return a6++}function hb(i){return i&hr.Cancelled?"cancel":i&hr.Ended?"end":i&hr.Changed?"move":i&hr.Began?"start":""}class a3{constructor(e){this.options=e,this.id=l6(),this.state=hr.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const o of e)this.recognizeWith(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const o of e)this.requireFailure(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<hr.Ended&&this.manager.emit(this.options.event+hb(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=hr.Ended&&this.manager.emit(this.options.event+hb(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=hr.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(hr.Failed|hr.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=hr.Failed;return}this.state&(hr.Recognized|hr.Cancelled|hr.Failed)&&(this.state=hr.Possible),this.state=this.process(t),this.state&(hr.Began|hr.Changed|hr.Ended|hr.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class l3 extends a3{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,o=t&(hr.Began|hr.Changed),c=this.attrTest(e);return o&&(r&Wn.Cancel||!c)?t|hr.Cancelled:o||c?r&Wn.End?t|hr.Ended:t&hr.Began?t|hr.Changed:hr.Began:hr.Failed}}class fb extends a3{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[$k]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,o=e.distance<t.threshold,c=e.deltaTime<t.time;if(this.reset(),e.eventType&Wn.Start&&this.count===0)return this.failTimeout();if(o&&c&&r){if(e.eventType!==Wn.End)return this.failTimeout();const f=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||n3(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!f?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=hr.Recognized,this.tryEmit(this._input)},t.interval),hr.Began):hr.Recognized}return hr.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=hr.Failed},this.options.interval),hr.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===hr.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const c6=["","start","move","end","cancel","up","down","left","right"];class Ab extends l3{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:is.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&is.Horizontal&&t.push(Xk),e&is.Vertical&&t.push(qk),t}getEventNames(){return c6.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:o}=e,{direction:c}=e;const f=e.deltaX,a=e.deltaY;return c&t.direction||(t.direction&is.Horizontal?(c=f===0?is.None:f<0?is.Left:is.Right,r=f!==this.pX,o=Math.abs(e.deltaX)):(c=a===0?is.None:a<0?is.Up:is.Down,r=a!==this.pY,o=Math.abs(e.deltaY))),e.direction=c,r&&o>t.threshold&&!!(c&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&hr.Began)||!(this.state&hr.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=is[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const u6=["","start","move","end","cancel","in","out"];class h6 extends l3{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Zk]}getEventNames(){return u6.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&hr.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class f6{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const A6=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",d6=A6.indexOf("firefox")!==-1,db=4.000244140625,p6=40,g6=.25;class gU extends f6{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=o=>{if(!this.options.enable)return;let c=o.deltaY;globalThis.WheelEvent&&(d6&&o.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(c/=globalThis.devicePixelRatio),o.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(c*=p6)),c!==0&&c%db===0&&(c=Math.floor(c/db)),o.shiftKey&&c&&(c=c*g6),this.callback({type:"wheel",center:{x:o.clientX,y:o.clientY},delta:-c,srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Cr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Cr,"IDENTITY",{get:()=>(rn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ho={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},La={common:0,meters:1,pixels:2},mU={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},_U={multipan:[Ab,{threshold:10,direction:is.Vertical,pointers:2}],pinch:[h6,{},null,["multipan"]],pan:[Ab,{threshold:1},["pinch"],["multipan"]],dblclick:[fb,{event:"dblclick",taps:2}],click:[fb,{event:"click"},null,["dblclick"]]};function m6(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function N_(i){let e={},t;return r=>{for(const o in r)if(!m6(r[o],e[o])){t=i(r),e=r;break}return t}}const pb=[0,0,0,0],_6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],c3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y6=[0,0,0],u3=[0,0,0],b6=N_(w6);function h3(i,e,t=u3){t.length<3&&(t=[t[0],t[1],0]);let r=t,o,c=!0;switch(e===Cr.LNGLAT_OFFSETS||e===Cr.METER_OFFSETS?o=t:o=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Ho.WEB_MERCATOR:(e===Cr.LNGLAT||e===Cr.CARTESIAN)&&(o=[0,0,0],c=!1);break;case Ho.WEB_MERCATOR_AUTO_OFFSET:e===Cr.LNGLAT?r=o:e===Cr.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],o=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Ho.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case Ho.GLOBE:c=!1,o=null;break;default:c=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:c}}function v6(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:o}=i;let{viewMatrix:c,viewProjectionMatrix:f}=i,a=pb,w=pb,P=i.cameraPosition;const{geospatialOrigin:k,shaderCoordinateOrigin:F,offsetMode:V}=h3(i,e,t);return V&&(w=i.projectPosition(k||F),P=[P[0]-w[0],P[1]-w[1],P[2]-w[2]],w[3]=1,a=df([],w,f),c=r||c,f=Nu([],o,c),f=Nu([],f,_6)),{viewMatrix:c,viewProjectionMatrix:f,projectionCenter:a,originCommon:w,cameraPosCommon:P,shaderCoordinateOrigin:F,geospatialOrigin:k}}function x6({viewport:i,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=Cr.DEFAULT,coordinateOrigin:o=u3,autoWrapLongitude:c=!1}){r===Cr.DEFAULT&&(r=i.isGeospatial?Cr.LNGLAT:Cr.CARTESIAN);const f=b6({viewport:i,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:o});return f.wrapLongitude=c,f.modelMatrix=t||c3,f}function w6({viewport:i,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:c,originCommon:f,cameraPosCommon:a,shaderCoordinateOrigin:w,geospatialOrigin:P}=v6(i,t,r),k=i.getDistanceScales(),F=[i.width*e,i.height*e],V=df([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,W={coordinateSystem:t,projectionMode:i.projectionMode,coordinateOrigin:w,commonOrigin:f.slice(0,3),center:o,pseudoMeters:!!i._pseudoMeters,viewportSize:F,devicePixelRatio:e,focalDistance:V,commonUnitsPerMeter:k.unitsPerMeter,commonUnitsPerWorldUnit:k.unitsPerMeter,commonUnitsPerWorldUnit2:y6,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:c,modelMatrix:c3,cameraPosition:a};if(P){const ee=i.getDistanceScales(P);switch(t){case Cr.METER_OFFSETS:W.commonUnitsPerWorldUnit=ee.unitsPerMeter,W.commonUnitsPerWorldUnit2=ee.unitsPerMeter2;break;case Cr.LNGLAT:case Cr.LNGLAT_OFFSETS:i._pseudoMeters||(W.commonUnitsPerMeter=ee.unitsPerMeter),W.commonUnitsPerWorldUnit=ee.unitsPerDegree,W.commonUnitsPerWorldUnit2=ee.unitsPerDegree2;break;case Cr.CARTESIAN:W.commonUnitsPerWorldUnit=[1,1,ee.unitsPerMeter[2]],W.commonUnitsPerWorldUnit2=[0,0,ee.unitsPerMeter2[2]];break}}return W}const T6=Object.keys(Cr).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${Cr[i]};`).join(""),S6=Object.keys(Ho).map(i=>`const PROJECTION_MODE_${i}: i32 = ${Ho[i]};`).join(""),E6=Object.keys(La).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${La[i]};`).join(""),C6=`${T6}
${S6}
${E6}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,I6=`${C6}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zâaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,P6=Object.keys(Cr).map(i=>`const int COORDINATE_SYSTEM_${i} = ${Cr[i]};`).join(""),M6=Object.keys(Ho).map(i=>`const int PROJECTION_MODE_${i} = ${Ho[i]};`).join(""),R6=Object.keys(La).map(i=>`const int UNIT_${i.toUpperCase()} = ${La[i]};`).join(""),k6=`${P6}
${M6}
${R6}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,D6={};function B6(i=D6){return"viewport"in i?x6(i):{}}const O6={name:"project",dependencies:[Ck,Wk],source:I6,vs:k6,getUniforms:B6,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},L6=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,F6=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,pf={name:"project32",dependencies:[O6],source:L6,vs:F6};function N6(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Gh(i,e){const t=df([],e,i);return L_(t,t,1/t[3]),t}function yU(i,e){const t=i%e;return t<0?e+t:t}function Fm(i,e,t){return i<e?e:i>t?t:i}function z6(i){return Math.log(i)*Math.LOG2E}const f3=Math.log2||z6;function $l(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Da=Math.PI,A3=Da/4,Zo=Da/180,Nm=180/Da,nf=512,kp=4003e4,zm=85.051129,U6=1.5;function j6(i){return f3(i)}function sf(i){const[e,t]=i;$l(Number.isFinite(e)),$l(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Zo,o=t*Zo,c=nf*(r+Da)/(2*Da),f=nf*(Da+Math.log(Math.tan(A3+o*.5)))/(2*Da);return[c,f]}function f0(i){const[e,t]=i,r=e/nf*(2*Da)-Da,o=2*(Math.atan(Math.exp(t/nf*(2*Da)-Da))-A3);return[r*Nm,o*Nm]}function V6(i){const{latitude:e}=i;$l(Number.isFinite(e));const t=Math.cos(e*Zo);return j6(kp*t)-9}function Hg(i){const e=Math.cos(i*Zo);return nf/kp/e}function Um(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;$l(Number.isFinite(e)&&Number.isFinite(t));const o=nf,c=Math.cos(e*Zo),f=o/360,a=f/c,w=o/kp/c,P={unitsPerMeter:[w,w,w],metersPerUnit:[1/w,1/w,1/w],unitsPerDegree:[f,a,w],degreesPerUnit:[1/f,1/a,1/w]};if(r){const k=Zo*Math.tan(e*Zo)/c,F=f*k/2,V=o/kp*k,W=V/a*w;P.unitsPerDegree2=[0,F,V],P.unitsPerMeter2=[W,0,W]}return P}function d3(i,e){const[t,r,o]=i,[c,f,a]=e,{unitsPerMeter:w,unitsPerMeter2:P}=Um({longitude:t,latitude:r,highPrecision:!0}),k=sf(i);k[0]+=c*(w[0]+P[0]*f),k[1]+=f*(w[1]+P[1]*f);const F=f0(k),V=(o||0)+(a||0);return Number.isFinite(o)||Number.isFinite(a)?[F[0],F[1],V]:F}function W6(i){const{height:e,pitch:t,bearing:r,altitude:o,scale:c,center:f}=i,a=N6();Rp(a,a,[0,0,-o]),Hw(a,a,-t*Zo),$w(a,a,r*Zo);const w=c/e;return O_(a,a,[w,w,w]),f&&Rp(a,a,mR([],f)),a}function H6(i){const{width:e,height:t,altitude:r,pitch:o=0,offset:c,center:f,scale:a,nearZMultiplier:w=1,farZMultiplier:P=1}=i;let{fovy:k=UA(U6)}=i;r!==void 0&&(k=UA(r));const F=k*Zo,V=o*Zo,W=z_(k);let ee=W;f&&(ee+=f[2]*a/Math.cos(V)/t);const he=F*(.5+(c?c[1]:0)/t),Ie=Math.sin(he)*ee/Math.sin(Fm(Math.PI/2-V-he,.01,Math.PI-.01)),Ee=Math.sin(V)*Ie+ee,Ne=ee*10,Ce=Math.min(Ee*P,Ne);return{fov:F,aspect:e/t,focalDistance:W,near:w,far:Ce}}function UA(i){return 2*Math.atan(.5/i)*Nm}function z_(i){return .5/Math.tan(.5*i*Zo)}function p3(i,e){const[t,r,o=0]=i;return $l(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(o)),Gh(e,[t,r,o,1])}function g3(i,e,t=0){const[r,o,c]=i;if($l(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(c))return Gh(e,[r,o,c,1]);const f=Gh(e,[r,o,0,1]),a=Gh(e,[r,o,1,1]),w=f[2],P=a[2],k=w===P?0:((t||0)-w)/(P-w);return Bw([],f,a,k)}function $6(i){const{width:e,height:t,bounds:r,minExtent:o=0,maxZoom:c=24,offset:f=[0,0]}=i,[[a,w],[P,k]]=r,F=Z6(i.padding),V=sf([a,Fm(k,-85.051129,zm)]),W=sf([P,Fm(w,-85.051129,zm)]),ee=[Math.max(Math.abs(W[0]-V[0]),o),Math.max(Math.abs(W[1]-V[1]),o)],he=[e-F.left-F.right-Math.abs(f[0])*2,t-F.top-F.bottom-Math.abs(f[1])*2];$l(he[0]>0&&he[1]>0);const Ie=he[0]/ee[0],Ee=he[1]/ee[1],Ne=(F.right-F.left)/2/Ie,Ce=(F.top-F.bottom)/2/Ee,De=[(W[0]+V[0])/2+Ne,(W[1]+V[1])/2+Ce],Ye=f0(De),Ke=Math.min(c,f3(Math.abs(Math.min(Ie,Ee))));return $l(Number.isFinite(Ke)),{longitude:Ye[0],latitude:Ye[1],zoom:Ke}}function Z6(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:($l(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const gb=Math.PI/180;function q6(i,e=0){const{width:t,height:r,unproject:o}=i,c={targetZ:e},f=o([0,r],c),a=o([t,r],c);let w,P;const k=i.fovy?.5*i.fovy*gb:Math.atan(.5/i.altitude),F=(90-i.pitch)*gb;return k>F-.01?(w=mb(i,0,e),P=mb(i,t,e)):(w=o([0,0],c),P=o([t,0],c)),[f,a,P,w]}function mb(i,e,t){const{pixelUnprojectionMatrix:r}=i,o=Gh(r,[e,0,1,1]),c=Gh(r,[e,i.height,1,1]),a=(t*i.distanceScales.unitsPerMeter[2]-o[2])/(c[2]-o[2]),w=Bw([],o,c,a),P=f0(w);return P.push(t),P}const gf={...sb,defaultUniforms:{...sb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};class X6{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:o,padding:c=0,copy:f=!1,initialize:a=!1,maxCount:w}){const P=o||e&&e.constructor||Float32Array,k=t*r+c;if(ArrayBuffer.isView(e)){if(k<=e.length)return e;if(k*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new P(e.buffer,0,k)}let F=1/0;w&&(F=w*r+c);const V=this._allocate(P,k,a,F);return e&&f?V.set(e):a||V.fill(0,0,4),this._release(e),V}release(e){this._release(e)}_allocate(e,t,r,o){let c=Math.max(Math.ceil(t*this.opts.overAlloc),1);c>o&&(c=o);const f=this._pool,a=e.BYTES_PER_ELEMENT*c,w=f.findIndex(P=>P.byteLength>=a);if(w>=0){const P=new e(f.splice(w,1)[0],0,c);return r&&P.fill(0),P}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:o}=r,c=t.findIndex(f=>f.byteLength>=o);c<0?t.push(r):(c>0||t.length<this.opts.poolSize)&&t.splice(c,0,r),t.length>this.opts.poolSize&&t.shift()}}const jA=new X6;function _A(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bU(i,e){const t=i%e;return t<0?e+t:t}function G6(i){return[i[12],i[13],i[14]]}function Y6(i){return{left:Fh(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:Fh(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:Fh(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:Fh(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:Fh(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:Fh(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const _b=new wi;function Fh(i,e,t,r){_b.set(i,e,t);const o=_b.len();return{distance:r/o,normal:new wi(-i/o,-e/o,-t/o)}}function Q6(i){return i-Math.fround(i)}let sA;function $g(i,e){const{size:t=1,startIndex:r=0}=e,o=e.endIndex!==void 0?e.endIndex:i.length,c=(o-r)/t;sA=jA.allocate(sA,c,{type:Float32Array,size:t*2});let f=r,a=0;for(;f<o;){for(let w=0;w<t;w++){const P=i[f++];sA[a+w]=P,sA[a+w+t]=Q6(P)}a+=t*2}return sA.subarray(0,c*t*2)}function K6(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const J6=Math.PI/180,eD=_A(),yb=[0,0,0],tD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function iD({width:i,height:e,orthographic:t,fovyRadians:r,focalDistance:o,padding:c,near:f,far:a}){const w=i/e,P=t?new Eo().orthographic({fovy:r,aspect:w,focalDistance:o,near:f,far:a}):new Eo().perspective({fovy:r,aspect:w,near:f,far:a});if(c){const{left:k=0,right:F=0,top:V=0,bottom:W=0}=c,ee=Mp((k+i-F)/2,0,i)-i/2,he=Mp((V+e-W)/2,0,e)-e/2;P[8]-=ee*2/i,P[9]+=he*2/e}return P}class rd{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||tD,this.focalDistance=e.focalDistance||1,this.position=e.position||yb,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ho.WEB_MERCATOR:Ho.WEB_MERCATOR_AUTO_OFFSET:Ho.IDENTITY}equals(e){return e instanceof rd?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Uc(e.projectionMatrix,this.projectionMatrix)&&Uc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),o=p3(r,this.pixelProjectionMatrix),[c,f]=o,a=t?f:this.height-f;return e.length===2?[c,a]:[c,a,o[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[o,c,f]=e,a=t?c:this.height-c,w=r&&r*this.distanceScales.unitsPerMeter[2],P=g3([o,a,f],this.pixelUnprojectionMatrix,w),[k,F,V]=this.unprojectPosition(P);return Number.isFinite(f)?[k,F,V]:Number.isFinite(r)?[k,F,r]:[k,F]}projectPosition(e){const[t,r]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,o]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,o]}projectFlat(e){if(this.isGeospatial){const t=sf(e);return t[1]=Mp(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?f0(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),o=this.unproject([this.width,0],t),c=this.unproject([0,this.height],t),f=this.unproject([this.width,this.height],t);return[Math.min(r[0],o[0],c[0],f[0]),Math.min(r[1],o[1],c[1],f[1]),Math.max(r[0],o[0],c[0],f[0]),Math.max(r[1],o[1],c[1],f[1])]}getDistanceScales(e){return e&&this.isGeospatial?Um({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:o=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Y6(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=V6({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Um({latitude:r,longitude:t}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:c,modelMatrix:f}=e;let a=yb;if(c&&(a=f?new Eo(f).transformAsVector(c,[]):c),this.isGeospatial){const w=this.projectPosition([t,r,0]);this.center=new wi(a).scale(this.distanceScales.unitsPerMeter).add(w)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=eD,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:c,fovy:f=75,near:a=.1,far:w=1e3,padding:P=null,focalDistance:k=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Eo().multiplyRight(t).translate(new wi(this.center).negate()),this.projectionMatrix=r||iD({width:this.width,height:this.height,orthographic:o,fovyRadians:c||f*J6,focalDistance:k,padding:P,near:a,far:w});const F=_A();Nu(F,F,this.projectionMatrix),Nu(F,F,this.viewMatrix),this.viewProjectionMatrix=F,this.viewMatrixInverse=Om([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=G6(this.viewMatrixInverse);const V=_A(),W=_A();O_(V,V,[this.width/2,-this.height/2,1]),Rp(V,V,[1,-1,0]),Nu(W,V,this.viewProjectionMatrix),this.pixelProjectionMatrix=W,this.pixelUnprojectionMatrix=Om(_A(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||rn.warn("Pixel project matrix not invertible")()}}rd.displayName="Viewport";class Hu extends rd{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:o=0,pitch:c=0,bearing:f=0,nearZMultiplier:a=.1,farZMultiplier:w=1.01,nearZ:P,farZ:k,orthographic:F=!1,projectionMatrix:V,repeat:W=!1,worldOffset:ee=0,position:he,padding:Ie,legacyMeterSizes:Ee=!1}=e;let{width:Ne,height:Ce,altitude:De=1.5}=e;const Ye=Math.pow(2,o);Ne=Ne||1,Ce=Ce||1;let Ke,kt=null;if(V)De=V[5]/2,Ke=UA(De);else{e.fovy?(Ke=e.fovy,De=z_(Ke)):Ke=UA(De);let jt;if(Ie){const{top:Lt=0,bottom:Mt=0}=Ie;jt=[0,Mp((Lt+Ce-Mt)/2,0,Ce)-Ce/2]}kt=H6({width:Ne,height:Ce,scale:Ye,center:he&&[0,0,he[2]*Hg(t)],offset:jt,pitch:c,fovy:Ke,nearZMultiplier:a,farZMultiplier:w}),Number.isFinite(P)&&(kt.near=P),Number.isFinite(k)&&(kt.far=k)}let It=W6({height:Ce,pitch:c,bearing:f,scale:Ye,altitude:De});ee&&(It=new Eo().translate([512*ee,0,0]).multiplyLeft(It)),super({...e,width:Ne,height:Ce,viewMatrix:It,longitude:r,latitude:t,zoom:o,...kt,fovy:Ke,focalDistance:De}),this.latitude=t,this.longitude=r,this.zoom=o,this.pitch=c,this.bearing=f,this.altitude=De,this.fovy=Ke,this.orthographic=F,this._subViewports=W?[]:null,this._pseudoMeters=Ee,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let o=t;o<=r;o++){const c=o?new Hu({...this,worldOffset:o}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),o=(e[2]||0)*Hg(e[1]);return[t,r,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),o=(e[2]||0)/Hg(r);return[t,r,o]}addMetersToLngLat(e,t){return d3(e,t)}panByPosition(e,t){const r=g3(t,this.pixelUnprojectionMatrix),o=this.projectFlat(e),c=Q1([],o,lR([],r)),f=Q1([],this.center,c),[a,w]=this.unprojectFlat(f);return{longitude:a,latitude:w}}getBounds(e={}){const t=q6(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:o}=this,{longitude:c,latitude:f,zoom:a}=$6({width:r,height:o,bounds:e,...t});return new Hu({width:r,height:o,longitude:c,latitude:f,zoom:a})}}Hu.displayName="WebMercatorViewport";const bb=[0,0,0];function Zg(i,e,t=!1){const r=e.projectPosition(i);if(t&&e instanceof Hu){const[o,c,f=0]=i,a=e.getDistanceScales([o,c]);r[2]=f*a.unitsPerMeter[2]}return r}function rD(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:o,fromCoordinateSystem:c,fromCoordinateOrigin:f}=i;return o===Cr.DEFAULT&&(o=e.isGeospatial?Cr.LNGLAT:Cr.CARTESIAN),c===void 0&&(c=o),f===void 0&&(f=r),{viewport:e,coordinateSystem:o,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:c,fromCoordinateOrigin:f}}function m3(i,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:o,offsetMode:c}){let[f,a,w=0]=i;switch(t&&([f,a,w]=df([],[f,a,w,1],t)),r){case Cr.LNGLAT:return Zg([f,a,w],e,c);case Cr.LNGLAT_OFFSETS:return Zg([f+o[0],a+o[1],w+(o[2]||0)],e,c);case Cr.METER_OFFSETS:return Zg(d3(o,[f,a,w]),e,c);case Cr.CARTESIAN:default:return e.isGeospatial?[f+o[0],a+o[1],w+o[2]]:e.projectPosition([f,a,w])}}function nD(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:o,modelMatrix:c,fromCoordinateSystem:f,fromCoordinateOrigin:a}=rD(e),{autoOffset:w=!0}=e,{geospatialOrigin:P=bb,shaderCoordinateOrigin:k=bb,offsetMode:F=!1}=w?h3(t,r,o):{},V=m3(i,{viewport:t,modelMatrix:c,coordinateSystem:f,coordinateOrigin:a,offsetMode:F});if(F){const W=t.projectPosition(P||k);jw(V,V,W)}return V}const qg={};function A0(i="id"){qg[i]=qg[i]||1;const e=qg[i]++;return`${i}-${e}`}class vb{constructor(e){de(this,"id");de(this,"userData",{});de(this,"topology");de(this,"bufferLayout",[]);de(this,"vertexCount");de(this,"indices");de(this,"attributes");if(this.id=e.id||A0("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&tn.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function sD(i,e){if(e instanceof vb)return e;const t=oD(i,e),{attributes:r,bufferLayout:o}=aD(i,e);return new vb({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:t,attributes:r})}function oD(i,e){if(!e.indices)return;const t=e.indices.value;return i.createBuffer({usage:tn.INDEX,data:t})}function aD(i,e){const t=[],r={};for(const[c,f]of Object.entries(e.attributes)){let a=c;switch(c){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(f){r[a]=i.createBuffer({data:f.value,id:`${c}-buffer`});const{value:w,size:P,normalized:k}=f;t.push({name:a,format:w4(w,P,k)})}}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:o}}const o0=class o0{constructor(e){de(this,"device");de(this,"destroyPolicy");de(this,"_hashCounter",0);de(this,"_hashes",{});de(this,"_renderPipelineCache",{});de(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new o0(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...ef.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const o=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});o.hash=r,this._renderPipelineCache[r]={pipeline:o,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...wp.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const o=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});o.hash=r,this._computePipelineCache[r]={pipeline:o,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof wp?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,o="-",c=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${o}BL${c}`;default:const f=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${o}T${e.topology}P${f}BL${c}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};de(o0,"defaultProps",{...ef.defaultProps});let jm=o0;const a0=class a0{constructor(e){de(this,"device");de(this,"destroyPolicy");de(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new a0(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:o,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};de(a0,"defaultProps",{...bp.defaultProps});let Vm=a0;function lD(i,e){var o;const t={},r="Values";if(i.attributes.length===0&&!((o=i.varyings)!=null&&o.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const c of i.attributes)if(c){const f=`${c.location} ${c.name}: ${c.type}`;t[`in ${f}`]={[r]:c.stepMode||"vertex"}}for(const c of i.varyings||[]){const f=`${c.location} ${c.name}`;t[`out ${f}`]={[r]:JSON.stringify(c)}}return t}let ps=null,Mu=null;function cD(i,{id:e,minimap:t,opaque:r,top:o="0",left:c="0",rgbaScale:f=1}){ps||(ps=document.createElement("canvas"),ps.id=e,ps.title=e,ps.style.zIndex="100",ps.style.position="absolute",ps.style.top=o,ps.style.left=c,ps.style.border="blue 5px solid",ps.style.transform="scaleY(-1)",document.body.appendChild(ps),Mu=ps.getContext("2d")),(ps.width!==i.width||ps.height!==i.height)&&(ps.width=i.width/2,ps.height=i.height/2,ps.style.width="400px",ps.style.height="400px");const a=i.device.readPixelsToArrayWebGL(i),w=Mu==null?void 0:Mu.createImageData(i.width,i.height);if(w){for(let k=0;k<a.length;k+=4)w.data[0+k+0]=a[k+0]*f,w.data[0+k+1]=a[k+1]*f,w.data[0+k+2]=a[k+2]*f,w.data[0+k+3]=r?255:a[k+3]*f;Mu==null||Mu.putImageData(w,0,0)}}function Wm(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Wm(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),o=Object.keys(e);if(r.length!==o.length)return!1;for(const c of r)if(!e.hasOwnProperty(c)||!Wm(i[c],e[c],t-1))return!1;return!0}return!1}function uD(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function hD(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function _3(i){return uD(i)||hD(i)}function fD(i){return _3(i)||typeof i=="number"||typeof i=="boolean"}function y3(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const r=i[t];fD(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class AD{constructor(e,t){de(this,"options",{disableWarnings:!1});de(this,"modules");de(this,"moduleUniforms");de(this,"moduleBindings");Object.assign(this.options,t);const r=v_(Object.values(e).filter(o=>o.dependencies));for(const o of r)e[o.name]=o;ci.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[o,c]of Object.entries(e))this._addModule(c),c.name&&o!==c.name&&!this.options.disableWarnings&&ci.warn(`Module name: ${o} vs ${c.name}`)()}destroy(){}setProps(e){var t;for(const r of Object.keys(e)){const o=r,c=e[o]||{},f=this.modules[o];if(!f){this.options.disableWarnings||ci.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[o],w=this.moduleBindings[o],P=((t=f.getUniforms)==null?void 0:t.call(f,c,a))||c,{uniforms:k,bindings:F}=y3(P);this.moduleUniforms[o]={...a,...k},this.moduleBindings[o]={...w,...F}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[r,o]of Object.entries(this.moduleUniforms))for(const[c,f]of Object.entries(o))e[`${r}.${c}`]={type:(t=this.modules[r].uniformTypes)==null?void 0:t[c],value:String(f)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let dD="";async function pD(i,e){const t=new Image;return t.crossOrigin="anonymous",t.src=i.startsWith("http")?i:dD+i,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Xg{constructor(e,t){de(this,"device");de(this,"id");de(this,"texture");de(this,"sampler");de(this,"view");de(this,"ready");de(this,"isReady",!1);de(this,"destroyed",!1);de(this,"resolveReady",()=>{});de(this,"rejectReady",()=>{});this.device=e,this.id=t.id||A0("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:pD(t.data)}),this.ready=new Promise((r,o)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=o}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let r;try{r=await b3(t)}catch(c){this.rejectReady(c)}if(this.destroyed)return;const o={...e,data:r};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function b3(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(b3));if(i&&typeof i=="object"&&i.constructor===Object){const e=i,t=await Promise.all(Object.values(e)),r=Object.keys(e),o={};for(let c=0;c<r.length;c++)o[r[c]]=t[c];return o}return i}const Ru=2,gD=1e4,l0=class l0{constructor(e,t){de(this,"device");de(this,"id");de(this,"source");de(this,"vs");de(this,"fs");de(this,"pipelineFactory");de(this,"shaderFactory");de(this,"userData",{});de(this,"parameters");de(this,"topology");de(this,"bufferLayout");de(this,"isInstanced");de(this,"instanceCount",0);de(this,"vertexCount");de(this,"indexBuffer",null);de(this,"bufferAttributes",{});de(this,"constantAttributes",{});de(this,"bindings",{});de(this,"uniforms",{});de(this,"vertexArray");de(this,"transformFeedback",null);de(this,"pipeline");de(this,"shaderInputs");de(this,"_uniformStore");de(this,"_attributeInfos",{});de(this,"_gpuGeometry",null);de(this,"_getModuleUniforms");de(this,"props");de(this,"_pipelineNeedsUpdate","newly created");de(this,"_needsRedraw","initializing");de(this,"_destroyed",!1);de(this,"_lastDrawTimestamp",-1);de(this,"_lastLogTime",0);de(this,"_logOpen",!1);de(this,"_drawCount",0);var w,P,k,F;this.props={...l0.defaultProps,...t},t=this.props,this.id=t.id||A0("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(((w=this.props.modules)==null?void 0:w.map(V=>[V.name,V]))||[]),o=t.shaderInputs||new AD(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(o);const c=_D(e),f=(((P=this.props.modules)==null?void 0:P.length)>0?this.props.modules:(k=this.shaderInputs)==null?void 0:k.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:V,getUniforms:W}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:f});this.source=V,this._getModuleUniforms=W,(F=this.props).shaderLayout||(F.shaderLayout=J4(this.source))}else{const{vs:V,fs:W,getUniforms:ee}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:f});this.vs=V,this.fs=W,this._getModuleUniforms=ee}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||jm.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Vm.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ci.info(Ru,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const o=this._getBindings();this.pipeline.setBindings(o,{disableWarnings:this.props.disableWarnings}),Hm(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:c}=this.vertexArray,f=c?c.byteLength/(c.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:f,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const t=e&&sD(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const o=new Bg(this.bufferLayout);this.bufferLayout=o.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Bg(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Wm(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new x4(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(mD(r)){const o=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=o}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ci.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=T4(this.pipeline.shaderLayout,this.bufferLayout);const o=new Bg(this.bufferLayout);for(const[c,f]of Object.entries(e)){const a=o.getBufferLayout(c);if(!a){r||ci.warn(`Model(${this.id}): Missing layout for buffer "${c}".`)();continue}const w=o.getAttributeNamesForBuffer(a);let P=!1;for(const k of w){const F=this._attributeInfos[k];if(F){const V=this.device.type==="webgpu"?o.getBufferIndex(F.bufferName):F.location;this.vertexArray.setBuffer(V,f),P=!0}}!P&&!r&&ci.warn(`Model(${this.id}): Ignoring buffer "${f.id}" for unknown attribute "${c}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,o]of Object.entries(e)){const c=this._attributeInfos[r];c?this.vertexArray.setConstantWebGL(c.location,o):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ci.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Hm(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=y3(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Xg&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof Xg?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof yp?e=Math.max(e,t.texture.updateTimestamp):t instanceof tn||t instanceof vn?e=Math.max(e,t.updateTimestamp):t instanceof Xg?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof vp||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(o=>o.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ci.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let o=null;this.source?o=r:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:o}),this._attributeInfos=lw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ci.level>3?0:gD;ci.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ci.group(Ru,`>>> DRAWING MODEL ${this.id}`,{collapsed:ci.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=lD(this.pipeline.shaderLayout,this.id);ci.table(Ru,e)();const t=this.shaderInputs.getDebugTable();for(const[o,c]of Object.entries(this.uniforms))t[o]={value:c};ci.table(Ru,t)();const r=this._getAttributeDebugTable();ci.table(Ru,this._attributeInfos)(),ci.table(Ru,r)(),ci.groupEnd(Ru)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&cD(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const o=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:o?this._getBufferOrConstantValues(o,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=hw(t);return(e instanceof tn?new r(e.debugData):e).toString()}};de(l0,"defaultProps",{...ef.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:wm.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Co=l0;function mD(i){return!!(i.uniformTypes&&!Hm(i.uniformTypes))}function _D(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function Hm(i){for(const e in i)return!1;return!0}const OA=class OA{constructor(e,t=OA.defaultProps){de(this,"device");de(this,"model");de(this,"transformFeedback");if(!OA.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Co(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||PM(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof tn)return t.readAsync();const{buffer:r,byteOffset:o=0,byteLength:c=r.byteLength}=t;return r.readAsync(o,c)}};de(OA,"defaultProps",{...Co.defaultProps,outputs:void 0,feedbackBuffers:void 0});let VA=OA;class $u{constructor(e){de(this,"id");de(this,"topology");de(this,"vertexCount");de(this,"indices");de(this,"attributes");de(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:o=null}=e;this.id=e.id||A0("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[c,f]of Object.entries(t)){const a=ArrayBuffer.isView(f)?{value:f}:f;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(c)}: must be typed array or object with value as typed array`);if((c==="POSITION"||c==="positions")&&!a.size&&(a.size=3),c==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[c]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const o of Object.values(e)){const{value:c,size:f,constant:a}=o;!a&&c&&f!==void 0&&f>=1&&(r=Math.min(r,c.length/f))}return r}}const yD={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Dp=Symbol.for("component"),jc=Symbol.for("propTypes"),Gg=Symbol.for("deprecatedProps"),Yh=Symbol.for("asyncPropDefaults"),Zu=Symbol.for("asyncPropOriginal"),Fc=Symbol.for("asyncPropResolved");function v3(i,e=()=>!0){return Array.isArray(i)?x3(i,e,[]):e(i)?[i]:[]}function x3(i,e,t){let r=-1;for(;++r<i.length;){const o=i[r];Array.isArray(o)?x3(o,e,t):e(o)&&t.push(o)}return t}function bD({target:i,source:e,start:t=0,count:r=1}){const o=e.length,c=r*o;let f=0;for(let a=t;f<o;f++)i[a++]=e[f];for(;f<c;)f<c-f?(i.copyWithin(t+f,t,t+f),f*=2):(i.copyWithin(t+f,t,t+c-f),f=c);return i}function Ou(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ou(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),o=Object.keys(e);if(r.length!==o.length)return!1;for(const c of r)if(!e.hasOwnProperty(c)||!Ou(i[c],e[c],t-1))return!1;return!0}return!1}class U_{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(t=this.settings).onStart)==null||r.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:o}=this;this._handle=r.addChannel({delay:r.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}function Vl(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}var jh;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(jh||(jh={}));const j_={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},zn=(i,e,t)=>e?i.enable(t):i.disable(t),xb=(i,e,t)=>i.hint(t,e),wo=(i,e,t)=>i.pixelStorei(t,e),wb=(i,e,t)=>{const r=t===36006?36009:36008;return i.bindFramebuffer(r,e)},oA=(i,e,t)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];i.bindBuffer(o,e)};function Yg(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const vD={3042:zn,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:zn,2885:(i,e)=>i.cullFace(e),2929:zn,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:zn,35723:xb,35725:(i,e)=>i.useProgram(e),36007:(i,e)=>i.bindRenderbuffer(36161,e),36389:(i,e)=>{var t;return(t=i.bindTransformFeedback)==null?void 0:t.call(i,36386,e)},34229:(i,e)=>i.bindVertexArray(e),36006:wb,36010:wb,34964:oA,36662:oA,36663:oA,35053:oA,35055:oA,2886:(i,e)=>i.frontFace(e),33170:xb,2849:(i,e)=>i.lineWidth(e),32823:zn,32824:"polygonOffset",10752:"polygonOffset",35977:zn,32926:zn,32928:zn,32938:"sampleCoverage",32939:"sampleCoverage",3089:zn,3088:(i,e)=>i.scissor(...e),2960:zn,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),34383:zn,10754:zn,12288:zn,12289:zn,12290:zn,12291:zn,12292:zn,12293:zn,12294:zn,12295:zn,3333:wo,3317:wo,37440:wo,37441:wo,37443:wo,3330:wo,3332:wo,3331:wo,3314:wo,32878:wo,3316:wo,3315:wo,32877:wo,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{const t=typeof e=="number"?[e,e]:e;i.blendEquationSeparate(...t)},blendFunc:(i,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;i.blendFuncSeparate(...t)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(e[0],e[1]||!1),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=Yg(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=Yg(e)&&e.length===3?[...e,...e]:e;const[t,r,o,c,f,a]=e;i.stencilFuncSeparate(1028,t,r,o),i.stencilFuncSeparate(1029,c,f,a)},stencilOp:(i,e)=>{e=Yg(e)&&e.length===3?[...e,...e]:e;const[t,r,o,c,f,a]=e;i.stencilOpSeparate(1028,t,r,o),i.stencilOpSeparate(1029,c,f,a)},viewport:(i,e)=>i.viewport(...e)};function bn(i,e,t){return e[i]!==void 0?e[i]:t[i]}const xD={blendEquation:(i,e,t)=>i.blendEquationSeparate(bn(32777,e,t),bn(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(bn(32969,e,t),bn(32968,e,t),bn(32971,e,t),bn(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(bn(32824,e,t),bn(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(bn(32938,e,t),bn(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,bn(2962,e,t),bn(2967,e,t),bn(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,bn(34816,e,t),bn(36003,e,t),bn(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,bn(2964,e,t),bn(2965,e,t),bn(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,bn(34817,e,t),bn(34818,e,t),bn(34819,e,t))},Tb={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),useProgram:(i,e)=>i({35725:e}),bindRenderbuffer:(i,e,t)=>i({36007:t}),bindTransformFeedback:(i,e,t)=>i({36389:t}),bindVertexArray:(i,e)=>i({34229:e}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},bindBuffer:(i,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?i({[r]:t}):{valueChanged:!0}},blendColor:(i,e,t,r,o)=>i({32773:new Float32Array([e,t,r,o])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,r,o)=>i({32969:e,32968:t,32971:r,32970:o}),clearColor:(i,e,t,r,o)=>i({3106:new Float32Array([e,t,r,o])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,r,o)=>i({3107:[e,t,r,o]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,r,o)=>i({3088:new Int32Array([e,t,r,o])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(i,e,t,r,o)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:o}),stencilOp:(i,e,t,r)=>i({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(i,e,t,r,o)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:o}),viewport:(i,e,t,r,o)=>i({2978:[e,t,r,o]})},ul=(i,e)=>i.isEnabled(e),Sb={3042:ul,2884:ul,2929:ul,3024:ul,32823:ul,32926:ul,32928:ul,3089:ul,2960:ul,35977:ul},wD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function mf(i,e){if(SD(e))return;const t={};for(const o in e){const c=Number(o),f=vD[o];f&&(typeof f=="string"?t[f]=!0:f(i,e[o],c))}const r=i.state&&i.state.cache;if(r)for(const o in t){const c=xD[o];c(i,e,r)}}function w3(i,e=j_){if(typeof e=="number"){const o=e,c=Sb[o];return c?c(i,o):i.getParameter(o)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const o of t){const c=Sb[o];r[o]=c?c(i,Number(o)):i.getParameter(Number(o))}return r}function TD(i){mf(i,j_)}function SD(i){for(const e in i)return!1;return!0}function ED(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&i.length===e.length){for(let o=0;o<i.length;++o)if(i[o]!==e[o])return!1;return!0}return!1}class zu{constructor(e,t){de(this,"gl");de(this,"program",null);de(this,"stateStack",[]);de(this,"enable",!0);de(this,"cache",null);de(this,"log");de(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];mf(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?w3(e):Object.assign({},j_),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,ID(e);for(const r in Tb){const o=Tb[r];CD(e,r,o)}Eb(e,"getParameter"),Eb(e,"isEnabled")}_updateCache(e){let t=!1,r;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const c in e){const f=e[c],a=this.cache[c];ED(f,a)||(t=!0,r=a,o&&!(c in o)&&(o[c]=a),this.cache[c]=f)}return{valueChanged:t,oldValue:r}}}function Eb(i,e){const t=i[e].bind(i);i[e]=function(o){if(o===void 0||wD.has(o))return t(o);const c=zu.get(i);return o in c.cache||(c.cache[o]=t(o)),c.enable?c.cache[o]:t(o)},Object.defineProperty(i[e],"name",{value:`${e}-from-cache`,configurable:!1})}function CD(i,e,t){if(!i[e])return;const r=i[e].bind(i);i[e]=function(...c){const f=zu.get(i),{valueChanged:a,oldValue:w}=t(f._updateCache,...c);return a&&r(...c),w},Object.defineProperty(i[e],"name",{value:`${e}-to-cache`,configurable:!1})}function ID(i){const e=i.useProgram.bind(i);i.useProgram=function(r){const o=zu.get(i);o.program!==r&&(e(r),o.program=r)}}function PD(i,e,t){let r="";const o={preserveDrawingBuffer:!0,...t};let c=null;if(c||(c=i.getContext("webgl2",o)),o.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!c&&!t.failIfMajorPerformanceCaveat&&(o.failIfMajorPerformanceCaveat=!1,c=i.getContext("webgl2",o),c.luma||(c.luma={}),c.luma.softwareRenderer=!0),c||(c=i.getContext("webgl",{}),c&&(c=null,r||(r="Your browser only supports WebGL1"))),!c)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:f,onContextRestored:a}=e;return i.addEventListener("webglcontextlost",w=>f(w),!1),i.addEventListener("webglcontextrestored",w=>a(w),!1),c.luma||(c.luma={}),c}function of(i,e,t){return t[e]===void 0&&(t[e]=i.getExtension(e)||null),t[e]}function MD(i,e){const t=i.getParameter(7936),r=i.getParameter(7937);of(i,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,c=i.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),f=i.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),a=c||t,w=f||r,P=i.getParameter(7938),k=T3(a,w),F=RD(a,w),V=kD(a,w);return{type:"webgl",gpu:k,gpuType:V,gpuBackend:F,vendor:a,renderer:w,version:P,shadingLanguage:"glsl",shadingLanguageVersion:300}}function T3(i,e){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(i)||/Apple/i.exec(e)?"apple":/AMD/i.exec(i)||/AMD/i.exec(e)||/ATI/i.exec(i)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e)?"software":"unknown"}function RD(i,e){return/Metal/i.exec(i)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(e)?"opengl":"unknown"}function kD(i,e){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e))return"cpu";switch(T3(i,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function S3(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const yA="WEBGL_compressed_texture_s3tc",bA="WEBGL_compressed_texture_s3tc_srgb",Vh="EXT_texture_compression_rgtc",Wh="EXT_texture_compression_bptc",DD="WEBGL_compressed_texture_etc",BD="WEBGL_compressed_texture_astc",OD="WEBGL_compressed_texture_etc1",LD="WEBGL_compressed_texture_pvrtc",FD="WEBGL_compressed_texture_atc",Cb="EXT_texture_norm16",Ib="EXT_render_snorm",ND="EXT_color_buffer_float",V_={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Ib],"norm16-renderable-webgl":[Cb],"snorm16-renderable-webgl":[Cb,Ib],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[yA,bA,Vh,Wh],"texture-compression-bc5-webgl":[Vh],"texture-compression-bc7-webgl":[Wh],"texture-compression-etc2":[DD],"texture-compression-astc":[BD],"texture-compression-etc1-webgl":[OD],"texture-compression-pvrtc-webgl":[LD],"texture-compression-atc-webgl":[FD]};function zD(i){return i in V_}function UD(i,e,t){return(V_[e]||[]).every(o=>of(i,o,t))}const W_={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:ND,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:yA},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:bA},"bc1-rgba-unorm":{gl:33777,x:yA},"bc1-rgba-unorm-srgb":{gl:35916,x:bA},"bc2-rgba-unorm":{gl:33778,x:yA},"bc2-rgba-unorm-srgb":{gl:35918,x:bA},"bc3-rgba-unorm":{gl:33779,x:yA},"bc3-rgba-unorm-srgb":{gl:35919,x:bA},"bc4-r-unorm":{gl:36283,x:Vh},"bc4-r-snorm":{gl:36284,x:Vh},"bc5-rg-unorm":{gl:36285,x:Vh},"bc5-rg-snorm":{gl:36286,x:Vh},"bc6h-rgb-ufloat":{gl:36495,x:Wh},"bc6h-rgb-float":{gl:36494,x:Wh},"bc7-rgba-unorm":{gl:36492,x:Wh},"bc7-rgba-unorm-srgb":{gl:36493,x:Wh},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function jD(i,e,t){let r=e.create;const o=W_[e.format];return(o==null?void 0:o.gl)===void 0&&(r=!1),o!=null&&o.x&&(r=r&&!!of(i,o.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function E3(i){var o;const e=W_[i],t=HD(i),r=x_(i);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||WD(r.channels,r.integer,r.normalized,t),type:r.dataType?S3(r.dataType):((o=e==null?void 0:e.types)==null?void 0:o[0])||5121,compressed:r.compressed||!1}}function VD(i){switch(x_(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function WD(i,e,t,r){if(r===6408||r===6407)return r;switch(i){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function HD(i){const e=W_[i],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${i}`);return t}const Pb={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class $D extends ZM{constructor(t,r,o){super([],o);de(this,"gl");de(this,"extensions");de(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,of(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){var r;return(r=this.disabledFeatures)!=null&&r[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),zD(t)&&UD(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(Pb),...Object.keys(V_)]}getWebGLFeature(t){const r=Pb[t];return typeof r=="string"?!!of(this.gl,r,this.extensions):!!r}}class ZD extends $M{constructor(t){super();de(this,"gl");de(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class MA extends xp{constructor(t,r){super(t,r);de(this,"device");de(this,"gl");de(this,"handle");de(this,"colorAttachments",[]);de(this,"depthStencilAttachment",null);const o=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||o?this.props.handle:this.gl.createFramebuffer(),o||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const o=this.colorAttachments[r];if(o){const c=36064+r;this._attachTextureView(c,o)}}if(this.depthStencilAttachment){const r=VD(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${XD(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:o}=this.device,{texture:c}=r,f=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(o.bindTexture(c.glTarget,c.handle),c.glTarget){case 35866:case 32879:o.framebufferTextureLayer(36160,t,c.handle,f,a);break;case 34067:const w=qD(a);o.framebufferTexture2D(36160,t,w,c.handle,f);break;case 3553:o.framebufferTexture2D(36160,t,3553,c.handle,f);break;default:throw new Error("Illegal texture type")}o.bindTexture(c.glTarget,null)}}function qD(i){return i<34069?i+34069:i}function XD(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class GD extends Tm{constructor(t,r){super(r);de(this,"device");de(this,"format","rgba8unorm");de(this,"depthStencilFormat","depth24plus");de(this,"presentationSize");de(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new MA(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}async function C3(i,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",i),new Promise((o,c)=>{r.onload=o,r.onerror=f=>c(new Error(`Unable to load script '${i}': ${f}`)),t.appendChild(r)})}const YD=1;let Wr=null,Mb=!1;const I3={debugSpectorJS:ci.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function vU(i){if(!globalThis.SPECTOR)try{await C3(i.debugSpectorJSUrl||I3.debugSpectorJSUrl)}catch(e){ci.warn(String(e))}}function QD(i){var e;if(i={...I3,...i},!i.debugSpectorJS)return null;if(!Wr&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ci.probe(YD,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;Wr=new t,globalThis.luma&&(globalThis.luma.spector=Wr)}if(!Wr)return null;if(Mb||(Mb=!0,Wr.spyCanvases(),Wr==null||Wr.onCaptureStarted.add(t=>ci.info("Spector capture started:",t)()),Wr==null||Wr.onCapture.add(t=>{ci.info("Spector capture complete:",t)(),Wr==null||Wr.getResultUI(),Wr==null||Wr.resultView.display(),Wr==null||Wr.resultView.addCapture(t)})),i.gl){const t=i.gl,r=t.device;Wr==null||Wr.startCapture(i.gl,500),t.device=r,new Promise(o=>setTimeout(o,2e3)).then(o=>{ci.info("Spector capture stopped after 2 seconds")(),Wr==null||Wr.stopCapture()})}return Wr}const KD="https://unpkg.com/webgl-debug@2.0.1/index.js";function P3(i){return i.luma=i.luma||{},i.luma}async function xU(){Af()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await C3(KD))}function JD(i,e={}){return e.debugWebGL||e.traceWebGL?tB(i,e):eB(i)}function eB(i){const e=P3(i);return e.realContext?e.realContext:i}function tB(i,e){if(!globalThis.WebGLDebugUtils)return ci.warn("webgl-debug not loaded")(),i;const t=P3(i);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...jh,...i});const r=globalThis.WebGLDebugUtils.makeDebugContext(i,iB.bind(null,e),rB.bind(null,e));for(const f in jh)!(f in r)&&typeof jh[f]=="number"&&(r[f]=jh[f]);class o{}Object.setPrototypeOf(r,Object.getPrototypeOf(i)),Object.setPrototypeOf(o,r);const c=Object.create(o);return t.realContext=i,t.debugContext=c,c.debug=!0,c}function Rb(i,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${i}(${t})`}function iB(i,e,t,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const o=globalThis.WebGLDebugUtils.glEnumToString(e),c=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),f=`${o} in gl.${t}(${c})`;ci.error(f)();debugger}function rB(i,e,t){let r="";ci.level>=1&&(r=Rb(e,t),i.traceWebGL&&ci.log(1,r)());for(const o of t)if(o===void 0){r=r||Rb(e,t);debugger}}const Qg={};function nB(i="id"){Qg[i]=Qg[i]||1;const e=Qg[i]++;return`${i}-${e}`}class RA extends tn{constructor(t,r={}){super(t,r);de(this,"device");de(this,"gl");de(this,"handle");de(this,"glTarget");de(this,"glUsage");de(this,"glIndexType",5123);de(this,"byteLength");de(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const o=typeof r=="object"?r.handle:void 0;this.handle=o||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=sB(this.props.usage),this.glUsage=oB(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,o=t.byteLength+r){const c=this.glTarget;this.gl.bindBuffer(c,this.handle),this.gl.bufferData(c,o,this.glUsage),this.gl.bufferSubData(c,r,t),this.gl.bindBuffer(c,null),this.bytesUsed=o,this.byteLength=o,this._setDebugData(t,r,o),this.trackAllocatedMemory(o)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const o=this.glTarget;return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.glUsage),this.gl.bindBuffer(o,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const o=new Uint8Array(r),c=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,o,c,r),this.gl.bindBuffer(36662,null),this._setDebugData(o,t,r),o}}function sB(i){return i&tn.INDEX?34963:i&tn.VERTEX?34962:i&tn.UNIFORM?35345:34962}function oB(i){return i&tn.INDEX||i&tn.VERTEX?35044:i&tn.UNIFORM?35048:35044}function aB(i){const e=i.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const o=r.split(":");if(o.length===2){const[F,V]=o;t.push({message:V.trim(),type:kb(F),lineNum:0,linePos:0});continue}const[c,f,a,...w]=o;let P=parseInt(a,10);isNaN(P)&&(P=0);let k=parseInt(f,10);isNaN(k)&&(k=0),t.push({message:w.join(":").trim(),type:kb(c),lineNum:P,linePos:k})}return t}function kb(i){const e=["warning","error","info"],t=i.toLowerCase();return e.includes(t)?t:"info"}class lB extends bp{constructor(t,r){super(t,r);de(this,"device");de(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?aB(t):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ci.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ci.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async c=>await new Promise(f=>setTimeout(f,c));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:o}=this.device;for(;;){if(o.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function cB(i,e,t,r){if(AB(e))return r(i);const o=i;o.pushState();try{return uB(i,e),mf(o.gl,t),r(i)}finally{o.popState()}}function uB(i,e){const t=i,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Uu("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&i.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&i.features.has("provoking-vertex-webgl")){const c=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,f=Uu("provokingVertex",e.provokingVertex,{first:36429,last:36430});c==null||c.provokingVertexWEBGL(f)}if((e.polygonMode||e.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(e.polygonMode){const c=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,f=Uu("polygonMode",e.polygonMode,{fill:6914,line:6913});c==null||c.polygonModeWEBGL(1028,f),c==null||c.polygonModeWEBGL(1029,f)}e.polygonOffsetLine&&r.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(fB("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc($m("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;r.stencilMaskSeparate(1028,o),r.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&ci.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,c=$m("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,c,0,o),r.stencilFuncSeparate(1029,c,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=Kg("stencilPassOperation",e.stencilPassOperation),c=Kg("stencilFailOperation",e.stencilFailOperation),f=Kg("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,c,f,o),r.stencilOpSeparate(1029,c,f,o)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const o=Db("blendColorOperation",e.blendColorOperation||"add"),c=Db("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(o,c);const f=Nd("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Nd("blendColorDstFactor",e.blendColorDstFactor||"zero"),w=Nd("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),P=Nd("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(f,a,w,P)}}function $m(i,e){return Uu(i,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Kg(i,e){return Uu(i,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Db(i,e){return Uu(i,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Nd(i,e){return Uu(i,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function hB(i,e){return`Illegal parameter ${e} for ${i}`}function Uu(i,e,t){if(!(e in t))throw new Error(hB(i,e));return t[e]}function fB(i,e){return e}function AB(i){let e=!0;for(const t in i){e=!1;break}return e}function M3(i){const e={};return i.addressModeU&&(e[10242]=Jg(i.addressModeU)),i.addressModeV&&(e[10243]=Jg(i.addressModeV)),i.addressModeW&&(e[32882]=Jg(i.addressModeW)),i.magFilter&&(e[10240]=Zm(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(e[10241]=dB(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(e[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(e[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(e[34892]=34894),i.compare&&(e[34893]=$m("compare",i.compare)),i.maxAnisotropy&&(e[34046]=i.maxAnisotropy),e}function Jg(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Zm(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function dB(i,e="none"){if(!e)return Zm(i);switch(e){case"none":return Zm(i);case"nearest":return i==="nearest"?9984:9986;case"linear":return i==="nearest"?9985:9987}}class qm extends vp{constructor(t,r){super(t,r);de(this,"device");de(this,"handle");de(this,"parameters");this.device=t,this.parameters=M3(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,o]of Object.entries(t)){const c=Number(r);switch(c){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,c,o);break;default:this.device.gl.samplerParameteri(this.handle,c,o);break}}}}class Hh extends yp{constructor(t,r){super(t,{...vn.defaultProps,...r});de(this,"device");de(this,"gl");de(this,"handle");de(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const pB="Failed to deduce GL constant from typed array";function gB(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(pB)}}function mB(i,e){const{clamped:t=!0}=e||{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function R3(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function _B(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Bp(i,e,t){if(yB(e))return t(i);const{nocatch:r=!0}=e,o=zu.get(i);o.push(),mf(i,e);let c;if(r)c=t(i),o.pop();else try{c=t(i)}finally{o.pop()}return c}function yB(i){for(const e in i)return!1;return!0}function bB(i,e,t){const{dimension:r,width:o,height:c,depth:f=0}=t,{glInternalFormat:a}=t,w=t.glTarget;switch(r){case"2d-array":case"3d":i.texStorage3D(w,e,a,o,c,f);break;default:i.texStorage2D(w,e,a,o,c)}}function Bb(i,e,t,r){const{width:o,height:c}=r,{dimension:f,depth:a=0,mipLevel:w=0}=r,{x:P=0,y:k=0,z:F=0}=r,{glFormat:V,glType:W}=r,ee=k3(r.glTarget,f,a),he=r.flipY?{37440:!0}:{};Bp(i,he,()=>{switch(f){case"2d-array":case"3d":i.bindTexture(ee,e),i.texSubImage3D(ee,w,P,k,F,o,c,a,V,W,t),i.bindTexture(ee,null);break;case"2d":case"cube":i.bindTexture(ee,e),i.texSubImage2D(ee,w,P,k,o,c,V,W,t),i.bindTexture(ee,null);break;default:throw new Error(f)}})}function Ob(i,e,t){const{dimension:r,width:o,height:c,depth:f=0,mipLevel:a=0,byteOffset:w=0}=t,{x:P=0,y:k=0,z:F=0}=t,{glFormat:V,glType:W,compressed:ee}=t,he=k3(t.glTarget,r,f);switch(r){case"2d-array":case"3d":ee?i.compressedTexSubImage3D(he,a,P,k,F,o,c,f,V,e,w):i.texSubImage3D(he,a,P,k,F,o,c,f,V,W,e,w);break;case"2d":case"cube":ee?i.compressedTexSubImage2D(he,a,P,k,o,c,V,e,w):i.texSubImage2D(he,a,P,k,o,c,V,W,e,w);break;default:throw new Error(r)}}function vB(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function k3(i,e,t){return e==="cube"?34069+t:i}function xB(i,e){var Ee;const{sourceX:t=0,sourceY:r=0,sourceAttachment:o=0}=e||{};let{target:c=null,sourceWidth:f,sourceHeight:a,sourceDepth:w,sourceFormat:P,sourceType:k}=e||{};const{framebuffer:F,deleteFramebuffer:V}=D3(i),{gl:W,handle:ee}=F;f||(f=F.width),a||(a=F.height);const he=(Ee=F.colorAttachments[o])==null?void 0:Ee.texture;if(!he)throw new Error(`Invalid framebuffer attachment ${o}`);w=(he==null?void 0:he.depth)||1,P||(P=(he==null?void 0:he.glFormat)||6408),k||(k=(he==null?void 0:he.glType)||5121),c=SB(c,k,P,f,a),k=k||gB(c);const Ie=W.bindFramebuffer(36160,ee);return W.readBuffer(36064+o),W.readPixels(t,r,f,a,P,k,c),W.readBuffer(36064),W.bindFramebuffer(36160,Ie||null),V&&F.destroy(),c}function wB(i,e){const{target:t,sourceX:r=0,sourceY:o=0,sourceFormat:c=6408,targetByteOffset:f=0}=e||{};let{sourceWidth:a,sourceHeight:w,sourceType:P}=e||{};const{framebuffer:k,deleteFramebuffer:F}=D3(i);a=a||k.width,w=w||k.height;const V=k;P=P||5121;let W=t;if(!W){const he=R3(c),Ie=_B(P),Ee=f+a*w*he*Ie;W=V.device.createBuffer({byteLength:Ee})}const ee=i.device.createCommandEncoder();return ee.copyTextureToBuffer({sourceTexture:i,width:a,height:w,origin:[r,o],destinationBuffer:W,byteOffset:f}),ee.destroy(),F&&k.destroy(),W}function D3(i){return i instanceof xp?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:TB(i),deleteFramebuffer:!0}}function TB(i,e){const{device:t,width:r,height:o,id:c}=i;return t.createFramebuffer({...e,id:`framebuffer-for-${c}`,width:r,height:o,colorAttachments:[i]})}function SB(i,e,t,r,o,c){if(i)return i;e||(e=5121);const f=mB(e,{clamped:!1}),a=R3(t);return new f(r*o*a)}class kA extends vn{constructor(t,r){super(t,r);de(this,"device");de(this,"gl");de(this,"handle");de(this,"sampler");de(this,"view");de(this,"mipmaps");de(this,"compressed");de(this,"glTarget");de(this,"glFormat");de(this,"glType");de(this,"glInternalFormat");de(this,"textureUnit",0);const o={...this.props};o.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=vB(this.props.dimension);const c=E3(this.props.format);this.glInternalFormat=c.internalFormat,this.glFormat=c.format,this.glType=c.type,this.compressed=c.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(o),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:o}=t;if(!r||!o){const c=vn.getTextureDataSize(t.data);r=(c==null?void 0:c.width)||1,o=(c==null?void 0:c.height)||1}if(this.width=r,this.height=o,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Hh(this.device,{...this.props,texture:this}),this.bind(),bB(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Hh(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof qm?(this.sampler=t,r=t.props):(this.sampler=new qm(this.device,t),r=t);const o=M3(r);this._setSamplerParameters(o)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ci.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(o){ci.warn(`Error generating mipmap for ${this}: ${o.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const r=vn.getExternalImageSize(t.image),o={...vn.defaultCopyExternalImageOptions,...r,...t},{image:c,depth:f,mipLevel:a,x:w,y:P,z:k,flipY:F}=o;let{width:V,height:W}=o;const{dimension:ee,glTarget:he,glFormat:Ie,glInternalFormat:Ee,glType:Ne}=this;if(V=Math.min(V,this.width-w),W=Math.min(W,this.height-P),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Bb(this.device.gl,this.handle,c,{dimension:ee,mipLevel:a,x:w,y:P,z:k,width:V,height:W,depth:f,glFormat:Ie,glType:Ne,glTarget:he,flipY:F}),{width:o.width,height:o.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();const o=vn.normalizeTextureData(t,this);o.length>1&&this.props.mipmaps!==!1&&ci.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let c=0;c<o.length;c++){const f=o[c];this._setMipLevel(r,c,f)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),Ob(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const o of vn.CubeFaces)this.setTextureCubeFaceData(t[o],o)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,o=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ci.warn(`${this.id} has mipmap and multiple LODs.`)();const c=vn.CubeFaces.indexOf(r);this.setTexture2DData(t,c)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:r,width:o,height:c,pixels:f,data:a,format:w=6408,type:P=5121}=t,{gl:k}=this,F=f||a;this.bind(),F instanceof Promise?F.then(V=>this.setImageDataForFace(Object.assign({},t,{face:r,data:V,pixels:V}))):this.width||this.height?k.texImage2D(r,0,w,o,c,0,w,P,F):k.texImage2D(r,0,w,w,P,F)}_getImageDataMap(t){for(let r=0;r<vn.CubeFaces.length;++r){const o=vn.CubeFaces[r];t[o]&&(t[34069+r]=t[o],delete t[o])}return t}_setSamplerParameters(t){ci.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,o]of Object.entries(t)){const c=Number(r),f=o;switch(c){case 33082:case 33083:this.gl.texParameterf(this.glTarget,c,f);break;case 10241:this.gl.texParameteri(this.glTarget,c,f);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,c,f);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,c,f);break;default:this.gl.texParameteri(this.glTarget,c,f);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,o,c=this.glTarget){if(vn.isExternalImage(o)){Bb(this.device.gl,this.handle,o,{...this,depth:t,mipLevel:r,glTarget:c,flipY:this.props.flipY});return}if(vn.isTextureLevelData(o)){Ob(this.device.gl,o.data,{...this,depth:t,mipLevel:r,glTarget:c});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}const EB=[1,2,4,8];class CB extends Sm{constructor(t,r){var f;super(t,r);de(this,"device");de(this,"glParameters");this.device=t;let o;if(!((f=r==null?void 0:r.parameters)!=null&&f.viewport))if(r!=null&&r.framebuffer){const{width:a,height:w}=r.framebuffer;o=[0,0,a,w]}else{const[a,w]=t.getCanvasContext().getDrawingBufferSize();o=[0,0,a,w]}this.device.pushState(),this.setParameters({viewport:o,...this.props.parameters});const c=this.props.framebuffer;if(c!=null&&c.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((w,P)=>36064+P);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=EB.map(o=>!!(o&t.colorMask))),this.glParameters=r,mf(this.device.gl,r)}beginOcclusionQuery(t){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((o,c)=>{o&&this.clearColorBuffer(c,o)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&Bp(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){Bp(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function IB(i){return PB.includes(i)}const PB=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],B3={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function O3(i){const e=B3[i];if(!e)throw new Error("uniform");const[t,r,,o]=e;return{format:o,components:r,glType:t}}function MB(i){const e=B3[i];if(!e)throw new Error("attribute");const[,t,,r,o]=e;return{attributeType:r,vertexFormat:o,components:t}}function RB(i,e){const t={attributes:[],bindings:[]};t.attributes=kB(i,e);const r=OB(i,e);for(const a of r){const w=a.uniforms.map(P=>({name:P.name,format:P.format,byteOffset:P.byteOffset,byteStride:P.byteStride,arrayLength:P.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:w})}const o=BB(i,e);let c=0;for(const a of o)if(IB(a.type)){const{viewDimension:w,sampleType:P}=FB(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:c,viewDimension:w,sampleType:P}),a.textureUnit=c,c+=1}o.length&&(t.uniforms=o);const f=DB(i,e);return f!=null&&f.length&&(t.varyings=f),t}function kB(i,e){const t=[],r=i.getProgramParameter(e,35721);for(let o=0;o<r;o++){const c=i.getActiveAttrib(e,o);if(!c)throw new Error("activeInfo");const{name:f,type:a}=c,w=i.getAttribLocation(e,f);if(w>=0){const{attributeType:P}=MB(a),k=/instance/i.test(f)?"instance":"vertex";t.push({name:f,location:w,stepMode:k,type:P})}}return t.sort((o,c)=>o.location-c.location),t}function DB(i,e){const t=[],r=i.getProgramParameter(e,35971);for(let o=0;o<r;o++){const c=i.getTransformFeedbackVarying(e,o);if(!c)throw new Error("activeInfo");const{name:f,type:a,size:w}=c,{glType:P,components:k}=O3(a),F={location:o,name:f,type:P,size:w*k};t.push(F)}return t.sort((o,c)=>o.location-c.location),t}function BB(i,e){const t=[],r=i.getProgramParameter(e,35718);for(let o=0;o<r;o++){const c=i.getActiveUniform(e,o);if(!c)throw new Error("activeInfo");const{name:f,size:a,type:w}=c,{name:P,isArray:k}=NB(f);let F=i.getUniformLocation(e,P);const V={location:F,name:P,size:a,type:w,isArray:k};if(t.push(V),V.size>1)for(let W=0;W<V.size;W++){const ee=`${P}[${W}]`;F=i.getUniformLocation(e,ee);const he={...V,name:ee,location:F};t.push(he)}}return t}function OB(i,e){const t=(c,f)=>i.getActiveUniformBlockParameter(e,c,f),r=[],o=i.getProgramParameter(e,35382);for(let c=0;c<o;c++){const f={name:i.getActiveUniformBlockName(e,c)||"",location:t(c,35391),byteLength:t(c,35392),vertex:t(c,35396),fragment:t(c,35398),uniformCount:t(c,35394),uniforms:[]},a=t(c,35395)||[],w=i.getActiveUniforms(e,a,35383),P=i.getActiveUniforms(e,a,35384),k=i.getActiveUniforms(e,a,35387),F=i.getActiveUniforms(e,a,35388);for(let V=0;V<f.uniformCount;++V){const W=i.getActiveUniform(e,a[V]);if(!W)throw new Error("activeInfo");f.uniforms.push({name:W.name,format:O3(w[V]).format,type:w[V],arrayLength:P[V],byteOffset:k[V],byteStride:F[V]})}r.push(f)}return r.sort((c,f)=>c.location-f.location),r}const LB={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function FB(i){const e=LB[i];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function NB(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function zB(i,e,t,r){const o=i;let c=r;c===!0&&(c=1),c===!1&&(c=0);const f=typeof c=="number"?[c]:c;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return i.uniform1i(e,r);case 5126:return i.uniform1fv(e,f);case 35664:return i.uniform2fv(e,f);case 35665:return i.uniform3fv(e,f);case 35666:return i.uniform4fv(e,f);case 5124:return i.uniform1iv(e,f);case 35667:return i.uniform2iv(e,f);case 35668:return i.uniform3iv(e,f);case 35669:return i.uniform4iv(e,f);case 35670:return i.uniform1iv(e,f);case 35671:return i.uniform2iv(e,f);case 35672:return i.uniform3iv(e,f);case 35673:return i.uniform4iv(e,f);case 5125:return o.uniform1uiv(e,f,1);case 36294:return o.uniform2uiv(e,f,2);case 36295:return o.uniform3uiv(e,f,3);case 36296:return o.uniform4uiv(e,f,4);case 35674:return i.uniformMatrix2fv(e,!1,f);case 35675:return i.uniformMatrix3fv(e,!1,f);case 35676:return i.uniformMatrix4fv(e,!1,f);case 35685:return o.uniformMatrix2x3fv(e,!1,f);case 35686:return o.uniformMatrix2x4fv(e,!1,f);case 35687:return o.uniformMatrix3x2fv(e,!1,f);case 35688:return o.uniformMatrix3x4fv(e,!1,f);case 35689:return o.uniformMatrix4x2fv(e,!1,f);case 35690:return o.uniformMatrix4x3fv(e,!1,f)}throw new Error("Illegal uniform")}function UB(i){return _3(i)!==null||typeof i=="number"||typeof i=="boolean"}function jB(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const r=i[t];UB(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function VB(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function WB(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const Lb=4;class HB extends ef{constructor(t,r){super(t,r);de(this,"device");de(this,"handle");de(this,"vs");de(this,"fs");de(this,"introspectedLayout");de(this,"uniforms",{});de(this,"bindings",{});de(this,"varyings",null);de(this,"_uniformCount",0);de(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:o,bufferMode:c=35981}=r;o&&o.length>0&&(this.varyings=o,this.device.gl.transformFeedbackVaryings(this.handle,o,c)),this._linkShaders(),ci.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=RB(this.device.gl,this.handle),ci.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=$B(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[o,c]of Object.entries(t)){const f=this.shaderLayout.bindings.find(a=>a.name===o)||this.shaderLayout.bindings.find(a=>a.name===`${o}Uniforms`);if(!f){const a=this.shaderLayout.bindings.map(w=>`"${w.name}"`).join(", ");r!=null&&r.disableWarnings||ci.warn(`No binding "${o}" in render pipeline "${this.id}", expected one of ${a}`,c)();continue}switch(c||ci.warn(`Unsetting binding "${o}" in render pipeline "${this.id}"`)(),f.type){case"uniform":if(!(c instanceof RA)&&!(c.buffer instanceof RA))throw new Error("buffer value");break;case"texture":if(!(c instanceof Hh||c instanceof kA||c instanceof MA))throw new Error("texture value");break;case"sampler":ci.warn(`Ignoring sampler ${o}`)();break;default:throw new Error(f.type)}this.bindings[o]=c}}draw(t){var Ie;const{renderPass:r,parameters:o=this.props.parameters,topology:c=this.props.topology,vertexArray:f,vertexCount:a,instanceCount:w,isInstanced:P=!1,firstVertex:k=0,transformFeedback:F}=t,V=VB(c),W=!!f.indexBuffer,ee=(Ie=f.indexBuffer)==null?void 0:Ie.glIndexType;if(this.linkStatus!=="success")return ci.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ci.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),f.bindBeforeRender(r),F&&F.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const he=r;return cB(this.device,o,he.glParameters,()=>{W&&P?this.device.gl.drawElementsInstanced(V,a||0,ee,k,w||0):W?this.device.gl.drawElements(V,a||0,ee,k):P?this.device.gl.drawArraysInstanced(V,k,a||0,w||0):this.device.gl.drawArrays(V,k,a||0),F&&F.end()}),f.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=jB(t);Object.keys(r).forEach(o=>{ci.warn(`Unsupported value "${JSON.stringify(r[o])}" used in setUniforms() for key ${o}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ci.time(Lb,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ci.timeEnd(Lb,`linkProgram for ${this.id}`)(),ci.level,!this.device.features.has("compilation-status-async-webgl")){const o=this._getLinkStatus();this._reportLinkStatus(o);return}ci.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ci.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){var r;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const o=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${o}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async c=>await new Promise(f=>setTimeout(f,c));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:o}=this.device;for(;;){if(o.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(ci.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,o=0;for(const c of this.shaderLayout.bindings){const f=this.bindings[c.name]||this.bindings[c.name.replace(/Uniforms$/,"")];if(!f)throw new Error(`No value for binding ${c.name} in ${this.id}`);switch(c.type){case"uniform":const{name:a}=c,w=t.getUniformBlockIndex(this.handle,a);if(w===4294967295)throw new Error(`Invalid uniform block name ${a}`);t.uniformBlockBinding(this.handle,o,w),f instanceof RA?t.bindBufferBase(35345,o,f.handle):t.bindBufferRange(35345,o,f.buffer.handle,f.offset||0,f.size||f.buffer.byteLength-f.offset),o+=1;break;case"texture":if(!(f instanceof Hh||f instanceof kA||f instanceof MA))throw new Error("texture");let P;if(f instanceof Hh)P=f.texture;else if(f instanceof kA)P=f;else if(f instanceof MA&&f.colorAttachments[0]instanceof Hh)ci.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),P=f.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(P.glTarget,P.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${c.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:o,type:c,textureUnit:f}=t,a=this.uniforms[r]??f;a!==void 0&&zB(this.device.gl,o,c,a)}}}function $B(i,e){const t={...i,attributes:i.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const o=t.attributes.find(c=>c.name===r.name);o?(o.type=r.type||o.type,o.stepMode=r.stepMode||o.stepMode):ci.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class ZB extends Cm{constructor(t){super(t,{});de(this,"device");de(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":qB(this.device,r.options);break;case"copy-buffer-to-texture":XB(this.device,r.options);break;case"copy-texture-to-buffer":GB(this.device,r.options);break;case"copy-texture-to-texture":YB(this.device,r.options);break;default:throw new Error(r.name)}}}function qB(i,e){const t=e.sourceBuffer,r=e.destinationBuffer;i.gl.bindBuffer(36662,t.handle),i.gl.bindBuffer(36663,r.handle),i.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function XB(i,e){throw new Error("Not implemented")}function GB(i,e){const{sourceTexture:t,mipLevel:r=0,aspect:o="all",width:c=e.sourceTexture.width,height:f=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:w=[0,0],destinationBuffer:P,byteOffset:k=0,bytesPerRow:F,rowsPerImage:V}=e;if(o!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||F||V)throw new Error("not implemented");const{framebuffer:W,destroyFramebuffer:ee}=L3(t);let he;try{const Ie=P,Ee=c||W.width,Ne=f||W.height,Ce=E3(W.colorAttachments[0].texture.props.format),De=Ce.format,Ye=Ce.type;i.gl.bindBuffer(35051,Ie.handle),he=i.gl.bindFramebuffer(36160,W.handle),i.gl.readPixels(w[0],w[1],Ee,Ne,De,Ye,k)}finally{i.gl.bindBuffer(35051,null),he!==void 0&&i.gl.bindFramebuffer(36160,he),ee&&W.destroy()}}function YB(i,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:o=[0,0],destinationOrigin:c=[0,0],destinationTexture:f}=e;let{width:a=e.destinationTexture.width,height:w=e.destinationTexture.height}=e;const{framebuffer:P,destroyFramebuffer:k}=L3(t),[F,V]=o,[W,ee,he]=c,Ie=i.gl.bindFramebuffer(36160,P.handle);let Ee=null,Ne;if(f instanceof kA)Ee=f,a=Number.isFinite(a)?a:Ee.width,w=Number.isFinite(w)?w:Ee.height,Ee.bind(0),Ne=Ee.glTarget;else throw new Error("invalid destination");switch(Ne){case 3553:case 34067:i.gl.copyTexSubImage2D(Ne,r,W,ee,F,V,a,w);break;case 35866:case 32879:i.gl.copyTexSubImage3D(Ne,r,W,ee,he,F,V,a,w);break}Ee&&Ee.unbind(),i.gl.bindFramebuffer(36160,Ie),k&&P.destroy()}function L3(i){if(i instanceof vn){const{width:e,height:t,id:r}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}class QB extends Em{constructor(t,r){super(t,r);de(this,"device");de(this,"commandBuffer");this.device=t,this.commandBuffer=new ZB(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,o){}}function KB(i){const{target:e,source:t,start:r=0,count:o=1}=i,c=t.length,f=o*c;let a=0;for(let w=r;a<c;a++)e[w++]=t[a];for(;a<f;)a<f-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+f-a),a=f);return i.target}class H_ extends Im{constructor(t,r){super(t,r);de(this,"device");de(this,"handle");de(this,"buffer",null);de(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return AI()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const o=r;if(o.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:c,type:f,stride:a,offset:w,normalized:P,integer:k,divisor:F}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,o.handle),k?this.device.gl.vertexAttribIPointer(t,c,f,a,w):this.device.gl.vertexAttribPointer(t,c,f,P,a,w),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,F||0),this.attributes[t]=o,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const o=S3(r.bufferDataType);return{size:r.bufferComponents,type:o,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const c=H_.isConstantAttributeZeroSupported(this.device)||t!==0;(r||c)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const o=JB(r),c=o.byteLength*t,f=o.length*t;if(this.buffer&&c!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${c} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:c}),a=a||!eO(o,this.bufferValue),a){const w=g4(r.constructor,f);KB({target:w,source:o,start:0,count:f}),this.buffer.write(w),this.bufferValue=r}return this.buffer}}function JB(i){return Array.isArray(i)?new Float32Array(i):i}function eO(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}class tO extends Pm{constructor(t,r){super(t,r);de(this,"device");de(this,"gl");de(this,"handle");de(this,"layout");de(this,"buffers",{});de(this,"unusedBuffers",{});de(this,"bindOnUse",!0);de(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(WB(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const o=this._getVaryingIndex(t),{buffer:c,byteLength:f,byteOffset:a}=this._getBufferRange(r);if(o<0){this.unusedBuffers[t]=c,ci.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[o]={buffer:c,byteLength:f,byteOffset:a},this.bindOnUse||this._bindBuffer(o,c,a,f)}getBuffer(t){if(Fb(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof RA)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:o=0,byteLength:c=t.buffer.byteLength}=t;return{buffer:r,byteOffset:o,byteLength:c}}_getVaryingIndex(t){if(Fb(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:o,byteOffset:c}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,c,o)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,o=0,c){const f=r&&r.handle;!f||c===void 0?this.gl.bindBufferBase(35982,t,f):this.gl.bindBufferRange(35982,t,f,o,c)}}function Fb(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class iO extends Mm{constructor(t,r){super(t,r);de(this,"device");de(this,"handle");de(this,"target",null);de(this,"_queryPending",!1);de(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((o,c)=>{const f=()=>{this.isResultAvailable()?(o(this.getResult()),this._pollingPromise=null):r++>t?(c("Timed out"),this._pollingPromise=null):requestAnimationFrame(f)};requestAnimationFrame(f)}),this._pollingPromise}}class Nb extends _p{constructor(t){var F,V;super({...t,id:t.id||nB("webgl-device")});de(this,"type","webgl");de(this,"handle");de(this,"features");de(this,"limits");de(this,"info");de(this,"canvasContext");de(this,"lost");de(this,"_resolveContextLost");de(this,"gl");de(this,"debug",!1);de(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});de(this,"_extensions",{});de(this,"_polyfilled",!1);de(this,"spectorJS");de(this,"renderPass",null);de(this,"_constants");const r=_p._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let o=(V=(F=r.canvas)==null?void 0:F.gl)==null?void 0:V.device;if(o)throw new Error(`WebGL context already attached to device ${o.id}`);this.canvasContext=new GD(this,r),this.lost=new Promise(W=>{this._resolveContextLost=W});const c={...t.webgl};r.alphaMode==="premultiplied"&&(c.premultipliedAlpha=!0),t.powerPreference!==void 0&&(c.powerPreference=t.powerPreference);const a=this.props._handle||PD(this.canvasContext.canvas,{onContextLost:W=>{var ee;return(ee=this._resolveContextLost)==null?void 0:ee.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:W=>console.log("WebGL context restored")},c);if(!a)throw new Error("WebGL context creation failed");if(o=a.device,o){if(t._reuseDevices)return ci.log(1,`Not creating a new Device, instead returning a reference to Device ${o.id} already attached to WebGL context`,o)(),o._reused=!0,o;throw new Error(`WebGL context already attached to device ${o.id}`)}this.handle=a,this.gl=a,this.spectorJS=QD({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=MD(this.gl,this._extensions),this.limits=new ZD(this.gl),this.features=new $D(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new zu(this.gl,{log:(...W)=>ci.log(1,...W)()}).trackState(this.gl,{copyState:!1});const P=t.debugWebGL||t.debug,k=t.debugWebGL;P&&(this.gl=JD(this.gl,{debugWebGL:P,traceWebGL:k}),ci.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ci.level=Math.max(ci.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new RA(this,r)}createTexture(t){return new kA(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new qm(this,t)}createShader(t){return new lB(this,t)}createFramebuffer(t){return new MA(this,t)}createVertexArray(t){return new H_(this,t)}createTransformFeedback(t){return new tO(this,t)}createQuerySet(t){return new iO(this,t)}createRenderPipeline(t){return new HB(this,t)}beginRenderPass(t){return new CB(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new QB(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return xB(t,r)}readPixelsToBufferWebGL(t,r){return wB(t,r)}setParametersWebGL(t){mf(this.gl,t)}getParametersWebGL(t){return w3(this.gl,t)}withParametersWebGL(t,r){return Bp(this.gl,t,r)}resetWebGL(){ci.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),TD(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return jD(this.gl,t,this._extensions)}loseDevice(){var c;let t=!1;const o=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return o&&(t=!0,o.loseContext()),(c=this._resolveContextLost)==null||c.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){zu.get(this.gl).push()}popState(){zu.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){const o=Number(t);for(const c in this.gl)if(this.gl[c]===o)return`GL.${c}`;return r!=null&&r.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((o,[c,f])=>(o[`${c}:${this.getGLKey(c,r)}`]=`${f}:${this.getGLKey(f,r)}`,o),{})}setConstantAttributeWebGL(t,r){const o=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(o).fill(null);const c=this._constants[t];switch(c&&oO(c,r)&&ci.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:rO(this,t,r);break;case Int32Array:nO(this,t,r);break;case Uint32Array:sO(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return of(this.gl,t,this._extensions),this._extensions}}function rO(i,e,t){switch(t.length){case 1:i.gl.vertexAttrib1fv(e,t);break;case 2:i.gl.vertexAttrib2fv(e,t);break;case 3:i.gl.vertexAttrib3fv(e,t);break;case 4:i.gl.vertexAttrib4fv(e,t);break}}function nO(i,e,t){i.gl.vertexAttribI4iv(e,t)}function sO(i,e,t){i.gl.vertexAttribI4uiv(e,t)}function oO(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}function aO(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return hw(i)}}const lO=uw;function zd(i,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:i,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function Lu(i){return i.stride||i.size*i.bytesPerElement}function cO(i,e){return i.type===e.type&&i.size===e.size&&Lu(i)===Lu(e)&&(i.offset||0)===(e.offset||0)}function Xm(i,e){e.offset&&rn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Lu(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,o=e.elementOffset||0,c=r*t+o*i.bytesPerElement+(i.offset||0);return{...e,offset:c,stride:t}}function uO(i,e){const t=Xm(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class hO{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const o=t.logicalType||t.type,c=o==="float64";let{defaultValue:f}=t;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let a;c?a="float32":!o&&t.isIndexed?a="uint32":a=o||"float32";let w=aO(o||a);this.doublePrecision=c,c&&t.fp64===!1&&(w=Float32Array),this.value=null,this.settings={...t,defaultType:w,defaultValue:f,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:w.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Lu(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),jA.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const o=this.value;if(t){const c=Xm(this.getAccessor(),t),f=c.offset/o.BYTES_PER_ELEMENT,a=c.size||this.size;r[e]=o.subarray(f,f+a)}else r[e]=o}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),o=[],c={name:this.id,byteStride:Lu(r),attributes:o};if(this.doublePrecision){const f=uO(r,t||{});o.push(zd(e,{...r,...f.high},this.device.type),zd(`${e}64Low`,{...r,...f.low},this.device.type))}else if(t){const f=Xm(r,t);o.push(zd(e,{...r,...f},this.device.type))}else o.push(zd(e,r,this.device.type));return c}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:o}=this,c=r*o;if(t&&c&&t.length>=c){const f=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let w=0;w<c;)for(let P=0;P<o;P++){const k=t[w++];k<f[P]&&(f[P]=k),k>a[P]&&(a[P]=k)}e=[f,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof tn?r={buffer:e}:r=e;const o={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)o.type="float32";else{const f=lO(r.value);o.type=o.normalized?f.replace("int","norm"):f}o.bytesPerElement=r.value.BYTES_PER_ELEMENT,o.stride=Lu(o)}if(t.bounds=null,r.constant){let c=r.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!t.constant||!this._areValuesEqual(c,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(c)?c:new Float32Array(c)}else if(r.buffer){const c=r.buffer;t.externalBuffer=c,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let c=r.value;t.externalBuffer=null,t.constant=!1,this.value=c;let{buffer:f}=this;const a=Lu(o),w=(o.vertexOffset||0)*a;if(this.doublePrecision&&c instanceof Float64Array&&(c=$g(c,o)),this.settings.isIndexed){const k=this.settings.defaultType;c.constructor!==k&&(c=new k(c))}const P=c.byteLength+w+a*2;(!f||f.byteLength<P)&&(f=this._createBuffer(P)),f.write(c,w)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?$g(t,{size:this.size,startIndex:r,endIndex:o}):t.subarray(r,o),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,o=r.allocatedValue,c=jA.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=c;const{byteOffset:f}=this;let{buffer:a}=this;return(!a||a.byteLength<c.byteLength+f)&&(a=this._createBuffer(c.byteLength+f),t&&o&&a.write(o instanceof Float64Array?$g(o,this):o,f)),r.allocatedValue=c,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=t.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&rn.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:o,size:c}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let f=c;for(;--f>=0;)t[r+f]=o[f];return t}switch(c){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let f=c;for(;--f>=0;)t[r+f]=Number.isFinite(e[f])?e[f]:o[f]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(e[o]!==t[o])return!1;return!0}_createBuffer(e){var o;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(o=this._buffer)==null?void 0:o.props,id:this.id,usage:(t?tn.INDEX:tn.VERTEX)|tn.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const zb=[],Ub=[];function _f(i,e=0,t=1/0){let r=zb;const o={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(Ub.length=i.length,r=Ub):r=zb,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),o.index=e-1),{iterable:r,objectInfo:o}}function F3(i){return i&&i[Symbol.asyncIterator]}function N3(i,e){const{size:t,stride:r,offset:o,startIndices:c,nested:f}=e,a=i.BYTES_PER_ELEMENT,w=r?r/a:t,P=o?o/a:0,k=Math.floor((i.length-P)/w);return(F,{index:V,target:W})=>{if(!c){const Ee=V*w+P;for(let Ne=0;Ne<t;Ne++)W[Ne]=i[Ee+Ne];return W}const ee=c[V],he=c[V+1]||k;let Ie;if(f){Ie=new Array(he-ee);for(let Ee=ee;Ee<he;Ee++){const Ne=Ee*w+P;W=new Array(t);for(let Ce=0;Ce<t;Ce++)W[Ce]=i[Ne+Ce];Ie[Ee-ee]=W}}else if(w===t)Ie=i.subarray(ee*t+P,he*t+P);else{Ie=new i.constructor((he-ee)*t);let Ee=0;for(let Ne=ee;Ne<he;Ne++){const Ce=Ne*w+P;for(let De=0;De<t;De++)Ie[Ee++]=i[Ce+De]}}return Ie}}const fO=[],np=[[0,1/0]];function AO(i,e){if(i===np||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let o=0;for(let c=0;c<r;c++){const f=i[c];f[1]<e[0]?(t.push(f),o=c+1):f[0]>e[1]?t.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return t.splice(o,0,e),t}const dO={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function z3(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...dO[t],...e,...i,type:t}}class U3 extends hO{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:np}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!cO(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,o=Array.isArray(t)?e[t.find(c=>e[c])]:e[t];return z3(o,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:o=1/0}=t;this.state.updateRanges=AO(this.state.updateRanges,[r,o])}else this.state.updateRanges=np}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=fO}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==np),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:f,noAlloc:a}}=this;let w=!0;if(f){for(const[P,k]of c)f.call(o,this,{data:t,startRow:P,endRow:k,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[P,k]of c){const F=Number.isFinite(P)?this.getVertexOffset(P):0,V=Number.isFinite(k)?this.getVertexOffset(k):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:F,endOffset:V})}this._checkAttributeArray()}else w=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),w}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:o}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),o.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Vl(ArrayBuffer.isView(f.value),`invalid ${o.accessor}`);const a=!!f.size&&f.size!==this.size;return r.binaryAccessor=N3(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=o??"vertex",!t)return r;for(const c in t){const f=super._getBufferLayout(c,t[c]);r.attributes.push(...f.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:o,props:c,numInstances:f}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:w,value:P,size:k,startIndices:F}=e,{accessor:V,transform:W}=a;let ee=w.binaryAccessor||(typeof V=="function"?V:c[V]);typeof ee!="function"&&(ee=()=>ee),Vl(typeof ee=="function",`accessor "${V}" is not a function`);let he=e.getVertexOffset(r);const{iterable:Ie,objectInfo:Ee}=_f(t,r,o);for(const Ne of Ie){Ee.index++;let Ce=ee(Ne,Ee);if(W&&(Ce=W.call(this,Ce)),F){const De=(Ee.index<F.length-1?F[Ee.index+1]:f)-F[Ee.index];if(Ce&&Array.isArray(Ce[0])){let Ye=he;for(const Ke of Ce)e._normalizeValue(Ke,P,Ye),Ye+=k}else Ce&&Ce.length>k?P.set(Ce,he):(e._normalizeValue(Ce,Ee.target,0),bD({target:P,source:Ee.target,start:he,count:De}));he+=De*k}else e._normalizeValue(Ce,P,he),he+=k}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function em(i){const{source:e,target:t,start:r=0,size:o,getData:c}=i,f=i.end||t.length,a=e.length,w=f-r;if(a>w){t.set(e.subarray(0,w),r);return}if(t.set(e,r),!c)return;let P=a;for(;P<w;){const k=c(P,e);for(let F=0;F<o;F++)t[r+P]=k[F]||0,P++}}function pO({source:i,target:e,size:t,getData:r,sourceStartIndices:o,targetStartIndices:c}){if(!o||!c)return em({source:i,target:e,size:t,getData:r}),e;let f=0,a=0;const w=r&&((k,F)=>r(k+a,F)),P=Math.min(o.length,c.length);for(let k=1;k<P;k++){const F=o[k]*t,V=c[k]*t;em({source:i.subarray(f,F),target:e,start:a,end:V,size:t,getData:w}),f=F,a=V}return a<e.length&&em({source:[],target:e,start:a,size:t,getData:w}),e}function gO(i){const{device:e,settings:t,value:r}=i,o=new U3(e,t);return o.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),o}function j3(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function V3(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function W3(i){i.push(i.shift())}function mO(i,e){const{doublePrecision:t,settings:r,value:o,size:c}=i,f=t&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:w}=i.settings;if(w)for(const P of Object.values(w))a=Math.max(a,P.vertexOffset??0);return(r.noAlloc?o.length:(e+a)*c)*f}function H3({device:i,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=i.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function $3({device:i,buffer:e,attribute:t,fromLength:r,toLength:o,fromStartIndices:c,getData:f=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,w=t.size*a,P=t.byteOffset,k=t.settings.bytesPerElement<4?P/t.settings.bytesPerElement*4:P,F=t.startIndices,V=c&&F,W=t.isConstant;if(!V&&e&&r>=o)return e;const ee=t.value instanceof Float64Array?Float32Array:t.value.constructor,he=W?t.value:new ee(t.getBuffer().readSyncWebGL(P,o*ee.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!W){const Ce=f;f=(De,Ye)=>t.normalizeConstant(Ce(De,Ye))}const Ie=W?(Ce,De)=>f(he,De):(Ce,De)=>f(he.subarray(Ce+P,Ce+P+w),De),Ee=e?new Float32Array(e.readSyncWebGL(k,r*4).buffer):new Float32Array(0),Ne=new Float32Array(o);return pO({source:Ee,target:Ne,sourceStartIndices:c,targetStartIndices:F,size:w,getData:Ie}),(!e||e.byteLength<Ne.byteLength+k)&&(e==null||e.destroy(),e=i.createBuffer({byteLength:Ne.byteLength+k,usage:35050})),e.write(Ne,k),e}class Z3{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new U_(r),this.attribute=t,this.attributeInTransition=gO(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=mO(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class _O extends Z3{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=xO(e,t)}start(e,t){const r=this.currentLength,o=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:c,attribute:f}=this;W3(c),c[0]=$3({device:this.device,buffer:c[0],attribute:f,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),c[1]=H3({device:this.device,source:c[0],target:c[1]}),this.setBuffer(c[1]);const{transform:a}=this,w=a.model;let P=Math.floor(this.currentLength/f.size);q3(f)&&(P/=2),w.setVertexCount(P),f.isConstant?(w.setAttributes({aFrom:c[0]}),w.setConstantAttributes({aTo:f.value})):w.setAttributes({aFrom:c[0],aTo:f.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:c[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let o=r/e;t&&(o=t(o));const{model:c}=this.transform,f={time:o};c.shaderInputs.setProps({interpolation:f}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const yO=`uniform interpolationUniforms {
  float time;
} interpolation;
`,jb={name:"interpolation",vs:yO,uniformTypes:{time:"f32"}},bO=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,vO=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function q3(i){return i.doublePrecision&&i.value instanceof Float64Array}function xO(i,e){const t=e.size,r=j3(t),o=V3(t),c=e.getBufferLayout();return q3(e)?new VA(i,{vs:vO,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*t}]}],modules:[Mk,jb],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new VA(i,{vs:bO,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:c.attributes[0].format}],modules:[jb],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class wO extends Z3{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=PO(e),this.framebuffer=MO(e,this.texture),this.transform=IO(e,t)}start(e,t){const r=this.currentLength,o=this.currentStartIndices;super.start(e,t);const{buffers:c,attribute:f}=this;for(let w=0;w<2;w++)c[w]=$3({device:this.device,buffer:c[w],attribute:f,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});c[2]=H3({device:this.device,source:c[0],target:c[2]}),this.setBuffer(c[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?a.setConstantAttributes({aTo:f.value}):a.setAttributes({aTo:f.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:o}=this,c=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const f={stiffness:c.stiffness,damping:c.damping};t.model.shaderInputs.setProps({spring:f}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),W3(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const TO=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,SO={name:"spring",vs:TO,uniformTypes:{damping:"f32",stiffness:"f32"}},EO=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,CO=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function IO(i,e){const t=j3(e.size),r=V3(e.size);return new VA(i,{vs:EO,fs:CO,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[SO],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function PO(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function MO(i,e){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const RO={interpolation:_O,spring:wO};class kO{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const o in e){const c=e[o],f=c.getTransitionSetting(t);f&&this._updateAttribute(o,c,f)}for(const o in this.transitions){const c=e[o];(!c||!c.getTransitionSetting(t))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const o=this.transitions[e];let c=!o||o.type!==r.type;if(c){o&&this._removeTransition(e);const f=RO[r.type];f?this.transitions[e]=new f({attribute:t,timeline:this.timeline,device:this.device}):(rn.error(`unsupported transition type '${r.type}'`)(),c=!1)}(c||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const Vb="attributeManager.invalidate",DO="attributeManager.updateStart",BO="attributeManager.updateEnd",OO="attribute.updateStart",LO="attribute.allocate",FO="attribute.updateEnd";class NO{constructor(e,{id:t="attribute-manager",stats:r,timeline:o}={}){this.mergeBoundsMemoized=N_(K6),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new kO(e,{id:`${t}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);To(Vb,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);To(Vb,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:o,props:c={},buffers:f={},context:a={}}){let w=!1;To(DO,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const P in this.attributes){const k=this.attributes[P],F=k.settings.accessor;k.startIndices=r,k.numInstances=t,c[P]&&rn.removed(`props.${P}`,`data.attributes.${P}`)(),k.setExternalBuffer(f[P])||k.setBinaryValue(typeof F=="string"?f[F]:void 0,e.startIndices)||typeof F=="string"&&!f[F]&&k.setConstantValue(c[F])||k.needsUpdate()&&(w=!0,this._updateAttribute({attribute:k,numInstances:t,data:e,props:c,context:a})),this.needsRedraw=this.needsRedraw||k.needsRedraw()}w&&To(BO,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>{var o;return(o=this.attributes[r])==null?void 0:o.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const c in t){const f=t[c];f.needsRedraw(e)&&!r.hasAttribute(c)&&(o[c]=f)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const o=e[r],c={...o,id:r,size:o.isIndexed&&1||o.size||1,...t};this.attributes[r]=new U3(this.device,c)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:o}=this,c=o[e];return c&&c.forEach(f=>{const a=r[f];a&&a.setNeedsUpdate(a.id,t)}),c}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(To(OO,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&To(LO,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,To(FO,t,r))}}class zO extends U_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:o,easing:c}}=this,f=c(e/o);this._value=rf(t,r,f)}}const Wb=1e-5;function Hb(i,e,t,r,o){const c=e-i,a=(t-e)*o,w=-c*r;return a+w+c+e}function UO(i,e,t,r,o){if(Array.isArray(t)){const c=[];for(let f=0;f<t.length;f++)c[f]=Hb(i[f],e[f],t[f],r,o);return c}return Hb(i,e,t,r,o)}function $b(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const o=i[r]-e[r];t+=o*o}return Math.sqrt(t)}return Math.abs(i-e)}class jO extends U_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:o}=this.settings,{_prevValue:c=e,_currValue:f=e}=this;let a=UO(c,f,t,r,o);const w=$b(a,t),P=$b(a,f);w<Wb&&P<Wb&&(a=t,this.end()),this._prevValue=f,this._currValue=a}}const VO={interpolation:zO,spring:jO};class WO{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,o){const{transitions:c}=this;if(c.has(e)){const w=c.get(e),{value:P=w.settings.fromValue}=w;t=P,this.remove(e)}if(o=z3(o),!o)return;const f=VO[o.type];if(!f){rn.error(`unsupported transition type '${o.type}'`)();return}const a=new f(this.timeline);a.start({...o,fromValue:t,toValue:r}),c.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function HO(i){const e=i[jc];for(const t in e){const r=e[t],{validate:o}=r;if(o&&!o(i[t],r))throw new Error(`Invalid prop ${t}: ${i[t]}`)}}function $O(i,e){const t=X3({newProps:i,oldProps:e,propTypes:i[jc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=qO(i,e);let o=!1;return r||(o=XO(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:o,extensionsChanged:GO(i,e),transitionsChanged:ZO(i,e)}}function ZO(i,e){if(!i.transitions)return!1;const t={},r=i[jc];let o=!1;for(const c in i.transitions){const f=r[c],a=f&&f.type;(a==="number"||a==="color"||a==="array")&&Gm(i[c],e[c],f)&&(t[c]=!0,o=!0)}return o?t:!1}function X3({newProps:i,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:o="props"}){if(e===i)return!1;if(typeof i!="object"||i===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const c of Object.keys(i))if(!(c in t)){if(!(c in e))return`${o}.${c} added`;const f=Gm(i[c],e[c],r[c]);if(f)return`${o}.${c} ${f}`}for(const c of Object.keys(e))if(!(c in t)){if(!(c in i))return`${o}.${c} dropped`;if(!Object.hasOwnProperty.call(i,c)){const f=Gm(i[c],e[c],r[c]);if(f)return`${o}.${c} ${f}`}}return!1}function Gm(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function qO(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:o}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&o&&(t=o(i.data,e.data)||t),t}function XO(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&Zb(i,e,"all"))return{all:!0};const t={};let r=!1;for(const o in i.updateTriggers)o!=="all"&&Zb(i,e,o)&&(t[o]=!0,r=!0);return r?t:!1}function GO(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(t[o]))return!0;return!1}function Zb(i,e,t){let r=i.updateTriggers[t];r=r??{};let o=e.updateTriggers[t];return o=o??{},X3({oldProps:o,newProps:r,triggerName:t})}const YO="count(): argument not an object",QO="count(): argument not a container";function KO(i){if(!eL(i))throw new Error(YO);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(JO(i))return Object.keys(i).length;throw new Error(QO)}function JO(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function eL(i){return i!==null&&typeof i=="object"}function qb(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(o=>o.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const o in e.inject)r[o]=(r[o]||"")+e.inject[o];t.inject=r}return t}const tL={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ym={};function iL(i,e,t,r){if(t instanceof vn)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let o=null;t.compressed&&(o={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const c=e.createTexture({...t,sampler:{...tL,...o,...r},mipmaps:!0});return Ym[c.id]=i,c}function rL(i,e){!e||!(e instanceof vn)||Ym[e.id]===i&&(e.delete(),delete Ym[e.id])}const nL={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||Qm(i)&&(i.length===3||i.length===4)},equal(i,e,t){return Ou(i,e,1)}},accessor:{validate(i,e){const t=Op(i);return t==="function"||t===Op(e.value)},equal(i,e,t){return typeof e=="function"?!0:Ou(i,e,1)}},array:{validate(i,e){return e.optional&&!i||Qm(i)},equal(i,e,t){const{compare:r}=t,o=Number.isInteger(r)?r:r?1:0;return r?Ou(i,e,o):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,o=Number.isInteger(r)?r:r?1:0;return r?Ou(i,e,o):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{if(!i)return i;const{dataTransform:r}=t.props;return r?r(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.device?null:iL(t.id,r.device,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{rL(t.id,i)}}};function sL(i){const e={},t={},r={};for(const[o,c]of Object.entries(i)){const f=c==null?void 0:c.deprecatedFor;if(f)r[o]=Array.isArray(f)?f:[f];else{const a=oL(o,c);e[o]=a,t[o]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function oL(i,e){switch(Op(e)){case"object":return aA(i,e);case"array":return aA(i,{type:"array",value:e,compare:!1});case"boolean":return aA(i,{type:"boolean",value:e});case"number":return aA(i,{type:"number",value:e});case"function":return aA(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function aA(i,e){return"type"in e?{name:i,...nL[e.type],...e}:"value"in e?{name:i,type:Op(e.value),...e}:{name:i,type:"object",value:e}}function Qm(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function Op(i){return Qm(i)?"array":i===null?"null":typeof i}function aL(i,e){let t;for(let c=e.length-1;c>=0;c--){const f=e[c];"extensions"in f&&(t=f.extensions)}const r=Km(i.constructor,t),o=Object.create(r);o[Dp]=i,o[Zu]={},o[Fc]={};for(let c=0;c<e.length;++c){const f=e[c];for(const a in f)o[a]=f[a]}return Object.freeze(o),o}const lL="_mergedDefaultProps";function Km(i,e){if(!(i instanceof d0.constructor))return{};let t=lL;if(e)for(const o of e){const c=o.constructor;c&&(t+=`:${c.extensionName||c.name}`)}const r=G3(i,t);return r||(i[t]=cL(i,e||[]))}function cL(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),o=Km(r),c=G3(i,"defaultProps")||{},f=sL(c),a=Object.assign(Object.create(null),o,f.defaultProps),w=Object.assign(Object.create(null),o==null?void 0:o[jc],f.propTypes),P=Object.assign(Object.create(null),o==null?void 0:o[Gg],f.deprecatedProps);for(const k of e){const F=Km(k.constructor);F&&(Object.assign(a,F),Object.assign(w,F[jc]),Object.assign(P,F[Gg]))}return uL(a,i),fL(a,w),hL(a,P),a[jc]=w,a[Gg]=P,e.length===0&&!$_(i,"_propTypes")&&(i._propTypes=w),a}function uL(i,e){const t=dL(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function hL(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const o=`${this.id}: ${t}`;for(const c of e[t])$_(this,c)||(this[c]=r);rn.deprecated(o,e[t].join("/"))()}})}function fL(i,e){const t={},r={};for(const o in e){const c=e[o],{name:f,value:a}=c;c.async&&(t[f]=a,r[f]=AL(f))}i[Yh]=t,i[Zu]={},Object.defineProperties(i,r)}function AL(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||F3(e)?this[Zu][i]=e:this[Fc][i]=e},get(){if(this[Fc]){if(i in this[Fc])return this[Fc][i]||this[Yh][i];if(i in this[Zu]){const e=this[Dp]&&this[Dp].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[Yh][i]}}return this[Yh][i]}}}function $_(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function G3(i,e){return $_(i,e)&&i[e]}function dL(i){const e=i.componentName;return e||rn.warn(`${i.name}.componentName not specified`)(),e||i.name}let pL=0;class d0{constructor(...e){this.props=aL(this,e),this.id=this.props.id,this.count=pL++}clone(e){const{props:t}=this,r={};for(const o in t[Yh])o in t[Fc]?r[o]=t[Fc][o]:o in t[Zu]&&(r[o]=t[Zu][o]);return new this.constructor({...t,...r,...e})}}d0.componentName="Component";d0.defaultProps={};const gL=Object.freeze({});class mL{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||gL}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Dp]||this.component;const t=e[Fc]||{},r=e[Zu]||e,o=e[Yh]||{};for(const c in t){const f=t[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,f),t[c]=this.getAsyncProp(c)}for(const c in r){const f=r[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,f)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(F3(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const o=this.asyncProps[e];o&&r>=o.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=t,o.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;t.then(c=>{this.component&&(c=this._postProcessValue(r,c),this._setAsyncPropValue(e,c,o),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let c=[],f=0;for await(const a of t){if(!this.component)return;const{dataTransform:w}=this.component.props;w?c=w(a,c):c=c.concat(a),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:f,endRow:c.length}]}),f=c.length,this._setAsyncPropValue(e,c,o)}this._onResolve(e,c)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const o=this.component&&this.component.props[jc];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class _L extends mL{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,o=r==null?void 0:r.props.fetch;return o?o(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const o=r.props.onDataLoad;e==="data"&&o&&o(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const yL="layer.changeFlag",bL="layer.initialize",vL="layer.update",xL="layer.finalize",wL="layer.matched",Xb=2**24-1,TL=Object.freeze([]),SL=N_(({oldViewport:i,viewport:e})=>i.equals(e));let Ia=new Uint8ClampedArray(0);const EL={data:{type:"data",value:TL,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:e,layer:t,loaders:r,loadOptions:o,signal:c})=>{const{resourceManager:f}=t.context;o=o||t.getLoadOptions(),r=r||t.props.loaders,c&&(o={...o,fetch:{...o==null?void 0:o.fetch,signal:c}});let a=f.contains(i);return!a&&!o&&(f.add({resourceId:i,data:bm(i,r),persistent:!1}),a=!0),a?f.subscribe({resourceId:i,onChange:w=>{var P;return(P=t.internalState)==null?void 0:P.reloadAsyncProp(e,w)},consumerId:t.id,requestId:e}):bm(i,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Cr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ql extends d0{constructor(){super(...arguments),this.internalState=null,this.lifecycle=yD.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Vl(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=m3(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,c,f]=p3(r,t.pixelProjectionMatrix);return e.length===2?[o,c]:[o,c,f]}unproject(e){return Vl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Vl(this.internalState);const r=this.internalState.viewport||this.context.viewport;return nD(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Cr.DEFAULT||e===Cr.LNGLAT||e===Cr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Vl(e instanceof Uint8Array);const[t,r,o]=e;return t+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:KO(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=qb(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=qb(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const o of r)t.invalidateAll(o);else t.invalidateAll();if(t){const{props:o}=e,c=this.internalState.hasPickingBuffer,f=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(c!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:a,instancePickingColors:w}=t.attributes,P=a||w;P&&(f&&P.constant&&(P.constant=!1,t.invalidate(P.id)),!P.value&&!f&&(P.constant=!0,P.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,t){var r,o,c,f;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(o=(r=this.props).onError)!=null&&o.call(r,e)||(f=(c=this.context)==null?void 0:c.onError)==null||f.call(c,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!SL({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),o=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:o,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const o in t)Object.defineProperty(r,o,{value:t[o]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(Ia.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>Xb&&rn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ia=jA.allocate(Ia,t,{size:4,copy:!0,maxCount:Math.max(t,Xb)});const o=Math.floor(Ia.length/4),c=[0,0,0];for(let f=r;f<o;f++)this.encodePickingColor(f,c),Ia[f*4+0]=c[0],Ia[f*4+1]=c[1],Ia[f*4+2]=c[2],Ia[f*4+3]=0}e.value=Ia.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){var a;if(!Object.keys(t).length)return;if(r){const w=this.getAttributeManager();e.setBufferLayout(w.getBufferLayouts(e)),t=w.getAttributes()}const o=((a=e.userData)==null?void 0:a.excludeAttributes)||{},c={},f={};for(const w in t){if(o[w])continue;const P=t[w].getValue();for(const k in P){const F=P[k];F instanceof tn?t[w].settings.isIndexed?e.setIndexBuffer(F):c[k]=F:F&&(f[k]=F)}}e.setAttributes(c),e.setConstantAttributes(f)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:o}=this.getAttributeManager().attributes,c=r||o,f=c&&t.attributes&&t.attributes[c.id];if(f&&f.value){const a=f.value,w=this.encodePickingColor(e);for(let P=0;P<t.length;P++){const k=c.getVertexOffset(P);a[k]===w[0]&&a[k+1]===w[1]&&a[k+2]===w[2]&&this._disablePickingIndex(P)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,o=t||r;if(!o)return;const c=o.getVertexOffset(e),f=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(f-c),c)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ia.buffer&&(r.value=Ia.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Vl(!this.internalState),Vl(Number.isFinite(this.props.coordinateSystem)),To(bL,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _L({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(rn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new WO(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){To(wL,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(To(vL,this,e),!e)return;const t=this.props,r=this.context,o=this.internalState,c=r.viewport,f=this._updateUniformTransition();o.propsInTransition=f,r.viewport=o.viewport||c,this.props=f;try{const a=this._getUpdateParams(),w=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const k of this.props.extensions)k.updateState.call(this,a,k);this.setNeedsRedraw(),this._updateAttributes();const P=this.getModels()[0]!==w[0];this._postUpdate(a,P)}finally{r.viewport=c,this.props=t,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){To(xL,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:o={}}){this._updateAttributeTransition();const c=this.props,f=this.context;this.props=this.internalState.propsInTransition||c;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,w=a&&a(r)||[0,0];f.device instanceof Nb&&f.device.setParametersWebGL({polygonOffset:w});for(const P of this.getModels())P.device.type==="webgpu"?P.setParameters({...P.parameters,...o}):P.setParameters(o);if(f.device instanceof Nb)f.device.withParametersWebGL(o,()=>{const P={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:o,context:f};for(const k of this.props.extensions)k.draw.call(this,P,k);this.draw(P)});else{const P={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:o,context:f};for(const k of this.props.extensions)k.draw.call(this,P,k);this.draw(P)}}finally{this.props=c}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const o in e)if(e[o]){let c=!1;switch(o){case"dataChanged":const f=e[o],a=t[o];f&&Array.isArray(a)&&(t.dataChanged=Array.isArray(f)?a.concat(f):f,c=!0);default:t[o]||(t[o]=e[o],c=!0)}c&&To(yL,this,o,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var o;const r=$O(e,t);if(r.updateTriggersChanged)for(const c in r.updateTriggersChanged)r.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(r.transitionsChanged)for(const c in r.transitionsChanged)this.internalState.uniformTransitions.add(c,t[c],e[c],(o=e.transitions)==null?void 0:o[c]);return this.setChangeFlags(r)}validateProps(){HO(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new NO(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:o}=e,c=this.state.model;c!=null&&c.isInstanced&&c.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:a,highlightColor:w}=r;if(t||o.autoHighlight!==f||o.highlightedObjectIndex!==a||o.highlightColor!==w){const P={};Array.isArray(w)&&(P.highlightColor=w),(t||o.autoHighlight!==f||a!==o.highlightedObjectIndex)&&(P.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:P})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(e):!1;if(t=t||o,t)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ql.defaultProps=EL;ql.layerName="Layer";const CL="compositeLayer.renderLayers";class yf extends ql{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,o)}return e}getSubLayerProps(e={}){var kt;const{opacity:t,pickable:r,visible:o,parameters:c,getPolygonOffset:f,highlightedObjectIndex:a,autoHighlight:w,highlightColor:P,coordinateSystem:k,coordinateOrigin:F,wrapLongitude:V,positionFormat:W,modelMatrix:ee,extensions:he,fetch:Ie,operation:Ee,_subLayerProps:Ne}=this.props,Ce={id:"",updateTriggers:{},opacity:t,pickable:r,visible:o,parameters:c,getPolygonOffset:f,highlightedObjectIndex:a,autoHighlight:w,highlightColor:P,coordinateSystem:k,coordinateOrigin:F,wrapLongitude:V,positionFormat:W,modelMatrix:ee,extensions:he,fetch:Ie,operation:Ee},De=Ne&&e.id&&Ne[e.id],Ye=De&&De.updateTriggers,Ke=e.id||"sublayer";if(De){const It=this.props[jc],jt=e.type?e.type._propTypes:{};for(const Lt in De){const Mt=jt[Lt]||It[Lt];Mt&&Mt.type==="accessor"&&(De[Lt]=this.getSubLayerAccessor(De[Lt]))}}Object.assign(Ce,e,De),Ce.id=`${this.props.id}-${Ke}`,Ce.updateTriggers={all:(kt=this.props.updateTriggers)==null?void 0:kt.all,...e.updateTriggers,...Ye};for(const It of he){const jt=It.getSubLayerProps.call(this,It);jt&&Object.assign(Ce,jt,{updateTriggers:Object.assign(Ce.updateTriggers,jt.updateTriggers)})}return Ce}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const o=!r||this.needsUpdate();if(o){const c=this.renderLayers();r=v3(c,Boolean),this.internalState.subLayers=r}To(CL,this,o,r);for(const c of r)c.parent=this}}yf.layerName="CompositeLayer";const Ud=Math.PI/180,Gb=180/Math.PI,sp=6370972,$h=256;function IL(){const i=$h/sp,e=Math.PI/180*$h;return{unitsPerMeter:[i,i,i],unitsPerMeter2:[0,0,0],metersPerUnit:[1/i,1/i,1/i],unitsPerDegree:[e,e,i],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/i]}}class PL extends rd{constructor(e={}){const{longitude:t=0,zoom:r=0,nearZMultiplier:o=.5,farZMultiplier:c=1,resolution:f=10}=e;let{latitude:a=0,height:w,altitude:P=1.5,fovy:k}=e;a=Math.max(Math.min(a,zm),-85.051129),w=w||1,k?P=z_(k):k=UA(P);const F=1/Math.PI/Math.cos(a*Math.PI/180),V=Math.pow(2,r)*F,W=e.nearZ??o,ee=e.farZ??(P+$h*2*V/w)*c,he=new Eo().lookAt({eye:[0,-P,0],up:[0,0,1]});he.rotateX(a*Ud),he.rotateZ(-t*Ud),he.scale(V/w),super({...e,height:w,viewMatrix:he,longitude:t,latitude:a,zoom:r,distanceScales:IL(),fovy:k,focalDistance:P,near:W,far:ee}),this.scale=V,this.latitude=a,this.longitude=t,this.resolution=f}get projectionMode(){return Ho.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),o=this.unproject([this.width/2,0],t),c=this.unproject([this.width,this.height/2],t),f=this.unproject([this.width/2,this.height],t);return c[0]<this.longitude&&(c[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],c[0],o[0],f[0]),Math.min(r[1],c[1],o[1],f[1]),Math.max(r[0],c[0],o[0],f[0]),Math.max(r[1],c[1],o[1],f[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[o,c,f]=e,a=t?c:this.height-c,{pixelUnprojectionMatrix:w}=this;let P;if(Number.isFinite(f))P=tm(w,[o,a,f,1]);else{const W=tm(w,[o,a,-1,1]),ee=tm(w,[o,a,1,1]),he=((r||0)/sp+1)*$h,Ie=Fg(jw([],W,ee)),Ee=Fg(W),Ne=Fg(ee),De=4*((4*Ee*Ne-(Ie-Ee-Ne)**2)/16)/Ie,Ye=Math.sqrt(Ee-De),Ke=Math.sqrt(Math.max(0,he*he-De)),kt=(Ye-Ke)/Math.sqrt(Ie);P=yR([],W,ee,kt)}const[k,F,V]=this.unprojectPosition(P);return Number.isFinite(f)?[k,F,V]:Number.isFinite(r)?[k,F,r]:[k,F]}projectPosition(e){const[t,r,o=0]=e,c=t*Ud,f=r*Ud,a=Math.cos(f),w=(o/sp+1)*$h;return[Math.sin(c)*a*w,-Math.cos(c)*a*w,Math.sin(f)*w]}unprojectPosition(e){const[t,r,o]=e,c=Vw(e),f=Math.asin(o/c),w=Math.atan2(t,-r)*Gb,P=f*Gb,k=(c/$h-1)*sp;return[w,P,k]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function tm(i,e){const t=df([],e,i);return L_(t,t,1/t[3]),t}class Z_{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ou(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,r={updateTriggers:{}};for(const o in t)if(o in this.props){const c=t[o],f=this.props[o];r[o]=f,c&&c.type==="accessor"&&(r.updateTriggers[o]=this.props.updateTriggers[o],typeof f=="function"&&(r[o]=this.getSubLayerAccessor(f)))}return r}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}Z_.defaultProps={};Z_.extensionName="LayerExtension";class Y3{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=jA,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:o,geometryBuffer:c,positionFormat:f,dataChanged:a,normalize:w=!0}=this.opts;if(this.data=t,this.getGeometry=o,this.positionSize=c&&c.size||(f==="XY"?2:3),this.buffers=r,this.normalize=w,c&&(Vl(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),w||(r.vertexPositions=c)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const P of a)this._rebuildGeometry(P);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?N3(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:o,_attributeDefs:c,typedArrayManager:f}=this;for(const a in c)if(a in o)f.release(r[a]),r[a]=null;else{const w=c[a];w.copy=t,r[a]=f.allocate(r[a],e,w)}}_forEachGeometry(e,t,r){const{data:o,getGeometry:c}=this,{iterable:f,objectInfo:a}=_f(o,t,r);for(const w of f){a.index++;const P=c?c(w,a):null;e(P,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:o}=this;const{data:c,geometryBuffer:f}=this,{startRow:a=0,endRow:w=1/0}=e||{},P={};if(e||(t=[0],r=[0]),this.normalize||!f)this._forEachGeometry((F,V)=>{const W=F&&this.normalizeGeometry(F);P[V]=W,r[V+1]=r[V]+(W?this.getGeometrySize(W):0)},a,w),o=r[r.length-1];else if(r=c.startIndices,o=r[c.length]||0,ArrayBuffer.isView(f))o=o||f.length/this.positionSize;else if(f instanceof tn){const F=this.positionSize*4;o=o||f.byteLength/F}else if(f.buffer){const F=f.stride||this.positionSize*4;o=o||f.buffer.byteLength/F}else if(f.value){const F=f.value,V=f.stride/F.BYTES_PER_ELEMENT||this.positionSize;o=o||F.length/V}this._allocate(o,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=o;const k={};this._forEachGeometry((F,V)=>{const W=P[V]||F;k.vertexStart=r[V],k.indexStart=t[V];const ee=V<r.length-1?r[V+1]:o;k.geometrySize=ee-r[V],k.geometryIndex=V,this.updateGeometryAttributes(W,k)},a,w),this.vertexCount=t[t.length-1]}}const Yb=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,ML={name:"icon",vs:Yb,fs:Yb,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},RL=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,kL=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,DL=1024,BL=4,Qb=()=>{},Kb={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},OL={x:0,y:0,width:0,height:0};function LL(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function FL(i,e,t,r){const o=Math.min(t/e.width,r/e.height),c=Math.floor(e.width*o),f=Math.floor(e.height*o);return o===1?{image:e,width:c,height:f}:(i.canvas.height=f,i.canvas.width=c,i.clearRect(0,0,c,f),i.drawImage(e,0,0,e.width,e.height,0,0,c,f),{image:i.canvas,width:c,height:f})}function WA(i){return i&&(i.id||i.url)}function NL(i,e,t,r){const{width:o,height:c,device:f}=i,a=f.createTexture({format:"rgba8unorm",width:e,height:t,sampler:r,mipmaps:!0}),w=f.createCommandEncoder();return w.copyTextureToTexture({sourceTexture:i,destinationTexture:a,width:o,height:c}),w.finish(),i.destroy(),a}function Jb(i,e,t){for(let r=0;r<e.length;r++){const{icon:o,xOffset:c}=e[r],f=WA(o);i[f]={...o,x:c,y:t}}}function zL({icons:i,buffer:e,mapping:t={},xOffset:r=0,yOffset:o=0,rowHeight:c=0,canvasWidth:f}){let a=[];for(let w=0;w<i.length;w++){const P=i[w],k=WA(P);if(!t[k]){const{height:F,width:V}=P;r+V+e>f&&(Jb(t,a,o),r=0,o=c+o+e,c=0,a=[]),a.push({icon:P,xOffset:r}),r=r+V+e,c=Math.max(c,F)}}return a.length>0&&Jb(t,a,o),{mapping:t,rowHeight:c,xOffset:r,yOffset:o,canvasWidth:f,canvasHeight:LL(c+o+e)}}function UL(i,e,t){if(!i||!e)return null;t=t||{};const r={},{iterable:o,objectInfo:c}=_f(i);for(const f of o){c.index++;const a=e(f,c),w=WA(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[w]&&(!t[w]||a.url!==t[w].url)&&(r[w]={...a,source:f,sourceIndex:c.index})}return r}class jL{constructor(e,{onUpdate:t=Qb,onError:r=Qb}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=BL,this._canvasWidth=DL,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?WA(e):e;return this._mapping[t]||OL}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:o,textureParameters:c}){var f;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),o&&(this._mapping=o),r&&((f=this._texture)==null||f.delete(),this._texture=null,this._externalTexture=r),c&&(this._samplerParameters=c)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(UL(e,t,this._mapping)||{});if(r.length>0){const{mapping:o,xOffset:c,yOffset:f,rowHeight:a,canvasHeight:w}=zL({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=o,this._xOffset=c,this._yOffset=f,this._canvasHeight=w,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||Kb,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=NL(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||Kb)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,bm(r.url,this._loadOptions).then(o=>{var ee;const c=WA(r),f=this._mapping[c],{x:a,y:w,width:P,height:k}=f,{image:F,width:V,height:W}=FL(t,o,P,k);(ee=this._texture)==null||ee.copyExternalImage({image:F,x:a+(P-V)/2,y:w+(k-W)/2,width:V,height:W}),f.width=V,f.height=W,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const Q3=[0,0,0,255],VL={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:i=>i.position},getIcon:{type:"accessor",value:i=>i.icon},getColor:{type:"accessor",value:Q3},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class p0 extends ql{getShaders(){return super.getShaders({vs:RL,fs:kL,modules:[pf,gf,ML]})}initializeState(){this.state={iconManager:new jL(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Q3},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var W;super.updateState(e);const{props:t,oldProps:r,changeFlags:o}=e,c=this.getAttributeManager(),{iconAtlas:f,iconMapping:a,data:w,getIcon:P,textureParameters:k}=t,{iconManager:F}=this.state;if(typeof f=="string")return;const V=f||this.internalState.isAsyncPropLoading("iconAtlas");F.setProps({loadOptions:t.loadOptions,autoPacking:!V,iconAtlas:f,iconMapping:V?a:null,textureParameters:k}),V?r.iconMapping!==t.iconMapping&&c.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&F.packIcons(w,P),o.extensionsChanged&&((W=this.state.model)==null||W.destroy(),this.state.model=this._getModel(),c.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:o,sizeUnits:c,billboard:f,alphaCutoff:a}=this.props,{iconManager:w}=this.state,P=w.getTexture();if(P){const k=this.state.model,F={iconsTexture:P,iconsTextureDim:[P.width,P.height],sizeUnits:La[c],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:o,billboard:f,alphaCutoff:a};k.shaderInputs.setProps({icon:F}),k.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $u({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const t=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;t?t(e):rn.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:o=t/2,anchorY:c=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-o,r/2-c]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:o,height:c}=this.state.iconManager.getIconMapping(e);return[t,r,o,c]}}p0.defaultProps=VL;p0.layerName="IconLayer";const ev=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,WL={name:"scatterplot",vs:ev,fs:ev,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},HL=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,$L=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ZL=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,tv=[0,0,0,255],qL={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:tv},getLineColor:{type:"accessor",value:tv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class q_ extends ql{getShaders(){return super.getShaders({vs:HL,fs:$L,source:ZL,modules:[pf,gf,WL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:o,radiusMaxPixels:c,stroked:f,filled:a,billboard:w,antialiasing:P,lineWidthUnits:k,lineWidthScale:F,lineWidthMinPixels:V,lineWidthMaxPixels:W}=this.props,ee={stroked:f,filled:a,billboard:w,antialiasing:P,radiusUnits:La[t],radiusScale:r,radiusMinPixels:o,radiusMaxPixels:c,lineWidthUnits:La[k],lineWidthScale:F,lineWidthMinPixels:V,lineWidthMaxPixels:W},he=this.state.model;he.shaderInputs.setProps({scatterplot:ee}),he.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $u({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}q_.defaultProps=qL;q_.layerName="ScatterplotLayer";const X_={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function G_(i,e,t={}){return XL(i,t)!==e?(YL(i,t),!0):!1}function XL(i,e={}){return Math.sign(GL(i,e))}const iv={x:0,y:1,z:2};function GL(i,e={}){const{start:t=0,end:r=i.length,plane:o="xy"}=e,c=e.size||2;let f=0;const a=iv[o[0]],w=iv[o[1]];for(let P=t,k=r-c;P<r;P+=c)f+=(i[P+a]-i[k+a])*(i[P+w]+i[k+w]),k=P;return f/2}function YL(i,e){const{start:t=0,end:r=i.length,size:o=2}=e,c=(r-t)/o,f=Math.floor(c/2);for(let a=0;a<f;++a){const w=t+a*o,P=t+(c-1-a)*o;for(let k=0;k<o;++k){const F=i[w+k];i[w+k]=i[P+k],i[P+k]=F}}}function Ba(i,e){const t=e.length,r=i.length;if(r>0){let o=!0;for(let c=0;c<t;c++)if(i[r-t+c]!==e[c]){o=!1;break}if(o)return!1}for(let o=0;o<t;o++)i[r+o]=e[o];return!0}function Jm(i,e){const t=e.length;for(let r=0;r<t;r++)i[r]=e[r]}function HA(i,e,t,r,o=[]){const c=r+e*t;for(let f=0;f<t;f++)o[f]=i[c+f];return o}function e_(i,e,t,r,o=[]){let c,f;if(t&8)c=(r[3]-i[1])/(e[1]-i[1]),f=3;else if(t&4)c=(r[1]-i[1])/(e[1]-i[1]),f=1;else if(t&2)c=(r[2]-i[0])/(e[0]-i[0]),f=2;else if(t&1)c=(r[0]-i[0])/(e[0]-i[0]),f=0;else return null;for(let a=0;a<i.length;a++)o[a]=(f&1)===a?r[f]:c*(e[a]-i[a])+i[a];return o}function op(i,e){let t=0;return i[0]<e[0]?t|=1:i[0]>e[2]&&(t|=2),i[1]<e[1]?t|=4:i[1]>e[3]&&(t|=8),t}function K3(i,e){const{size:t=2,broken:r=!1,gridResolution:o=10,gridOffset:c=[0,0],startIndex:f=0,endIndex:a=i.length}=e||{},w=(a-f)/t;let P=[];const k=[P],F=HA(i,0,t,f);let V,W;const ee=eT(F,o,c,[]),he=[];Ba(P,F);for(let Ie=1;Ie<w;Ie++){for(V=HA(i,Ie,t,f,V),W=op(V,ee);W;){e_(F,V,W,ee,he);const Ee=op(he,ee);Ee&&(e_(F,he,Ee,ee,he),W=Ee),Ba(P,he),Jm(F,he),KL(ee,o,W),r&&P.length>t&&(P=[],k.push(P),Ba(P,F)),W=op(V,ee)}Ba(P,V),Jm(F,V)}return r?k:k[0]}const rv=0,QL=1;function J3(i,e=null,t){if(!i.length)return[];const{size:r=2,gridResolution:o=10,gridOffset:c=[0,0],edgeTypes:f=!1}=t||{},a=[],w=[{pos:i,types:f?new Array(i.length/r).fill(QL):null,holes:e||[]}],P=[[],[]];let k=[];for(;w.length;){const{pos:F,types:V,holes:W}=w.shift();JL(F,r,W[0]||F.length,P),k=eT(P[0],o,c,k);const ee=op(P[1],k);if(ee){let he=nv(F,V,r,0,W[0]||F.length,k,ee);const Ie={pos:he[0].pos,types:he[0].types,holes:[]},Ee={pos:he[1].pos,types:he[1].types,holes:[]};w.push(Ie,Ee);for(let Ne=0;Ne<W.length;Ne++)he=nv(F,V,r,W[Ne],W[Ne+1]||F.length,k,ee),he[0]&&(Ie.holes.push(Ie.pos.length),Ie.pos=jd(Ie.pos,he[0].pos),f&&(Ie.types=jd(Ie.types,he[0].types))),he[1]&&(Ee.holes.push(Ee.pos.length),Ee.pos=jd(Ee.pos,he[1].pos),f&&(Ee.types=jd(Ee.types,he[1].types)))}else{const he={positions:F};f&&(he.edgeTypes=V),W.length&&(he.holeIndices=W),a.push(he)}}return a}function nv(i,e,t,r,o,c,f){const a=(o-r)/t,w=[],P=[],k=[],F=[],V=[];let W,ee,he;const Ie=HA(i,a-1,t,r);let Ee=Math.sign(f&8?Ie[1]-c[3]:Ie[0]-c[2]),Ne=e&&e[a-1],Ce=0,De=0;for(let Ye=0;Ye<a;Ye++)W=HA(i,Ye,t,r,W),ee=Math.sign(f&8?W[1]-c[3]:W[0]-c[2]),he=e&&e[r/t+Ye],ee&&Ee&&Ee!==ee&&(e_(Ie,W,f,c,V),Ba(w,V)&&k.push(Ne),Ba(P,V)&&F.push(Ne)),ee<=0?(Ba(w,W)&&k.push(he),Ce-=ee):k.length&&(k[k.length-1]=rv),ee>=0?(Ba(P,W)&&F.push(he),De+=ee):F.length&&(F[F.length-1]=rv),Jm(Ie,W),Ee=ee,Ne=he;return[Ce?{pos:w,types:e&&k}:null,De?{pos:P,types:e&&F}:null]}function eT(i,e,t,r){const o=Math.floor((i[0]-t[0])/e)*e+t[0],c=Math.floor((i[1]-t[1])/e)*e+t[1];return r[0]=o,r[1]=c,r[2]=o+e,r[3]=c+e,r}function KL(i,e,t){t&8?(i[1]+=e,i[3]+=e):t&4?(i[1]-=e,i[3]-=e):t&2?(i[0]+=e,i[2]+=e):t&1&&(i[0]-=e,i[2]-=e)}function JL(i,e,t,r){let o=1/0,c=-1/0,f=1/0,a=-1/0;for(let w=0;w<t;w+=e){const P=i[w],k=i[w+1];o=P<o?P:o,c=P>c?P:c,f=k<f?k:f,a=k>a?k:a}return r[0][0]=o,r[0][1]=f,r[1][0]=c,r[1][1]=a,r}function jd(i,e){for(let t=0;t<e.length;t++)i.push(e[t]);return i}const e8=85.051129;function t8(i,e){const{size:t=2,startIndex:r=0,endIndex:o=i.length,normalize:c=!0}=e||{},f=i.slice(r,o);tT(f,t,0,o-r);const a=K3(f,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c)for(const w of a)iT(w,t);return a}function i8(i,e=null,t){const{size:r=2,normalize:o=!0,edgeTypes:c=!1}=t||{};e=e||[];const f=[],a=[];let w=0,P=0;for(let F=0;F<=e.length;F++){const V=e[F]||i.length,W=P,ee=r8(i,r,w,V);for(let he=ee;he<V;he++)f[P++]=i[he];for(let he=w;he<ee;he++)f[P++]=i[he];tT(f,r,W,P),n8(f,r,W,P,t==null?void 0:t.maxLatitude),w=V,a[F]=P}a.pop();const k=J3(f,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(o)for(const F of k)iT(F.positions,r);return k}function r8(i,e,t,r){let o=-1,c=-1;for(let f=t+1;f<r;f+=e){const a=Math.abs(i[f]);a>o&&(o=a,c=f-1)}return c}function n8(i,e,t,r,o=e8){const c=i[t],f=i[r-e];if(Math.abs(c-f)>180){const a=HA(i,0,e,t);a[0]+=Math.round((f-c)/360)*360,Ba(i,a),a[1]=Math.sign(a[1])*o,Ba(i,a),a[0]=c,Ba(i,a)}}function tT(i,e,t,r){let o=i[0],c;for(let f=t;f<r;f+=e){c=i[f];const a=c-o;(a>180||a<-180)&&(c-=Math.round(a/360)*360),i[f]=o=c}}function iT(i,e){let t;const r=i.length/e;for(let c=0;c<r&&(t=i[c*e],(t+180)%360===0);c++);const o=-Math.round(t/360)*360;if(o!==0)for(let c=0;c<r;c++)i[c*e]+=o}class s8 extends $u{constructor(e){const{indices:t,attributes:r}=o8(e);super({...e,indices:t,attributes:r})}}function o8(i){const{radius:e,height:t=1,nradial:r=10}=i;let{vertices:o}=i;o&&(rn.assert(o.length>=r),o=o.flatMap(W=>[W[0],W[1]]),G_(o,X_.COUNTER_CLOCKWISE));const c=t>0,f=r+1,a=c?f*3+1:r,w=Math.PI*2/r,P=new Uint16Array(c?r*3*2:0),k=new Float32Array(a*3),F=new Float32Array(a*3);let V=0;if(c){for(let W=0;W<f;W++){const ee=W*w,he=W%r,Ie=Math.sin(ee),Ee=Math.cos(ee);for(let Ne=0;Ne<2;Ne++)k[V+0]=o?o[he*2]:Ee*e,k[V+1]=o?o[he*2+1]:Ie*e,k[V+2]=(1/2-Ne)*t,F[V+0]=o?o[he*2]:Ee,F[V+1]=o?o[he*2+1]:Ie,V+=3}k[V+0]=k[V-3],k[V+1]=k[V-2],k[V+2]=k[V-1],V+=3}for(let W=c?0:1;W<f;W++){const ee=Math.floor(W/2)*Math.sign(.5-W%2),he=ee*w,Ie=(ee+r)%r,Ee=Math.sin(he),Ne=Math.cos(he);k[V+0]=o?o[Ie*2]:Ne*e,k[V+1]=o?o[Ie*2+1]:Ee*e,k[V+2]=t/2,F[V+2]=1,V+=3}if(c){let W=0;for(let ee=0;ee<r;ee++)P[W++]=ee*2+0,P[W++]=ee*2+2,P[W++]=ee*2+0,P[W++]=ee*2+1,P[W++]=ee*2+1,P[W++]=ee*2+3}return{indices:P,attributes:{POSITION:{size:3,value:k},NORMAL:{size:3,value:F}}}}const sv=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,a8={name:"column",vs:sv,fs:sv,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},l8=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,c8=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Lp=[0,0,0,255],u8={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:i=>i.position},getFillColor:{type:"accessor",value:Lp},getLineColor:{type:"accessor",value:Lp},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Y_ extends ql{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:l8,fs:c8,defines:e,modules:[pf,t?e3:F_,gf,a8]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Lp},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Lp},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var a;super.updateState(e);const{props:t,oldProps:r,changeFlags:o}=e,c=o.extensionsChanged||t.flatShading!==r.flatShading;c&&((a=this.state.models)==null||a.forEach(w=>w.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const f=this.getNumInstances();this.state.fillModel.setInstanceCount(f),this.state.wireframeModel.setInstanceCount(f),(c||t.diskResolution!==r.diskResolution||t.vertices!==r.vertices||(t.extruded||t.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(t)}getGeometry(e,t,r){const o=new s8({radius:1,height:r?2:0,vertices:t,nradial:e});let c=0;if(t)for(let f=0;f<e;f++){const a=t[f],w=Math.sqrt(a[0]*a[0]+a[1]*a[1]);c+=w/e}else c=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*c}),o}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),r=new Co(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),o=new Co(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:r,wireframeModel:o,models:[o,r]}}_updateGeometry({diskResolution:e,vertices:t,extruded:r,stroked:o}){const c=this.getGeometry(e,t,r||o);this.setState({fillVertexCount:c.attributes.POSITION.value.length/3});const f=this.state.fillModel,a=this.state.wireframeModel;f.setGeometry(c),f.setTopology("triangle-strip"),f.setIndexBuffer(null),a.setGeometry(c),a.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:r,lineWidthMinPixels:o,lineWidthMaxPixels:c,radiusUnits:f,elevationScale:a,extruded:w,filled:P,stroked:k,wireframe:F,offset:V,coverage:W,radius:ee,angle:he}=this.props,Ie=this.state.fillModel,Ee=this.state.wireframeModel,{fillVertexCount:Ne,edgeDistance:Ce}=this.state,De={radius:ee,angle:he/180*Math.PI,offset:V,extruded:w,stroked:k,coverage:W,elevationScale:a,edgeDistance:Ce,radiusUnits:La[f],widthUnits:La[t],widthScale:r,widthMinPixels:o,widthMaxPixels:c};w&&F&&(Ee.shaderInputs.setProps({column:{...De,isStroke:!0}}),Ee.draw(this.context.renderPass)),P&&(Ie.setVertexCount(Ne),Ie.shaderInputs.setProps({column:{...De,isStroke:!1}}),Ie.draw(this.context.renderPass)),!w&&k&&(Ie.setVertexCount(Ne*2/3),Ie.shaderInputs.setProps({column:{...De,isStroke:!0}}),Ie.draw(this.context.renderPass))}}Y_.layerName="ColumnLayer";Y_.defaultProps=u8;function h8(i,e,t,r){let o;if(Array.isArray(i[0])){const c=i.length*e;o=new Array(c);for(let f=0;f<i.length;f++)for(let a=0;a<e;a++)o[f*e+a]=i[f][a]||0}else o=i;return t?K3(o,{size:e,gridResolution:t}):r?t8(o,{size:e}):o}const f8=1,A8=2,im=4;class d8 extends Y3{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?h8(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(ov(e)){let r=0;for(const o of e)r+=this.getGeometrySize(o);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&ov(e))for(const r of e){const o=this.getGeometrySize(r);t.geometrySize=o,this.updateGeometryAttributes(r,t),t.vertexStart+=o}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,o=e?this.isClosed(e):!1,{vertexStart:c,geometrySize:f}=t;r.fill(0,c,c+f),o?(r[c]=im,r[c+f-2]=im):(r[c]+=f8,r[c+f-2]+=A8),r[c+f-1]=im}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:o,geometrySize:c}=t,f=new Array(3);for(let a=o,w=0;w<c;a++,w++)this.getPointOnPath(e,w,f),r[a*3]=f[0],r[a*3+1]=f[1],r[a*3+2]=f[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:o}=this;t*o>=e.length&&(t+=1-e.length/o);const c=t*o;return r[0]=e[c],r[1]=e[c+1],r[2]=o===3&&e[c+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function ov(i){return Array.isArray(i[0])}const av=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,p8={name:"path",vs:av,fs:av,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},g8=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,m8=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,rT=[0,0,0,255],_8={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:i=>i.path},getColor:{type:"accessor",value:rT},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},rm={enter:(i,e)=>e.length?e.subarray(e.length-i.length):i};class g0 extends ql{getShaders(){return super.getShaders({vs:g8,fs:m8,modules:[pf,gf,p8]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:rm,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:rm,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:rm,defaultValue:rT},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:o,target:c})=>this.encodePickingColor(r&&r.__source?r.__source.index:o,c)}}),this.setState({pathTesselator:new d8({fp64:this.use64bitPositions()})})}updateState(e){var f;super.updateState(e);const{props:t,changeFlags:r}=e,o=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,w=t.data.attributes||{};a.updateGeometry({data:t.data,geometryBuffer:w.getPath,buffers:w,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||o.invalidateAll()}r.extensionsChanged&&((f=this.state.model)==null||f.destroy(),this.state.model=this._getModel(),o.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find(c=>c.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:o,miterLimit:c,widthUnits:f,widthScale:a,widthMinPixels:w,widthMaxPixels:P}=this.props,k=this.state.model,F={jointType:Number(t),capType:Number(r),billboard:o,widthUnits:La[f],widthScale:a,miterLimit:c,widthMinPixels:w,widthMaxPixels:P};k.shaderInputs.setProps({path:F}),k.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $u({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}g0.defaultProps=_8;g0.layerName="PathLayer";var Vd={exports:{}},lv;function y8(){if(lv)return Vd.exports;lv=1,Vd.exports=i,Vd.exports.default=i;function i(Fe,tt,Me){Me=Me||2;var dt=tt&&tt.length,vt=dt?tt[0]*Me:Fe.length,Pt=e(Fe,0,vt,Me,!0),Ct=[];if(!Pt||Pt.next===Pt.prev)return Ct;var ei,Ai,oi,Zi,Oi,Li,Ar;if(dt&&(Pt=w(Fe,tt,Pt,Me)),Fe.length>80*Me){ei=oi=Fe[0],Ai=Zi=Fe[1];for(var Yi=Me;Yi<vt;Yi+=Me)Oi=Fe[Yi],Li=Fe[Yi+1],Oi<ei&&(ei=Oi),Li<Ai&&(Ai=Li),Oi>oi&&(oi=Oi),Li>Zi&&(Zi=Li);Ar=Math.max(oi-ei,Zi-Ai),Ar=Ar!==0?32767/Ar:0}return r(Pt,Ct,Me,ei,Ai,Ar,0),Ct}function e(Fe,tt,Me,dt,vt){var Pt,Ct;if(vt===zi(Fe,tt,Me,dt)>0)for(Pt=tt;Pt<Me;Pt+=dt)Ct=vi(Pt,Fe[Pt],Fe[Pt+1],Ct);else for(Pt=Me-dt;Pt>=tt;Pt-=dt)Ct=vi(Pt,Fe[Pt],Fe[Pt+1],Ct);return Ct&&De(Ct,Ct.next)&&(Xt(Ct),Ct=Ct.next),Ct}function t(Fe,tt){if(!Fe)return Fe;tt||(tt=Fe);var Me=Fe,dt;do if(dt=!1,!Me.steiner&&(De(Me,Me.next)||Ce(Me.prev,Me,Me.next)===0)){if(Xt(Me),Me=tt=Me.prev,Me===Me.next)break;dt=!0}else Me=Me.next;while(dt||Me!==tt);return tt}function r(Fe,tt,Me,dt,vt,Pt,Ct){if(Fe){!Ct&&Pt&&W(Fe,dt,vt,Pt);for(var ei=Fe,Ai,oi;Fe.prev!==Fe.next;){if(Ai=Fe.prev,oi=Fe.next,Pt?c(Fe,dt,vt,Pt):o(Fe)){tt.push(Ai.i/Me|0),tt.push(Fe.i/Me|0),tt.push(oi.i/Me|0),Xt(Fe),Fe=oi.next,ei=oi.next;continue}if(Fe=oi,Fe===ei){Ct?Ct===1?(Fe=f(t(Fe),tt,Me),r(Fe,tt,Me,dt,vt,Pt,2)):Ct===2&&a(Fe,tt,Me,dt,vt,Pt):r(t(Fe),tt,Me,dt,vt,Pt,1);break}}}}function o(Fe){var tt=Fe.prev,Me=Fe,dt=Fe.next;if(Ce(tt,Me,dt)>=0)return!1;for(var vt=tt.x,Pt=Me.x,Ct=dt.x,ei=tt.y,Ai=Me.y,oi=dt.y,Zi=vt<Pt?vt<Ct?vt:Ct:Pt<Ct?Pt:Ct,Oi=ei<Ai?ei<oi?ei:oi:Ai<oi?Ai:oi,Li=vt>Pt?vt>Ct?vt:Ct:Pt>Ct?Pt:Ct,Ar=ei>Ai?ei>oi?ei:oi:Ai>oi?Ai:oi,Yi=dt.next;Yi!==tt;){if(Yi.x>=Zi&&Yi.x<=Li&&Yi.y>=Oi&&Yi.y<=Ar&&Ee(vt,ei,Pt,Ai,Ct,oi,Yi.x,Yi.y)&&Ce(Yi.prev,Yi,Yi.next)>=0)return!1;Yi=Yi.next}return!0}function c(Fe,tt,Me,dt){var vt=Fe.prev,Pt=Fe,Ct=Fe.next;if(Ce(vt,Pt,Ct)>=0)return!1;for(var ei=vt.x,Ai=Pt.x,oi=Ct.x,Zi=vt.y,Oi=Pt.y,Li=Ct.y,Ar=ei<Ai?ei<oi?ei:oi:Ai<oi?Ai:oi,Yi=Zi<Oi?Zi<Li?Zi:Li:Oi<Li?Oi:Li,Fi=ei>Ai?ei>oi?ei:oi:Ai>oi?Ai:oi,wr=Zi>Oi?Zi>Li?Zi:Li:Oi>Li?Oi:Li,sr=he(Ar,Yi,tt,Me,dt),ur=he(Fi,wr,tt,Me,dt),qi=Fe.prevZ,Vt=Fe.nextZ;qi&&qi.z>=sr&&Vt&&Vt.z<=ur;){if(qi.x>=Ar&&qi.x<=Fi&&qi.y>=Yi&&qi.y<=wr&&qi!==vt&&qi!==Ct&&Ee(ei,Zi,Ai,Oi,oi,Li,qi.x,qi.y)&&Ce(qi.prev,qi,qi.next)>=0||(qi=qi.prevZ,Vt.x>=Ar&&Vt.x<=Fi&&Vt.y>=Yi&&Vt.y<=wr&&Vt!==vt&&Vt!==Ct&&Ee(ei,Zi,Ai,Oi,oi,Li,Vt.x,Vt.y)&&Ce(Vt.prev,Vt,Vt.next)>=0))return!1;Vt=Vt.nextZ}for(;qi&&qi.z>=sr;){if(qi.x>=Ar&&qi.x<=Fi&&qi.y>=Yi&&qi.y<=wr&&qi!==vt&&qi!==Ct&&Ee(ei,Zi,Ai,Oi,oi,Li,qi.x,qi.y)&&Ce(qi.prev,qi,qi.next)>=0)return!1;qi=qi.prevZ}for(;Vt&&Vt.z<=ur;){if(Vt.x>=Ar&&Vt.x<=Fi&&Vt.y>=Yi&&Vt.y<=wr&&Vt!==vt&&Vt!==Ct&&Ee(ei,Zi,Ai,Oi,oi,Li,Vt.x,Vt.y)&&Ce(Vt.prev,Vt,Vt.next)>=0)return!1;Vt=Vt.nextZ}return!0}function f(Fe,tt,Me){var dt=Fe;do{var vt=dt.prev,Pt=dt.next.next;!De(vt,Pt)&&Ye(vt,dt,dt.next,Pt)&&jt(vt,Pt)&&jt(Pt,vt)&&(tt.push(vt.i/Me|0),tt.push(dt.i/Me|0),tt.push(Pt.i/Me|0),Xt(dt),Xt(dt.next),dt=Fe=Pt),dt=dt.next}while(dt!==Fe);return t(dt)}function a(Fe,tt,Me,dt,vt,Pt){var Ct=Fe;do{for(var ei=Ct.next.next;ei!==Ct.prev;){if(Ct.i!==ei.i&&Ne(Ct,ei)){var Ai=Mt(Ct,ei);Ct=t(Ct,Ct.next),Ai=t(Ai,Ai.next),r(Ct,tt,Me,dt,vt,Pt,0),r(Ai,tt,Me,dt,vt,Pt,0);return}ei=ei.next}Ct=Ct.next}while(Ct!==Fe)}function w(Fe,tt,Me,dt){var vt=[],Pt,Ct,ei,Ai,oi;for(Pt=0,Ct=tt.length;Pt<Ct;Pt++)ei=tt[Pt]*dt,Ai=Pt<Ct-1?tt[Pt+1]*dt:Fe.length,oi=e(Fe,ei,Ai,dt,!1),oi===oi.next&&(oi.steiner=!0),vt.push(Ie(oi));for(vt.sort(P),Pt=0;Pt<vt.length;Pt++)Me=k(vt[Pt],Me);return Me}function P(Fe,tt){return Fe.x-tt.x}function k(Fe,tt){var Me=F(Fe,tt);if(!Me)return tt;var dt=Mt(Me,Fe);return t(dt,dt.next),t(Me,Me.next)}function F(Fe,tt){var Me=tt,dt=Fe.x,vt=Fe.y,Pt=-1/0,Ct;do{if(vt<=Me.y&&vt>=Me.next.y&&Me.next.y!==Me.y){var ei=Me.x+(vt-Me.y)*(Me.next.x-Me.x)/(Me.next.y-Me.y);if(ei<=dt&&ei>Pt&&(Pt=ei,Ct=Me.x<Me.next.x?Me:Me.next,ei===dt))return Ct}Me=Me.next}while(Me!==tt);if(!Ct)return null;var Ai=Ct,oi=Ct.x,Zi=Ct.y,Oi=1/0,Li;Me=Ct;do dt>=Me.x&&Me.x>=oi&&dt!==Me.x&&Ee(vt<Zi?dt:Pt,vt,oi,Zi,vt<Zi?Pt:dt,vt,Me.x,Me.y)&&(Li=Math.abs(vt-Me.y)/(dt-Me.x),jt(Me,Fe)&&(Li<Oi||Li===Oi&&(Me.x>Ct.x||Me.x===Ct.x&&V(Ct,Me)))&&(Ct=Me,Oi=Li)),Me=Me.next;while(Me!==Ai);return Ct}function V(Fe,tt){return Ce(Fe.prev,Fe,tt.prev)<0&&Ce(tt.next,Fe,Fe.next)<0}function W(Fe,tt,Me,dt){var vt=Fe;do vt.z===0&&(vt.z=he(vt.x,vt.y,tt,Me,dt)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==Fe);vt.prevZ.nextZ=null,vt.prevZ=null,ee(vt)}function ee(Fe){var tt,Me,dt,vt,Pt,Ct,ei,Ai,oi=1;do{for(Me=Fe,Fe=null,Pt=null,Ct=0;Me;){for(Ct++,dt=Me,ei=0,tt=0;tt<oi&&(ei++,dt=dt.nextZ,!!dt);tt++);for(Ai=oi;ei>0||Ai>0&&dt;)ei!==0&&(Ai===0||!dt||Me.z<=dt.z)?(vt=Me,Me=Me.nextZ,ei--):(vt=dt,dt=dt.nextZ,Ai--),Pt?Pt.nextZ=vt:Fe=vt,vt.prevZ=Pt,Pt=vt;Me=dt}Pt.nextZ=null,oi*=2}while(Ct>1);return Fe}function he(Fe,tt,Me,dt,vt){return Fe=(Fe-Me)*vt|0,tt=(tt-dt)*vt|0,Fe=(Fe|Fe<<8)&16711935,Fe=(Fe|Fe<<4)&252645135,Fe=(Fe|Fe<<2)&858993459,Fe=(Fe|Fe<<1)&1431655765,tt=(tt|tt<<8)&16711935,tt=(tt|tt<<4)&252645135,tt=(tt|tt<<2)&858993459,tt=(tt|tt<<1)&1431655765,Fe|tt<<1}function Ie(Fe){var tt=Fe,Me=Fe;do(tt.x<Me.x||tt.x===Me.x&&tt.y<Me.y)&&(Me=tt),tt=tt.next;while(tt!==Fe);return Me}function Ee(Fe,tt,Me,dt,vt,Pt,Ct,ei){return(vt-Ct)*(tt-ei)>=(Fe-Ct)*(Pt-ei)&&(Fe-Ct)*(dt-ei)>=(Me-Ct)*(tt-ei)&&(Me-Ct)*(Pt-ei)>=(vt-Ct)*(dt-ei)}function Ne(Fe,tt){return Fe.next.i!==tt.i&&Fe.prev.i!==tt.i&&!It(Fe,tt)&&(jt(Fe,tt)&&jt(tt,Fe)&&Lt(Fe,tt)&&(Ce(Fe.prev,Fe,tt.prev)||Ce(Fe,tt.prev,tt))||De(Fe,tt)&&Ce(Fe.prev,Fe,Fe.next)>0&&Ce(tt.prev,tt,tt.next)>0)}function Ce(Fe,tt,Me){return(tt.y-Fe.y)*(Me.x-tt.x)-(tt.x-Fe.x)*(Me.y-tt.y)}function De(Fe,tt){return Fe.x===tt.x&&Fe.y===tt.y}function Ye(Fe,tt,Me,dt){var vt=kt(Ce(Fe,tt,Me)),Pt=kt(Ce(Fe,tt,dt)),Ct=kt(Ce(Me,dt,Fe)),ei=kt(Ce(Me,dt,tt));return!!(vt!==Pt&&Ct!==ei||vt===0&&Ke(Fe,Me,tt)||Pt===0&&Ke(Fe,dt,tt)||Ct===0&&Ke(Me,Fe,dt)||ei===0&&Ke(Me,tt,dt))}function Ke(Fe,tt,Me){return tt.x<=Math.max(Fe.x,Me.x)&&tt.x>=Math.min(Fe.x,Me.x)&&tt.y<=Math.max(Fe.y,Me.y)&&tt.y>=Math.min(Fe.y,Me.y)}function kt(Fe){return Fe>0?1:Fe<0?-1:0}function It(Fe,tt){var Me=Fe;do{if(Me.i!==Fe.i&&Me.next.i!==Fe.i&&Me.i!==tt.i&&Me.next.i!==tt.i&&Ye(Me,Me.next,Fe,tt))return!0;Me=Me.next}while(Me!==Fe);return!1}function jt(Fe,tt){return Ce(Fe.prev,Fe,Fe.next)<0?Ce(Fe,tt,Fe.next)>=0&&Ce(Fe,Fe.prev,tt)>=0:Ce(Fe,tt,Fe.prev)<0||Ce(Fe,Fe.next,tt)<0}function Lt(Fe,tt){var Me=Fe,dt=!1,vt=(Fe.x+tt.x)/2,Pt=(Fe.y+tt.y)/2;do Me.y>Pt!=Me.next.y>Pt&&Me.next.y!==Me.y&&vt<(Me.next.x-Me.x)*(Pt-Me.y)/(Me.next.y-Me.y)+Me.x&&(dt=!dt),Me=Me.next;while(Me!==Fe);return dt}function Mt(Fe,tt){var Me=new Jt(Fe.i,Fe.x,Fe.y),dt=new Jt(tt.i,tt.x,tt.y),vt=Fe.next,Pt=tt.prev;return Fe.next=tt,tt.prev=Fe,Me.next=vt,vt.prev=Me,dt.next=Me,Me.prev=dt,Pt.next=dt,dt.prev=Pt,dt}function vi(Fe,tt,Me,dt){var vt=new Jt(Fe,tt,Me);return dt?(vt.next=dt.next,vt.prev=dt,dt.next.prev=vt,dt.next=vt):(vt.prev=vt,vt.next=vt),vt}function Xt(Fe){Fe.next.prev=Fe.prev,Fe.prev.next=Fe.next,Fe.prevZ&&(Fe.prevZ.nextZ=Fe.nextZ),Fe.nextZ&&(Fe.nextZ.prevZ=Fe.prevZ)}function Jt(Fe,tt,Me){this.i=Fe,this.x=tt,this.y=Me,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(Fe,tt,Me,dt){var vt=tt&&tt.length,Pt=vt?tt[0]*Me:Fe.length,Ct=Math.abs(zi(Fe,0,Pt,Me));if(vt)for(var ei=0,Ai=tt.length;ei<Ai;ei++){var oi=tt[ei]*Me,Zi=ei<Ai-1?tt[ei+1]*Me:Fe.length;Ct-=Math.abs(zi(Fe,oi,Zi,Me))}var Oi=0;for(ei=0;ei<dt.length;ei+=3){var Li=dt[ei]*Me,Ar=dt[ei+1]*Me,Yi=dt[ei+2]*Me;Oi+=Math.abs((Fe[Li]-Fe[Yi])*(Fe[Ar+1]-Fe[Li+1])-(Fe[Li]-Fe[Ar])*(Fe[Yi+1]-Fe[Li+1]))}return Ct===0&&Oi===0?0:Math.abs((Oi-Ct)/Ct)};function zi(Fe,tt,Me,dt){for(var vt=0,Pt=tt,Ct=Me-dt;Pt<Me;Pt+=dt)vt+=(Fe[Ct]-Fe[Pt])*(Fe[Pt+1]+Fe[Ct+1]),Ct=Pt;return vt}return i.flatten=function(Fe){for(var tt=Fe[0][0].length,Me={vertices:[],holes:[],dimensions:tt},dt=0,vt=0;vt<Fe.length;vt++){for(var Pt=0;Pt<Fe[vt].length;Pt++)for(var Ct=0;Ct<tt;Ct++)Me.vertices.push(Fe[vt][Pt][Ct]);vt>0&&(dt+=Fe[vt-1].length,Me.holes.push(dt))}return Me},Vd.exports}var b8=y8();const v8=Tx(b8),Wd=X_.CLOCKWISE,cv=X_.COUNTER_CLOCKWISE,Nc={};function x8(i){if(i=i&&i.positions||i,!Array.isArray(i)&&!ArrayBuffer.isView(i))throw new Error("invalid polygon")}function vA(i){return"positions"in i?i.positions:i}function ap(i){return"holeIndices"in i?i.holeIndices:null}function w8(i){return Array.isArray(i[0])}function T8(i){return i.length>=1&&i[0].length>=2&&Number.isFinite(i[0][0])}function S8(i){const e=i[0],t=i[i.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function E8(i,e,t,r){for(let o=0;o<e;o++)if(i[t+o]!==i[r-e+o])return!1;return!0}function uv(i,e,t,r,o){let c=e;const f=t.length;for(let a=0;a<f;a++)for(let w=0;w<r;w++)i[c++]=t[a][w]||0;if(!S8(t))for(let a=0;a<r;a++)i[c++]=t[0][a]||0;return Nc.start=e,Nc.end=c,Nc.size=r,G_(i,o,Nc),c}function hv(i,e,t,r,o=0,c,f){c=c||t.length;const a=c-o;if(a<=0)return e;let w=e;for(let P=0;P<a;P++)i[w++]=t[o+P];if(!E8(t,r,o,c))for(let P=0;P<r;P++)i[w++]=t[o+P];return Nc.start=e,Nc.end=w,Nc.size=r,G_(i,f,Nc),w}function nT(i,e){x8(i);const t=[],r=[];if("positions"in i){const{positions:o,holeIndices:c}=i;if(c){let f=0;for(let a=0;a<=c.length;a++)f=hv(t,f,o,e,c[a-1],c[a],a===0?Wd:cv),r.push(f);return r.pop(),{positions:t,holeIndices:r}}i=o}if(!w8(i))return hv(t,0,i,e,0,t.length,Wd),t;if(!T8(i)){let o=0;for(const[c,f]of i.entries())o=uv(t,o,f,e,c===0?Wd:cv),r.push(o);return r.pop(),{positions:t,holeIndices:r}}return uv(t,0,i,e,Wd),t}function nm(i,e,t){const r=i.length/3;let o=0;for(let c=0;c<r;c++){const f=(c+1)%r;o+=i[c*3+e]*i[f*3+t],o-=i[f*3+e]*i[c*3+t]}return Math.abs(o/2)}function fv(i,e,t,r){const o=i.length/3;for(let c=0;c<o;c++){const f=c*3,a=i[f+0],w=i[f+1],P=i[f+2];i[f+e]=a,i[f+t]=w,i[f+r]=P}}function C8(i,e,t,r){let o=ap(i);o&&(o=o.map(a=>a/e));let c=vA(i);const f=r&&e===3;if(t){const a=c.length;c=c.slice();const w=[];for(let P=0;P<a;P+=e){w[0]=c[P],w[1]=c[P+1],f&&(w[2]=c[P+2]);const k=t(w);c[P]=k[0],c[P+1]=k[1],f&&(c[P+2]=k[2])}}if(f){const a=nm(c,0,1),w=nm(c,0,2),P=nm(c,1,2);if(!a&&!w&&!P)return[];a>w&&a>P||(w>P?(t||(c=c.slice()),fv(c,0,2,1)):(t||(c=c.slice()),fv(c,2,0,1)))}return v8(c,o,e)}class I8 extends Y3{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=nT(e,this.positionSize);return this.opts.resolution?J3(vA(t),ap(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?i8(vA(t),ap(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(Av(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return vA(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&Av(e))for(const r of e){const o=this.getGeometrySize(r);t.geometrySize=o,this.updateGeometryAttributes(r,t),t.vertexStart+=o,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const r=e;this._updateIndices(r,t),this._updatePositions(r,t),this._updateVertexValid(r,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:o}){const{attributes:c,indexStarts:f,typedArrayManager:a}=this;let w=c.indices;if(!w||!e)return;let P=o;const k=C8(e,this.positionSize,this.opts.preproject,this.opts.full3d);w=a.allocate(w,o+k.length,{copy:!0});for(let F=0;F<k.length;F++)w[P++]=k[F]+r;f[t+1]=o+k.length,c.indices=w}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:o},positionSize:c}=this;if(!o||!e)return;const f=vA(e);for(let a=t,w=0;w<r;a++,w++){const P=f[w*c],k=f[w*c+1],F=c>2?f[w*c+2]:0;o[a*3]=P,o[a*3+1]=k,o[a*3+2]=F}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:o}=this,c=this.attributes.vertexValid,f=e&&ap(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,t):c.fill(1,t,t+r),f)for(let a=0;a<f.length;a++)c[t+f[a]/o-1]=0;c[t+r-1]=0}}function Av(i){return Array.isArray(i)&&i.length>0&&!Number.isFinite(i[0])}const dv=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,P8={name:"solidPolygon",vs:dv,fs:dv,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},sT=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,M8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${sT}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,R8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${sT}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,k8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fp=[0,0,0,255],D8={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:i=>i.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Fp},getLineColor:{type:"accessor",value:Fp},material:!0},Hd={enter:(i,e)=>e.length?e.subarray(e.length-i.length):i};class m0 extends ql{getShaders(e){return super.getShaders({vs:e==="top"?M8:R8,fs:k8,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[pf,F_,gf,P8]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&t===Cr.DEFAULT&&(t=Cr.LNGLAT);let o;t===Cr.LNGLAT&&(r?o=e.projectPosition.bind(e):o=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new I8({preproject:o,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const c=this.getAttributeManager(),f=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:f},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Hd,accessor:"getPolygon",update:this.calculatePositions,noAlloc:f,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:f},elevations:{size:1,stepMode:"dynamic",transition:Hd,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Hd,accessor:"getFillColor",defaultValue:Fp},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Hd,accessor:"getLineColor",defaultValue:Fp},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:w,target:P})=>this.encodePickingColor(a&&a.__source?a.__source.index:w,P)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find(c=>c.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:o,elevationScale:c}=this.props,{topModel:f,sideModel:a,wireframeModel:w,polygonTesselator:P}=this.state,k={extruded:!!t,elevationScale:c,isWireframe:!1};w&&o&&(w.setInstanceCount(P.instanceCount-1),w.shaderInputs.setProps({solidPolygon:{...k,isWireframe:!0}}),w.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(P.instanceCount-1),a.shaderInputs.setProps({solidPolygon:k}),a.draw(this.context.renderPass)),f&&r&&(f.setVertexCount(P.vertexCount),f.shaderInputs.setProps({solidPolygon:k}),f.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:o}=e,c=this.getAttributeManager();(o.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(w=>w.destroy()),this.setState(this._getModels()),c.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,f=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:r}=this.props;let o,c,f;if(t){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const w=this.getAttributeManager().getBufferLayouts({isInstanced:!1});o=new Co(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:w,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});c=new Co(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new $u({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),f=new Co(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new $u({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[c,f,o].filter(Boolean),topModel:o,sideModel:c,wireframeModel:f}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}m0.defaultProps=D8;m0.layerName="SolidPolygonLayer";function oT({data:i,getIndex:e,dataRange:t,replace:r}){const{startRow:o=0,endRow:c=1/0}=t,f=i.length;let a=f,w=f;for(let V=0;V<f;V++){const W=e(i[V]);if(a>V&&W>=o&&(a=V),W>=c){w=V;break}}let P=a;const F=w-a!==r.length?i.slice(w):void 0;for(let V=0;V<r.length;V++)i[P++]=r[V];if(F){for(let V=0;V<F.length;V++)i[P++]=F[V];i.length=P}return{startRow:a,endRow:a+r.length}}const aT=[0,0,0,255],B8=[0,0,0,255],O8={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:i=>i.polygon},getFillColor:{type:"accessor",value:B8},getLineColor:{type:"accessor",value:aT},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class _0 extends yf{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&rn.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),o=e.dataChanged.map(c=>oT({data:r,getIndex:f=>f.__source.index,dataRange:c,replace:this._getPaths(c)}));this.setState({paths:r,pathsDiff:o})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:r,positionFormat:o,_normalize:c}=this.props,f=[],a=o==="XY"?2:3,{startRow:w,endRow:P}=e,{iterable:k,objectInfo:F}=_f(t,w,P);for(const V of k){F.index++;let W=r(V,F);c&&(W=nT(W,a));const{holeIndices:ee}=W,he=W.positions||W;if(ee)for(let Ie=0;Ie<=ee.length;Ie++){const Ee=he.slice(ee[Ie-1]||0,ee[Ie]||he.length);f.push(this.getSubLayerRow({path:Ee},V,F.index))}else f.push(this.getSubLayerRow({path:he},V,F.index))}return f}renderLayers(){const{data:e,_dataDiff:t,stroked:r,filled:o,extruded:c,wireframe:f,_normalize:a,_windingOrder:w,elevationScale:P,transitions:k,positionFormat:F}=this.props,{lineWidthUnits:V,lineWidthScale:W,lineWidthMinPixels:ee,lineWidthMaxPixels:he,lineJointRounded:Ie,lineMiterLimit:Ee,lineDashJustified:Ne}=this.props,{getFillColor:Ce,getLineColor:De,getLineWidth:Ye,getLineDashArray:Ke,getElevation:kt,getPolygon:It,updateTriggers:jt,material:Lt}=this.props,{paths:Mt,pathsDiff:vi}=this.state,Xt=this.getSubLayerClass("fill",m0),Jt=this.getSubLayerClass("stroke",g0),zi=this.shouldRenderSubLayer("fill",Mt)&&new Xt({_dataDiff:t,extruded:c,elevationScale:P,filled:o,wireframe:f,_normalize:a,_windingOrder:w,getElevation:kt,getFillColor:Ce,getLineColor:c&&f?De:aT,material:Lt,transitions:k},this.getSubLayerProps({id:"fill",updateTriggers:jt&&{getPolygon:jt.getPolygon,getElevation:jt.getElevation,getFillColor:jt.getFillColor,lineColors:c&&f,getLineColor:jt.getLineColor}}),{data:e,positionFormat:F,getPolygon:It}),Fe=!c&&r&&this.shouldRenderSubLayer("stroke",Mt)&&new Jt({_dataDiff:vi&&(()=>vi),widthUnits:V,widthScale:W,widthMinPixels:ee,widthMaxPixels:he,jointRounded:Ie,miterLimit:Ee,dashJustified:Ne,_pathType:"loop",transitions:k&&{getWidth:k.getLineWidth,getColor:k.getLineColor,getPath:k.getPolygon},getColor:this.getSubLayerAccessor(De),getWidth:this.getSubLayerAccessor(Ye),getDashArray:this.getSubLayerAccessor(Ke)},this.getSubLayerProps({id:"stroke",updateTriggers:jt&&{getWidth:jt.getLineWidth,getColor:jt.getLineColor,getDashArray:jt.getLineDashArray}}),{data:Mt,positionFormat:F,getPath:tt=>tt.path});return[!c&&zi,Fe,c&&zi]}}_0.layerName="PolygonLayer";_0.defaultProps=O8;function L8(i,e){if(!i)return null;const t="startIndices"in i?i.startIndices[e]:e,r=i.featureIds.value[t];return t!==-1?F8(i,r,t):null}function F8(i,e,t){const r={properties:{...i.properties[e]}};for(const o in i.numericProps)r.properties[o]=i.numericProps[o].value[t];return r}function N8(i,e){const t={points:null,lines:null,polygons:null};for(const r in t){const o=i[r].globalFeatureIds.value;t[r]=new Uint8ClampedArray(o.length*4);const c=[];for(let f=0;f<o.length;f++)e(o[f],c),t[r][f*4+0]=c[0],t[r][f*4+1]=c[1],t[r][f*4+2]=c[2],t[r][f*4+3]=255}return t}const pv=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,z8={name:"sdf",vs:pv,fs:pv,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},U8=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,sm=192/256,gv=[],j8={getIconOffsets:{type:"accessor",value:i=>i.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Q_ extends p0{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,z8],fs:U8}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:r,target:o})=>this.encodePickingColor(r,o)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:o}=t;o!==r.outlineColor&&(o=o.map(c=>c/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!t.sdf&&t.outlineWidth&&rn.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:r,outlineWidth:o}=this.props,{outlineColor:c}=this.state,f=o?Math.max(r,sm*(1-o)):-1,a=this.state.model,w={buffer:sm,outlineBuffer:f,gamma:r,enabled:!!t,outlineColor:c};if(a.shaderInputs.setProps({sdf:w}),super.draw(e),t&&o){const{iconManager:P}=this.state;P.getTexture()&&(a.shaderInputs.setProps({sdf:{...w,outlineBuffer:sm}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):gv}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):gv}}Q_.defaultProps=j8;Q_.layerName="MultiIconLayer";const Np=1e20;class V8{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=r;const w=this.size=e+t*4,P=this._createCanvas(w),k=this.ctx=P.getContext("2d",{willReadFrequently:!0});k.font=`${a} ${f} ${e}px ${c}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(e),a=Math.ceil(r),w=0,P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),k=Math.min(this.size-this.buffer,a+Math.ceil(o)),F=P+2*this.buffer,V=k+2*this.buffer,W=Math.max(F*V,0),ee=new Uint8ClampedArray(W),he={data:ee,width:F,height:V,glyphWidth:P,glyphHeight:k,glyphTop:a,glyphLeft:w,glyphAdvance:t};if(P===0||k===0)return he;const{ctx:Ie,buffer:Ee,gridInner:Ne,gridOuter:Ce}=this;Ie.clearRect(Ee,Ee,P,k),Ie.fillText(e,Ee,Ee+a);const De=Ie.getImageData(Ee,Ee,P,k);Ce.fill(Np,0,W),Ne.fill(0,0,W);for(let Ye=0;Ye<k;Ye++)for(let Ke=0;Ke<P;Ke++){const kt=De.data[4*(Ye*P+Ke)+3]/255;if(kt===0)continue;const It=(Ye+Ee)*F+Ke+Ee;if(kt===1)Ce[It]=0,Ne[It]=Np;else{const jt=.5-kt;Ce[It]=jt>0?jt*jt:0,Ne[It]=jt<0?jt*jt:0}}mv(Ce,0,0,F,V,F,this.f,this.v,this.z),mv(Ne,Ee,Ee,P,k,F,this.f,this.v,this.z);for(let Ye=0;Ye<W;Ye++){const Ke=Math.sqrt(Ce[Ye])-Math.sqrt(Ne[Ye]);ee[Ye]=Math.round(255-255*(Ke/this.radius+this.cutoff))}return he}}function mv(i,e,t,r,o,c,f,a,w){for(let P=e;P<e+r;P++)_v(i,t*c+P,c,o,f,a,w);for(let P=t;P<t+o;P++)_v(i,P*c+e,1,r,f,a,w)}function _v(i,e,t,r,o,c,f){c[0]=0,f[0]=-1e20,f[1]=Np,o[0]=i[e];for(let a=1,w=0,P=0;a<r;a++){o[a]=i[e+a*t];const k=a*a;do{const F=c[w];P=(o[a]-o[F]+k-F*F)/(a-F)/2}while(P<=f[w]&&--w>-1);w++,c[w]=a,f[w]=P,f[w+1]=Np}for(let a=0,w=0;a<r;a++){for(;f[w+1]<a;)w++;const P=c[w],k=a-P;i[e+a*t]=o[P]+k*k}}const W8=32,H8=[];function $8(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function Z8({characterSet:i,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:o,mapping:c={},xOffset:f=0,yOffset:a=0}){let w=0,P=f;const k=t+r*2;for(const F of i)if(!c[F]){const V=e(F);P+V+r*2>o&&(P=0,w++),c[F]={x:P+r,y:a+w*k+r,width:V,height:k,layoutWidth:V,layoutHeight:t},P+=V+r*2}return{mapping:c,xOffset:P,yOffset:a+w*k,canvasHeight:$8(a+(w+1)*k)}}function lT(i,e,t,r){var c;let o=0;for(let f=e;f<t;f++){const a=i[f];o+=((c=r[a])==null?void 0:c.layoutWidth)||0}return o}function cT(i,e,t,r,o,c){let f=e,a=0;for(let w=e;w<t;w++){const P=lT(i,w,w+1,o);a+P>r&&(f<w&&c.push(w),f=w,a=0),a+=P}return a}function q8(i,e,t,r,o,c){let f=e,a=e,w=e,P=0;for(let k=e;k<t;k++)if((i[k]===" "||i[k+1]===" "||k+1===t)&&(w=k+1),w>a){let F=lT(i,a,w,o);P+F>r&&(f<a&&(c.push(a),f=a,P=0),F>r&&(F=cT(i,a,w,r,o,c),f=c[c.length-1])),a=w,P+=F}return P}function X8(i,e,t,r,o=0,c){c===void 0&&(c=i.length);const f=[];return e==="break-all"?cT(i,o,c,t,r,f):q8(i,o,c,t,r,f),f}function G8(i,e,t,r,o,c){let f=0,a=0;for(let w=e;w<t;w++){const P=i[w],k=r[P];k?(a||(a=k.layoutHeight),o[w]=f+k.layoutWidth/2,f+=k.layoutWidth):(rn.warn(`Missing character: ${P} (${P.codePointAt(0)})`)(),o[w]=f,f+=W8)}c[0]=f,c[1]=a}function Y8(i,e,t,r,o){var Ie;const c=Array.from(i),f=c.length,a=new Array(f),w=new Array(f),P=new Array(f),k=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,F=[0,0],V=[0,0];let W=0,ee=0,he=0;for(let Ee=0;Ee<=f;Ee++){const Ne=c[Ee];if((Ne===`
`||Ee===f)&&(he=Ee),he>ee){const Ce=k?X8(c,t,r,o,ee,he):H8;for(let De=0;De<=Ce.length;De++){const Ye=De===0?ee:Ce[De-1],Ke=De<Ce.length?Ce[De]:he;G8(c,Ye,Ke,o,a,V);for(let kt=Ye;kt<Ke;kt++){a[kt]-V[0]/2;const It=c[kt],jt=((Ie=o[It])==null?void 0:Ie.layoutOffsetY)||0;w[kt]=W+V[1]/2+jt,P[kt]=V[0]}W=W+V[1]*e,F[0]=Math.max(F[0],V[0])}ee=he}Ne===`
`&&(a[ee]=0,w[ee]=0,P[ee]=0,ee++)}return F[1]=W,{x:a,y:w,rowWidth:P,size:F}}function Q8({value:i,length:e,stride:t,offset:r,startIndices:o,characterSet:c}){const f=i.BYTES_PER_ELEMENT,a=t?t/f:1,w=r?r/f:0,P=o[e]||Math.ceil((i.length-w)/a),k=c&&new Set,F=new Array(e);let V=i;if(a>1||w>0){const W=i.constructor;V=new W(P);for(let ee=0;ee<P;ee++)V[ee]=i[ee*a+w]}for(let W=0;W<e;W++){const ee=o[W],he=o[W+1]||P,Ie=V.subarray(ee,he);F[W]=String.fromCodePoint.apply(null,Ie),k&&Ie.forEach(k.add,k)}if(k)for(const W of k)c.add(String.fromCodePoint(W));return{texts:F,characterCount:P}}class uT{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function K8(){const i=[];for(let e=32;e<128;e++)i.push(String.fromCharCode(e));return i}const Qh={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:K8(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},yv=1024,bv=.9,vv=1.2,hT=3;let zp=new uT(hT);function J8(i,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=zp.get(i);if(!r)return t;for(const o in r.mapping)t.has(o)&&t.delete(o);return t}function e5(i,e){for(let t=0;t<i.length;t++)e.data[4*t+3]=i[t]}function xv(i,e,t,r){i.font=`${r} ${t}px ${e}`,i.fillStyle="#000",i.textBaseline="alphabetic",i.textAlign="left"}function t5(i){rn.assert(Number.isFinite(i)&&i>=hT,"Invalid cache limit"),zp=new uT(i)}class i5{constructor(){this.props={...Qh}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*vv+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=J8(this._key,this.props.characterSet),r=zp.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const o=this._generateFontAtlas(t,r);this._atlas=o,zp.set(this._key,o)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:o,fontSize:c,buffer:f,sdf:a,radius:w,cutoff:P}=this.props;let k=t&&t.data;k||(k=document.createElement("canvas"),k.width=yv);const F=k.getContext("2d",{willReadFrequently:!0});xv(F,r,c,o);const{mapping:V,canvasHeight:W,xOffset:ee,yOffset:he}=Z8({getFontWidth:Ie=>F.measureText(Ie).width,fontHeight:c*vv,buffer:f,characterSet:e,maxCanvasWidth:yv,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(k.height!==W){const Ie=F.getImageData(0,0,k.width,k.height);k.height=W,F.putImageData(Ie,0,0)}if(xv(F,r,c,o),a){const Ie=new V8({fontSize:c,buffer:f,radius:w,cutoff:P,fontFamily:r,fontWeight:`${o}`});for(const Ee of e){const{data:Ne,width:Ce,height:De,glyphTop:Ye}=Ie.draw(Ee);V[Ee].width=Ce,V[Ee].layoutOffsetY=c*bv-Ye;const Ke=F.createImageData(Ce,De);e5(Ne,Ke),F.putImageData(Ke,V[Ee].x,V[Ee].y)}}else for(const Ie of e)F.fillText(Ie,V[Ie].x,V[Ie].y+f+c*bv);return{xOffset:ee,yOffset:he,mapping:V,data:k,width:k.width,height:k.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:o,sdf:c,radius:f,cutoff:a}=this.props;return c?`${e} ${t} ${r} ${o} ${f} ${a}`:`${e} ${t} ${r} ${o}`}}const wv=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,r5={name:"textBackground",vs:wv,fs:wv,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},n5=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,s5=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,o5={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:i=>i.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class K_ extends ql{getShaders(){return super.getShaders({vs:n5,fs:s5,modules:[pf,gf,r5]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:o,sizeMinPixels:c,sizeMaxPixels:f,getLineWidth:a}=this.props;let{padding:w,borderRadius:P}=this.props;w.length<4&&(w=[w[0],w[1],w[0],w[1]]),Array.isArray(P)||(P=[P,P,P,P]);const k=this.state.model,F={billboard:t,stroked:!!a,borderRadius:P,padding:w,sizeUnits:La[o],sizeScale:r,sizeMinPixels:c,sizeMaxPixels:f};k.shaderInputs.setProps({textBackground:F}),k.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new $u({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}K_.defaultProps=o5;K_.layerName="TextBackgroundLayer";const Tv={start:1,middle:0,end:-1},Sv={top:1,center:0,bottom:-1},om=[0,0,0,255],a5=1,l5={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:om},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Qh.characterSet},fontFamily:Qh.fontFamily,fontWeight:Qh.fontWeight,lineHeight:a5,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:om},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:i=>i.text},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:om},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class J_ extends yf{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,o]}=this.transformParagraph(e,t);const{fontSize:c}=this.state.fontAtlasManager.props;r/=c,o/=c;const{getTextAnchor:f,getAlignmentBaseline:a}=this.props,w=Tv[typeof f=="function"?f(e,t):f],P=Sv[typeof a=="function"?a(e,t):a];return[(w-1)*r/2,(P-1)*o/2,r,o]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:r,getAlignmentBaseline:o}=this.props,{x:c,y:f,rowWidth:a,size:[w,P]}=this.transformParagraph(e,t),k=Tv[typeof r=="function"?r(e,t):r],F=Sv[typeof o=="function"?o(e,t):o],V=c.length,W=new Array(V*2);let ee=0;for(let he=0;he<V;he++){const Ie=(1-k)*(w-a[he])/2;W[ee++]=(k-1)*w/2+Ie+c[he],W[ee++]=(F-1)*P/2+f[he]}return W}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new i5},this.props.maxWidth>0&&rn.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:o}=e;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:o,characterSet:c}=this.state,f={...e,characterSet:c,fontFamily:t,fontWeight:r};if(!o.mapping)return o.setProps(f),!0;for(const a in f)if(f[a]!==o.props[a])return o.setProps(f),!0;return!1}_updateText(){var w;const{data:e,characterSet:t}=this.props,r=(w=e.attributes)==null?void 0:w.getText;let{getText:o}=this.props,c=e.startIndices,f;const a=t==="auto"&&new Set;if(r&&c){const{texts:P,characterCount:k}=Q8({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:c,characterSet:a});f=k,o=(F,{index:V})=>P[V]}else{const{iterable:P,objectInfo:k}=_f(e);c=[0],f=0;for(const F of P){k.index++;const V=Array.from(o(F,k)||"");a&&V.forEach(a.add,a),f+=V.length,c.push(f)}}this.setState({getText:o,startIndices:c,numInstances:f,characterSet:a||t})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,o=r.mapping,c=this.state.getText,{wordBreak:f,lineHeight:a,maxWidth:w}=this.props,P=c(e,t)||"";return Y8(P,a,f,w*r.props.fontSize,o)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:o,atlas:c,mapping:f},styleVersion:a}=this.state,{data:w,_dataDiff:P,getPosition:k,getColor:F,getSize:V,getAngle:W,getPixelOffset:ee,getBackgroundColor:he,getBorderColor:Ie,getBorderWidth:Ee,backgroundBorderRadius:Ne,backgroundPadding:Ce,background:De,billboard:Ye,fontSettings:Ke,outlineWidth:kt,outlineColor:It,sizeScale:jt,sizeUnits:Lt,sizeMinPixels:Mt,sizeMaxPixels:vi,transitions:Xt,updateTriggers:Jt}=this.props,zi=this.getSubLayerClass("characters",Q_),Fe=this.getSubLayerClass("background",K_);return[De&&new Fe({getFillColor:he,getLineColor:Ie,getLineWidth:Ee,borderRadius:Ne,padding:Ce,getPosition:k,getSize:V,getAngle:W,getPixelOffset:ee,billboard:Ye,sizeScale:jt,sizeUnits:Lt,sizeMinPixels:Mt,sizeMaxPixels:vi,transitions:Xt&&{getPosition:Xt.getPosition,getAngle:Xt.getAngle,getSize:Xt.getSize,getFillColor:Xt.getBackgroundColor,getLineColor:Xt.getBorderColor,getLineWidth:Xt.getBorderWidth,getPixelOffset:Xt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Jt.getPosition,getAngle:Jt.getAngle,getSize:Jt.getSize,getFillColor:Jt.getBackgroundColor,getLineColor:Jt.getBorderColor,getLineWidth:Jt.getBorderWidth,getPixelOffset:Jt.getPixelOffset,getBoundingRect:{getText:Jt.getText,getTextAnchor:Jt.getTextAnchor,getAlignmentBaseline:Jt.getAlignmentBaseline,styleVersion:a}}}),{data:w.attributes&&w.attributes.background?{length:w.length,attributes:w.attributes.background}:w,_dataDiff:P,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new zi({sdf:Ke.sdf,smoothing:Number.isFinite(Ke.smoothing)?Ke.smoothing:Qh.smoothing,outlineWidth:kt/(Ke.radius||Qh.radius),outlineColor:It,iconAtlas:c,iconMapping:f,getPosition:k,getColor:F,getSize:V,getAngle:W,getPixelOffset:ee,billboard:Ye,sizeScale:jt*o,sizeUnits:Lt,sizeMinPixels:Mt*o,sizeMaxPixels:vi*o,transitions:Xt&&{getPosition:Xt.getPosition,getAngle:Xt.getAngle,getColor:Xt.getColor,getSize:Xt.getSize,getPixelOffset:Xt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Jt.getText,getPosition:Jt.getPosition,getAngle:Jt.getAngle,getColor:Jt.getColor,getSize:Jt.getSize,getPixelOffset:Jt.getPixelOffset,getIconOffsets:{getTextAnchor:Jt.getTextAnchor,getAlignmentBaseline:Jt.getAlignmentBaseline,styleVersion:a}}}),{data:w,_dataDiff:P,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){t5(e)}}J_.defaultProps=l5;J_.layerName="TextLayer";const lp={circle:{type:q_,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:p0,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:J_,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},cp={type:g0,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},t_={type:m0,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function lA({type:i,props:e}){const t={};for(const r in e)t[r]=i.defaultProps[e[r]];return t}function am(i,e){const{transitions:t,updateTriggers:r}=i.props,o={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const c in e){const f=e[c];let a=i.props[c];c.startsWith("get")&&(a=i.getSubLayerAccessor(a),o.updateTriggers[f]=r[c],t&&(o.transitions[f]=t[c])),o[f]=a}return o}function c5(i){if(Array.isArray(i))return i;switch(rn.assert(i.type,"GeoJSON does not have type"),i.type){case"Feature":return[i];case"FeatureCollection":return rn.assert(Array.isArray(i.features),"GeoJSON does not have features array"),i.features;default:return[{geometry:i}]}}function Ev(i,e,t={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:c=i.length}=t;for(let f=o;f<c;f++){const a=i[f],{geometry:w}=a;if(w)if(w.type==="GeometryCollection"){rn.assert(Array.isArray(w.geometries),"GeoJSON does not have geometries array");const{geometries:P}=w;for(let k=0;k<P.length;k++){const F=P[k];Cv(F,r,e,a,f)}}else Cv(w,r,e,a,f)}return r}function Cv(i,e,t,r,o){const{type:c,coordinates:f}=i,{pointFeatures:a,lineFeatures:w,polygonFeatures:P,polygonOutlineFeatures:k}=e;if(!h5(c,f)){rn.warn(`${c} coordinates are malformed`)();return}switch(c){case"Point":a.push(t({geometry:i},r,o));break;case"MultiPoint":f.forEach(F=>{a.push(t({geometry:{type:"Point",coordinates:F}},r,o))});break;case"LineString":w.push(t({geometry:i},r,o));break;case"MultiLineString":f.forEach(F=>{w.push(t({geometry:{type:"LineString",coordinates:F}},r,o))});break;case"Polygon":P.push(t({geometry:i},r,o)),f.forEach(F=>{k.push(t({geometry:{type:"LineString",coordinates:F}},r,o))});break;case"MultiPolygon":f.forEach(F=>{P.push(t({geometry:{type:"Polygon",coordinates:F}},r,o)),F.forEach(V=>{k.push(t({geometry:{type:"LineString",coordinates:V}},r,o))})});break}}const u5={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function h5(i,e){let t=u5[i];for(rn.assert(t,`Unknown GeoJSON type ${i}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function fT(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function $d(i){return i.geometry.coordinates}function f5(i,e){const t=fT(),{pointFeatures:r,lineFeatures:o,polygonFeatures:c,polygonOutlineFeatures:f}=i;return t.points.data=r,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=$d,t.lines.data=o,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=$d,t.polygons.data=c,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=$d,t.polygonsOutline.data=f,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=$d,t}function A5(i,e){const t=fT(),{points:r,lines:o,polygons:c}=i,f=N8(i,e);return t.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:f.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:f.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.lines._pathType="open",t.polygons.data={length:c.polygonIndices.value.length-1,startIndices:c.polygonIndices.value,attributes:{...c.attributes,getPolygon:c.positions,pickingColors:{size:4,value:f.polygons}},properties:c.properties,numericProps:c.numericProps,featureIds:c.featureIds},t.polygons._normalize=!1,c.triangles&&(t.polygons.data.attributes.indices=c.triangles.value),t.polygonsOutline.data={length:c.primitivePolygonIndices.value.length-1,startIndices:c.primitivePolygonIndices.value,attributes:{...c.attributes,getPath:c.positions,instancePickingColors:{size:4,value:f.polygons}},properties:c.properties,numericProps:c.numericProps,featureIds:c.featureIds},t.polygonsOutline._pathType="open",t}const d5=["points","linestrings","polygons"],p5={...lA(lp.circle),...lA(lp.icon),...lA(lp.text),...lA(cp),...lA(t_),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:i=>i.properties.icon},getText:{type:"accessor",value:i=>i.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class qu extends yf{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:r}=this.props,o=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:o}),o?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const r=A5(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){const r=c5(e.data),o=this.getSubLayerRow.bind(this);let c={};const f={};if(Array.isArray(t.dataChanged)){const w=this.state.features;for(const P in w)c[P]=w[P].slice(),f[P]=[];for(const P of t.dataChanged){const k=Ev(r,o,P);for(const F in w)f[F].push(oT({data:c[F],getIndex:V=>V.__source.index,dataRange:P,replace:k[F]}))}}else c=Ev(r,o);const a=f5(c,f);this.setState({features:c,featuresDiff:f,layerProps:a})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r,sourceLayer:o}=t;return t.featureType=d5.find(c=>o.id.startsWith(`${this.id}-${c}-`)),r>=0&&o.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,r=e.featureType==="points";for(const o of this.getSubLayers())o.id.startsWith(t)===r&&o.updateAutoHighlight(e)}_renderPolygonLayer(){var f;const{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,o="polygons-fill",c=this.shouldRenderSubLayer(o,(f=r.polygons)==null?void 0:f.data)&&this.getSubLayerClass(o,t_.type);if(c){const a=am(this,t_.props),w=e&&t;return w||delete a.getLineColor,a.updateTriggers.lineColors=w,new c(a,this.getSubLayerProps({id:o,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var w,P;const{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,o="polygons-stroke",c="linestrings",f=!e&&t&&this.shouldRenderSubLayer(o,(w=r.polygonsOutline)==null?void 0:w.data)&&this.getSubLayerClass(o,cp.type),a=this.shouldRenderSubLayer(c,(P=r.lines)==null?void 0:P.data)&&this.getSubLayerClass(c,cp.type);if(f||a){const k=am(this,cp.props);return[f&&new f(k,this.getSubLayerProps({id:o,updateTriggers:k.updateTriggers}),r.polygonsOutline),a&&new a(k,this.getSubLayerProps({id:c,updateTriggers:k.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:t,binary:r}=this.state;let{highlightedObjectIndex:o}=this.props;!r&&Number.isFinite(o)&&(o=t.points.data.findIndex(w=>w.__source.index===o));const c=new Set(e.split("+")),f=[];for(const w of c){const P=`points-${w}`,k=lp[w],F=k&&this.shouldRenderSubLayer(P,(a=t.points)==null?void 0:a.data)&&this.getSubLayerClass(P,k.type);if(F){const V=am(this,k.props);let W=t.points;if(w==="text"&&r){const{instancePickingColors:ee,...he}=W.data.attributes;W={...W,data:{...W.data,attributes:he}}}f.push(new F(V,this.getSubLayerProps({id:P,updateTriggers:V.updateTriggers,highlightedObjectIndex:o}),W))}}return f}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),r=this._renderLineLayers(),o=this._renderPointLayers();return[!e&&t,r,o,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(r,o)=>{const{data:c,index:f}=o,a=L8(c,f);return e(a,o)}}}qu.layerName="GeoJsonLayer";qu.defaultProps=p5;class g5{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:r,onError:o}){const{index:c,id:f,bbox:a,userData:w,zoom:P}=this,k=this._loaderId;this._abortController=new AbortController;const{signal:F}=this._abortController,V=await t.scheduleRequest(this,he=>he.isSelected?1:-1);if(!V){this._isCancelled=!0;return}if(this._isCancelled){V.done();return}let W=null,ee;try{W=await e({index:c,id:f,bbox:a,userData:w,zoom:P,signal:F})}catch(he){ee=he||!0}finally{V.done()}if(k===this._loaderId){if(this._loader=void 0,this.content=W,this._isCancelled&&!W){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,ee?o(ee,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Us={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},Iv=new wi,m5=new wi;class ey{constructor(e=[0,0,0],t=[0,0,0],r){r=r||Iv.copy(e).add(t).scale(.5),this.center=new wi(r),this.halfDiagonal=new wi(t).subtract(this.center),this.minimum=new wi(e),this.maximum=new wi(t)}clone(){return new ey(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,r=m5.from(e.normal),o=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),c=this.center.dot(r)+e.distance;return c-o>0?Us.INSIDE:c+o<0?Us.OUTSIDE:Us.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Iv.from(e).subtract(this.center),{halfDiagonal:r}=this;let o=0,c;return c=Math.abs(t.x)-r.x,c>0&&(o+=c*c),c=Math.abs(t.y)-r.y,c>0&&(o+=c*c),c=Math.abs(t.z)-r.z,c>0&&(o+=c*c),o}}const cA=new wi,Pv=new wi;class ty{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new wi,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=cA.from(t),this.center=new wi().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new ty(this.center,this.radius)}union(e){const t=this.center,r=this.radius,o=e.center,c=e.radius,f=cA.copy(o).subtract(t),a=f.magnitude();if(r>=a+c)return this.clone();if(c>=a+r)return e.clone();const w=(r+a+c)*.5;return Pv.copy(f).scale((-r+w)/a).add(t),this.center.copy(Pv),this.radius=w,this}expand(e){const r=cA.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=zR(cA,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=cA.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,c=e.normal.dot(t)+e.distance;return c<-r?Us.OUTSIDE:c<r?Us.INTERSECTING:Us.INSIDE}}const _5=new wi,y5=new wi,Zd=new wi,qd=new wi,Xd=new wi,b5=new wi,v5=new wi,zl={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class iy{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new wi().from(e),this.halfAxes=new Ps(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new wi(e).len(),new wi(t).len(),new wi(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),o=new wi(e).normalize(),c=new wi(t).normalize(),f=new wi(r).normalize();return new nb().fromMatrix3(new Ps([...o,...c,...f]))}fromCenterHalfSizeQuaternion(e,t,r){const o=new nb(r),c=new Ps().fromQuaternion(o);return c[0]=c[0]*t[0],c[1]=c[1]*t[0],c[2]=c[2]*t[0],c[3]=c[3]*t[1],c[4]=c[4]*t[1],c[5]=c[5]*t[1],c[6]=c[6]*t[2],c[7]=c[7]*t[2],c[8]=c[8]*t[2],this.center=new wi().from(e),this.halfAxes=c,this}clone(){return new iy(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new ty){const t=this.halfAxes,r=t.getColumn(0,Zd),o=t.getColumn(1,qd),c=t.getColumn(2,Xd),f=_5.copy(r).add(o).add(c);return e.center.copy(this.center),e.radius=f.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,o=this.halfAxes,c=r.x,f=r.y,a=r.z,w=Math.abs(c*o[zl.COLUMN0ROW0]+f*o[zl.COLUMN0ROW1]+a*o[zl.COLUMN0ROW2])+Math.abs(c*o[zl.COLUMN1ROW0]+f*o[zl.COLUMN1ROW1]+a*o[zl.COLUMN1ROW2])+Math.abs(c*o[zl.COLUMN2ROW0]+f*o[zl.COLUMN2ROW1]+a*o[zl.COLUMN2ROW2]),P=r.dot(t)+e.distance;return P<=-w?Us.OUTSIDE:P>=w?Us.INSIDE:Us.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=y5.from(e).subtract(this.center),r=this.halfAxes,o=r.getColumn(0,Zd),c=r.getColumn(1,qd),f=r.getColumn(2,Xd),a=o.magnitude(),w=c.magnitude(),P=f.magnitude();o.normalize(),c.normalize(),f.normalize();let k=0,F;return F=Math.abs(t.dot(o))-a,F>0&&(k+=F*F),F=Math.abs(t.dot(c))-w,F>0&&(k+=F*F),F=Math.abs(t.dot(f))-P,F>0&&(k+=F*F),k}computePlaneDistances(e,t,r=[-0,-0]){let o=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;const f=this.center,a=this.halfAxes,w=a.getColumn(0,Zd),P=a.getColumn(1,qd),k=a.getColumn(2,Xd),F=b5.copy(w).add(P).add(k).add(f),V=v5.copy(F).subtract(e);let W=t.dot(V);return o=Math.min(W,o),c=Math.max(W,c),F.copy(f).add(w).add(P).subtract(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),F.copy(f).add(w).subtract(P).add(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),F.copy(f).add(w).subtract(P).subtract(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),f.copy(F).subtract(w).add(P).add(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),f.copy(F).subtract(w).add(P).subtract(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),f.copy(F).subtract(w).subtract(P).add(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),f.copy(F).subtract(w).subtract(P).subtract(k),V.copy(F).subtract(e),W=t.dot(V),o=Math.min(W,o),c=Math.max(W,c),r[0]=o,r[1]=c,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Zd);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,qd);r.transformAsPoint(e);const o=this.halfAxes.getColumn(2,Xd);return o.transformAsPoint(e),this.halfAxes=new Ps([...t,...r,...o]),this}getTransform(){throw new Error("not implemented")}}const Mv=new wi,Rv=new wi;class $A{constructor(e=[0,0,1],t=0){this.normal=new wi,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return NA(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=Mv.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,o){return this.normal.set(e,t,r),NA(Uc(this.normal.len(),1)),this.distance=o,this}clone(){return new $A(this.normal,this.distance)}equals(e){return Uc(this.distance,e.distance)&&Uc(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=Rv.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){const r=Mv.from(e),o=this.getPointDistance(r),c=Rv.copy(this.normal).scale(o);return r.subtract(c).to(t)}}const kv=[new wi([1,0,0]),new wi([0,1,0]),new wi([0,0,1])],Dv=new wi,x5=new wi;class Hl{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*kv.length;const t=e.center,r=e.radius;let o=0;for(const c of kv){let f=this.planes[o],a=this.planes[o+1];f||(f=this.planes[o]=new $A),a||(a=this.planes[o+1]=new $A);const w=Dv.copy(c).scale(-r).add(t);f.fromPointNormal(w,c);const P=Dv.copy(c).scale(r).add(t),k=x5.copy(c).negate();a.fromPointNormal(P,k),o+=2}return this}computeVisibility(e){let t=Us.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Us.OUTSIDE:return Us.OUTSIDE;case Us.INTERSECTING:t=Us.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(NA(Number.isFinite(t),"parentPlaneMask is required."),t===Hl.MASK_OUTSIDE||t===Hl.MASK_INSIDE)return t;let r=Hl.MASK_INSIDE;const o=this.planes;for(let c=0;c<this.planes.length;++c){const f=c<31?1<<c:0;if(c<31&&(t&f)===0)continue;const a=o[c],w=e.intersectPlane(a);if(w===Us.OUTSIDE)return Hl.MASK_OUTSIDE;w===Us.INTERSECTING&&(r|=f)}return r}}Hl.MASK_OUTSIDE=4294967295;Hl.MASK_INSIDE=0;Hl.MASK_INDETERMINATE=2147483647;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;new wi;const hl=new Ps,w5=new Ps,T5=new Ps,Gd=new Ps,Bv=new Ps;function S5(i,e={}){const t=wk,r=10;let o=0,c=0;const f=w5,a=T5;f.identity(),a.copy(i);const w=t*E5(a);for(;c<r&&C5(a)>w;)I5(a,Gd),Bv.copy(Gd).transpose(),a.multiplyRight(Gd),a.multiplyLeft(Bv),f.multiplyRight(Gd),++o>2&&(++c,o=0);return e.unitary=f.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function E5(i){let e=0;for(let t=0;t<9;++t){const r=i[t];e+=r*r}return Math.sqrt(e)}const i_=[1,0,0],r_=[2,2,1];function C5(i){let e=0;for(let t=0;t<3;++t){const r=i[hl.getElementIndex(r_[t],i_[t])];e+=2*r*r}return Math.sqrt(e)}function I5(i,e){const t=xk;let r=0,o=1;for(let P=0;P<3;++P){const k=Math.abs(i[hl.getElementIndex(r_[P],i_[P])]);k>r&&(o=P,r=k)}const c=i_[o],f=r_[o];let a=1,w=0;if(Math.abs(i[hl.getElementIndex(f,c)])>t){const P=i[hl.getElementIndex(f,f)],k=i[hl.getElementIndex(c,c)],F=i[hl.getElementIndex(f,c)],V=(P-k)/2/F;let W;V<0?W=-1/(-V+Math.sqrt(1+V*V)):W=1/(V+Math.sqrt(1+V*V)),a=1/Math.sqrt(1+W*W),w=W*a}return Ps.IDENTITY.to(e),e[hl.getElementIndex(c,c)]=e[hl.getElementIndex(f,f)]=a,e[hl.getElementIndex(f,c)]=w,e[hl.getElementIndex(c,f)]=-w,e}const Pc=new wi,P5=new wi,M5=new wi,R5=new wi,k5=new wi,D5=new Ps,B5={diagonal:new Ps,unitary:new Ps};function O5(i,e=new iy){if(!i||i.length===0)return e.halfAxes=new Ps([0,0,0,0,0,0,0,0,0]),e.center=new wi,e;const t=i.length,r=new wi(0,0,0);for(const jt of i)r.add(jt);const o=1/t;r.multiplyByScalar(o);let c=0,f=0,a=0,w=0,P=0,k=0;for(const jt of i){const Lt=Pc.copy(jt).subtract(r);c+=Lt.x*Lt.x,f+=Lt.x*Lt.y,a+=Lt.x*Lt.z,w+=Lt.y*Lt.y,P+=Lt.y*Lt.z,k+=Lt.z*Lt.z}c*=o,f*=o,a*=o,w*=o,P*=o,k*=o;const F=D5;F[0]=c,F[1]=f,F[2]=a,F[3]=f,F[4]=w,F[5]=P,F[6]=a,F[7]=P,F[8]=k;const{unitary:V}=S5(F,B5),W=e.halfAxes.copy(V);let ee=W.getColumn(0,M5),he=W.getColumn(1,R5),Ie=W.getColumn(2,k5),Ee=-Number.MAX_VALUE,Ne=-Number.MAX_VALUE,Ce=-Number.MAX_VALUE,De=Number.MAX_VALUE,Ye=Number.MAX_VALUE,Ke=Number.MAX_VALUE;for(const jt of i)Pc.copy(jt),Ee=Math.max(Pc.dot(ee),Ee),Ne=Math.max(Pc.dot(he),Ne),Ce=Math.max(Pc.dot(Ie),Ce),De=Math.min(Pc.dot(ee),De),Ye=Math.min(Pc.dot(he),Ye),Ke=Math.min(Pc.dot(Ie),Ke);ee=ee.multiplyByScalar(.5*(De+Ee)),he=he.multiplyByScalar(.5*(Ye+Ne)),Ie=Ie.multiplyByScalar(.5*(Ke+Ce)),e.center.copy(ee).add(he).add(Ie);const kt=P5.set(Ee-De,Ne-Ye,Ce-Ke).multiplyByScalar(.5),It=new Ps([kt[0],0,0,0,kt[1],0,0,0,kt[2]]);return e.halfAxes.multiplyRight(It),e}const Zh=512,L5=3,AT=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],dT=AT.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),F5=dT.concat([[.25,.5],[.75,.5]]);class qh{constructor(e,t,r){this.x=e,this.y=t,this.z=r}get children(){if(!this._children){const e=this.x*2,t=this.y*2,r=this.z+1;this._children=[new qh(e,t,r),new qh(e,t+1,r),new qh(e+1,t,r),new qh(e+1,t+1,r)]}return this._children}update(e){const{viewport:t,cullingVolume:r,elevationBounds:o,minZ:c,maxZ:f,bounds:a,offset:w,project:P}=e,k=this.getBoundingVolume(o,w,P);if(a&&!this.insideBounds(a)||r.computeVisibility(k)<0)return!1;if(!this.childVisible){let{z:V}=this;if(V<f&&V>=c){const W=k.distanceTo(t.cameraPosition)*t.scale/t.height;V+=Math.floor(Math.log2(W))}if(V>=f)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const V of this.children)V.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,r,o]){const c=Math.pow(2,this.z),f=Zh/c;return this.x*f<r&&this.y*f<o&&(this.x+1)*f>e&&(this.y+1)*f>t}getBoundingVolume(e,t,r){if(r){const w=this.z<1?F5:this.z<2?dT:AT,P=[];for(const k of w){const F=s_(this.x+k[0],this.y+k[1],this.z);F[2]=e[0],P.push(r(F)),e[0]!==e[1]&&(F[2]=e[1],P.push(r(F)))}return O5(P)}const o=Math.pow(2,this.z),c=Zh/o,f=this.x*c+t*Zh,a=Zh-(this.y+1)*c;return new ey([f,a,e[0]],[f+c,a+c,e[1]])}}function N5(i,e,t,r){const o=i instanceof PL&&i.resolution?i.projectPosition:null,c=Object.values(i.getFrustumPlanes()).map(({normal:W,distance:ee})=>new $A(W.clone().negate(),ee)),f=new Hl(c),a=i.distanceScales.unitsPerMeter[2],w=t&&t[0]*a||0,P=t&&t[1]*a||0,k=i instanceof Hu&&i.pitch<=60?e:0;if(r){const[W,ee,he,Ie]=r,Ee=sf([W,Ie]),Ne=sf([he,ee]);r=[Ee[0],Zh-Ee[1],Ne[0],Zh-Ne[1]]}const F=new qh(0,0,0),V={viewport:i,project:o,cullingVolume:f,elevationBounds:[w,P],minZ:k,maxZ:e,bounds:r,offset:0};if(F.update(V),i instanceof Hu&&i.subViewports&&i.subViewports.length>1){for(V.offset=-1;F.update(V)&&!(--V.offset<-3););for(V.offset=1;F.update(V)&&!(++V.offset>L5););}return F.getSelected()}const Zl=512,z5=[-1/0,-1/0,1/0,1/0],pT={type:"object",value:null,validate:(i,e)=>e.optional&&i===null||typeof i=="string"||Array.isArray(i)&&i.every(t=>typeof t=="string"),equal:(i,e)=>{if(i===e)return!0;if(!Array.isArray(i)||!Array.isArray(e))return!1;const t=i.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}};function gT(i,e){const t=[e.transformAsPoint([i[0],i[1]]),e.transformAsPoint([i[2],i[1]]),e.transformAsPoint([i[0],i[3]]),e.transformAsPoint([i[2],i[3]])];return[Math.min(...t.map(o=>o[0])),Math.min(...t.map(o=>o[1])),Math.max(...t.map(o=>o[0])),Math.max(...t.map(o=>o[1]))]}function U5(i){return Math.abs(i.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function mT(i,e){if(!i||!i.length)return null;const{index:t,id:r}=e;if(Array.isArray(i)){const c=U5(r)%i.length;i=i[c]}let o=i;for(const c of Object.keys(t)){const f=new RegExp(`{${c}}`,"g");o=o.replace(f,String(t[c]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(o=o.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),o}function j5(i,e,t){let r;return r=i.getBounds(),i.isGeospatial?[Math.max(r[0],t[0]),Math.max(r[1],t[1]),Math.min(r[2],t[2]),Math.min(r[3],t[3])]:[Math.max(Math.min(r[0],t[2]),t[0]),Math.max(Math.min(r[1],t[3]),t[1]),Math.min(Math.max(r[2],t[0]),t[2]),Math.min(Math.max(r[3],t[1]),t[3])]}function V5({viewport:i,z:e,cullRect:t}){return(i.subViewports||[i]).map(o=>n_(o,e||0,t))}function n_(i,e,t){if(!Array.isArray(e)){const c=t.x-i.x,f=t.y-i.y,{width:a,height:w}=t,P={targetZ:e},k=i.unproject([c,f],P),F=i.unproject([c+a,f],P),V=i.unproject([c,f+w],P),W=i.unproject([c+a,f+w],P);return[Math.min(k[0],F[0],V[0],W[0]),Math.min(k[1],F[1],V[1],W[1]),Math.max(k[0],F[0],V[0],W[0]),Math.max(k[1],F[1],V[1],W[1])]}const r=n_(i,e[0],t),o=n_(i,e[1],t);return[Math.min(r[0],o[0]),Math.min(r[1],o[1]),Math.max(r[2],o[2]),Math.max(r[3],o[3])]}function W5(i,e,t){return t?gT(i,t).map(o=>o*e/Zl):i.map(r=>r*e/Zl)}function ry(i,e){return Math.pow(2,i)*Zl/e}function s_(i,e,t){const r=ry(t,Zl),o=i/r*360-180,c=Math.PI-2*Math.PI*e/r,f=180/Math.PI*Math.atan(.5*(Math.exp(c)-Math.exp(-c)));return[o,f]}function Ov(i,e,t,r){const o=ry(t,r);return[i/o*Zl,e/o*Zl]}function H5(i,e,t,r,o=Zl){if(i.isGeospatial){const[P,k]=s_(e,t,r),[F,V]=s_(e+1,t+1,r);return{west:P,north:k,east:F,south:V}}const[c,f]=Ov(e,t,r,o),[a,w]=Ov(e+1,t+1,r,o);return{left:c,top:f,right:a,bottom:w}}function $5(i,e,t,r,o){const c=j5(i,null,r),f=ry(e,t),[a,w,P,k]=W5(c,f,o),F=[];for(let V=Math.floor(a);V<P;V++)for(let W=Math.floor(w);W<k;W++)F.push({x:V,y:W,z:e});return F}function Z5({viewport:i,maxZoom:e,minZoom:t,zRange:r,extent:o,tileSize:c=Zl,modelMatrix:f,modelMatrixInverse:a,zoomOffset:w=0}){let P=i.isGeospatial?Math.round(i.zoom+Math.log2(Zl/c))+w:Math.ceil(i.zoom)+w;if(typeof t=="number"&&Number.isFinite(t)&&P<t){if(!o)return[];P=t}typeof e=="number"&&Number.isFinite(e)&&P>e&&(P=e);let k=o;return f&&a&&o&&!i.isGeospatial&&(k=gT(o,f)),i.isGeospatial?N5(i,P,r,o):$5(i,P,c,k||z5,a)}function q5(i){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(i)}function X5(i){return Number.isFinite(i.west)&&Number.isFinite(i.north)&&Number.isFinite(i.east)&&Number.isFinite(i.south)}function G5(i){let e={},t;return r=>{for(const o in r)if(!Y5(r[o],e[o])){t=i(r),e=r;break}return t}}function Y5(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}const Lv=1,y0=2,Q5="never",K5="no-overlap",ny="best-available",J5=5,eF={[ny]:rF,[K5]:nF,[Q5]:()=>{}},tF={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class iF{constructor(e){this._getCullBounds=G5(V5),this.opts={...tF,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var r,o;(o=(r=this.opts).onTileLoad)==null||o.call(r,t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new JI({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Eo,this._modelMatrixInverse=new Eo}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:r}={zRange:null,modelMatrix:null}){const o=r?new Eo(r):new Eo,c=!o.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Uc(this._zRange,t)||c){c&&(this._modelMatrixInverse=o.clone().invert(),this._modelMatrix=o),this._viewport=e,this._zRange=t;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(w=>this._getTile(w,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const f=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),f&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:o}=e;for(const[c,f,a,w]of r){let P;if("west"in o)P=o.west<a&&o.east>c&&o.south<w&&o.north>f;else{const k=Math.min(o.top,o.bottom),F=Math.max(o.top,o.bottom);P=o.left<a&&o.right>c&&k<w&&F>f}if(P)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:r,zRange:o,modelMatrix:c,modelMatrixInverse:f}){const{tileSize:a,extent:w,zoomOffset:P}=this.opts;return Z5({viewport:e,maxZoom:t,minZoom:r,zRange:o,tileSize:a,extent:w,modelMatrix:c,modelMatrixInverse:f,zoomOffset:P})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:H5(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),r=Math.floor(e.y/2),o=e.z-1;return{x:t,y:r,z:o}}updateTileStates(){const e=this.opts.refinementStrategy||ny,t=new Array(this._cache.size);let r=0;for(const o of this._cache.values())t[r++]=o.isVisible,o.isSelected=!1,o.isVisible=!1;for(const o of this._selectedTiles)o.isSelected=!0,o.isVisible=!0;(typeof e=="function"?e:eF[e])(Array.from(this._cache.values())),r=0;for(const o of this._cache.values())if(t[r++]!==o.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let r=0;for(const o of this._cache.values())o.isLoading&&(r++,!o.isSelected&&!o.isVisible&&t.push(o));for(;e>0&&r>e&&t.length>0;)t.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const r=this._getNearestAncestor(t);t.parent=r,r!=null&&r.children&&r.children.push(t)}}_resizeCache(){var f,a;const{_cache:e,opts:t}=this,r=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:J5*this.selectedTiles.length),o=t.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>o){for(const[w,P]of e)if(!P.isVisible&&!P.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?P.byteLength:0,e.delete(w),(a=(f=this.opts).onTileUnload)==null||a.call(f,P)),e.size<=r&&this._cacheByteSize<=o)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((w,P)=>w.zoom-P.zoom),this._dirty=!1)}_getTile(e,t){const r=this.getTileId(e);let o=this._cache.get(r),c=!1;return!o&&t?(o=new g5(e),Object.assign(o,this.getTileMetadata(o.index)),Object.assign(o,{id:r,zoom:this.getTileZoom(o.index)}),c=!0,this._cache.set(r,o),this._dirty=!0):o&&o.needsReload&&(c=!0),o&&c&&o.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),o}_getNearestAncestor(e){const{_minZoom:t=0}=this;let r=e.index;for(;this.getTileZoom(r)>t;){r=this.getParentIndex(r);const o=this._getTile(r);if(o)return o}return null}}function rF(i){for(const e of i)e.state=0;for(const e of i)e.isSelected&&!_T(e)&&sy(e);for(const e of i)e.isVisible=!!(e.state&y0)}function nF(i){for(const t of i)t.state=0;for(const t of i)t.isSelected&&_T(t);const e=Array.from(i).sort((t,r)=>t.zoom-r.zoom);for(const t of e)if(t.isVisible=!!(t.state&y0),t.children&&(t.isVisible||t.state&Lv))for(const r of t.children)r.state=Lv;else t.isSelected&&sy(t)}function _T(i){let e=i;for(;e;){if(e.isLoaded||e.content)return e.state|=y0,!0;e=e.parent}return!1}function sy(i){for(const e of i.children)e.isLoaded||e.content?e.state|=y0:sy(e)}const sF={TilesetClass:iF,data:{type:"data",value:[]},dataComparator:pT.equal,renderSubLayers:{type:"function",value:i=>new qu(i)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:i=>console.error(i)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:ny,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class oy extends yf{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,r;return!!((r=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&r.every(o=>o.isLoaded&&o.layers&&o.layers.every(c=>c.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,o=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?r&&(t.setOptions(this._getTilesetOptions()),o?t.reloadAll():t.tiles.forEach(c=>{c.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:r,refinementStrategy:o,extent:c,maxZoom:f,minZoom:a,maxRequests:w,debounceTime:P,zoomOffset:k}=this.props;return{maxCacheSize:t,maxCacheByteSize:r,maxZoom:f,minZoom:a,tileSize:e,refinementStrategy:o,extent:c,maxRequests:w,debounceTime:P,zoomOffset:k,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:r}=this.props,o=e.update(this.context.viewport,{zRange:t,modelMatrix:r}),{isLoaded:c}=e,f=this.state.isLoaded!==c,a=this.state.frameNumber!==o;c&&(f||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:o}),this.state.isLoaded=c}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:r,fetch:o}=this.props,{signal:c}=e;return e.url=typeof t=="string"||Array.isArray(t)?mT(t,e):null,r?r(e):o&&e.url?o(e.url,{propName:"data",layer:this,signal:c}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,r=t.props.tile,o=e.info;return o.picked&&(o.tile=r),o.sourceTile=r,o.sourceTileSubLayer=t,o}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(r=>e.layers[0].props[r]!==t[r])&&(e.layers=e.layers.map(r=>r.clone(t)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=v3(r,Boolean).map(o=>o.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,t)}}oy.defaultProps=sF;oy.layerName="TileLayer";var wn=function(i){i=i||{};var e=typeof i<"u"?i:{},t={},r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);var o="";function c(Qe){return e.locateFile?e.locateFile(Qe,o):o+Qe}var f;typeof document<"u"&&document.currentScript&&(o=document.currentScript.src),o.indexOf("blob:")!==0?o=o.substr(0,o.lastIndexOf("/")+1):o="",f=function(ht,We,Tt){var A=new XMLHttpRequest;A.open("GET",ht,!0),A.responseType="arraybuffer",A.onload=function(){if(A.status==200||A.status==0&&A.response){We(A.response);return}var ri=ae(ht);if(ri){We(ri.buffer);return}Tt()},A.onerror=Tt,A.send(null)};var a=e.print||console.log.bind(console),w=e.printErr||console.warn.bind(console);for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);t=null,e.arguments&&e.arguments;var P=0,k=function(Qe){P=Qe},F=function(){return P},V=8;function W(Qe,ht,We,Tt){switch(We=We||"i8",We.charAt(We.length-1)==="*"&&(We="i32"),We){case"i1":vi[Qe>>0]=ht;break;case"i8":vi[Qe>>0]=ht;break;case"i16":Jt[Qe>>1]=ht;break;case"i32":zi[Qe>>2]=ht;break;case"i64":js=[ht>>>0,(Sn=ht,+sr(Sn)>=1?Sn>0?(Vt(+qi(Sn/4294967296),4294967295)|0)>>>0:~~+ur((Sn-+(~~Sn>>>0))/4294967296)>>>0:0)],zi[Qe>>2]=js[0],zi[Qe+4>>2]=js[1];break;case"float":Fe[Qe>>2]=ht;break;case"double":tt[Qe>>3]=ht;break;default:gi("invalid type for setValue: "+We)}}function ee(Qe,ht,We){switch(ht=ht||"i8",ht.charAt(ht.length-1)==="*"&&(ht="i32"),ht){case"i1":return vi[Qe>>0];case"i8":return vi[Qe>>0];case"i16":return Jt[Qe>>1];case"i32":return zi[Qe>>2];case"i64":return zi[Qe>>2];case"float":return Fe[Qe>>2];case"double":return tt[Qe>>3];default:gi("invalid type for getValue: "+ht)}return null}var he=!1;function Ie(Qe,ht){Qe||gi("Assertion failed: "+ht)}function Ee(Qe){var ht=e["_"+Qe];return Ie(ht,"Cannot call unknown function "+Qe+", make sure it is exported"),ht}function Ne(Qe,ht,We,Tt,A){var ie={string:function(si){var En=0;if(si!=null&&si!==0){var Mo=(si.length<<2)+1;En=ge(Mo),It(si,En,Mo)}return En},array:function(si){var En=ge(si.length);return jt(si,En),En}};function ri(si){return ht==="string"?Ke(si):ht==="boolean"?!!si:si}var _t=Ee(Qe),ui=[],ni=0;if(Tt)for(var Ei=0;Ei<Tt.length;Ei++){var Tr=ie[We[Ei]];Tr?(ni===0&&(ni=Ge()),ui[Ei]=Tr(Tt[Ei])):ui[Ei]=Tt[Ei]}var Xi=_t.apply(null,ui);return Xi=ri(Xi),ni!==0&&ut(ni),Xi}function Ce(Qe,ht,We,Tt){We=We||[];var A=We.every(function(ri){return ri==="number"}),ie=ht!=="string";return ie&&A&&!Tt?Ee(Qe):function(){return Ne(Qe,ht,We,arguments)}}var De=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Ye(Qe,ht,We){for(var Tt=ht+We,A=ht;Qe[A]&&!(A>=Tt);)++A;if(A-ht>16&&Qe.subarray&&De)return De.decode(Qe.subarray(ht,A));for(var ie="";ht<A;){var ri=Qe[ht++];if(!(ri&128)){ie+=String.fromCharCode(ri);continue}var _t=Qe[ht++]&63;if((ri&224)==192){ie+=String.fromCharCode((ri&31)<<6|_t);continue}var ui=Qe[ht++]&63;if((ri&240)==224?ri=(ri&15)<<12|_t<<6|ui:ri=(ri&7)<<18|_t<<12|ui<<6|Qe[ht++]&63,ri<65536)ie+=String.fromCharCode(ri);else{var ni=ri-65536;ie+=String.fromCharCode(55296|ni>>10,56320|ni&1023)}}return ie}function Ke(Qe,ht){return Qe?Ye(Xt,Qe,ht):""}function kt(Qe,ht,We,Tt){if(!(Tt>0))return 0;for(var A=We,ie=We+Tt-1,ri=0;ri<Qe.length;++ri){var _t=Qe.charCodeAt(ri);if(_t>=55296&&_t<=57343){var ui=Qe.charCodeAt(++ri);_t=65536+((_t&1023)<<10)|ui&1023}if(_t<=127){if(We>=ie)break;ht[We++]=_t}else if(_t<=2047){if(We+1>=ie)break;ht[We++]=192|_t>>6,ht[We++]=128|_t&63}else if(_t<=65535){if(We+2>=ie)break;ht[We++]=224|_t>>12,ht[We++]=128|_t>>6&63,ht[We++]=128|_t&63}else{if(We+3>=ie)break;ht[We++]=240|_t>>18,ht[We++]=128|_t>>12&63,ht[We++]=128|_t>>6&63,ht[We++]=128|_t&63}}return ht[We]=0,We-A}function It(Qe,ht,We){return kt(Qe,Xt,ht,We)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function jt(Qe,ht){vi.set(Qe,ht)}function Lt(Qe,ht){return Qe%ht>0&&(Qe+=ht-Qe%ht),Qe}var Mt,vi,Xt,Jt,zi,Fe,tt;function Me(Qe){Mt=Qe,e.HEAP8=vi=new Int8Array(Qe),e.HEAP16=Jt=new Int16Array(Qe),e.HEAP32=zi=new Int32Array(Qe),e.HEAPU8=Xt=new Uint8Array(Qe),e.HEAPU16=new Uint16Array(Qe),e.HEAPU32=new Uint32Array(Qe),e.HEAPF32=Fe=new Float32Array(Qe),e.HEAPF64=tt=new Float64Array(Qe)}var dt=5271520,vt=28608,Pt=e.TOTAL_MEMORY||33554432;e.buffer?Mt=e.buffer:Mt=new ArrayBuffer(Pt),Pt=Mt.byteLength,Me(Mt),zi[vt>>2]=dt;function Ct(Qe){for(;Qe.length>0;){var ht=Qe.shift();if(typeof ht=="function"){ht();continue}var We=ht.func;typeof We=="number"?ht.arg===void 0?e.dynCall_v(We):e.dynCall_vi(We,ht.arg):We(ht.arg===void 0?null:ht.arg)}}var ei=[],Ai=[],oi=[],Zi=[];function Oi(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Fi(e.preRun.shift());Ct(ei)}function Li(){Ct(Ai)}function Ar(){Ct(oi)}function Yi(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)wr(e.postRun.shift());Ct(Zi)}function Fi(Qe){ei.unshift(Qe)}function wr(Qe){Zi.unshift(Qe)}var sr=Math.abs,ur=Math.ceil,qi=Math.floor,Vt=Math.min,zt=0,Pi=null;function dr(Qe){zt++,e.monitorRunDependencies&&e.monitorRunDependencies(zt)}function tr(Qe){if(zt--,e.monitorRunDependencies&&e.monitorRunDependencies(zt),zt==0&&Pi){var ht=Pi;Pi=null,ht()}}e.preloadedImages={},e.preloadedAudios={};var or=null,Tn="data:application/octet-stream;base64,";function rs(Qe){return String.prototype.startsWith?Qe.startsWith(Tn):Qe.indexOf(Tn)===0}var Sn,js;or="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var ao=28624;function Io(Qe,ht,We,Tt){gi("Assertion failed: "+Ke(Qe)+", at: "+[ht?Ke(ht):"unknown filename",We,Tt?Ke(Tt):"unknown function"])}function Qs(){return vi.length}function lo(Qe,ht,We){Xt.set(Xt.subarray(ht,ht+We),Qe)}function Po(Qe){return e.___errno_location&&(zi[e.___errno_location()>>2]=Qe),Qe}function Na(Qe){gi("OOM")}function ks(Qe){try{var ht=new ArrayBuffer(Qe);return ht.byteLength!=Qe?void 0:(new Int8Array(ht).set(vi),$e(ht),Me(ht),1)}catch{}}function ns(Qe){var ht=Qs(),We=16777216,Tt=2147483648-We;if(Qe>Tt)return!1;for(var A=16777216,ie=Math.max(ht,A);ie<Qe;)ie<=536870912?ie=Lt(2*ie,We):ie=Math.min(Lt((3*ie+2147483648)/4,We),Tt);var ri=ks(ie);return!!ri}var Ks=typeof atob=="function"?atob:function(Qe){var ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",We="",Tt,A,ie,ri,_t,ui,ni,Ei=0;Qe=Qe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ri=ht.indexOf(Qe.charAt(Ei++)),_t=ht.indexOf(Qe.charAt(Ei++)),ui=ht.indexOf(Qe.charAt(Ei++)),ni=ht.indexOf(Qe.charAt(Ei++)),Tt=ri<<2|_t>>4,A=(_t&15)<<4|ui>>2,ie=(ui&3)<<6|ni,We=We+String.fromCharCode(Tt),ui!==64&&(We=We+String.fromCharCode(A)),ni!==64&&(We=We+String.fromCharCode(ie));while(Ei<Qe.length);return We};function rt(Qe){try{for(var ht=Ks(Qe),We=new Uint8Array(ht.length),Tt=0;Tt<ht.length;++Tt)We[Tt]=ht.charCodeAt(Tt);return We}catch{throw new Error("Converting base64 string to bytes failed.")}}function ae(Qe){if(rs(Qe))return rt(Qe.slice(Tn.length))}var le={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},me={b:k,c:F,d:Io,e:Po,f:Qs,g:lo,h:ns,i:Na,o:ao,p:vt},ue=function(Qe,ht,We){"almost asm";var Tt=new Qe.Int8Array(We),A=new Qe.Int32Array(We);new Qe.Uint8Array(We),new Qe.Float32Array(We);var ie=new Qe.Float64Array(We),ri=ht.o|0,_t=ht.p|0,ui=Qe.Math.floor,ni=Qe.Math.abs,Ei=Qe.Math.sqrt,Tr=Qe.Math.pow,Xi=Qe.Math.cos,si=Qe.Math.sin,En=Qe.Math.tan,Mo=Qe.Math.acos,Ko=Qe.Math.asin,Jo=Qe.Math.atan,nn=Qe.Math.atan2,Ds=Qe.Math.ceil,Sr=Qe.Math.imul,Hn=Qe.Math.min,Br=Qe.Math.max,ys=Qe.Math.clz32,Di=ht.b,fe=ht.c,Mi=ht.d,Js=ht.e,Ku=ht.f,Hc=ht.g,Ju=ht.h,za=ht.i,se=28640;function vf(d){return Tt=new Int8Array(d),A=new Int32Array(d),ie=new Float64Array(d),We=d,!0}function xf(d){d=d|0;var p=0;return p=se,se=se+d|0,se=se+15&-16,p|0}function wf(){return se|0}function eh(d){d=d|0,se=d}function $c(d,p){d=d|0,se=d}function ea(d,p){d=d|0,p=p|0;var g=0,v=0,x=0;return(d|0)<0?(p=2,p|0):(d|0)>13780509?(p=uc(15,p)|0,p|0):(g=((d|0)<0)<<31>>31,x=Rr(d|0,g|0,3,0)|0,v=fe()|0,g=Ci(d|0,g|0,1,0)|0,g=Rr(x|0,v|0,g|0,fe()|0)|0,g=Ci(g|0,fe()|0,1,0)|0,d=fe()|0,A[p>>2]=g,A[p+4>>2]=d,p=0,p|0)}function Xl(d,p,g,v){return d=d|0,p=p|0,g=g|0,v=v|0,Zc(d,p,g,v,0)|0}function Zc(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0;if(z=se,se=se+16|0,R=z,!(Ro(d,p,g,v,x)|0))return v=0,se=z,v|0;do if((g|0)>=0){if((g|0)>13780509){if(I=uc(15,R)|0,I|0)break;B=R,R=A[B>>2]|0,B=A[B+4>>2]|0}else I=((g|0)<0)<<31>>31,$=Rr(g|0,I|0,3,0)|0,B=fe()|0,I=Ci(g|0,I|0,1,0)|0,I=Rr($|0,B|0,I|0,fe()|0)|0,I=Ci(I|0,fe()|0,1,0)|0,B=fe()|0,A[R>>2]=I,A[R+4>>2]=B,R=I;if(to(v|0,0,R<<3|0)|0,x|0){to(x|0,0,R<<2|0)|0,I=Vs(d,p,g,v,x,R,B,0)|0;break}I=Yn(R,4)|0,I?($=Vs(d,p,g,v,I,R,B,0)|0,ki(I),I=$):I=13}else I=2;while(!1);return $=I,se=z,$|0}function Ro(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0;if(je=se,se=se+16|0,xe=je,we=je+8|0,Te=xe,A[Te>>2]=d,A[Te+4>>2]=p,(g|0)<0)return we=2,se=je,we|0;if(I=v,A[I>>2]=d,A[I+4>>2]=p,I=(x|0)!=0,I&&(A[x>>2]=0),Ir(d,p)|0)return we=9,se=je,we|0;A[we>>2]=0;e:do if((g|0)>=1)if(I)for(X=1,$=0,ce=0,Te=1,I=d;;){if(!($|ce)){if(I=hn(I,p,4,we,xe)|0,I|0)break e;if(p=xe,I=A[p>>2]|0,p=A[p+4>>2]|0,Ir(I,p)|0){I=9;break e}}if(I=hn(I,p,A[26800+(ce<<2)>>2]|0,we,xe)|0,I|0)break e;if(p=xe,I=A[p>>2]|0,p=A[p+4>>2]|0,d=v+(X<<3)|0,A[d>>2]=I,A[d+4>>2]=p,A[x+(X<<2)>>2]=Te,d=$+1|0,R=(d|0)==(Te|0),B=ce+1|0,z=(B|0)==6,Ir(I,p)|0){I=9;break e}if(Te=Te+(z&R&1)|0,(Te|0)>(g|0)){I=0;break}else X=X+1|0,$=R?0:d,ce=R?z?0:B:ce}else for(X=1,$=0,ce=0,Te=1,I=d;;){if(!($|ce)){if(I=hn(I,p,4,we,xe)|0,I|0)break e;if(p=xe,I=A[p>>2]|0,p=A[p+4>>2]|0,Ir(I,p)|0){I=9;break e}}if(I=hn(I,p,A[26800+(ce<<2)>>2]|0,we,xe)|0,I|0)break e;if(p=xe,I=A[p>>2]|0,p=A[p+4>>2]|0,d=v+(X<<3)|0,A[d>>2]=I,A[d+4>>2]=p,d=$+1|0,R=(d|0)==(Te|0),B=ce+1|0,z=(B|0)==6,Ir(I,p)|0){I=9;break e}if(Te=Te+(z&R&1)|0,(Te|0)>(g|0)){I=0;break}else X=X+1|0,$=R?0:d,ce=R?z?0:B:ce}else I=0;while(!1);return we=I,se=je,we|0}function Vs(d,p,g,v,x,I,R,B){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,I=I|0,R=R|0,B=B|0;var z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0;if(je=se,se=se+16|0,xe=je+8|0,we=je,z=go(d|0,p|0,I|0,R|0)|0,X=fe()|0,ce=v+(z<<3)|0,Ze=ce,gt=A[Ze>>2]|0,Ze=A[Ze+4>>2]|0,$=(gt|0)==(d|0)&(Ze|0)==(p|0),!((gt|0)==0&(Ze|0)==0|$))do z=Ci(z|0,X|0,1,0)|0,z=Hs(z|0,fe()|0,I|0,R|0)|0,X=fe()|0,ce=v+(z<<3)|0,gt=ce,Ze=A[gt>>2]|0,gt=A[gt+4>>2]|0,$=(Ze|0)==(d|0)&(gt|0)==(p|0);while(!((Ze|0)==0&(gt|0)==0|$));if(z=x+(z<<2)|0,$&&(A[z>>2]|0)<=(B|0)||(gt=ce,A[gt>>2]=d,A[gt+4>>2]=p,A[z>>2]=B,(B|0)>=(g|0)))return gt=0,se=je,gt|0;switch($=B+1|0,A[xe>>2]=0,z=hn(d,p,2,xe,we)|0,z|0){case 9:{Te=9;break}case 0:{z=we,z=Vs(A[z>>2]|0,A[z+4>>2]|0,g,v,x,I,R,$)|0,z||(Te=9);break}}e:do if((Te|0)==9){switch(A[xe>>2]=0,z=hn(d,p,3,xe,we)|0,z|0){case 9:break;case 0:{if(z=we,z=Vs(A[z>>2]|0,A[z+4>>2]|0,g,v,x,I,R,$)|0,z|0)break e;break}default:break e}switch(A[xe>>2]=0,z=hn(d,p,1,xe,we)|0,z|0){case 9:break;case 0:{if(z=we,z=Vs(A[z>>2]|0,A[z+4>>2]|0,g,v,x,I,R,$)|0,z|0)break e;break}default:break e}switch(A[xe>>2]=0,z=hn(d,p,5,xe,we)|0,z|0){case 9:break;case 0:{if(z=we,z=Vs(A[z>>2]|0,A[z+4>>2]|0,g,v,x,I,R,$)|0,z|0)break e;break}default:break e}switch(A[xe>>2]=0,z=hn(d,p,4,xe,we)|0,z|0){case 9:break;case 0:{if(z=we,z=Vs(A[z>>2]|0,A[z+4>>2]|0,g,v,x,I,R,$)|0,z|0)break e;break}default:break e}switch(A[xe>>2]=0,z=hn(d,p,6,xe,we)|0,z|0){case 9:break;case 0:{if(z=we,z=Vs(A[z>>2]|0,A[z+4>>2]|0,g,v,x,I,R,$)|0,z|0)break e;break}default:break e}return gt=0,se=je,gt|0}while(!1);return gt=z,se=je,gt|0}function hn(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0;if(g>>>0>6)return x=1,x|0;if(ce=(A[v>>2]|0)%6|0,A[v>>2]=ce,(ce|0)>0){I=0;do g=Bo(g)|0,I=I+1|0;while((I|0)<(A[v>>2]|0))}if(ce=Ut(d|0,p|0,45)|0,fe()|0,X=ce&127,X>>>0>121)return x=5,x|0;z=qn(d,p)|0,I=Ut(d|0,p|0,52)|0,fe()|0,I=I&15;e:do if(!I)$=8;else{for(;;){if(R=(15-I|0)*3|0,B=Ut(d|0,p|0,R|0)|0,fe()|0,B=B&7,(B|0)==7){p=5;break}if(we=(vs(I)|0)==0,I=I+-1|0,Te=qt(7,0,R|0)|0,p=p&~(fe()|0),xe=qt(A[(we?432:16)+(B*28|0)+(g<<2)>>2]|0,0,R|0)|0,R=fe()|0,g=A[(we?640:224)+(B*28|0)+(g<<2)>>2]|0,d=xe|d&~Te,p=R|p,!g){g=0;break e}if(!I){$=8;break e}}return p|0}while(!1);($|0)==8&&(we=A[848+(X*28|0)+(g<<2)>>2]|0,xe=qt(we|0,0,45)|0,d=xe|d,p=fe()|0|p&-1040385,g=A[4272+(X*28|0)+(g<<2)>>2]|0,(we&127|0)==127&&(we=qt(A[848+(X*28|0)+20>>2]|0,0,45)|0,p=fe()|0|p&-1040385,g=A[4272+(X*28|0)+20>>2]|0,d=ha(we|d,p)|0,p=fe()|0,A[v>>2]=(A[v>>2]|0)+1)),B=Ut(d|0,p|0,45)|0,fe()|0,B=B&127;e:do if(gr(B)|0){t:do if((qn(d,p)|0)==1){if((X|0)!=(B|0))if(fn(B,A[7696+(X*28|0)>>2]|0)|0){d=vl(d,p)|0,R=1,p=fe()|0;break}else Mi(27795,26864,436,26872);switch(z|0){case 3:{d=ha(d,p)|0,p=fe()|0,A[v>>2]=(A[v>>2]|0)+1,R=0;break t}case 5:{d=vl(d,p)|0,p=fe()|0,A[v>>2]=(A[v>>2]|0)+5,R=0;break t}case 0:return we=9,we|0;default:return we=1,we|0}}else R=0;while(!1);if((g|0)>0){I=0;do d=Xa(d,p)|0,p=fe()|0,I=I+1|0;while((I|0)!=(g|0))}if((X|0)!=(B|0)){if(!(ir(B)|0)){if((R|0)!=0|(qn(d,p)|0)!=5)break;A[v>>2]=(A[v>>2]|0)+1;break}switch(ce&127){case 8:case 118:break e}(qn(d,p)|0)!=3&&(A[v>>2]=(A[v>>2]|0)+1)}}else if((g|0)>0){I=0;do d=ha(d,p)|0,p=fe()|0,I=I+1|0;while((I|0)!=(g|0))}while(!1);return A[v>>2]=((A[v>>2]|0)+g|0)%6|0,we=x,A[we>>2]=d,A[we+4>>2]=p,we=0,we|0}function ta(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0;for(B=se,se=se+16|0,I=B,R=B+8|0,x=(Ir(d,p)|0)==0,x=x?1:2;;){if(A[R>>2]=0,$=(hn(d,p,x,R,I)|0)==0,z=I,$&((A[z>>2]|0)==(g|0)?(A[z+4>>2]|0)==(v|0):0)){d=4;break}if(x=x+1|0,x>>>0>=7){x=7,d=4;break}}return(d|0)==4?(se=B,x|0):0}function pl(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0;if(we=se,se=se+16|0,Te=we,xe=we+8|0,ce=Te,A[ce>>2]=d,A[ce+4>>2]=p,!g)return xe=v,A[xe>>2]=d,A[xe+4>>2]=p,xe=0,se=we,xe|0;A[xe>>2]=0;e:do if(Ir(d,p)|0)d=9;else{if(I=(g|0)>0,I){x=0,ce=d;do{if(d=hn(ce,p,4,xe,Te)|0,d|0)break e;if(p=Te,ce=A[p>>2]|0,p=A[p+4>>2]|0,x=x+1|0,Ir(ce,p)|0){d=9;break e}}while((x|0)<(g|0));if(X=v,A[X>>2]=ce,A[X+4>>2]=p,X=g+-1|0,I){$=0,d=1;do{if(x=26800+($<<2)|0,($|0)==5)for(R=A[x>>2]|0,I=0,x=d;;){if(d=Te,d=hn(A[d>>2]|0,A[d+4>>2]|0,R,xe,Te)|0,d|0)break e;if((I|0)!=(X|0))if(z=Te,B=A[z>>2]|0,z=A[z+4>>2]|0,d=v+(x<<3)|0,A[d>>2]=B,A[d+4>>2]=z,!(Ir(B,z)|0))d=x+1|0;else{d=9;break e}else d=x;if(I=I+1|0,(I|0)>=(g|0))break;x=d}else for(R=Te,z=A[x>>2]|0,B=0,x=d,I=A[R>>2]|0,R=A[R+4>>2]|0;;){if(d=hn(I,R,z,xe,Te)|0,d|0)break e;if(R=Te,I=A[R>>2]|0,R=A[R+4>>2]|0,d=v+(x<<3)|0,A[d>>2]=I,A[d+4>>2]=R,d=x+1|0,Ir(I,R)|0){d=9;break e}if(B=B+1|0,(B|0)>=(g|0))break;x=d}$=$+1|0}while($>>>0<6);d=Te,R=ce,x=A[d>>2]|0,I=p,d=A[d+4>>2]|0}else R=ce,x=ce,I=p,d=p}else R=v,A[R>>2]=d,A[R+4>>2]=p,R=d,x=d,I=p,d=p;d=(R|0)==(x|0)&(I|0)==(d|0)?0:9}while(!1);return xe=d,se=we,xe|0}function qc(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0;if(B=se,se=se+48|0,x=B+16|0,I=B+8|0,R=B,g=fo(g)|0,g|0)return R=g,se=B,R|0;if($=d,z=A[$+4>>2]|0,g=I,A[g>>2]=A[$>>2],A[g+4>>2]=z,Qa(I,x),g=ra(x,p,R)|0,!g){if(p=A[I>>2]|0,I=A[d+8>>2]|0,(I|0)>0){x=A[d+12>>2]|0,g=0;do p=(A[x+(g<<3)>>2]|0)+p|0,g=g+1|0;while((g|0)<(I|0))}g=R,x=A[g>>2]|0,g=A[g+4>>2]|0,I=((p|0)<0)<<31>>31,(g|0)<(I|0)|(g|0)==(I|0)&x>>>0<p>>>0?(g=R,A[g>>2]=p,A[g+4>>2]=I,g=I):p=x,z=Ci(p|0,g|0,12,0)|0,$=fe()|0,g=R,A[g>>2]=z,A[g+4>>2]=$,g=v,A[g>>2]=z,A[g+4>>2]=$,g=0}return $=g,se=B,$|0}function kn(d,p,g,v,x,I,R){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,I=I|0,R=R|0;var B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0,Ft=0,Gt=0,Ri=0,mi=0,Ht=0,bi=0,_r=0,Ii=0,Er=0,Jr=0,Fr=0;if(_r=se,se=se+64|0,Ri=_r+48|0,mi=_r+32|0,Ht=_r+24|0,Zt=_r+8|0,yi=_r,z=A[d>>2]|0,(z|0)<=0)return bi=0,se=_r,bi|0;for(ai=d+4|0,Ni=Ri+8|0,Ft=mi+8|0,Gt=Zt+8|0,B=0,st=0;;){$=A[ai>>2]|0,at=$+(st<<4)|0,A[Ri>>2]=A[at>>2],A[Ri+4>>2]=A[at+4>>2],A[Ri+8>>2]=A[at+8>>2],A[Ri+12>>2]=A[at+12>>2],(st|0)==(z+-1|0)?(A[mi>>2]=A[$>>2],A[mi+4>>2]=A[$+4>>2],A[mi+8>>2]=A[$+8>>2],A[mi+12>>2]=A[$+12>>2]):(at=$+(st+1<<4)|0,A[mi>>2]=A[at>>2],A[mi+4>>2]=A[at+4>>2],A[mi+8>>2]=A[at+8>>2],A[mi+12>>2]=A[at+12>>2]),z=Gi(Ri,mi,v,Ht)|0;e:do if(z)$=0,B=z;else if(z=Ht,$=A[z>>2]|0,z=A[z+4>>2]|0,(z|0)>0|(z|0)==0&$>>>0>0){gt=0,at=0;t:for(;;){if(Er=1/(+($>>>0)+4294967296*+(z|0)),Fr=+ie[Ri>>3],z=qr($|0,z|0,gt|0,at|0)|0,Jr=+(z>>>0)+4294967296*+(fe()|0),Ii=+(gt>>>0)+4294967296*+(at|0),ie[Zt>>3]=Er*(Fr*Jr)+Er*(+ie[mi>>3]*Ii),ie[Gt>>3]=Er*(+ie[Ni>>3]*Jr)+Er*(+ie[Ft>>3]*Ii),z=xl(Zt,v,yi)|0,z|0){B=z;break}Ze=yi,je=A[Ze>>2]|0,Ze=A[Ze+4>>2]|0,Te=go(je|0,Ze|0,p|0,g|0)|0,X=fe()|0,z=R+(Te<<3)|0,ce=z,$=A[ce>>2]|0,ce=A[ce+4>>2]|0;i:do if(($|0)==0&(ce|0)==0)qe=z,bi=16;else for(xe=0,we=0;;){if((xe|0)>(g|0)|(xe|0)==(g|0)&we>>>0>p>>>0){B=1;break t}if(($|0)==(je|0)&(ce|0)==(Ze|0))break i;if(z=Ci(Te|0,X|0,1,0)|0,Te=Hs(z|0,fe()|0,p|0,g|0)|0,X=fe()|0,we=Ci(we|0,xe|0,1,0)|0,xe=fe()|0,z=R+(Te<<3)|0,ce=z,$=A[ce>>2]|0,ce=A[ce+4>>2]|0,($|0)==0&(ce|0)==0){qe=z,bi=16;break}}while(!1);if((bi|0)==16&&(bi=0,!((je|0)==0&(Ze|0)==0))&&(we=qe,A[we>>2]=je,A[we+4>>2]=Ze,we=I+(A[x>>2]<<3)|0,A[we>>2]=je,A[we+4>>2]=Ze,we=x,we=Ci(A[we>>2]|0,A[we+4>>2]|0,1,0)|0,je=fe()|0,Ze=x,A[Ze>>2]=we,A[Ze+4>>2]=je),gt=Ci(gt|0,at|0,1,0)|0,at=fe()|0,z=Ht,$=A[z>>2]|0,z=A[z+4>>2]|0,!((z|0)>(at|0)|(z|0)==(at|0)&$>>>0>gt>>>0)){$=1;break e}}$=0}else $=1;while(!1);if(st=st+1|0,!$){bi=21;break}if(z=A[d>>2]|0,(st|0)>=(z|0)){B=0,bi=21;break}}return(bi|0)==21?(se=_r,B|0):0}function lr(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0,Ft=0,Gt=0,Ri=0,mi=0,Ht=0,bi=0,_r=0,Ii=0,Er=0,Jr=0;if(Jr=se,se=se+112|0,bi=Jr+80|0,z=Jr+72|0,_r=Jr,Ii=Jr+56|0,x=fo(g)|0,x|0)return Er=x,se=Jr,Er|0;if($=d+8|0,Er=Gn((A[$>>2]<<5)+32|0)|0,!Er)return Er=13,se=Jr,Er|0;if(ma(d,Er),x=fo(g)|0,!x){if(mi=d,Ht=A[mi+4>>2]|0,x=z,A[x>>2]=A[mi>>2],A[x+4>>2]=Ht,Qa(z,bi),x=ra(bi,p,_r)|0,x)mi=0,Ht=0;else{if(x=A[z>>2]|0,I=A[$>>2]|0,(I|0)>0){R=A[d+12>>2]|0,g=0;do x=(A[R+(g<<3)>>2]|0)+x|0,g=g+1|0;while((g|0)!=(I|0));g=x}else g=x;x=_r,I=A[x>>2]|0,x=A[x+4>>2]|0,R=((g|0)<0)<<31>>31,(x|0)<(R|0)|(x|0)==(R|0)&I>>>0<g>>>0?(x=_r,A[x>>2]=g,A[x+4>>2]=R,x=R):g=I,mi=Ci(g|0,x|0,12,0)|0,Ht=fe()|0,x=_r,A[x>>2]=mi,A[x+4>>2]=Ht,x=0}if(!x){if(g=Yn(mi,8)|0,!g)return ki(Er),Er=13,se=Jr,Er|0;if(B=Yn(mi,8)|0,!B)return ki(Er),ki(g),Er=13,se=Jr,Er|0;Gt=bi,A[Gt>>2]=0,A[Gt+4>>2]=0,Gt=d,Ri=A[Gt+4>>2]|0,x=z,A[x>>2]=A[Gt>>2],A[x+4>>2]=Ri,x=kn(z,mi,Ht,p,bi,g,B)|0;e:do if(x)ki(g),ki(B),ki(Er);else{t:do if((A[$>>2]|0)>0){for(R=d+12|0,I=0;x=kn((A[R>>2]|0)+(I<<3)|0,mi,Ht,p,bi,g,B)|0,I=I+1|0,!(x|0);)if((I|0)>=(A[$>>2]|0))break t;ki(g),ki(B),ki(Er);break e}while(!1);(Ht|0)>0|(Ht|0)==0&mi>>>0>0&&to(B|0,0,mi<<3|0)|0,Ri=bi,Gt=A[Ri+4>>2]|0;t:do if((Gt|0)>0|(Gt|0)==0&(A[Ri>>2]|0)>>>0>0){ai=g,Ni=B,Ft=g,Gt=B,Ri=g,x=g,qe=g,Zt=B,yi=B,g=B;i:for(;;){for(Ze=0,gt=0,at=0,st=0,I=0,R=0;;){B=_r,z=B+56|0;do A[B>>2]=0,B=B+4|0;while((B|0)<(z|0));if(p=ai+(Ze<<3)|0,$=A[p>>2]|0,p=A[p+4>>2]|0,Ro($,p,1,_r,0)|0){B=_r,z=B+56|0;do A[B>>2]=0,B=B+4|0;while((B|0)<(z|0));B=Yn(7,4)|0,B|0&&(Vs($,p,1,_r,B,7,0,0)|0,ki(B))}for(je=0;;){we=_r+(je<<3)|0,xe=A[we>>2]|0,we=A[we+4>>2]|0;r:do if((xe|0)==0&(we|0)==0)B=I,z=R;else{if(X=go(xe|0,we|0,mi|0,Ht|0)|0,$=fe()|0,B=v+(X<<3)|0,p=B,z=A[p>>2]|0,p=A[p+4>>2]|0,!((z|0)==0&(p|0)==0)){ce=0,Te=0;do{if((ce|0)>(Ht|0)|(ce|0)==(Ht|0)&Te>>>0>mi>>>0)break i;if((z|0)==(xe|0)&(p|0)==(we|0)){B=I,z=R;break r}B=Ci(X|0,$|0,1,0)|0,X=Hs(B|0,fe()|0,mi|0,Ht|0)|0,$=fe()|0,Te=Ci(Te|0,ce|0,1,0)|0,ce=fe()|0,B=v+(X<<3)|0,p=B,z=A[p>>2]|0,p=A[p+4>>2]|0}while(!((z|0)==0&(p|0)==0))}if((xe|0)==0&(we|0)==0){B=I,z=R;break}Xn(xe,we,Ii)|0,Rl(d,Er,Ii)|0&&(Te=Ci(I|0,R|0,1,0)|0,R=fe()|0,ce=B,A[ce>>2]=xe,A[ce+4>>2]=we,I=Ni+(I<<3)|0,A[I>>2]=xe,A[I+4>>2]=we,I=Te),B=I,z=R}while(!1);if(je=je+1|0,je>>>0>=7)break;I=B,R=z}if(Ze=Ci(Ze|0,gt|0,1,0)|0,gt=fe()|0,at=Ci(at|0,st|0,1,0)|0,st=fe()|0,R=bi,I=A[R>>2]|0,R=A[R+4>>2]|0,(st|0)<(R|0)|(st|0)==(R|0)&at>>>0<I>>>0)I=B,R=z;else break}if((R|0)>0|(R|0)==0&I>>>0>0){I=0,R=0;do st=ai+(I<<3)|0,A[st>>2]=0,A[st+4>>2]=0,I=Ci(I|0,R|0,1,0)|0,R=fe()|0,st=bi,at=A[st+4>>2]|0;while((R|0)<(at|0)|((R|0)==(at|0)?I>>>0<(A[st>>2]|0)>>>0:0))}if(st=bi,A[st>>2]=B,A[st+4>>2]=z,(z|0)>0|(z|0)==0&B>>>0>0)je=g,Ze=yi,gt=Ri,at=Zt,st=Ni,g=qe,yi=x,Zt=Ft,qe=je,x=Ze,Ri=Gt,Gt=gt,Ft=at,Ni=ai,ai=st;else break t}ki(Ft),ki(Gt),ki(Er),x=1;break e}else x=B;while(!1);ki(Er),ki(g),ki(x),x=0}while(!1);return Er=x,se=Jr,Er|0}}return ki(Er),Er=x,se=Jr,Er|0}function Ua(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(X=se,se=se+176|0,z=X,(p|0)<1)return Au(g,0,0),$=0,se=X,$|0;for(B=d,B=Ut(A[B>>2]|0,A[B+4>>2]|0,52)|0,fe()|0,Au(g,(p|0)>6?p:6,B&15),B=0;v=d+(B<<3)|0,v=Fo(A[v>>2]|0,A[v+4>>2]|0,z)|0,!(v|0);){if(v=A[z>>2]|0,(v|0)>0){R=0;do I=z+8+(R<<4)|0,R=R+1|0,v=z+8+(((R|0)%(v|0)|0)<<4)|0,x=Ja(g,v,I)|0,x?ba(g,x)|0:cn(g,I,v)|0,v=A[z>>2]|0;while((R|0)<(v|0))}if(B=B+1|0,(B|0)>=(p|0)){v=0,$=13;break}}return($|0)==13?(se=X,v|0):(du(g),$=v,se=X,$|0)}function $n(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0;if(I=se,se=se+32|0,v=I,x=I+16|0,d=Ua(d,p,x)|0,d|0)return g=d,se=I,g|0;if(A[g>>2]=0,A[g+4>>2]=0,A[g+8>>2]=0,d=ya(x)|0,d|0)do{p=dc(g)|0;do Ya(p,d)|0,R=d+16|0,A[v>>2]=A[R>>2],A[v+4>>2]=A[R+4>>2],A[v+8>>2]=A[R+8>>2],A[v+12>>2]=A[R+12>>2],ba(x,d)|0,d=pu(x,v)|0;while((d|0)!=0);d=ya(x)|0}while((d|0)!=0);return du(x),d=ch(g)|0,d?(pa(g),R=d,se=I,R|0):(R=0,se=I,R|0)}function gr(d){return d=d|0,d>>>0>121?(d=0,d|0):(d=A[7696+(d*28|0)+16>>2]|0,d|0)}function ir(d){return d=d|0,(d|0)==4|(d|0)==117|0}function ja(d){return d=d|0,A[11120+((A[d>>2]|0)*216|0)+((A[d+4>>2]|0)*72|0)+((A[d+8>>2]|0)*24|0)+(A[d+12>>2]<<3)>>2]|0}function gl(d){return d=d|0,A[11120+((A[d>>2]|0)*216|0)+((A[d+4>>2]|0)*72|0)+((A[d+8>>2]|0)*24|0)+(A[d+12>>2]<<3)+4>>2]|0}function Va(d,p){d=d|0,p=p|0,d=7696+(d*28|0)|0,A[p>>2]=A[d>>2],A[p+4>>2]=A[d+4>>2],A[p+8>>2]=A[d+8>>2],A[p+12>>2]=A[d+12>>2]}function ss(d,p){d=d|0,p=p|0;var g=0,v=0;if(p>>>0>20)return p=-1,p|0;do if((A[11120+(p*216|0)>>2]|0)!=(d|0))if((A[11120+(p*216|0)+8>>2]|0)!=(d|0))if((A[11120+(p*216|0)+16>>2]|0)!=(d|0))if((A[11120+(p*216|0)+24>>2]|0)!=(d|0))if((A[11120+(p*216|0)+32>>2]|0)!=(d|0))if((A[11120+(p*216|0)+40>>2]|0)!=(d|0))if((A[11120+(p*216|0)+48>>2]|0)!=(d|0))if((A[11120+(p*216|0)+56>>2]|0)!=(d|0))if((A[11120+(p*216|0)+64>>2]|0)!=(d|0))if((A[11120+(p*216|0)+72>>2]|0)!=(d|0))if((A[11120+(p*216|0)+80>>2]|0)!=(d|0))if((A[11120+(p*216|0)+88>>2]|0)!=(d|0))if((A[11120+(p*216|0)+96>>2]|0)!=(d|0))if((A[11120+(p*216|0)+104>>2]|0)!=(d|0))if((A[11120+(p*216|0)+112>>2]|0)!=(d|0))if((A[11120+(p*216|0)+120>>2]|0)!=(d|0))if((A[11120+(p*216|0)+128>>2]|0)!=(d|0))if((A[11120+(p*216|0)+136>>2]|0)==(d|0))d=2,g=1,v=2;else{if((A[11120+(p*216|0)+144>>2]|0)==(d|0)){d=0,g=2,v=0;break}if((A[11120+(p*216|0)+152>>2]|0)==(d|0)){d=0,g=2,v=1;break}if((A[11120+(p*216|0)+160>>2]|0)==(d|0)){d=0,g=2,v=2;break}if((A[11120+(p*216|0)+168>>2]|0)==(d|0)){d=1,g=2,v=0;break}if((A[11120+(p*216|0)+176>>2]|0)==(d|0)){d=1,g=2,v=1;break}if((A[11120+(p*216|0)+184>>2]|0)==(d|0)){d=1,g=2,v=2;break}if((A[11120+(p*216|0)+192>>2]|0)==(d|0)){d=2,g=2,v=0;break}if((A[11120+(p*216|0)+200>>2]|0)==(d|0)){d=2,g=2,v=1;break}if((A[11120+(p*216|0)+208>>2]|0)==(d|0)){d=2,g=2,v=2;break}else d=-1;return d|0}else d=2,g=1,v=1;else d=2,g=1,v=0;else d=1,g=1,v=2;else d=1,g=1,v=1;else d=1,g=1,v=0;else d=0,g=1,v=2;else d=0,g=1,v=1;else d=0,g=1,v=0;else d=2,g=0,v=2;else d=2,g=0,v=1;else d=2,g=0,v=0;else d=1,g=0,v=2;else d=1,g=0,v=1;else d=1,g=0,v=0;else d=0,g=0,v=2;else d=0,g=0,v=1;else d=0,g=0,v=0;while(!1);return p=A[11120+(p*216|0)+(g*72|0)+(d*24|0)+(v<<3)+4>>2]|0,p|0}function fn(d,p){return d=d|0,p=p|0,(A[7696+(d*28|0)+20>>2]|0)==(p|0)?(p=1,p|0):(p=(A[7696+(d*28|0)+24>>2]|0)==(p|0),p|0)}function jr(d,p){return d=d|0,p=p|0,A[848+(d*28|0)+(p<<2)>>2]|0}function an(d,p){return d=d|0,p=p|0,(A[848+(d*28|0)>>2]|0)==(p|0)?(p=0,p|0):(A[848+(d*28|0)+4>>2]|0)==(p|0)?(p=1,p|0):(A[848+(d*28|0)+8>>2]|0)==(p|0)?(p=2,p|0):(A[848+(d*28|0)+12>>2]|0)==(p|0)?(p=3,p|0):(A[848+(d*28|0)+16>>2]|0)==(p|0)?(p=4,p|0):(A[848+(d*28|0)+20>>2]|0)==(p|0)?(p=5,p|0):((A[848+(d*28|0)+24>>2]|0)==(p|0)?6:7)|0}function Mr(){return 122}function Wa(d){d=d|0;var p=0,g=0,v=0;p=0;do qt(p|0,0,45)|0,v=fe()|0|134225919,g=d+(p<<3)|0,A[g>>2]=-1,A[g+4>>2]=v,p=p+1|0;while((p|0)!=122);return 0}function Zn(d){d=d|0;var p=0,g=0,v=0;return v=+ie[d+16>>3],g=+ie[d+24>>3],p=v-g,+(v<g?p+6.283185307179586:p)}function os(d){return d=d|0,+ie[d+16>>3]<+ie[d+24>>3]|0}function as(d){return d=d|0,+(+ie[d>>3]-+ie[d+8>>3])}function ia(d,p){d=d|0,p=p|0;var g=0,v=0,x=0;return g=+ie[p>>3],!(g>=+ie[d+8>>3])||!(g<=+ie[d>>3])?(p=0,p|0):(v=+ie[d+16>>3],g=+ie[d+24>>3],x=+ie[p+8>>3],p=x>=g,d=x<=v&1,v<g?p&&(d=1):p||(d=0),p=(d|0)!=0,p|0)}function mr(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;return+ie[d>>3]<+ie[p+8>>3]||+ie[d+8>>3]>+ie[p>>3]?(v=0,v|0):(I=+ie[d+16>>3],g=d+24|0,X=+ie[g>>3],R=I<X,v=p+16|0,$=+ie[v>>3],x=p+24|0,z=+ie[x>>3],B=$<z,p=X-$<z-I,d=R?B|p?1:2:0,p=B?R?1:p?2:1:0,I=+xs(I,d),I<+xs(+ie[x>>3],p)||(X=+xs(+ie[g>>3],d),X>+xs(+ie[v>>3],p))?(B=0,B|0):(B=1,B|0))}function Vr(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0;I=+ie[d+16>>3],z=+ie[d+24>>3],d=I<z,B=+ie[p+16>>3],R=+ie[p+24>>3],x=B<R,p=z-B<R-I,A[g>>2]=d?x|p?1:2:0,A[v>>2]=x?d?1:p?2:1:0}function nr(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;return+ie[d>>3]<+ie[p>>3]||+ie[d+8>>3]>+ie[p+8>>3]?(v=0,v|0):(v=d+16|0,z=+ie[v>>3],I=+ie[d+24>>3],R=z<I,g=p+16|0,X=+ie[g>>3],x=p+24|0,$=+ie[x>>3],B=X<$,p=I-X<$-z,d=R?B|p?1:2:0,p=B?R?1:p?2:1:0,I=+xs(I,d),I<=+xs(+ie[x>>3],p)?(X=+xs(+ie[v>>3],d),B=X>=+xs(+ie[g>>3],p),B|0):(B=0,B|0))}function Ui(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0;x=se,se=se+176|0,v=x,A[v>>2]=4,B=+ie[p>>3],ie[v+8>>3]=B,I=+ie[p+16>>3],ie[v+16>>3]=I,ie[v+24>>3]=B,B=+ie[p+24>>3],ie[v+32>>3]=B,R=+ie[p+8>>3],ie[v+40>>3]=R,ie[v+48>>3]=B,ie[v+56>>3]=R,ie[v+64>>3]=I,p=v+72|0,g=p+96|0;do A[p>>2]=0,p=p+4|0;while((p|0)<(g|0));mo(d|0,v|0,168)|0,se=x}function ra(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0;we=se,se=se+288|0,X=we+264|0,ce=we+96|0,$=we,B=$,z=B+96|0;do A[B>>2]=0,B=B+4|0;while((B|0)<(z|0));return p=wl(p,$)|0,p|0?(xe=p,se=we,xe|0):(z=$,$=A[z>>2]|0,z=A[z+4>>2]|0,Xn($,z,X)|0,Fo($,z,ce)|0,R=+No(X,ce+8|0),ie[X>>3]=+ie[d>>3],z=X+8|0,ie[z>>3]=+ie[d+16>>3],ie[ce>>3]=+ie[d+8>>3],$=ce+8|0,ie[$>>3]=+ie[d+24>>3],x=+No(X,ce),Ze=+ie[z>>3]-+ie[$>>3],I=+ni(+Ze),je=+ie[X>>3]-+ie[ce>>3],v=+ni(+je),!(Ze==0|je==0)&&(Ze=+va(+I,+v),Ze=+Ds(+(x*x/+ws(+(Ze/+ws(+I,+v)),3)/(R*(R*2.59807621135)*.8))),ie[ri>>3]=Ze,Te=~~Ze>>>0,xe=+ni(Ze)>=1?Ze>0?~~+Hn(+ui(Ze/4294967296),4294967295)>>>0:~~+Ds((Ze-+(~~Ze>>>0))/4294967296)>>>0:0,(A[ri+4>>2]&2146435072|0)!=2146435072)?(ce=(Te|0)==0&(xe|0)==0,p=g,A[p>>2]=ce?1:Te,A[p+4>>2]=ce?0:xe,p=0):p=1,xe=p,se=we,xe|0)}function Gi(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0;$=se,se=se+288|0,R=$+264|0,B=$+96|0,z=$,x=z,I=x+96|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(I|0));return g=wl(g,z)|0,g|0?(v=g,se=$,v|0):(g=z,x=A[g>>2]|0,g=A[g+4>>2]|0,Xn(x,g,R)|0,Fo(x,g,B)|0,X=+No(R,B+8|0),X=+Ds(+(+No(d,p)/(X*2))),ie[ri>>3]=X,g=~~X>>>0,x=+ni(X)>=1?X>0?~~+Hn(+ui(X/4294967296),4294967295)>>>0:~~+Ds((X-+(~~X>>>0))/4294967296)>>>0:0,(A[ri+4>>2]&2146435072|0)==2146435072?(v=1,se=$,v|0):(z=(g|0)==0&(x|0)==0,A[v>>2]=z?1:g,A[v+4>>2]=z?0:x,v=0,se=$,v|0))}function Gl(d,p){d=d|0,p=+p;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;I=d+16|0,R=+ie[I>>3],g=d+24|0,x=+ie[g>>3],v=R-x,v=R<x?v+6.283185307179586:v,$=+ie[d>>3],B=d+8|0,z=+ie[B>>3],X=$-z,v=(v*p-v)*.5,p=(X*p-X)*.5,$=$+p,ie[d>>3]=$>1.5707963267948966?1.5707963267948966:$,p=z-p,ie[B>>3]=p<-1.5707963267948966?-1.5707963267948966:p,p=R+v,p=p>3.141592653589793?p+-6.283185307179586:p,ie[I>>3]=p<-3.141592653589793?p+6.283185307179586:p,p=x-v,p=p>3.141592653589793?p+-6.283185307179586:p,ie[g>>3]=p<-3.141592653589793?p+6.283185307179586:p}function Dn(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0,A[d>>2]=p,A[d+4>>2]=g,A[d+8>>2]=v}function Xc(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0;ce=p+8|0,A[ce>>2]=0,z=+ie[d>>3],R=+ni(+z),$=+ie[d+8>>3],B=+ni(+$)*1.1547005383792515,R=R+B*.5,g=~~R,d=~~B,R=R-+(g|0),B=B-+(d|0);do if(R<.5)if(R<.3333333333333333)if(A[p>>2]=g,B<(R+1)*.5){A[p+4>>2]=d;break}else{d=d+1|0,A[p+4>>2]=d;break}else if(Te=1-R,d=(!(B<Te)&1)+d|0,A[p+4>>2]=d,Te<=B&B<R*2){g=g+1|0,A[p>>2]=g;break}else{A[p>>2]=g;break}else{if(!(R<.6666666666666666))if(g=g+1|0,A[p>>2]=g,B<R*.5){A[p+4>>2]=d;break}else{d=d+1|0,A[p+4>>2]=d;break}if(B<1-R){if(A[p+4>>2]=d,R*2+-1<B){A[p>>2]=g;break}}else d=d+1|0,A[p+4>>2]=d;g=g+1|0,A[p>>2]=g}while(!1);do if(z<0)if(d&1){X=(d+1|0)/2|0,X=qr(g|0,((g|0)<0)<<31>>31|0,X|0,((X|0)<0)<<31>>31|0)|0,g=~~(+(g|0)-((+(X>>>0)+4294967296*+(fe()|0))*2+1)),A[p>>2]=g;break}else{X=(d|0)/2|0,X=qr(g|0,((g|0)<0)<<31>>31|0,X|0,((X|0)<0)<<31>>31|0)|0,g=~~(+(g|0)-(+(X>>>0)+4294967296*+(fe()|0))*2),A[p>>2]=g;break}while(!1);X=p+4|0,$<0&&(g=g-((d<<1|1|0)/2|0)|0,A[p>>2]=g,d=0-d|0,A[X>>2]=d),v=d-g|0,(g|0)<0?(x=0-g|0,A[X>>2]=v,A[ce>>2]=x,A[p>>2]=0,d=v,g=0):x=0,(d|0)<0&&(g=g-d|0,A[p>>2]=g,x=x-d|0,A[ce>>2]=x,A[X>>2]=0,d=0),I=g-x|0,v=d-x|0,(x|0)<0&&(A[p>>2]=I,A[X>>2]=v,A[ce>>2]=0,d=v,g=I,x=0),v=(d|0)<(g|0)?d:g,v=(x|0)<(v|0)?x:v,!((v|0)<=0)&&(A[p>>2]=g-v,A[X>>2]=d-v,A[ce>>2]=x-v)}function An(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0;p=A[d>>2]|0,R=d+4|0,g=A[R>>2]|0,(p|0)<0&&(g=g-p|0,A[R>>2]=g,I=d+8|0,A[I>>2]=(A[I>>2]|0)-p,A[d>>2]=0,p=0),(g|0)<0?(p=p-g|0,A[d>>2]=p,I=d+8|0,x=(A[I>>2]|0)-g|0,A[I>>2]=x,A[R>>2]=0,g=0):(x=d+8|0,I=x,x=A[x>>2]|0),(x|0)<0&&(p=p-x|0,A[d>>2]=p,g=g-x|0,A[R>>2]=g,A[I>>2]=0,x=0),v=(g|0)<(p|0)?g:p,v=(x|0)<(v|0)?x:v,!((v|0)<=0)&&(A[d>>2]=p-v,A[R>>2]=g-v,A[I>>2]=x-v)}function Ws(d,p){d=d|0,p=p|0;var g=0,v=0;v=A[d+8>>2]|0,g=+((A[d+4>>2]|0)-v|0),ie[p>>3]=+((A[d>>2]|0)-v|0)-g*.5,ie[p+8>>3]=g*.8660254037844386}function sn(d,p,g){d=d|0,p=p|0,g=g|0,A[g>>2]=(A[p>>2]|0)+(A[d>>2]|0),A[g+4>>2]=(A[p+4>>2]|0)+(A[d+4>>2]|0),A[g+8>>2]=(A[p+8>>2]|0)+(A[d+8>>2]|0)}function na(d,p,g){d=d|0,p=p|0,g=g|0,A[g>>2]=(A[d>>2]|0)-(A[p>>2]|0),A[g+4>>2]=(A[d+4>>2]|0)-(A[p+4>>2]|0),A[g+8>>2]=(A[d+8>>2]|0)-(A[p+8>>2]|0)}function Yl(d,p){d=d|0,p=p|0;var g=0,v=0;g=Sr(A[d>>2]|0,p)|0,A[d>>2]=g,g=d+4|0,v=Sr(A[g>>2]|0,p)|0,A[g>>2]=v,d=d+8|0,p=Sr(A[d>>2]|0,p)|0,A[d>>2]=p}function sa(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;R=A[d>>2]|0,B=(R|0)<0,v=(A[d+4>>2]|0)-(B?R:0)|0,I=(v|0)<0,x=(I?0-v|0:0)+((A[d+8>>2]|0)-(B?R:0))|0,g=(x|0)<0,d=g?0:x,p=(I?0:v)-(g?x:0)|0,x=(B?0:R)-(I?v:0)-(g?x:0)|0,g=(p|0)<(x|0)?p:x,g=(d|0)<(g|0)?d:g,v=(g|0)>0,d=d-(v?g:0)|0,p=p-(v?g:0)|0;e:do switch(x-(v?g:0)|0){case 0:switch(p|0){case 0:return B=(d|0)==0?0:(d|0)==1?1:7,B|0;case 1:return B=(d|0)==0?2:(d|0)==1?3:7,B|0;default:break e}case 1:switch(p|0){case 0:return B=(d|0)==0?4:(d|0)==1?5:7,B|0;case 1:{if(!d)d=6;else break e;return d|0}default:break e}}while(!1);return B=7,B|0}function ml(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0;if(z=d+8|0,R=A[z>>2]|0,B=(A[d>>2]|0)-R|0,$=d+4|0,R=(A[$>>2]|0)-R|0,B>>>0>715827881|R>>>0>715827881){if(v=(B|0)>0,x=2147483647-B|0,I=-2147483648-B|0,(v?(x|0)<(B|0):(I|0)>(B|0))||(g=B<<1,v?(2147483647-g|0)<(B|0):(-2147483648-g|0)>(B|0))||((R|0)>0?(2147483647-R|0)<(R|0):(-2147483648-R|0)>(R|0))||(p=B*3|0,g=R<<1,(v?(x|0)<(g|0):(I|0)>(g|0))||((B|0)>-1?(p|-2147483648|0)>=(R|0):(p^-2147483648|0)<(R|0))))return $=1,$|0}else g=R<<1,p=B*3|0;return v=po(+(p-R|0)*.14285714285714285)|0,A[d>>2]=v,x=po(+(g+B|0)*.14285714285714285)|0,A[$>>2]=x,A[z>>2]=0,g=(x|0)<(v|0),p=g?v:x,g=g?x:v,(g|0)<0&&(((g|0)==-2147483648||((p|0)>0?(2147483647-p|0)<(g|0):(-2147483648-p|0)>(g|0)))&&Mi(27795,26892,354,26903),((p|0)>-1?(p|-2147483648|0)>=(g|0):(p^-2147483648|0)<(g|0))&&Mi(27795,26892,354,26903)),p=x-v|0,(v|0)<0?(g=0-v|0,A[$>>2]=p,A[z>>2]=g,A[d>>2]=0,v=0):(p=x,g=0),(p|0)<0&&(v=v-p|0,A[d>>2]=v,g=g-p|0,A[z>>2]=g,A[$>>2]=0,p=0),I=v-g|0,x=p-g|0,(g|0)<0?(A[d>>2]=I,A[$>>2]=x,A[z>>2]=0,p=x,x=I,g=0):x=v,v=(p|0)<(x|0)?p:x,v=(g|0)<(v|0)?g:v,(v|0)<=0?($=0,$|0):(A[d>>2]=x-v,A[$>>2]=p-v,A[z>>2]=g-v,$=0,$|0)}function oa(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0;if(R=d+8|0,x=A[R>>2]|0,I=(A[d>>2]|0)-x|0,B=d+4|0,x=(A[B>>2]|0)-x|0,I>>>0>715827881|x>>>0>715827881){if(g=(I|0)>0,(g?(2147483647-I|0)<(I|0):(-2147483648-I|0)>(I|0))||(p=I<<1,v=(x|0)>0,v?(2147483647-x|0)<(x|0):(-2147483648-x|0)>(x|0)))return B=1,B|0;if(z=x<<1,(v?(2147483647-z|0)<(x|0):(-2147483648-z|0)>(x|0))||(g?(2147483647-p|0)<(x|0):(-2147483648-p|0)>(x|0))||(g=x*3|0,(x|0)>-1?(g|-2147483648|0)>=(I|0):(g^-2147483648|0)<(I|0)))return z=1,z|0}else g=x*3|0,p=I<<1;return v=po(+(p+x|0)*.14285714285714285)|0,A[d>>2]=v,x=po(+(g-I|0)*.14285714285714285)|0,A[B>>2]=x,A[R>>2]=0,g=(x|0)<(v|0),p=g?v:x,g=g?x:v,(g|0)<0&&(((g|0)==-2147483648||((p|0)>0?(2147483647-p|0)<(g|0):(-2147483648-p|0)>(g|0)))&&Mi(27795,26892,402,26917),((p|0)>-1?(p|-2147483648|0)>=(g|0):(p^-2147483648|0)<(g|0))&&Mi(27795,26892,402,26917)),p=x-v|0,(v|0)<0?(g=0-v|0,A[B>>2]=p,A[R>>2]=g,A[d>>2]=0,v=0):(p=x,g=0),(p|0)<0&&(v=v-p|0,A[d>>2]=v,g=g-p|0,A[R>>2]=g,A[B>>2]=0,p=0),I=v-g|0,x=p-g|0,(g|0)<0?(A[d>>2]=I,A[B>>2]=x,A[R>>2]=0,p=x,x=I,g=0):x=v,v=(p|0)<(x|0)?p:x,v=(g|0)<(v|0)?g:v,(v|0)<=0?(z=0,z|0):(A[d>>2]=x-v,A[B>>2]=p-v,A[R>>2]=g-v,z=0,z|0)}function dn(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;R=d+8|0,g=A[R>>2]|0,p=(A[d>>2]|0)-g|0,B=d+4|0,g=(A[B>>2]|0)-g|0,v=po(+((p*3|0)-g|0)*.14285714285714285)|0,A[d>>2]=v,p=po(+((g<<1)+p|0)*.14285714285714285)|0,A[B>>2]=p,A[R>>2]=0,g=p-v|0,(v|0)<0?(I=0-v|0,A[B>>2]=g,A[R>>2]=I,A[d>>2]=0,p=g,v=0,g=I):g=0,(p|0)<0&&(v=v-p|0,A[d>>2]=v,g=g-p|0,A[R>>2]=g,A[B>>2]=0,p=0),I=v-g|0,x=p-g|0,(g|0)<0?(A[d>>2]=I,A[B>>2]=x,A[R>>2]=0,p=x,x=I,g=0):x=v,v=(p|0)<(x|0)?p:x,v=(g|0)<(v|0)?g:v,!((v|0)<=0)&&(A[d>>2]=x-v,A[B>>2]=p-v,A[R>>2]=g-v)}function ko(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;R=d+8|0,g=A[R>>2]|0,p=(A[d>>2]|0)-g|0,B=d+4|0,g=(A[B>>2]|0)-g|0,v=po(+((p<<1)+g|0)*.14285714285714285)|0,A[d>>2]=v,p=po(+((g*3|0)-p|0)*.14285714285714285)|0,A[B>>2]=p,A[R>>2]=0,g=p-v|0,(v|0)<0?(I=0-v|0,A[B>>2]=g,A[R>>2]=I,A[d>>2]=0,p=g,v=0,g=I):g=0,(p|0)<0&&(v=v-p|0,A[d>>2]=v,g=g-p|0,A[R>>2]=g,A[B>>2]=0,p=0),I=v-g|0,x=p-g|0,(g|0)<0?(A[d>>2]=I,A[B>>2]=x,A[R>>2]=0,p=x,x=I,g=0):x=v,v=(p|0)<(x|0)?p:x,v=(g|0)<(v|0)?g:v,!((v|0)<=0)&&(A[d>>2]=x-v,A[B>>2]=p-v,A[R>>2]=g-v)}function Do(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;p=A[d>>2]|0,R=d+4|0,g=A[R>>2]|0,B=d+8|0,v=A[B>>2]|0,x=g+(p*3|0)|0,A[d>>2]=x,g=v+(g*3|0)|0,A[R>>2]=g,p=(v*3|0)+p|0,A[B>>2]=p,v=g-x|0,(x|0)<0?(p=p-x|0,A[R>>2]=v,A[B>>2]=p,A[d>>2]=0,g=v,v=0):v=x,(g|0)<0&&(v=v-g|0,A[d>>2]=v,p=p-g|0,A[B>>2]=p,A[R>>2]=0,g=0),I=v-p|0,x=g-p|0,(p|0)<0?(A[d>>2]=I,A[R>>2]=x,A[B>>2]=0,v=I,p=0):x=g,g=(x|0)<(v|0)?x:v,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=v-g,A[R>>2]=x-g,A[B>>2]=p-g)}function ls(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;x=A[d>>2]|0,R=d+4|0,p=A[R>>2]|0,B=d+8|0,g=A[B>>2]|0,v=(p*3|0)+x|0,x=g+(x*3|0)|0,A[d>>2]=x,A[R>>2]=v,p=(g*3|0)+p|0,A[B>>2]=p,g=v-x|0,(x|0)<0?(p=p-x|0,A[R>>2]=g,A[B>>2]=p,A[d>>2]=0,x=0):g=v,(g|0)<0&&(x=x-g|0,A[d>>2]=x,p=p-g|0,A[B>>2]=p,A[R>>2]=0,g=0),I=x-p|0,v=g-p|0,(p|0)<0?(A[d>>2]=I,A[R>>2]=v,A[B>>2]=0,x=I,p=0):v=g,g=(v|0)<(x|0)?v:x,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=x-g,A[R>>2]=v-g,A[B>>2]=p-g)}function ln(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0;(p+-1|0)>>>0>=6||(x=(A[15440+(p*12|0)>>2]|0)+(A[d>>2]|0)|0,A[d>>2]=x,B=d+4|0,v=(A[15440+(p*12|0)+4>>2]|0)+(A[B>>2]|0)|0,A[B>>2]=v,R=d+8|0,p=(A[15440+(p*12|0)+8>>2]|0)+(A[R>>2]|0)|0,A[R>>2]=p,g=v-x|0,(x|0)<0?(p=p-x|0,A[B>>2]=g,A[R>>2]=p,A[d>>2]=0,v=0):(g=v,v=x),(g|0)<0&&(v=v-g|0,A[d>>2]=v,p=p-g|0,A[R>>2]=p,A[B>>2]=0,g=0),I=v-p|0,x=g-p|0,(p|0)<0?(A[d>>2]=I,A[B>>2]=x,A[R>>2]=0,v=I,p=0):x=g,g=(x|0)<(v|0)?x:v,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=v-g,A[B>>2]=x-g,A[R>>2]=p-g))}function _l(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;x=A[d>>2]|0,R=d+4|0,p=A[R>>2]|0,B=d+8|0,g=A[B>>2]|0,v=p+x|0,x=g+x|0,A[d>>2]=x,A[R>>2]=v,p=g+p|0,A[B>>2]=p,g=v-x|0,(x|0)<0?(p=p-x|0,A[R>>2]=g,A[B>>2]=p,A[d>>2]=0,v=0):(g=v,v=x),(g|0)<0&&(v=v-g|0,A[d>>2]=v,p=p-g|0,A[B>>2]=p,A[R>>2]=0,g=0),I=v-p|0,x=g-p|0,(p|0)<0?(A[d>>2]=I,A[R>>2]=x,A[B>>2]=0,v=I,p=0):x=g,g=(x|0)<(v|0)?x:v,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=v-g,A[R>>2]=x-g,A[B>>2]=p-g)}function aa(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;p=A[d>>2]|0,R=d+4|0,v=A[R>>2]|0,B=d+8|0,g=A[B>>2]|0,x=v+p|0,A[d>>2]=x,v=g+v|0,A[R>>2]=v,p=g+p|0,A[B>>2]=p,g=v-x|0,(x|0)<0?(p=p-x|0,A[R>>2]=g,A[B>>2]=p,A[d>>2]=0,v=0):(g=v,v=x),(g|0)<0&&(v=v-g|0,A[d>>2]=v,p=p-g|0,A[B>>2]=p,A[R>>2]=0,g=0),I=v-p|0,x=g-p|0,(p|0)<0?(A[d>>2]=I,A[R>>2]=x,A[B>>2]=0,v=I,p=0):x=g,g=(x|0)<(v|0)?x:v,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=v-g,A[R>>2]=x-g,A[B>>2]=p-g)}function Bo(d){switch(d=d|0,d|0){case 1:{d=5;break}case 5:{d=4;break}case 4:{d=6;break}case 6:{d=2;break}case 2:{d=3;break}case 3:{d=1;break}}return d|0}function Oo(d){switch(d=d|0,d|0){case 1:{d=3;break}case 3:{d=2;break}case 2:{d=6;break}case 6:{d=4;break}case 4:{d=5;break}case 5:{d=1;break}}return d|0}function Cn(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;p=A[d>>2]|0,R=d+4|0,g=A[R>>2]|0,B=d+8|0,v=A[B>>2]|0,x=g+(p<<1)|0,A[d>>2]=x,g=v+(g<<1)|0,A[R>>2]=g,p=(v<<1)+p|0,A[B>>2]=p,v=g-x|0,(x|0)<0?(p=p-x|0,A[R>>2]=v,A[B>>2]=p,A[d>>2]=0,g=v,v=0):v=x,(g|0)<0&&(v=v-g|0,A[d>>2]=v,p=p-g|0,A[B>>2]=p,A[R>>2]=0,g=0),I=v-p|0,x=g-p|0,(p|0)<0?(A[d>>2]=I,A[R>>2]=x,A[B>>2]=0,v=I,p=0):x=g,g=(x|0)<(v|0)?x:v,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=v-g,A[R>>2]=x-g,A[B>>2]=p-g)}function Ha(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;x=A[d>>2]|0,R=d+4|0,p=A[R>>2]|0,B=d+8|0,g=A[B>>2]|0,v=(p<<1)+x|0,x=g+(x<<1)|0,A[d>>2]=x,A[R>>2]=v,p=(g<<1)+p|0,A[B>>2]=p,g=v-x|0,(x|0)<0?(p=p-x|0,A[R>>2]=g,A[B>>2]=p,A[d>>2]=0,x=0):g=v,(g|0)<0&&(x=x-g|0,A[d>>2]=x,p=p-g|0,A[B>>2]=p,A[R>>2]=0,g=0),I=x-p|0,v=g-p|0,(p|0)<0?(A[d>>2]=I,A[R>>2]=v,A[B>>2]=0,x=I,p=0):v=g,g=(v|0)<(x|0)?v:x,g=(p|0)<(g|0)?p:g,!((g|0)<=0)&&(A[d>>2]=x-g,A[R>>2]=v-g,A[B>>2]=p-g)}function Bs(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0;return R=(A[d>>2]|0)-(A[p>>2]|0)|0,B=(R|0)<0,v=(A[d+4>>2]|0)-(A[p+4>>2]|0)-(B?R:0)|0,I=(v|0)<0,x=(B?0-R|0:0)+(A[d+8>>2]|0)-(A[p+8>>2]|0)+(I?0-v|0:0)|0,d=(x|0)<0,p=d?0:x,g=(I?0:v)-(d?x:0)|0,x=(B?0:R)-(I?v:0)-(d?x:0)|0,d=(g|0)<(x|0)?g:x,d=(p|0)<(d|0)?p:d,v=(d|0)>0,p=p-(v?d:0)|0,g=g-(v?d:0)|0,d=x-(v?d:0)|0,d=(d|0)>-1?d:0-d|0,g=(g|0)>-1?g:0-g|0,p=(p|0)>-1?p:0-p|0,p=(g|0)>(p|0)?g:p,((d|0)>(p|0)?d:p)|0}function la(d,p){d=d|0,p=p|0;var g=0;g=A[d+8>>2]|0,A[p>>2]=(A[d>>2]|0)-g,A[p+4>>2]=(A[d+4>>2]|0)-g}function yl(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0;return v=A[d>>2]|0,A[p>>2]=v,x=A[d+4>>2]|0,R=p+4|0,A[R>>2]=x,B=p+8|0,A[B>>2]=0,g=(x|0)<(v|0),d=g?v:x,g=g?x:v,(g|0)<0&&((g|0)==-2147483648||((d|0)>0?(2147483647-d|0)<(g|0):(-2147483648-d|0)>(g|0))||((d|0)>-1?(d|-2147483648|0)>=(g|0):(d^-2147483648|0)<(g|0)))?(p=1,p|0):(d=x-v|0,(v|0)<0?(g=0-v|0,A[R>>2]=d,A[B>>2]=g,A[p>>2]=0,v=0):(d=x,g=0),(d|0)<0&&(v=v-d|0,A[p>>2]=v,g=g-d|0,A[B>>2]=g,A[R>>2]=0,d=0),I=v-g|0,x=d-g|0,(g|0)<0?(A[p>>2]=I,A[R>>2]=x,A[B>>2]=0,d=x,x=I,g=0):x=v,v=(d|0)<(x|0)?d:x,v=(g|0)<(v|0)?g:v,(v|0)<=0?(p=0,p|0):(A[p>>2]=x-v,A[R>>2]=d-v,A[B>>2]=g-v,p=0,p|0))}function bs(d){d=d|0;var p=0,g=0,v=0,x=0;p=d+8|0,x=A[p>>2]|0,g=x-(A[d>>2]|0)|0,A[d>>2]=g,v=d+4|0,d=(A[v>>2]|0)-x|0,A[v>>2]=d,A[p>>2]=0-(d+g)}function ca(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;g=A[d>>2]|0,p=0-g|0,A[d>>2]=p,R=d+8|0,A[R>>2]=0,B=d+4|0,v=A[B>>2]|0,x=v+g|0,(g|0)>0?(A[B>>2]=x,A[R>>2]=g,A[d>>2]=0,p=0,v=x):g=0,(v|0)<0?(I=p-v|0,A[d>>2]=I,g=g-v|0,A[R>>2]=g,A[B>>2]=0,x=I-g|0,p=0-g|0,(g|0)<0?(A[d>>2]=x,A[B>>2]=p,A[R>>2]=0,v=p,g=0):(v=0,x=I)):x=p,p=(v|0)<(x|0)?v:x,p=(g|0)<(p|0)?g:p,!((p|0)<=0)&&(A[d>>2]=x-p,A[B>>2]=v-p,A[R>>2]=g-p)}function Ql(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0;if(ce=se,se=se+64|0,X=ce,B=ce+56|0,!(!0&(p&2013265920|0)==134217728&(!0&(v&2013265920|0)==134217728)))return x=5,se=ce,x|0;if((d|0)==(g|0)&(p|0)==(v|0))return A[x>>2]=0,x=0,se=ce,x|0;if(R=Ut(d|0,p|0,52)|0,fe()|0,R=R&15,$=Ut(g|0,v|0,52)|0,fe()|0,(R|0)!=($&15|0))return x=12,se=ce,x|0;if(I=R+-1|0,R>>>0>1){rc(d,p,I,X)|0,rc(g,v,I,B)|0,$=X,z=A[$>>2]|0,$=A[$+4>>2]|0;e:do if((z|0)==(A[B>>2]|0)&&($|0)==(A[B+4>>2]|0)){R=(R^15)*3|0,I=Ut(d|0,p|0,R|0)|0,fe()|0,I=I&7,R=Ut(g|0,v|0,R|0)|0,fe()|0,R=R&7;do if((I|0)==0|(R|0)==0)A[x>>2]=1,I=0;else if((I|0)==7)I=5;else{if((I|0)==1|(R|0)==1&&Ir(z,$)|0){I=5;break}if((A[15536+(I<<2)>>2]|0)!=(R|0)&&(A[15568+(I<<2)>>2]|0)!=(R|0))break e;A[x>>2]=1,I=0}while(!1);return x=I,se=ce,x|0}while(!1)}I=X,R=I+56|0;do A[I>>2]=0,I=I+4|0;while((I|0)<(R|0));return Xl(d,p,1,X)|0,p=X,!((A[p>>2]|0)==(g|0)&&(A[p+4>>2]|0)==(v|0))&&(p=X+8|0,!((A[p>>2]|0)==(g|0)&&(A[p+4>>2]|0)==(v|0)))&&(p=X+16|0,!((A[p>>2]|0)==(g|0)&&(A[p+4>>2]|0)==(v|0)))&&(p=X+24|0,!((A[p>>2]|0)==(g|0)&&(A[p+4>>2]|0)==(v|0)))&&(p=X+32|0,!((A[p>>2]|0)==(g|0)&&(A[p+4>>2]|0)==(v|0)))&&(p=X+40|0,!((A[p>>2]|0)==(g|0)&&(A[p+4>>2]|0)==(v|0)))?(I=X+48|0,I=((A[I>>2]|0)==(g|0)?(A[I+4>>2]|0)==(v|0):0)&1):I=1,A[x>>2]=I,x=0,se=ce,x|0}function Tf(d,p,g,v,x){return d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,g=ta(d,p,g,v)|0,(g|0)==7?(x=11,x|0):(v=qt(g|0,0,56)|0,p=p&-2130706433|(fe()|0)|268435456,A[x>>2]=d|v,A[x+4>>2]=p,x=0,x|0)}function Gc(d,p,g){return d=d|0,p=p|0,g=g|0,!0&(p&2013265920|0)==268435456?(A[g>>2]=d,A[g+4>>2]=p&-2130706433|134217728,g=0,g|0):(g=6,g|0)}function Sf(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;return x=se,se=se+16|0,v=x,A[v>>2]=0,!0&(p&2013265920|0)==268435456?(I=Ut(d|0,p|0,56)|0,fe()|0,v=hn(d,p&-2130706433|134217728,I&7,v,g)|0,se=x,v|0):(v=6,se=x,v|0)}function Ef(d,p){d=d|0,p=p|0;var g=0;switch(g=Ut(d|0,p|0,56)|0,fe()|0,g&7){case 0:case 7:return g=0,g|0}return g=p&-2130706433|134217728,!(!0&(p&2013265920|0)==268435456)||!0&(p&117440512|0)==16777216&(Ir(d,g)|0)!=0?(g=0,g|0):(g=ic(d,g)|0,g|0)}function Cf(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0;return x=se,se=se+16|0,v=x,!0&(p&2013265920|0)==268435456?(I=p&-2130706433|134217728,R=g,A[R>>2]=d,A[R+4>>2]=I,A[v>>2]=0,p=Ut(d|0,p|0,56)|0,fe()|0,v=hn(d,I,p&7,v,g+8|0)|0,se=x,v|0):(v=6,se=x,v|0)}function Kl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0;return x=(Ir(d,p)|0)==0,p=p&-2130706433,v=g,A[v>>2]=x?d:0,A[v+4>>2]=x?p|285212672:0,v=g+8|0,A[v>>2]=d,A[v+4>>2]=p|301989888,v=g+16|0,A[v>>2]=d,A[v+4>>2]=p|318767104,v=g+24|0,A[v>>2]=d,A[v+4>>2]=p|335544320,v=g+32|0,A[v>>2]=d,A[v+4>>2]=p|352321536,g=g+40|0,A[g>>2]=d,A[g+4>>2]=p|369098752,0}function co(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0;return R=se,se=se+16|0,x=R,I=p&-2130706433|134217728,!0&(p&2013265920|0)==268435456?(v=Ut(d|0,p|0,56)|0,fe()|0,v=hu(d,I,v&7)|0,(v|0)==-1?(A[g>>2]=0,I=6,se=R,I|0):(rr(d,I,x)|0&&Mi(27795,26932,282,26947),p=Ut(d|0,p|0,52)|0,fe()|0,p=p&15,Ir(d,I)|0?bl(x,p,v,2,g):Za(x,p,v,2,g),I=0,se=R,I|0)):(I=6,se=R,I|0)}function Jl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0;v=se,se=se+16|0,x=v,ec(d,p,g,x),Xc(x,g+4|0),se=v}function ec(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0;if(B=se,se=se+16|0,z=B,tc(d,g,z),I=+Mo(+(1-+ie[z>>3]*.5)),I<1e-16){A[v>>2]=0,A[v+4>>2]=0,A[v+8>>2]=0,A[v+12>>2]=0,se=B;return}if(z=A[g>>2]|0,x=+ie[15920+(z*24|0)>>3],x=+Tl(x-+Tl(+lc(15600+(z<<4)|0,d))),vs(p)|0?R=+Tl(x+-.3334731722518321):R=x,x=+En(+I)*2.618033988749896,(p|0)>0){d=0;do x=x*2.6457513110645907,d=d+1|0;while((d|0)!=(p|0))}I=+Xi(+R)*x,ie[v>>3]=I,R=+si(+R)*x,ie[v+8>>3]=R,se=B}function tc(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;if(I=se,se=se+32|0,x=I,Dl(d,x),A[p>>2]=0,ie[g>>3]=5,v=+Zr(16400,x),v<+ie[g>>3]&&(A[p>>2]=0,ie[g>>3]=v),v=+Zr(16424,x),v<+ie[g>>3]&&(A[p>>2]=1,ie[g>>3]=v),v=+Zr(16448,x),v<+ie[g>>3]&&(A[p>>2]=2,ie[g>>3]=v),v=+Zr(16472,x),v<+ie[g>>3]&&(A[p>>2]=3,ie[g>>3]=v),v=+Zr(16496,x),v<+ie[g>>3]&&(A[p>>2]=4,ie[g>>3]=v),v=+Zr(16520,x),v<+ie[g>>3]&&(A[p>>2]=5,ie[g>>3]=v),v=+Zr(16544,x),v<+ie[g>>3]&&(A[p>>2]=6,ie[g>>3]=v),v=+Zr(16568,x),v<+ie[g>>3]&&(A[p>>2]=7,ie[g>>3]=v),v=+Zr(16592,x),v<+ie[g>>3]&&(A[p>>2]=8,ie[g>>3]=v),v=+Zr(16616,x),v<+ie[g>>3]&&(A[p>>2]=9,ie[g>>3]=v),v=+Zr(16640,x),v<+ie[g>>3]&&(A[p>>2]=10,ie[g>>3]=v),v=+Zr(16664,x),v<+ie[g>>3]&&(A[p>>2]=11,ie[g>>3]=v),v=+Zr(16688,x),v<+ie[g>>3]&&(A[p>>2]=12,ie[g>>3]=v),v=+Zr(16712,x),v<+ie[g>>3]&&(A[p>>2]=13,ie[g>>3]=v),v=+Zr(16736,x),v<+ie[g>>3]&&(A[p>>2]=14,ie[g>>3]=v),v=+Zr(16760,x),v<+ie[g>>3]&&(A[p>>2]=15,ie[g>>3]=v),v=+Zr(16784,x),v<+ie[g>>3]&&(A[p>>2]=16,ie[g>>3]=v),v=+Zr(16808,x),v<+ie[g>>3]&&(A[p>>2]=17,ie[g>>3]=v),v=+Zr(16832,x),v<+ie[g>>3]&&(A[p>>2]=18,ie[g>>3]=v),v=+Zr(16856,x),!(v<+ie[g>>3])){se=I;return}A[p>>2]=19,ie[g>>3]=v,se=I}function cs(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0;if(I=+$r(d),I<1e-16){p=15600+(p<<4)|0,A[x>>2]=A[p>>2],A[x+4>>2]=A[p+4>>2],A[x+8>>2]=A[p+8>>2],A[x+12>>2]=A[p+12>>2];return}if(R=+nn(+ +ie[d+8>>3],+ +ie[d>>3]),(g|0)>0){d=0;do I=I*.37796447300922725,d=d+1|0;while((d|0)!=(g|0))}B=I*.3333333333333333,v?(g=(vs(g)|0)==0,I=+Jo(+((g?B:B*.37796447300922725)*.381966011250105))):(I=+Jo(+(I*.381966011250105)),vs(g)|0&&(R=+Tl(R+.3334731722518321))),nu(15600+(p<<4)|0,+Tl(+ie[15920+(p*24|0)>>3]-R),I,x)}function th(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0;v=se,se=se+16|0,x=v,Ws(d+4|0,x),cs(x,A[d>>2]|0,p,0,g),se=v}function bl(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0,Ft=0,Gt=0,Ri=0,mi=0,Ht=0,bi=0,_r=0,Ii=0;if(bi=se,se=se+272|0,I=bi+256|0,at=bi+240|0,Ri=bi,mi=bi+224|0,Ht=bi+208|0,st=bi+176|0,qe=bi+160|0,Zt=bi+192|0,yi=bi+144|0,ai=bi+128|0,Ni=bi+112|0,Ft=bi+96|0,Gt=bi+80|0,A[I>>2]=p,A[at>>2]=A[d>>2],A[at+4>>2]=A[d+4>>2],A[at+8>>2]=A[d+8>>2],A[at+12>>2]=A[d+12>>2],$a(at,I,Ri),A[x>>2]=0,at=v+g+((v|0)==5&1)|0,(at|0)<=(g|0)){se=bi;return}z=A[I>>2]|0,$=mi+4|0,X=st+4|0,ce=g+5|0,Te=16880+(z<<2)|0,xe=16960+(z<<2)|0,we=ai+8|0,je=Ni+8|0,Ze=Ft+8|0,gt=Ht+4|0,B=g;e:for(;;){R=Ri+(((B|0)%5|0)<<4)|0,A[Ht>>2]=A[R>>2],A[Ht+4>>2]=A[R+4>>2],A[Ht+8>>2]=A[R+8>>2],A[Ht+12>>2]=A[R+12>>2];do;while((eo(Ht,z,0,1)|0)==2);if((B|0)>(g|0)&(vs(p)|0)!=0){if(A[st>>2]=A[Ht>>2],A[st+4>>2]=A[Ht+4>>2],A[st+8>>2]=A[Ht+8>>2],A[st+12>>2]=A[Ht+12>>2],Ws($,qe),v=A[st>>2]|0,I=A[17040+(v*80|0)+(A[mi>>2]<<2)>>2]|0,A[st>>2]=A[18640+(v*80|0)+(I*20|0)>>2],R=A[18640+(v*80|0)+(I*20|0)+16>>2]|0,(R|0)>0){d=0;do _l(X),d=d+1|0;while((d|0)<(R|0))}switch(R=18640+(v*80|0)+(I*20|0)+4|0,A[Zt>>2]=A[R>>2],A[Zt+4>>2]=A[R+4>>2],A[Zt+8>>2]=A[R+8>>2],Yl(Zt,(A[Te>>2]|0)*3|0),sn(X,Zt,X),An(X),Ws(X,yi),_r=+(A[xe>>2]|0),ie[ai>>3]=_r*3,ie[we>>3]=0,Ii=_r*-1.5,ie[Ni>>3]=Ii,ie[je>>3]=_r*2.598076211353316,ie[Ft>>3]=Ii,ie[Ze>>3]=_r*-2.598076211353316,A[17040+((A[st>>2]|0)*80|0)+(A[Ht>>2]<<2)>>2]|0){case 1:{d=Ni,v=ai;break}case 3:{d=Ft,v=Ni;break}case 2:{d=ai,v=Ft;break}default:{d=12;break e}}Ao(qe,yi,v,d,Gt),cs(Gt,A[st>>2]|0,z,1,x+8+(A[x>>2]<<4)|0),A[x>>2]=(A[x>>2]|0)+1}if((B|0)<(ce|0)&&(Ws(gt,st),cs(st,A[Ht>>2]|0,z,1,x+8+(A[x>>2]<<4)|0),A[x>>2]=(A[x>>2]|0)+1),A[mi>>2]=A[Ht>>2],A[mi+4>>2]=A[Ht+4>>2],A[mi+8>>2]=A[Ht+8>>2],A[mi+12>>2]=A[Ht+12>>2],B=B+1|0,(B|0)>=(at|0)){d=3;break}}if((d|0)==3){se=bi;return}else(d|0)==12&&Mi(26970,27017,572,27027)}function $a(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0;z=se,se=se+128|0,v=z+64|0,x=z,I=v,R=20240,B=I+60|0;do A[I>>2]=A[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(B|0));I=x,R=20304,B=I+60|0;do A[I>>2]=A[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(B|0));B=(vs(A[p>>2]|0)|0)==0,v=B?v:x,x=d+4|0,Cn(x),Ha(x),vs(A[p>>2]|0)|0&&(ls(x),A[p>>2]=(A[p>>2]|0)+1),A[g>>2]=A[d>>2],p=g+4|0,sn(x,v,p),An(p),A[g+16>>2]=A[d>>2],p=g+20|0,sn(x,v+12|0,p),An(p),A[g+32>>2]=A[d>>2],p=g+36|0,sn(x,v+24|0,p),An(p),A[g+48>>2]=A[d>>2],p=g+52|0,sn(x,v+36|0,p),An(p),A[g+64>>2]=A[d>>2],g=g+68|0,sn(x,v+48|0,g),An(g),se=z}function eo(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0;if(we=se,se=se+32|0,Te=we+12|0,B=we,xe=d+4|0,ce=A[16960+(p<<2)>>2]|0,X=(v|0)!=0,ce=X?ce*3|0:ce,x=A[xe>>2]|0,$=d+8|0,R=A[$>>2]|0,X){if(I=d+12|0,v=A[I>>2]|0,x=R+x+v|0,(x|0)==(ce|0))return xe=1,se=we,xe|0;z=I}else z=d+12|0,v=A[z>>2]|0,x=R+x+v|0;if((x|0)<=(ce|0))return xe=0,se=we,xe|0;do if((v|0)>0){if(v=A[d>>2]|0,(R|0)>0){I=18640+(v*80|0)+60|0,v=d;break}v=18640+(v*80|0)+40|0,g?(Dn(Te,ce,0,0),na(xe,Te,B),aa(B),sn(B,Te,xe),I=v,v=d):(I=v,v=d)}else I=18640+((A[d>>2]|0)*80|0)+20|0,v=d;while(!1);if(A[v>>2]=A[I>>2],x=I+16|0,(A[x>>2]|0)>0){v=0;do _l(xe),v=v+1|0;while((v|0)<(A[x>>2]|0))}return d=I+4|0,A[Te>>2]=A[d>>2],A[Te+4>>2]=A[d+4>>2],A[Te+8>>2]=A[d+8>>2],p=A[16880+(p<<2)>>2]|0,Yl(Te,X?p*3|0:p),sn(xe,Te,xe),An(xe),X?v=((A[$>>2]|0)+(A[xe>>2]|0)+(A[z>>2]|0)|0)==(ce|0)?1:2:v=2,xe=v,se=we,xe|0}function If(d,p){d=d|0,p=p|0;var g=0;do g=eo(d,p,0,1)|0;while((g|0)==2);return g|0}function Za(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0,Ft=0,Gt=0,Ri=0;if(Ft=se,se=se+240|0,I=Ft+224|0,Zt=Ft+208|0,yi=Ft,ai=Ft+192|0,Ni=Ft+176|0,Ze=Ft+160|0,gt=Ft+144|0,at=Ft+128|0,st=Ft+112|0,qe=Ft+96|0,A[I>>2]=p,A[Zt>>2]=A[d>>2],A[Zt+4>>2]=A[d+4>>2],A[Zt+8>>2]=A[d+8>>2],A[Zt+12>>2]=A[d+12>>2],Yc(Zt,I,yi),A[x>>2]=0,je=v+g+((v|0)==6&1)|0,(je|0)<=(g|0)){se=Ft;return}z=A[I>>2]|0,$=g+6|0,X=16960+(z<<2)|0,ce=gt+8|0,Te=at+8|0,xe=st+8|0,we=ai+4|0,R=0,B=g,v=-1;e:for(;;){if(I=(B|0)%6|0,d=yi+(I<<4)|0,A[ai>>2]=A[d>>2],A[ai+4>>2]=A[d+4>>2],A[ai+8>>2]=A[d+8>>2],A[ai+12>>2]=A[d+12>>2],d=R,R=eo(ai,z,0,1)|0,(B|0)>(g|0)&(vs(p)|0)!=0&&(d|0)!=1&&(A[ai>>2]|0)!=(v|0)){switch(Ws(yi+(((I+5|0)%6|0)<<4)+4|0,Ni),Ws(yi+(I<<4)+4|0,Ze),Gt=+(A[X>>2]|0),ie[gt>>3]=Gt*3,ie[ce>>3]=0,Ri=Gt*-1.5,ie[at>>3]=Ri,ie[Te>>3]=Gt*2.598076211353316,ie[st>>3]=Ri,ie[xe>>3]=Gt*-2.598076211353316,I=A[Zt>>2]|0,A[17040+(I*80|0)+(((v|0)==(I|0)?A[ai>>2]|0:v)<<2)>>2]|0){case 1:{d=at,v=gt;break}case 3:{d=st,v=at;break}case 2:{d=gt,v=st;break}default:{d=8;break e}}Ao(Ni,Ze,v,d,qe),!(us(Ni,qe)|0)&&!(us(Ze,qe)|0)&&(cs(qe,A[Zt>>2]|0,z,1,x+8+(A[x>>2]<<4)|0),A[x>>2]=(A[x>>2]|0)+1)}if((B|0)<($|0)&&(Ws(we,Ni),cs(Ni,A[ai>>2]|0,z,1,x+8+(A[x>>2]<<4)|0),A[x>>2]=(A[x>>2]|0)+1),B=B+1|0,(B|0)>=(je|0)){d=3;break}else v=A[ai>>2]|0}if((d|0)==3){se=Ft;return}else(d|0)==8&&Mi(27054,27017,737,27099)}function Yc(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0;z=se,se=se+160|0,v=z+80|0,x=z,I=v,R=20368,B=I+72|0;do A[I>>2]=A[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(B|0));I=x,R=20448,B=I+72|0;do A[I>>2]=A[R>>2],I=I+4|0,R=R+4|0;while((I|0)<(B|0));B=(vs(A[p>>2]|0)|0)==0,v=B?v:x,x=d+4|0,Cn(x),Ha(x),vs(A[p>>2]|0)|0&&(ls(x),A[p>>2]=(A[p>>2]|0)+1),A[g>>2]=A[d>>2],p=g+4|0,sn(x,v,p),An(p),A[g+16>>2]=A[d>>2],p=g+20|0,sn(x,v+12|0,p),An(p),A[g+32>>2]=A[d>>2],p=g+36|0,sn(x,v+24|0,p),An(p),A[g+48>>2]=A[d>>2],p=g+52|0,sn(x,v+36|0,p),An(p),A[g+64>>2]=A[d>>2],p=g+68|0,sn(x,v+48|0,p),An(p),A[g+80>>2]=A[d>>2],g=g+84|0,sn(x,v+60|0,g),An(g),se=z}function ua(d,p){return d=d|0,p=p|0,p=Ut(d|0,p|0,52)|0,fe()|0,p&15|0}function Qc(d,p){return d=d|0,p=p|0,p=Ut(d|0,p|0,45)|0,fe()|0,p&127|0}function ic(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0;return!(!0&(p&-16777216|0)==134217728)||(v=Ut(d|0,p|0,52)|0,fe()|0,v=v&15,g=Ut(d|0,p|0,45)|0,fe()|0,g=g&127,g>>>0>121)?(d=0,d|0):(R=(v^15)*3|0,x=Ut(d|0,p|0,R|0)|0,R=qt(x|0,fe()|0,R|0)|0,x=fe()|0,I=qr(-1227133514,-1171,R|0,x|0)|0,!((R&613566756&I|0)==0&(x&4681&(fe()|0)|0)==0)||(R=(v*3|0)+19|0,I=qt(~d|0,~p|0,R|0)|0,R=Ut(I|0,fe()|0,R|0)|0,!((v|0)==15|(R|0)==0&(fe()|0)==0))?(R=0,R|0):!(Tt[20528+g>>0]|0)||(p=p&8191,(d|0)==0&(p|0)==0)?(R=1,R|0):(R=vc(d|0,p|0)|0,fe()|0,((63-R|0)%3|0|0)!=0|0))}function Kc(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0;if(x=qt(p|0,0,52)|0,I=fe()|0,g=qt(g|0,0,45)|0,g=I|(fe()|0)|134225919,(p|0)<1){I=-1,v=g,p=d,A[p>>2]=I,d=d+4|0,A[d>>2]=v;return}for(I=1,x=-1;R=(15-I|0)*3|0,B=qt(7,0,R|0)|0,g=g&~(fe()|0),R=qt(v|0,0,R|0)|0,x=x&~B|R,g=g|(fe()|0),(I|0)!=(p|0);)I=I+1|0;B=d,R=B,A[R>>2]=x,B=B+4|0,A[B>>2]=g}function rc(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0;if(I=Ut(d|0,p|0,52)|0,fe()|0,I=I&15,g>>>0>15)return v=4,v|0;if((I|0)<(g|0))return v=12,v|0;if((I|0)==(g|0))return A[v>>2]=d,A[v+4>>2]=p,v=0,v|0;if(x=qt(g|0,0,52)|0,x=x|d,d=fe()|0|p&-15728641,(I|0)>(g|0))do p=qt(7,0,(14-g|0)*3|0)|0,g=g+1|0,x=p|x,d=fe()|0|d;while((g|0)<(I|0));return A[v>>2]=x,A[v+4>>2]=d,v=0,v|0}function uo(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0;if(I=Ut(d|0,p|0,52)|0,fe()|0,I=I&15,!((g|0)<16&(I|0)<=(g|0)))return v=4,v|0;x=g-I|0,g=Ut(d|0,p|0,45)|0,fe()|0;e:do if(!(gr(g&127)|0))g=ho(7,0,x,((x|0)<0)<<31>>31)|0,x=fe()|0;else{t:do if(I|0){for(g=1;R=qt(7,0,(15-g|0)*3|0)|0,!!((R&d|0)==0&((fe()|0)&p|0)==0);)if(g>>>0<I>>>0)g=g+1|0;else break t;g=ho(7,0,x,((x|0)<0)<<31>>31)|0,x=fe()|0;break e}while(!1);g=ho(7,0,x,((x|0)<0)<<31>>31)|0,g=Rr(g|0,fe()|0,5,0)|0,g=Ci(g|0,fe()|0,-5,-1)|0,g=gn(g|0,fe()|0,6,0)|0,g=Ci(g|0,fe()|0,1,0)|0,x=fe()|0}while(!1);return R=v,A[R>>2]=g,A[R+4>>2]=x,R=0,R|0}function Ir(d,p){d=d|0,p=p|0;var g=0,v=0,x=0;if(x=Ut(d|0,p|0,45)|0,fe()|0,!(gr(x&127)|0))return x=0,x|0;x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15;e:do if(!x)g=0;else for(v=1;;){if(g=Ut(d|0,p|0,(15-v|0)*3|0)|0,fe()|0,g=g&7,g|0)break e;if(v>>>0<x>>>0)v=v+1|0;else{g=0;break}}while(!1);return x=(g|0)==0&1,x|0}function ih(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0;if(R=se,se=se+16|0,I=R,iu(I,d,p,g),p=I,d=A[p>>2]|0,p=A[p+4>>2]|0,(d|0)==0&(p|0)==0)return se=R,0;x=0,g=0;do B=v+(x<<3)|0,A[B>>2]=d,A[B+4>>2]=p,x=Ci(x|0,g|0,1,0)|0,g=fe()|0,ru(I),B=I,d=A[B>>2]|0,p=A[B+4>>2]|0;while(!((d|0)==0&(p|0)==0));return se=R,0}function Jc(d,p,g,v){return d=d|0,p=p|0,g=g|0,v=v|0,(v|0)<(g|0)?(g=p,v=d,Di(g|0),v|0):(g=qt(-1,-1,((v-g|0)*3|0)+3|0)|0,v=qt(~g|0,~(fe()|0)|0,(15-v|0)*3|0)|0,g=~(fe()|0)&p,v=~v&d,Di(g|0),v|0)}function nc(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0;return x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15,(g|0)<16&(x|0)<=(g|0)?((x|0)<(g|0)&&(x=qt(-1,-1,((g+-1-x|0)*3|0)+3|0)|0,x=qt(~x|0,~(fe()|0)|0,(15-g|0)*3|0)|0,p=~(fe()|0)&p,d=~x&d),x=qt(g|0,0,52)|0,g=p&-15728641|(fe()|0),A[v>>2]=d|x,A[v+4>>2]=g,v=0,v|0):(v=4,v|0)}function Lo(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0,Ft=0,Gt=0,Ri=0,mi=0,Ht=0;if((g|0)==0&(v|0)==0)return Ht=0,Ht|0;if(x=d,I=A[x>>2]|0,x=A[x+4>>2]|0,!0&(x&15728640|0)==0){if(!((v|0)>0|(v|0)==0&g>>>0>0)||(Ht=p,A[Ht>>2]=I,A[Ht+4>>2]=x,(g|0)==1&(v|0)==0))return Ht=0,Ht|0;x=1,I=0;do Ri=d+(x<<3)|0,mi=A[Ri+4>>2]|0,Ht=p+(x<<3)|0,A[Ht>>2]=A[Ri>>2],A[Ht+4>>2]=mi,x=Ci(x|0,I|0,1,0)|0,I=fe()|0;while((I|0)<(v|0)|(I|0)==(v|0)&x>>>0<g>>>0);return x=0,x|0}if(Gt=g<<3,mi=Gn(Gt)|0,!mi)return Ht=13,Ht|0;if(mo(mi|0,d|0,Gt|0)|0,Ri=Yn(g,8)|0,!Ri)return ki(mi),Ht=13,Ht|0;e:for(;;){x=mi,$=A[x>>2]|0,x=A[x+4>>2]|0,Ni=Ut($|0,x|0,52)|0,fe()|0,Ni=Ni&15,Ft=Ni+-1|0,ai=(Ni|0)!=0,yi=(v|0)>0|(v|0)==0&g>>>0>0;t:do if(ai&yi){if(at=qt(Ft|0,0,52)|0,st=fe()|0,Ft>>>0>15){if(!(($|0)==0&(x|0)==0)){Ht=16;break e}for(I=0,d=0;;){if(I=Ci(I|0,d|0,1,0)|0,d=fe()|0,!((d|0)<(v|0)|(d|0)==(v|0)&I>>>0<g>>>0))break t;if(R=mi+(I<<3)|0,Zt=A[R>>2]|0,R=A[R+4>>2]|0,!((Zt|0)==0&(R|0)==0)){x=R,Ht=16;break e}}}for(B=$,d=x,I=0,R=0;;){if(!((B|0)==0&(d|0)==0)){if(!(!0&(d&117440512|0)==0)){Ht=21;break e}if(X=Ut(B|0,d|0,52)|0,fe()|0,X=X&15,(X|0)<(Ft|0)){x=12,Ht=27;break e}if((X|0)!=(Ft|0)&&(B=B|at,d=d&-15728641|st,X>>>0>=Ni>>>0)){z=Ft;do Zt=qt(7,0,(14-z|0)*3|0)|0,z=z+1|0,B=Zt|B,d=fe()|0|d;while(z>>>0<X>>>0)}if(Te=go(B|0,d|0,g|0,v|0)|0,xe=fe()|0,z=Ri+(Te<<3)|0,X=z,ce=A[X>>2]|0,X=A[X+4>>2]|0,!((ce|0)==0&(X|0)==0)){Ze=0,gt=0;do{if((Ze|0)>(v|0)|(Ze|0)==(v|0)&gt>>>0>g>>>0){Ht=31;break e}if((ce|0)==(B|0)&(X&-117440513|0)==(d|0)){we=Ut(ce|0,X|0,56)|0,fe()|0,we=we&7,je=we+1|0,Zt=Ut(ce|0,X|0,45)|0,fe()|0;i:do if(!(gr(Zt&127)|0))X=7;else{if(ce=Ut(ce|0,X|0,52)|0,fe()|0,ce=ce&15,!ce){X=6;break}for(X=1;;){if(Zt=qt(7,0,(15-X|0)*3|0)|0,!((Zt&B|0)==0&((fe()|0)&d|0)==0)){X=7;break i}if(X>>>0<ce>>>0)X=X+1|0;else{X=6;break}}}while(!1);if((we+2|0)>>>0>X>>>0){Ht=41;break e}Zt=qt(je|0,0,56)|0,d=fe()|0|d&-117440513,qe=z,A[qe>>2]=0,A[qe+4>>2]=0,B=Zt|B}else Te=Ci(Te|0,xe|0,1,0)|0,Te=Hs(Te|0,fe()|0,g|0,v|0)|0,xe=fe()|0;gt=Ci(gt|0,Ze|0,1,0)|0,Ze=fe()|0,z=Ri+(Te<<3)|0,X=z,ce=A[X>>2]|0,X=A[X+4>>2]|0}while(!((ce|0)==0&(X|0)==0))}Zt=z,A[Zt>>2]=B,A[Zt+4>>2]=d}if(I=Ci(I|0,R|0,1,0)|0,R=fe()|0,!((R|0)<(v|0)|(R|0)==(v|0)&I>>>0<g>>>0))break t;d=mi+(I<<3)|0,B=A[d>>2]|0,d=A[d+4>>2]|0}}while(!1);if(Zt=Ci(g|0,v|0,5,0)|0,qe=fe()|0,qe>>>0<0|(qe|0)==0&Zt>>>0<11){Ht=85;break}if(Zt=gn(g|0,v|0,6,0)|0,fe()|0,Zt=Yn(Zt,8)|0,!Zt){Ht=48;break}do if(yi){for(je=0,d=0,we=0,Ze=0;;){if(X=Ri+(je<<3)|0,R=X,I=A[R>>2]|0,R=A[R+4>>2]|0,(I|0)==0&(R|0)==0)qe=we;else{ce=Ut(I|0,R|0,56)|0,fe()|0,ce=ce&7,B=ce+1|0,Te=R&-117440513,qe=Ut(I|0,R|0,45)|0,fe()|0;t:do if(gr(qe&127)|0){if(xe=Ut(I|0,R|0,52)|0,fe()|0,xe=xe&15,xe|0)for(z=1;;){if(qe=qt(7,0,(15-z|0)*3|0)|0,!((I&qe|0)==0&(Te&(fe()|0)|0)==0))break t;if(z>>>0<xe>>>0)z=z+1|0;else break}R=qt(B|0,0,56)|0,I=R|I,R=fe()|0|Te,B=X,A[B>>2]=I,A[B+4>>2]=R,B=ce+2|0}while(!1);(B|0)==7?(qe=Zt+(d<<3)|0,A[qe>>2]=I,A[qe+4>>2]=R&-117440513,d=Ci(d|0,we|0,1,0)|0,qe=fe()|0):qe=we}if(je=Ci(je|0,Ze|0,1,0)|0,Ze=fe()|0,(Ze|0)<(v|0)|(Ze|0)==(v|0)&je>>>0<g>>>0)we=qe;else break}if(yi){if(gt=Ft>>>0>15,at=qt(Ft|0,0,52)|0,st=fe()|0,!ai){for(I=0,z=0,B=0,R=0;($|0)==0&(x|0)==0||(Ft=p+(I<<3)|0,A[Ft>>2]=$,A[Ft+4>>2]=x,I=Ci(I|0,z|0,1,0)|0,z=fe()|0),B=Ci(B|0,R|0,1,0)|0,R=fe()|0,!!((R|0)<(v|0)|(R|0)==(v|0)&B>>>0<g>>>0);)x=mi+(B<<3)|0,$=A[x>>2]|0,x=A[x+4>>2]|0;x=qe;break}for(I=0,z=0,R=0,B=0;;){do if(!(($|0)==0&(x|0)==0)){if(xe=Ut($|0,x|0,52)|0,fe()|0,xe=xe&15,gt|(xe|0)<(Ft|0)){Ht=80;break e}if((xe|0)!=(Ft|0)){if(X=$|at,ce=x&-15728641|st,xe>>>0>=Ni>>>0){Te=Ft;do ai=qt(7,0,(14-Te|0)*3|0)|0,Te=Te+1|0,X=ai|X,ce=fe()|0|ce;while(Te>>>0<xe>>>0)}}else X=$,ce=x;we=go(X|0,ce|0,g|0,v|0)|0,Te=0,xe=0,Ze=fe()|0;do{if((Te|0)>(v|0)|(Te|0)==(v|0)&xe>>>0>g>>>0){Ht=81;break e}if(ai=Ri+(we<<3)|0,je=A[ai+4>>2]|0,(je&-117440513|0)==(ce|0)&&(A[ai>>2]|0)==(X|0)){Ht=65;break}ai=Ci(we|0,Ze|0,1,0)|0,we=Hs(ai|0,fe()|0,g|0,v|0)|0,Ze=fe()|0,xe=Ci(xe|0,Te|0,1,0)|0,Te=fe()|0,ai=Ri+(we<<3)|0}while(!((A[ai>>2]|0)==(X|0)&&(A[ai+4>>2]|0)==(ce|0)));if((Ht|0)==65&&(Ht=0,!0&(je&117440512|0)==100663296))break;ai=p+(I<<3)|0,A[ai>>2]=$,A[ai+4>>2]=x,I=Ci(I|0,z|0,1,0)|0,z=fe()|0}while(!1);if(R=Ci(R|0,B|0,1,0)|0,B=fe()|0,!((B|0)<(v|0)|(B|0)==(v|0)&R>>>0<g>>>0))break;x=mi+(R<<3)|0,$=A[x>>2]|0,x=A[x+4>>2]|0}x=qe}else I=0,x=qe}else I=0,d=0,x=0;while(!1);if(to(Ri|0,0,Gt|0)|0,mo(mi|0,Zt|0,d<<3|0)|0,ki(Zt),(d|0)==0&(x|0)==0){Ht=89;break}else p=p+(I<<3)|0,v=x,g=d}if((Ht|0)==16)!0&(x&117440512|0)==0?(x=4,Ht=27):Ht=21;else if((Ht|0)==31)Mi(27795,27122,529,27132);else{if((Ht|0)==41)return ki(mi),ki(Ri),Ht=10,Ht|0;if((Ht|0)==48)return ki(mi),ki(Ri),Ht=13,Ht|0;(Ht|0)==80?Mi(27795,27122,620,27132):(Ht|0)==81?Mi(27795,27122,632,27132):(Ht|0)==85&&(mo(p|0,mi|0,g<<3|0)|0,Ht=89)}return(Ht|0)==21?(ki(mi),ki(Ri),Ht=5,Ht|0):(Ht|0)==27?(ki(mi),ki(Ri),Ht=x,Ht|0):(Ht|0)==89?(ki(mi),ki(Ri),Ht=0,Ht|0):0}function rh(d,p,g,v,x,I,R){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,I=I|0,R=R|0;var B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0;if(je=se,se=se+16|0,we=je,!((g|0)>0|(g|0)==0&p>>>0>0))return we=0,se=je,we|0;if((R|0)>=16)return we=12,se=je,we|0;Te=0,xe=0,ce=0,B=0;e:for(;;){if($=d+(Te<<3)|0,z=A[$>>2]|0,$=A[$+4>>2]|0,X=Ut(z|0,$|0,52)|0,fe()|0,(X&15|0)>(R|0)){B=12,z=11;break}if(iu(we,z,$,R),X=we,$=A[X>>2]|0,X=A[X+4>>2]|0,($|0)==0&(X|0)==0)z=ce;else{z=ce;do{if(!((B|0)<(I|0)|(B|0)==(I|0)&z>>>0<x>>>0)){z=10;break e}ce=v+(z<<3)|0,A[ce>>2]=$,A[ce+4>>2]=X,z=Ci(z|0,B|0,1,0)|0,B=fe()|0,ru(we),ce=we,$=A[ce>>2]|0,X=A[ce+4>>2]|0}while(!(($|0)==0&(X|0)==0))}if(Te=Ci(Te|0,xe|0,1,0)|0,xe=fe()|0,(xe|0)<(g|0)|(xe|0)==(g|0)&Te>>>0<p>>>0)ce=z;else{B=0,z=11;break}}return(z|0)==10?(we=14,se=je,we|0):(z|0)==11?(se=je,B|0):0}function nh(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0;Te=se,se=se+16|0,ce=Te;e:do if((g|0)>0|(g|0)==0&p>>>0>0){for($=0,R=0,I=0,X=0;;){if(z=d+($<<3)|0,B=A[z>>2]|0,z=A[z+4>>2]|0,!((B|0)==0&(z|0)==0)&&(z=(uo(B,z,v,ce)|0)==0,B=ce,R=Ci(A[B>>2]|0,A[B+4>>2]|0,R|0,I|0)|0,I=fe()|0,!z)){I=12;break}if($=Ci($|0,X|0,1,0)|0,X=fe()|0,!((X|0)<(g|0)|(X|0)==(g|0)&$>>>0<p>>>0))break e}return se=Te,I|0}else R=0,I=0;while(!1);return A[x>>2]=R,A[x+4>>2]=I,x=0,se=Te,x|0}function qa(d,p){return d=d|0,p=p|0,p=Ut(d|0,p|0,52)|0,fe()|0,p&1|0}function qn(d,p){d=d|0,p=p|0;var g=0,v=0,x=0;if(x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15,!x)return x=0,x|0;for(v=1;;){if(g=Ut(d|0,p|0,(15-v|0)*3|0)|0,fe()|0,g=g&7,g|0){v=5;break}if(v>>>0<x>>>0)v=v+1|0;else{g=0,v=5;break}}return(v|0)==5?g|0:0}function Xa(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0;if(z=Ut(d|0,p|0,52)|0,fe()|0,z=z&15,!z)return B=p,z=d,Di(B|0),z|0;for(B=1,g=0;;){I=(15-B|0)*3|0,v=qt(7,0,I|0)|0,x=fe()|0,R=Ut(d|0,p|0,I|0)|0,fe()|0,I=qt(Bo(R&7)|0,0,I|0)|0,R=fe()|0,d=I|d&~v,p=R|p&~x;e:do if(!g)if((I&v|0)==0&(R&x|0)==0)g=0;else if(v=Ut(d|0,p|0,52)|0,fe()|0,v=v&15,!v)g=1;else{g=1;t:for(;;){switch(R=Ut(d|0,p|0,(15-g|0)*3|0)|0,fe()|0,R&7){case 1:break t;case 0:break;default:{g=1;break e}}if(g>>>0<v>>>0)g=g+1|0;else{g=1;break e}}for(g=1;;)if(R=(15-g|0)*3|0,x=Ut(d|0,p|0,R|0)|0,fe()|0,I=qt(7,0,R|0)|0,p=p&~(fe()|0),R=qt(Bo(x&7)|0,0,R|0)|0,d=d&~I|R,p=p|(fe()|0),g>>>0<v>>>0)g=g+1|0;else{g=1;break}}while(!1);if(B>>>0<z>>>0)B=B+1|0;else break}return Di(p|0),d|0}function ha(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0;if(v=Ut(d|0,p|0,52)|0,fe()|0,v=v&15,!v)return g=p,v=d,Di(g|0),v|0;for(g=1;I=(15-g|0)*3|0,R=Ut(d|0,p|0,I|0)|0,fe()|0,x=qt(7,0,I|0)|0,p=p&~(fe()|0),I=qt(Bo(R&7)|0,0,I|0)|0,d=I|d&~x,p=fe()|0|p,g>>>0<v>>>0;)g=g+1|0;return Di(p|0),d|0}function Pf(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0;if(z=Ut(d|0,p|0,52)|0,fe()|0,z=z&15,!z)return B=p,z=d,Di(B|0),z|0;for(B=1,g=0;;){I=(15-B|0)*3|0,v=qt(7,0,I|0)|0,x=fe()|0,R=Ut(d|0,p|0,I|0)|0,fe()|0,I=qt(Oo(R&7)|0,0,I|0)|0,R=fe()|0,d=I|d&~v,p=R|p&~x;e:do if(!g)if((I&v|0)==0&(R&x|0)==0)g=0;else if(v=Ut(d|0,p|0,52)|0,fe()|0,v=v&15,!v)g=1;else{g=1;t:for(;;){switch(R=Ut(d|0,p|0,(15-g|0)*3|0)|0,fe()|0,R&7){case 1:break t;case 0:break;default:{g=1;break e}}if(g>>>0<v>>>0)g=g+1|0;else{g=1;break e}}for(g=1;;)if(x=(15-g|0)*3|0,I=qt(7,0,x|0)|0,R=p&~(fe()|0),p=Ut(d|0,p|0,x|0)|0,fe()|0,p=qt(Oo(p&7)|0,0,x|0)|0,d=d&~I|p,p=R|(fe()|0),g>>>0<v>>>0)g=g+1|0;else{g=1;break}}while(!1);if(B>>>0<z>>>0)B=B+1|0;else break}return Di(p|0),d|0}function vl(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0;if(v=Ut(d|0,p|0,52)|0,fe()|0,v=v&15,!v)return g=p,v=d,Di(g|0),v|0;for(g=1;R=(15-g|0)*3|0,I=qt(7,0,R|0)|0,x=p&~(fe()|0),p=Ut(d|0,p|0,R|0)|0,fe()|0,p=qt(Oo(p&7)|0,0,R|0)|0,d=p|d&~I,p=fe()|0|x,g>>>0<v>>>0;)g=g+1|0;return Di(p|0),d|0}function sh(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(z=se,se=se+64|0,B=z+40|0,v=z+24|0,x=z+12|0,I=z,qt(p|0,0,52)|0,g=fe()|0|134225919,!p)return(A[d+4>>2]|0)>2||(A[d+8>>2]|0)>2||(A[d+12>>2]|0)>2?(R=0,B=0,Di(R|0),se=z,B|0):(qt(ja(d)|0,0,45)|0,R=fe()|0|g,B=-1,Di(R|0),se=z,B|0);if(A[B>>2]=A[d>>2],A[B+4>>2]=A[d+4>>2],A[B+8>>2]=A[d+8>>2],A[B+12>>2]=A[d+12>>2],R=B+4|0,(p|0)>0)for(d=-1;A[v>>2]=A[R>>2],A[v+4>>2]=A[R+4>>2],A[v+8>>2]=A[R+8>>2],p&1?(dn(R),A[x>>2]=A[R>>2],A[x+4>>2]=A[R+4>>2],A[x+8>>2]=A[R+8>>2],Do(x)):(ko(R),A[x>>2]=A[R>>2],A[x+4>>2]=A[R+4>>2],A[x+8>>2]=A[R+8>>2],ls(x)),na(v,x,I),An(I),X=(15-p|0)*3|0,$=qt(7,0,X|0)|0,g=g&~(fe()|0),X=qt(sa(I)|0,0,X|0)|0,d=X|d&~$,g=fe()|0|g,(p|0)>1;)p=p+-1|0;else d=-1;e:do if((A[R>>2]|0)<=2&&(A[B+8>>2]|0)<=2&&(A[B+12>>2]|0)<=2){if(v=ja(B)|0,p=qt(v|0,0,45)|0,p=p|d,d=fe()|0|g&-1040385,I=gl(B)|0,!(gr(v)|0)){if((I|0)<=0)break;for(x=0;;){if(v=Ut(p|0,d|0,52)|0,fe()|0,v=v&15,v)for(g=1;X=(15-g|0)*3|0,B=Ut(p|0,d|0,X|0)|0,fe()|0,$=qt(7,0,X|0)|0,d=d&~(fe()|0),X=qt(Bo(B&7)|0,0,X|0)|0,p=p&~$|X,d=d|(fe()|0),g>>>0<v>>>0;)g=g+1|0;if(x=x+1|0,(x|0)==(I|0))break e}}x=Ut(p|0,d|0,52)|0,fe()|0,x=x&15;t:do if(x){g=1;i:for(;;){switch(X=Ut(p|0,d|0,(15-g|0)*3|0)|0,fe()|0,X&7){case 1:break i;case 0:break;default:break t}if(g>>>0<x>>>0)g=g+1|0;else break t}if(fn(v,A[B>>2]|0)|0)for(g=1;B=(15-g|0)*3|0,$=qt(7,0,B|0)|0,X=d&~(fe()|0),d=Ut(p|0,d|0,B|0)|0,fe()|0,d=qt(Oo(d&7)|0,0,B|0)|0,p=p&~$|d,d=X|(fe()|0),g>>>0<x>>>0;)g=g+1|0;else for(g=1;X=(15-g|0)*3|0,B=Ut(p|0,d|0,X|0)|0,fe()|0,$=qt(7,0,X|0)|0,d=d&~(fe()|0),X=qt(Bo(B&7)|0,0,X|0)|0,p=p&~$|X,d=d|(fe()|0),g>>>0<x>>>0;)g=g+1|0}while(!1);if((I|0)>0){g=0;do p=Xa(p,d)|0,d=fe()|0,g=g+1|0;while((g|0)!=(I|0))}}else p=0,d=0;while(!1);return $=d,X=p,Di($|0),se=z,X|0}function vs(d){return d=d|0,(d|0)%2|0|0}function xl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0;return x=se,se=se+16|0,v=x,p>>>0>15?(v=4,se=x,v|0):(A[d+4>>2]&2146435072|0)==2146435072||(A[d+8+4>>2]&2146435072|0)==2146435072?(v=3,se=x,v|0):(Jl(d,p,v),p=sh(v,p)|0,v=fe()|0,A[g>>2]=p,A[g+4>>2]=v,(p|0)==0&(v|0)==0&&Mi(27795,27122,959,27145),v=0,se=x,v|0)}function sc(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0;if(x=g+4|0,I=Ut(d|0,p|0,52)|0,fe()|0,I=I&15,R=Ut(d|0,p|0,45)|0,fe()|0,v=(I|0)==0,gr(R&127)|0){if(v)return R=1,R|0;v=1}else{if(v)return R=0,R|0;(A[x>>2]|0)==0&&(A[g+8>>2]|0)==0?v=(A[g+12>>2]|0)!=0&1:v=1}for(g=1;g&1?Do(x):ls(x),R=Ut(d|0,p|0,(15-g|0)*3|0)|0,fe()|0,ln(x,R&7),g>>>0<I>>>0;)g=g+1|0;return v|0}function rr(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(X=se,se=se+16|0,z=X,$=Ut(d|0,p|0,45)|0,fe()|0,$=$&127,$>>>0>121)return A[g>>2]=0,A[g+4>>2]=0,A[g+8>>2]=0,A[g+12>>2]=0,$=5,se=X,$|0;e:do if((gr($)|0)!=0&&(I=Ut(d|0,p|0,52)|0,fe()|0,I=I&15,(I|0)!=0)){v=1;t:for(;;){switch(B=Ut(d|0,p|0,(15-v|0)*3|0)|0,fe()|0,B&7){case 5:break t;case 0:break;default:{v=p;break e}}if(v>>>0<I>>>0)v=v+1|0;else{v=p;break e}}for(x=1,v=p;p=(15-x|0)*3|0,R=qt(7,0,p|0)|0,B=v&~(fe()|0),v=Ut(d|0,v|0,p|0)|0,fe()|0,v=qt(Oo(v&7)|0,0,p|0)|0,d=d&~R|v,v=B|(fe()|0),x>>>0<I>>>0;)x=x+1|0}else v=p;while(!1);if(B=7696+($*28|0)|0,A[g>>2]=A[B>>2],A[g+4>>2]=A[B+4>>2],A[g+8>>2]=A[B+8>>2],A[g+12>>2]=A[B+12>>2],!(sc(d,v,g)|0))return $=0,se=X,$|0;if(R=g+4|0,A[z>>2]=A[R>>2],A[z+4>>2]=A[R+4>>2],A[z+8>>2]=A[R+8>>2],I=Ut(d|0,v|0,52)|0,fe()|0,B=I&15,I&1?(ls(R),I=B+1|0):I=B,!(gr($)|0))v=0;else{e:do if(!B)v=0;else for(p=1;;){if(x=Ut(d|0,v|0,(15-p|0)*3|0)|0,fe()|0,x=x&7,x|0){v=x;break e}if(p>>>0<B>>>0)p=p+1|0;else{v=0;break}}while(!1);v=(v|0)==4&1}if(!(eo(g,I,v,0)|0))(I|0)!=(B|0)&&(A[R>>2]=A[z>>2],A[R+4>>2]=A[z+4>>2],A[R+8>>2]=A[z+8>>2]);else{if(gr($)|0)do;while((eo(g,I,0,0)|0)!=0);(I|0)!=(B|0)&&ko(R)}return $=0,se=X,$|0}function Xn(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;return I=se,se=se+16|0,v=I,x=rr(d,p,v)|0,x|0?(se=I,x|0):(x=Ut(d|0,p|0,52)|0,fe()|0,th(v,x&15,g),x=0,se=I,x|0)}function Fo(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0;if(R=se,se=se+16|0,I=R,v=rr(d,p,I)|0,v|0)return I=v,se=R,I|0;v=Ut(d|0,p|0,45)|0,fe()|0,v=(gr(v&127)|0)==0,x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15;e:do if(!v){if(x|0)for(v=1;;){if(B=qt(7,0,(15-v|0)*3|0)|0,!((B&d|0)==0&((fe()|0)&p|0)==0))break e;if(v>>>0<x>>>0)v=v+1|0;else break}return bl(I,x,0,5,g),B=0,se=R,B|0}while(!1);return Za(I,x,0,6,g),B=0,se=R,B|0}function eu(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;if(x=Ut(d|0,p|0,45)|0,fe()|0,!(gr(x&127)|0))return x=2,A[g>>2]=x,0;if(x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15,!x)return x=5,A[g>>2]=x,0;for(v=1;;){if(I=qt(7,0,(15-v|0)*3|0)|0,!((I&d|0)==0&((fe()|0)&p|0)==0)){v=2,d=6;break}if(v>>>0<x>>>0)v=v+1|0;else{v=5,d=6;break}}return(d|0)==6&&(A[g>>2]=v),0}function oc(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0;ce=se,se=se+128|0,$=ce+112|0,I=ce+96|0,X=ce,x=Ut(d|0,p|0,52)|0,fe()|0,B=x&15,A[$>>2]=B,R=Ut(d|0,p|0,45)|0,fe()|0,R=R&127;e:do if(gr(R)|0){if(B|0)for(v=1;;){if(z=qt(7,0,(15-v|0)*3|0)|0,!((z&d|0)==0&((fe()|0)&p|0)==0)){x=0;break e}if(v>>>0<B>>>0)v=v+1|0;else break}if(x&1)x=1;else return z=qt(B+1|0,0,52)|0,X=fe()|0|p&-15728641,$=qt(7,0,(14-B|0)*3|0)|0,X=oc((z|d)&~$,X&~(fe()|0),g)|0,se=ce,X|0}else x=0;while(!1);if(v=rr(d,p,I)|0,!v){x?($a(I,$,X),z=5):(Yc(I,$,X),z=6);e:do if(gr(R)|0)if(!B)d=5;else for(v=1;;){if(R=qt(7,0,(15-v|0)*3|0)|0,!((R&d|0)==0&((fe()|0)&p|0)==0)){d=2;break e}if(v>>>0<B>>>0)v=v+1|0;else{d=5;break}}else d=2;while(!1);to(g|0,-1,d<<2|0)|0;e:do if(x)for(I=0;;){if(R=X+(I<<4)|0,If(R,A[$>>2]|0)|0,R=A[R>>2]|0,B=A[g>>2]|0,(B|0)==-1|(B|0)==(R|0))v=g;else{x=0;do{if(x=x+1|0,x>>>0>=d>>>0){v=1;break e}v=g+(x<<2)|0,B=A[v>>2]|0}while(!((B|0)==-1|(B|0)==(R|0)))}if(A[v>>2]=R,I=I+1|0,I>>>0>=z>>>0){v=0;break}}else for(I=0;;){if(R=X+(I<<4)|0,eo(R,A[$>>2]|0,0,1)|0,R=A[R>>2]|0,B=A[g>>2]|0,(B|0)==-1|(B|0)==(R|0))v=g;else{x=0;do{if(x=x+1|0,x>>>0>=d>>>0){v=1;break e}v=g+(x<<2)|0,B=A[v>>2]|0}while(!((B|0)==-1|(B|0)==(R|0)))}if(A[v>>2]=R,I=I+1|0,I>>>0>=z>>>0){v=0;break}}while(!1)}return X=v,se=ce,X|0}function oh(){return 12}function wl(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0;if(d>>>0>15)return B=4,B|0;if(qt(d|0,0,52)|0,B=fe()|0|134225919,!d){g=0,v=0;do gr(v)|0&&(qt(v|0,0,45)|0,R=B|(fe()|0),d=p+(g<<3)|0,A[d>>2]=-1,A[d+4>>2]=R,g=g+1|0),v=v+1|0;while((v|0)!=122);return g=0,g|0}g=0,R=0;do{if(gr(R)|0){for(qt(R|0,0,45)|0,v=1,x=-1,I=B|(fe()|0);z=qt(7,0,(15-v|0)*3|0)|0,x=x&~z,I=I&~(fe()|0),(v|0)!=(d|0);)v=v+1|0;z=p+(g<<3)|0,A[z>>2]=x,A[z+4>>2]=I,g=g+1|0}R=R+1|0}while((R|0)!=122);return g=0,g|0}function fa(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0;if(at=se,se=se+16|0,Ze=at,gt=Ut(d|0,p|0,52)|0,fe()|0,gt=gt&15,g>>>0>15)return gt=4,se=at,gt|0;if((gt|0)<(g|0))return gt=12,se=at,gt|0;if((gt|0)!=(g|0))if(I=qt(g|0,0,52)|0,I=I|d,B=fe()|0|p&-15728641,(gt|0)>(g|0)){z=g;do je=qt(7,0,(14-z|0)*3|0)|0,z=z+1|0,I=je|I,B=fe()|0|B;while((z|0)<(gt|0));je=I}else je=I;else je=d,B=p;we=Ut(je|0,B|0,45)|0,fe()|0;e:do if(gr(we&127)|0){if(z=Ut(je|0,B|0,52)|0,fe()|0,z=z&15,z|0)for(I=1;;){if(we=qt(7,0,(15-I|0)*3|0)|0,!((we&je|0)==0&((fe()|0)&B|0)==0)){$=33;break e}if(I>>>0<z>>>0)I=I+1|0;else break}if(we=v,A[we>>2]=0,A[we+4>>2]=0,(gt|0)>(g|0)){for(we=p&-15728641,xe=gt;;){if(Te=xe,xe=xe+-1|0,xe>>>0>15|(gt|0)<(xe|0)){$=19;break}if((gt|0)!=(xe|0))if(I=qt(xe|0,0,52)|0,I=I|d,z=fe()|0|we,(gt|0)<(Te|0))ce=I;else{$=xe;do ce=qt(7,0,(14-$|0)*3|0)|0,$=$+1|0,I=ce|I,z=fe()|0|z;while(($|0)<(gt|0));ce=I}else ce=d,z=p;if(X=Ut(ce|0,z|0,45)|0,fe()|0,!(gr(X&127)|0))I=0;else{X=Ut(ce|0,z|0,52)|0,fe()|0,X=X&15;t:do if(!X)I=0;else for($=1;;){if(I=Ut(ce|0,z|0,(15-$|0)*3|0)|0,fe()|0,I=I&7,I|0)break t;if($>>>0<X>>>0)$=$+1|0;else{I=0;break}}while(!1);I=(I|0)==0&1}if(z=Ut(d|0,p|0,(15-Te|0)*3|0)|0,fe()|0,z=z&7,(z|0)==7){x=5,$=42;break}if(I=(I|0)!=0,(z|0)==1&I){x=5,$=42;break}if(ce=z+(((z|0)!=0&I)<<31>>31)|0,ce|0&&($=gt-Te|0,$=ho(7,0,$,(($|0)<0)<<31>>31)|0,X=fe()|0,I?(I=Rr($|0,X|0,5,0)|0,I=Ci(I|0,fe()|0,-5,-1)|0,I=gn(I|0,fe()|0,6,0)|0,I=Ci(I|0,fe()|0,1,0)|0,z=fe()|0):(I=$,z=X),Te=ce+-1|0,Te=Rr($|0,X|0,Te|0,((Te|0)<0)<<31>>31|0)|0,Te=Ci(I|0,z|0,Te|0,fe()|0)|0,ce=fe()|0,X=v,X=Ci(Te|0,ce|0,A[X>>2]|0,A[X+4>>2]|0)|0,ce=fe()|0,Te=v,A[Te>>2]=X,A[Te+4>>2]=ce),(xe|0)<=(g|0)){$=37;break}}if(($|0)==19)Mi(27795,27122,1276,27158);else if(($|0)==37){R=v,x=A[R+4>>2]|0,R=A[R>>2]|0;break}else if(($|0)==42)return se=at,x|0}else x=0,R=0}else $=33;while(!1);e:do if(($|0)==33)if(we=v,A[we>>2]=0,A[we+4>>2]=0,(gt|0)>(g|0)){for(I=gt;;){if(x=Ut(d|0,p|0,(15-I|0)*3|0)|0,fe()|0,x=x&7,(x|0)==7){x=5;break}if(R=gt-I|0,R=ho(7,0,R,((R|0)<0)<<31>>31)|0,x=Rr(R|0,fe()|0,x|0,0)|0,R=fe()|0,we=v,R=Ci(A[we>>2]|0,A[we+4>>2]|0,x|0,R|0)|0,x=fe()|0,we=v,A[we>>2]=R,A[we+4>>2]=x,I=I+-1|0,(I|0)<=(g|0))break e}return se=at,x|0}else x=0,R=0;while(!1);return uo(je,B,gt,Ze)|0&&Mi(27795,27122,1236,27173),gt=Ze,Ze=A[gt+4>>2]|0,((x|0)>-1|(x|0)==-1&R>>>0>4294967295)&((Ze|0)>(x|0)|((Ze|0)==(x|0)?(A[gt>>2]|0)>>>0>R>>>0:0))?(gt=0,se=at,gt|0):(Mi(27795,27122,1316,27158),0)}function tu(d,p,g,v,x,I){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,I=I|0;var R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0;if(ce=se,se=se+16|0,R=ce,x>>>0>15)return I=4,se=ce,I|0;if(B=Ut(g|0,v|0,52)|0,fe()|0,B=B&15,(B|0)>(x|0))return I=12,se=ce,I|0;if(uo(g,v,x,R)|0&&Mi(27795,27122,1236,27173),X=R,$=A[X+4>>2]|0,!(((p|0)>-1|(p|0)==-1&d>>>0>4294967295)&(($|0)>(p|0)|(($|0)==(p|0)?(A[X>>2]|0)>>>0>d>>>0:0))))return I=2,se=ce,I|0;X=x-B|0,x=qt(x|0,0,52)|0,z=fe()|0|v&-15728641,$=I,A[$>>2]=x|g,A[$+4>>2]=z,$=Ut(g|0,v|0,45)|0,fe()|0;e:do if(gr($&127)|0){if(B|0)for(R=1;;){if($=qt(7,0,(15-R|0)*3|0)|0,!(($&g|0)==0&((fe()|0)&v|0)==0))break e;if(R>>>0<B>>>0)R=R+1|0;else break}if((X|0)<1)return I=0,se=ce,I|0;for($=B^15,v=-1,z=1,R=1;;){B=X-z|0,B=ho(7,0,B,((B|0)<0)<<31>>31)|0,g=fe()|0;do if(R)if(R=Rr(B|0,g|0,5,0)|0,R=Ci(R|0,fe()|0,-5,-1)|0,R=gn(R|0,fe()|0,6,0)|0,x=fe()|0,(p|0)>(x|0)|(p|0)==(x|0)&d>>>0>R>>>0){p=Ci(d|0,p|0,-1,-1)|0,p=qr(p|0,fe()|0,R|0,x|0)|0,R=fe()|0,Te=I,we=A[Te>>2]|0,Te=A[Te+4>>2]|0,je=($+v|0)*3|0,xe=qt(7,0,je|0)|0,Te=Te&~(fe()|0),v=gn(p|0,R|0,B|0,g|0)|0,d=fe()|0,x=Ci(v|0,d|0,2,0)|0,je=qt(x|0,fe()|0,je|0)|0,Te=fe()|0|Te,x=I,A[x>>2]=je|we&~xe,A[x+4>>2]=Te,d=Rr(v|0,d|0,B|0,g|0)|0,d=qr(p|0,R|0,d|0,fe()|0)|0,R=0,p=fe()|0;break}else{je=I,xe=A[je>>2]|0,je=A[je+4>>2]|0,we=qt(7,0,($+v|0)*3|0)|0,je=je&~(fe()|0),R=I,A[R>>2]=xe&~we,A[R+4>>2]=je,R=1;break}else xe=I,x=A[xe>>2]|0,xe=A[xe+4>>2]|0,v=($+v|0)*3|0,Te=qt(7,0,v|0)|0,xe=xe&~(fe()|0),je=gn(d|0,p|0,B|0,g|0)|0,R=fe()|0,v=qt(je|0,R|0,v|0)|0,xe=fe()|0|xe,we=I,A[we>>2]=v|x&~Te,A[we+4>>2]=xe,R=Rr(je|0,R|0,B|0,g|0)|0,d=qr(d|0,p|0,R|0,fe()|0)|0,R=0,p=fe()|0;while(!1);if((X|0)>(z|0))v=~z,z=z+1|0;else{p=0;break}}return se=ce,p|0}while(!1);if((X|0)<1)return je=0,se=ce,je|0;for(x=B^15,R=1;;)if(we=X-R|0,we=ho(7,0,we,((we|0)<0)<<31>>31)|0,je=fe()|0,z=I,g=A[z>>2]|0,z=A[z+4>>2]|0,B=(x-R|0)*3|0,v=qt(7,0,B|0)|0,z=z&~(fe()|0),Te=gn(d|0,p|0,we|0,je|0)|0,xe=fe()|0,B=qt(Te|0,xe|0,B|0)|0,z=fe()|0|z,$=I,A[$>>2]=B|g&~v,A[$+4>>2]=z,je=Rr(Te|0,xe|0,we|0,je|0)|0,d=qr(d|0,p|0,je|0,fe()|0)|0,p=fe()|0,(X|0)<=(R|0)){p=0;break}else R=R+1|0;return se=ce,p|0}function iu(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0;x=Ut(p|0,g|0,52)|0,fe()|0,x=x&15,(p|0)==0&(g|0)==0|((v|0)>15|(x|0)>(v|0))?(I=-1,p=-1,g=0,x=0):(p=Jc(p,g,x+1|0,v)|0,R=(fe()|0)&-15728641,g=qt(v|0,0,52)|0,g=p|g,R=R|(fe()|0),p=(Ir(g,R)|0)==0,I=x,p=p?-1:v,x=R),R=d,A[R>>2]=g,A[R+4>>2]=x,A[d+8>>2]=I,A[d+12>>2]=p}function ah(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0;if(x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15,I=v+8|0,A[I>>2]=x,(d|0)==0&(p|0)==0|((g|0)>15|(x|0)>(g|0))){g=v,A[g>>2]=0,A[g+4>>2]=0,A[I>>2]=-1,A[v+12>>2]=-1;return}if(d=Jc(d,p,x+1|0,g)|0,I=(fe()|0)&-15728641,x=qt(g|0,0,52)|0,x=d|x,I=I|(fe()|0),d=v,A[d>>2]=x,A[d+4>>2]=I,d=v+12|0,Ir(x,I)|0){A[d>>2]=g;return}else{A[d>>2]=-1;return}}function ru(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0;if(g=d,p=A[g>>2]|0,g=A[g+4>>2]|0,!((p|0)==0&(g|0)==0)&&(v=Ut(p|0,g|0,52)|0,fe()|0,v=v&15,B=qt(1,0,(v^15)*3|0)|0,p=Ci(B|0,fe()|0,p|0,g|0)|0,g=fe()|0,B=d,A[B>>2]=p,A[B+4>>2]=g,B=d+8|0,R=A[B>>2]|0,!((v|0)<(R|0)))){for(z=d+12|0,I=v;;){if((I|0)==(R|0)){v=5;break}if($=(I|0)==(A[z>>2]|0),x=(15-I|0)*3|0,v=Ut(p|0,g|0,x|0)|0,fe()|0,v=v&7,$&((v|0)==1&!0)){v=7;break}if(!((v|0)==7&!0)){v=10;break}if($=qt(1,0,x|0)|0,p=Ci(p|0,g|0,$|0,fe()|0)|0,g=fe()|0,$=d,A[$>>2]=p,A[$+4>>2]=g,(I|0)>(R|0))I=I+-1|0;else{v=10;break}}if((v|0)==5){$=d,A[$>>2]=0,A[$+4>>2]=0,A[B>>2]=-1,A[z>>2]=-1;return}else if((v|0)==7){R=qt(1,0,x|0)|0,R=Ci(p|0,g|0,R|0,fe()|0)|0,B=fe()|0,$=d,A[$>>2]=R,A[$+4>>2]=B,A[z>>2]=I+-1;return}else if((v|0)==10)return}}function Tl(d){d=+d;var p=0;return p=d<0?d+6.283185307179586:d,+(d>=6.283185307179586?p+-6.283185307179586:p)}function Aa(d,p){return d=d|0,p=p|0,+ni(+(+ie[d>>3]-+ie[p>>3]))<17453292519943298e-27?(p=+ni(+(+ie[d+8>>3]-+ie[p+8>>3]))<17453292519943298e-27,p|0):(p=0,p|0)}function xs(d,p){switch(d=+d,p=p|0,p|0){case 1:{d=d<0?d+6.283185307179586:d;break}case 2:{d=d>0?d+-6.283185307179586:d;break}}return+d}function lh(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0;return x=+ie[p>>3],v=+ie[d>>3],I=+si(+((x-v)*.5)),g=+si(+((+ie[p+8>>3]-+ie[d+8>>3])*.5)),g=I*I+g*(+Xi(+x)*+Xi(+v)*g),+(+nn(+ +Ei(+g),+ +Ei(+(1-g)))*2)}function No(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0;return x=+ie[p>>3],v=+ie[d>>3],I=+si(+((x-v)*.5)),g=+si(+((+ie[p+8>>3]-+ie[d+8>>3])*.5)),g=I*I+g*(+Xi(+x)*+Xi(+v)*g),+(+nn(+ +Ei(+g),+ +Ei(+(1-g)))*2*6371.007180918475)}function ac(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0;return x=+ie[p>>3],v=+ie[d>>3],I=+si(+((x-v)*.5)),g=+si(+((+ie[p+8>>3]-+ie[d+8>>3])*.5)),g=I*I+g*(+Xi(+x)*+Xi(+v)*g),+(+nn(+ +Ei(+g),+ +Ei(+(1-g)))*2*6371.007180918475*1e3)}function lc(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0;return I=+ie[p>>3],v=+Xi(+I),x=+ie[p+8>>3]-+ie[d+8>>3],R=v*+si(+x),g=+ie[d>>3],+ +nn(+R,+(+si(+I)*+Xi(+g)-+Xi(+x)*(v*+si(+g))))}function nu(d,p,g,v){d=d|0,p=+p,g=+g,v=v|0;var x=0,I=0,R=0,B=0;if(g<1e-16){A[v>>2]=A[d>>2],A[v+4>>2]=A[d+4>>2],A[v+8>>2]=A[d+8>>2],A[v+12>>2]=A[d+12>>2];return}I=p<0?p+6.283185307179586:p,I=p>=6.283185307179586?I+-6.283185307179586:I;do if(I<1e-16)p=+ie[d>>3]+g,ie[v>>3]=p,x=v;else{if(x=+ni(+(I+-3.141592653589793))<1e-16,p=+ie[d>>3],x){p=p-g,ie[v>>3]=p,x=v;break}if(R=+Xi(+g),g=+si(+g),p=R*+si(+p)+ +Xi(+I)*(g*+Xi(+p)),p=p>1?1:p,p=+Ko(+(p<-1?-1:p)),ie[v>>3]=p,+ni(+(p+-1.5707963267948966))<1e-16){ie[v>>3]=1.5707963267948966,ie[v+8>>3]=0;return}if(+ni(+(p+1.5707963267948966))<1e-16){ie[v>>3]=-1.5707963267948966,ie[v+8>>3]=0;return}if(B=1/+Xi(+p),I=g*+si(+I)*B,g=+ie[d>>3],p=B*((R-+si(+p)*+si(+g))/+Xi(+g)),R=I>1?1:I,p=p>1?1:p,p=+ie[d+8>>3]+ +nn(+(R<-1?-1:R),+(p<-1?-1:p)),p>3.141592653589793)do p=p+-6.283185307179586;while(p>3.141592653589793);if(p<-3.141592653589793)do p=p+6.283185307179586;while(p<-3.141592653589793);ie[v+8>>3]=p;return}while(!1);if(+ni(+(p+-1.5707963267948966))<1e-16){ie[x>>3]=1.5707963267948966,ie[v+8>>3]=0;return}if(+ni(+(p+1.5707963267948966))<1e-16){ie[x>>3]=-1.5707963267948966,ie[v+8>>3]=0;return}if(p=+ie[d+8>>3],p>3.141592653589793)do p=p+-6.283185307179586;while(p>3.141592653589793);if(p<-3.141592653589793)do p=p+6.283185307179586;while(p<-3.141592653589793);ie[v+8>>3]=p}function zo(d,p){return d=d|0,p=p|0,d>>>0>15?(p=4,p|0):(ie[p>>3]=+ie[20656+(d<<3)>>3],p=0,p|0)}function cc(d,p){return d=d|0,p=p|0,d>>>0>15?(p=4,p|0):(ie[p>>3]=+ie[20784+(d<<3)>>3],p=0,p|0)}function Ga(d,p){return d=d|0,p=p|0,d>>>0>15?(p=4,p|0):(ie[p>>3]=+ie[20912+(d<<3)>>3],p=0,p|0)}function Os(d,p){return d=d|0,p=p|0,d>>>0>15?(p=4,p|0):(ie[p>>3]=+ie[21040+(d<<3)>>3],p=0,p|0)}function uc(d,p){d=d|0,p=p|0;var g=0;return d>>>0>15?(p=4,p|0):(g=ho(7,0,d,((d|0)<0)<<31>>31)|0,g=Rr(g|0,fe()|0,120,0)|0,d=fe()|0,A[p>>2]=g|2,A[p+4>>2]=d,p=0,p|0)}function su(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0;return Te=+ie[p>>3],X=+ie[d>>3],z=+si(+((Te-X)*.5)),I=+ie[p+8>>3],$=+ie[d+8>>3],R=+si(+((I-$)*.5)),B=+Xi(+X),ce=+Xi(+Te),R=z*z+R*(ce*B*R),R=+nn(+ +Ei(+R),+ +Ei(+(1-R)))*2,z=+ie[g>>3],Te=+si(+((z-Te)*.5)),v=+ie[g+8>>3],I=+si(+((v-I)*.5)),x=+Xi(+z),I=Te*Te+I*(ce*x*I),I=+nn(+ +Ei(+I),+ +Ei(+(1-I)))*2,z=+si(+((X-z)*.5)),v=+si(+(($-v)*.5)),v=z*z+v*(B*x*v),v=+nn(+ +Ei(+v),+ +Ei(+(1-v)))*2,x=(R+I+v)*.5,+(+Jo(+ +Ei(+(+En(+(x*.5))*+En(+((x-R)*.5))*+En(+((x-I)*.5))*+En(+((x-v)*.5)))))*4)}function Sl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0;if(B=se,se=se+192|0,I=B+168|0,R=B,x=Xn(d,p,I)|0,x|0)return g=x,se=B,g|0;if(Fo(d,p,R)|0&&Mi(27795,27190,415,27199),p=A[R>>2]|0,(p|0)>0){if(v=+su(R+8|0,R+8+(((p|0)!=1&1)<<4)|0,I)+0,(p|0)!=1){d=1;do x=d,d=d+1|0,v=v+ +su(R+8+(x<<4)|0,R+8+(((d|0)%(p|0)|0)<<4)|0,I);while((d|0)<(p|0))}}else v=0;return ie[g>>3]=v,g=0,se=B,g|0}function da(d,p,g){return d=d|0,p=p|0,g=g|0,d=Sl(d,p,g)|0,d|0||(ie[g>>3]=+ie[g>>3]*6371.007180918475*6371.007180918475),d|0}function hc(d,p,g){return d=d|0,p=p|0,g=g|0,d=Sl(d,p,g)|0,d|0||(ie[g>>3]=+ie[g>>3]*6371.007180918475*6371.007180918475*1e3*1e3),d|0}function fc(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(B=se,se=se+176|0,R=B,d=co(d,p,R)|0,d|0)return R=d,se=B,R|0;if(ie[g>>3]=0,d=A[R>>2]|0,(d|0)<=1)return R=0,se=B,R|0;p=d+-1|0,d=0,v=+ie[R+8>>3],x=+ie[R+16>>3],I=0;do d=d+1|0,$=v,v=+ie[R+8+(d<<4)>>3],X=+si(+((v-$)*.5)),z=x,x=+ie[R+8+(d<<4)+8>>3],z=+si(+((x-z)*.5)),z=X*X+z*(+Xi(+v)*+Xi(+$)*z),I=I+ +nn(+ +Ei(+z),+ +Ei(+(1-z)))*2;while((d|0)<(p|0));return ie[g>>3]=I,R=0,se=B,R|0}function El(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(B=se,se=se+176|0,R=B,d=co(d,p,R)|0,d|0)return R=d,I=+ie[g>>3],I=I*6371.007180918475,ie[g>>3]=I,se=B,R|0;if(ie[g>>3]=0,d=A[R>>2]|0,(d|0)<=1)return R=0,I=0,I=I*6371.007180918475,ie[g>>3]=I,se=B,R|0;p=d+-1|0,d=0,v=+ie[R+8>>3],x=+ie[R+16>>3],I=0;do d=d+1|0,$=v,v=+ie[R+8+(d<<4)>>3],X=+si(+((v-$)*.5)),z=x,x=+ie[R+8+(d<<4)+8>>3],z=+si(+((x-z)*.5)),z=X*X+z*(+Xi(+$)*+Xi(+v)*z),I=I+ +nn(+ +Ei(+z),+ +Ei(+(1-z)))*2;while((d|0)!=(p|0));return ie[g>>3]=I,R=0,X=I,X=X*6371.007180918475,ie[g>>3]=X,se=B,R|0}function Ac(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(B=se,se=se+176|0,R=B,d=co(d,p,R)|0,d|0)return R=d,I=+ie[g>>3],I=I*6371.007180918475,I=I*1e3,ie[g>>3]=I,se=B,R|0;if(ie[g>>3]=0,d=A[R>>2]|0,(d|0)<=1)return R=0,I=0,I=I*6371.007180918475,I=I*1e3,ie[g>>3]=I,se=B,R|0;p=d+-1|0,d=0,v=+ie[R+8>>3],x=+ie[R+16>>3],I=0;do d=d+1|0,$=v,v=+ie[R+8+(d<<4)>>3],X=+si(+((v-$)*.5)),z=x,x=+ie[R+8+(d<<4)+8>>3],z=+si(+((x-z)*.5)),z=X*X+z*(+Xi(+$)*+Xi(+v)*z),I=I+ +nn(+ +Ei(+z),+ +Ei(+(1-z)))*2;while((d|0)!=(p|0));return ie[g>>3]=I,R=0,X=I,X=X*6371.007180918475,X=X*1e3,ie[g>>3]=X,se=B,R|0}function dc(d){d=d|0;var p=0,g=0,v=0;return p=Yn(1,12)|0,p||Mi(27280,27235,49,27293),g=d+4|0,v=A[g>>2]|0,v|0?(v=v+8|0,A[v>>2]=p,A[g>>2]=p,p|0):(A[d>>2]|0&&Mi(27310,27235,61,27333),v=d,A[v>>2]=p,A[g>>2]=p,p|0)}function Ya(d,p){d=d|0,p=p|0;var g=0,v=0;return v=Gn(24)|0,v||Mi(27347,27235,78,27361),A[v>>2]=A[p>>2],A[v+4>>2]=A[p+4>>2],A[v+8>>2]=A[p+8>>2],A[v+12>>2]=A[p+12>>2],A[v+16>>2]=0,p=d+4|0,g=A[p>>2]|0,g|0?(A[g+16>>2]=v,A[p>>2]=v,v|0):(A[d>>2]|0&&Mi(27376,27235,82,27361),A[d>>2]=v,A[p>>2]=v,v|0)}function pa(d){d=d|0;var p=0,g=0,v=0,x=0;if(d)for(v=1;;){if(p=A[d>>2]|0,p|0)do{if(g=A[p>>2]|0,g|0)do x=g,g=A[g+16>>2]|0,ki(x);while((g|0)!=0);x=p,p=A[p+8>>2]|0,ki(x)}while((p|0)!=0);if(p=d,d=A[d+8>>2]|0,v||ki(p),d)v=0;else break}}function ch(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0,Ft=0,Gt=0,Ri=0,mi=0,Ht=0,bi=0,_r=0,Ii=0;if(x=d+8|0,A[x>>2]|0)return Ii=1,Ii|0;if(v=A[d>>2]|0,!v)return Ii=0,Ii|0;p=v,g=0;do g=g+1|0,p=A[p+8>>2]|0;while((p|0)!=0);if(g>>>0<2)return Ii=0,Ii|0;bi=Gn(g<<2)|0,bi||Mi(27396,27235,317,27415),Ht=Gn(g<<5)|0,Ht||Mi(27437,27235,321,27415),A[d>>2]=0,yi=d+4|0,A[yi>>2]=0,A[x>>2]=0,g=0,mi=0,Zt=0,ce=0;e:for(;;){if(X=A[v>>2]|0,X){I=0,R=X;do{if(z=+ie[R+8>>3],p=R,R=A[R+16>>2]|0,$=(R|0)==0,x=$?X:R,B=+ie[x+8>>3],+ni(+(z-B))>3.141592653589793){Ii=14;break}I=I+(B-z)*(+ie[p>>3]+ +ie[x>>3])}while(!$);if((Ii|0)==14){Ii=0,I=0,p=X;do qe=+ie[p+8>>3],Ri=p+16|0,Gt=A[Ri>>2]|0,Gt=(Gt|0)==0?X:Gt,st=+ie[Gt+8>>3],I=I+(+ie[p>>3]+ +ie[Gt>>3])*((st<0?st+6.283185307179586:st)-(qe<0?qe+6.283185307179586:qe)),p=A[((p|0)==0?v:Ri)>>2]|0;while((p|0)!=0)}I>0?(A[bi+(mi<<2)>>2]=v,mi=mi+1|0,x=Zt,p=ce):Ii=19}else Ii=19;if((Ii|0)==19){Ii=0;do if(g){if(p=g+8|0,A[p>>2]|0){Ii=21;break e}if(g=Yn(1,12)|0,!g){Ii=23;break e}A[p>>2]=g,x=g+4|0,R=g,p=ce}else if(ce){x=yi,R=ce+8|0,p=v,g=d;break}else if(A[d>>2]|0){Ii=27;break e}else{x=yi,R=d,p=v,g=d;break}while(!1);if(A[R>>2]=v,A[x>>2]=v,R=Ht+(Zt<<5)|0,$=A[v>>2]|0,$){for(X=Ht+(Zt<<5)+8|0,ie[X>>3]=17976931348623157e292,ce=Ht+(Zt<<5)+24|0,ie[ce>>3]=17976931348623157e292,ie[R>>3]=-17976931348623157e292,Te=Ht+(Zt<<5)+16|0,ie[Te>>3]=-17976931348623157e292,gt=17976931348623157e292,at=-17976931348623157e292,x=0,xe=$,z=17976931348623157e292,je=17976931348623157e292,Ze=-17976931348623157e292,B=-17976931348623157e292;I=+ie[xe>>3],qe=+ie[xe+8>>3],xe=A[xe+16>>2]|0,we=(xe|0)==0,st=+ie[(we?$:xe)+8>>3],I<z&&(ie[X>>3]=I,z=I),qe<je&&(ie[ce>>3]=qe,je=qe),I>Ze?ie[R>>3]=I:I=Ze,qe>B&&(ie[Te>>3]=qe,B=qe),gt=qe>0&qe<gt?qe:gt,at=qe<0&qe>at?qe:at,x=x|+ni(+(qe-st))>3.141592653589793,!we;)Ze=I;x&&(ie[Te>>3]=at,ie[ce>>3]=gt)}else A[R>>2]=0,A[R+4>>2]=0,A[R+8>>2]=0,A[R+12>>2]=0,A[R+16>>2]=0,A[R+20>>2]=0,A[R+24>>2]=0,A[R+28>>2]=0;x=Zt+1|0}if(Ri=v+8|0,v=A[Ri>>2]|0,A[Ri>>2]=0,v)Zt=x,ce=p;else{Ii=45;break}}if((Ii|0)==21)Mi(27213,27235,35,27247);else if((Ii|0)==23)Mi(27267,27235,37,27247);else if((Ii|0)==27)Mi(27310,27235,61,27333);else if((Ii|0)==45){e:do if((mi|0)>0){for(Ri=(x|0)==0,Ft=x<<2,Gt=(d|0)==0,Ni=0,p=0;;){if(ai=A[bi+(Ni<<2)>>2]|0,Ri)Ii=73;else{if(Zt=Gn(Ft)|0,!Zt){Ii=50;break}if(yi=Gn(Ft)|0,!yi){Ii=52;break}t:do if(Gt)g=0;else{for(x=0,g=0,R=d;v=Ht+(x<<5)|0,Cl(A[R>>2]|0,v,A[ai>>2]|0)|0?(A[Zt+(g<<2)>>2]=R,A[yi+(g<<2)>>2]=v,we=g+1|0):we=g,R=A[R+8>>2]|0,R;)x=x+1|0,g=we;if((we|0)>0)if(v=A[Zt>>2]|0,(we|0)==1)g=v;else for(Te=0,xe=-1,g=v,ce=v;;){for($=A[ce>>2]|0,v=0,R=0;x=A[A[Zt+(R<<2)>>2]>>2]|0,(x|0)==($|0)?X=v:X=v+((Cl(x,A[yi+(R<<2)>>2]|0,A[$>>2]|0)|0)&1)|0,R=R+1|0,(R|0)!=(we|0);)v=X;if(x=(X|0)>(xe|0),g=x?ce:g,v=Te+1|0,(v|0)==(we|0))break t;Te=v,xe=x?X:xe,ce=A[Zt+(v<<2)>>2]|0}else g=0}while(!1);if(ki(Zt),ki(yi),g){if(x=g+4|0,v=A[x>>2]|0,v)g=v+8|0;else if(A[g>>2]|0){Ii=70;break}A[g>>2]=ai,A[x>>2]=ai}else Ii=73}if((Ii|0)==73){if(Ii=0,p=A[ai>>2]|0,p|0)do yi=p,p=A[p+16>>2]|0,ki(yi);while((p|0)!=0);ki(ai),p=1}if(Ni=Ni+1|0,(Ni|0)>=(mi|0)){_r=p;break e}}(Ii|0)==50?Mi(27452,27235,249,27471):(Ii|0)==52?Mi(27490,27235,252,27471):(Ii|0)==70&&Mi(27310,27235,61,27333)}else _r=0;while(!1);return ki(bi),ki(Ht),Ii=_r,Ii|0}return 0}function Cl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0;if(!(ia(p,g)|0)||(p=os(p)|0,v=+ie[g>>3],x=+ie[g+8>>3],x=p&x<0?x+6.283185307179586:x,d=A[d>>2]|0,!d))return d=0,d|0;if(p){p=0,$=x,g=d;e:for(;;){for(;R=+ie[g>>3],x=+ie[g+8>>3],g=g+16|0,X=A[g>>2]|0,X=(X|0)==0?d:X,I=+ie[X>>3],B=+ie[X+8>>3],R>I?(z=R,R=B):(z=I,I=R,R=x,x=B),v=v==I|v==z?v+2220446049250313e-31:v,!!(v<I|v>z);)if(g=A[g>>2]|0,!g){g=22;break e}if(B=R<0?R+6.283185307179586:R,R=x<0?x+6.283185307179586:x,$=B==$|R==$?$+-2220446049250313e-31:$,z=B+(R-B)*((v-I)/(z-I)),(z<0?z+6.283185307179586:z)>$&&(p=p^1),g=A[g>>2]|0,!g){g=22;break}}if((g|0)==22)return p|0}else{p=0,$=x,g=d;e:for(;;){for(;R=+ie[g>>3],x=+ie[g+8>>3],g=g+16|0,X=A[g>>2]|0,X=(X|0)==0?d:X,I=+ie[X>>3],B=+ie[X+8>>3],R>I?(z=R,R=B):(z=I,I=R,R=x,x=B),v=v==I|v==z?v+2220446049250313e-31:v,!!(v<I|v>z);)if(g=A[g>>2]|0,!g){g=22;break e}if($=R==$|x==$?$+-2220446049250313e-31:$,R+(x-R)*((v-I)/(z-I))>$&&(p=p^1),g=A[g>>2]|0,!g){g=22;break}}if((g|0)==22)return p|0}return 0}function ji(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0;if(at=se,se=se+32|0,gt=at+16|0,Ze=at,I=Ut(d|0,p|0,52)|0,fe()|0,I=I&15,xe=Ut(g|0,v|0,52)|0,fe()|0,(I|0)!=(xe&15|0))return gt=12,se=at,gt|0;if($=Ut(d|0,p|0,45)|0,fe()|0,$=$&127,X=Ut(g|0,v|0,45)|0,fe()|0,X=X&127,$>>>0>121|X>>>0>121)return gt=5,se=at,gt|0;if(xe=($|0)!=(X|0),xe){if(B=an($,X)|0,(B|0)==7)return gt=1,se=at,gt|0;z=an(X,$)|0,(z|0)==7?Mi(27514,27538,161,27548):(we=B,R=z)}else we=0,R=0;ce=gr($)|0,Te=gr(X)|0,A[gt>>2]=0,A[gt+4>>2]=0,A[gt+8>>2]=0,A[gt+12>>2]=0;do if(we){if(X=A[4272+($*28|0)+(we<<2)>>2]|0,B=(X|0)>0,Te)if(B){$=0,z=g,B=v;do z=Pf(z,B)|0,B=fe()|0,R=Oo(R)|0,(R|0)==1&&(R=Oo(1)|0),$=$+1|0;while(($|0)!=(X|0));X=R,$=z,z=B}else X=R,$=g,z=v;else if(B){$=0,z=g,B=v;do z=vl(z,B)|0,B=fe()|0,R=Oo(R)|0,$=$+1|0;while(($|0)!=(X|0));X=R,$=z,z=B}else X=R,$=g,z=v;if(sc($,z,gt)|0,xe||Mi(27563,27538,191,27548),B=(ce|0)!=0,R=(Te|0)!=0,B&R&&Mi(27590,27538,192,27548),B){if(R=qn(d,p)|0,(R|0)==7){I=5;break}if(Tt[22e3+(R*7|0)+we>>0]|0){I=1;break}z=A[21168+(R*28|0)+(we<<2)>>2]|0,$=z}else if(R){if(R=qn($,z)|0,(R|0)==7){I=5;break}if(Tt[22e3+(R*7|0)+X>>0]|0){I=1;break}$=0,z=A[21168+(X*28|0)+(R<<2)>>2]|0}else $=0,z=0;if(($|z|0)<0)I=5;else{if((z|0)>0){B=gt+4|0,R=0;do aa(B),R=R+1|0;while((R|0)!=(z|0))}if(A[Ze>>2]=0,A[Ze+4>>2]=0,A[Ze+8>>2]=0,ln(Ze,we),I|0)for(;vs(I)|0?Do(Ze):ls(Ze),(I|0)>1;)I=I+-1|0;if(($|0)>0){I=0;do aa(Ze),I=I+1|0;while((I|0)!=($|0))}je=gt+4|0,sn(je,Ze,je),An(je),je=51}}else if(sc(g,v,gt)|0,(ce|0)!=0&(Te|0)!=0)if((X|0)!=($|0)&&Mi(27621,27538,261,27548),R=qn(d,p)|0,I=qn(g,v)|0,(R|0)==7|(I|0)==7)I=5;else if(Tt[22e3+(R*7|0)+I>>0]|0)I=1;else if(R=A[21168+(R*28|0)+(I<<2)>>2]|0,(R|0)>0){B=gt+4|0,I=0;do aa(B),I=I+1|0;while((I|0)!=(R|0));je=51}else je=51;else je=51;while(!1);return(je|0)==51&&(I=gt+4|0,A[x>>2]=A[I>>2],A[x+4>>2]=A[I+4>>2],A[x+8>>2]=A[I+8>>2],I=0),gt=I,se=at,gt|0}function Il(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0;if(je=se,se=se+48|0,$=je+36|0,R=je+24|0,B=je+12|0,z=je,x=Ut(d|0,p|0,52)|0,fe()|0,x=x&15,Te=Ut(d|0,p|0,45)|0,fe()|0,Te=Te&127,Te>>>0>121)return v=5,se=je,v|0;if(X=gr(Te)|0,qt(x|0,0,52)|0,Ze=fe()|0|134225919,I=v,A[I>>2]=-1,A[I+4>>2]=Ze,!x)return x=sa(g)|0,(x|0)==7||(x=jr(Te,x)|0,(x|0)==127)?(Ze=1,se=je,Ze|0):(xe=qt(x|0,0,45)|0,we=fe()|0,Te=v,we=A[Te+4>>2]&-1040385|we,Ze=v,A[Ze>>2]=A[Te>>2]|xe,A[Ze+4>>2]=we,Ze=0,se=je,Ze|0);for(A[$>>2]=A[g>>2],A[$+4>>2]=A[g+4>>2],A[$+8>>2]=A[g+8>>2],g=x;;){if(I=g,g=g+-1|0,A[R>>2]=A[$>>2],A[R+4>>2]=A[$+4>>2],A[R+8>>2]=A[$+8>>2],vs(I)|0){if(x=ml($)|0,x|0){g=13;break}A[B>>2]=A[$>>2],A[B+4>>2]=A[$+4>>2],A[B+8>>2]=A[$+8>>2],Do(B)}else{if(x=oa($)|0,x|0){g=13;break}A[B>>2]=A[$>>2],A[B+4>>2]=A[$+4>>2],A[B+8>>2]=A[$+8>>2],ls(B)}if(na(R,B,z),An(z),x=v,at=A[x>>2]|0,x=A[x+4>>2]|0,st=(15-I|0)*3|0,gt=qt(7,0,st|0)|0,x=x&~(fe()|0),st=qt(sa(z)|0,0,st|0)|0,x=fe()|0|x,Ze=v,A[Ze>>2]=st|at&~gt,A[Ze+4>>2]=x,(I|0)<=1){g=14;break}}e:do if((g|0)!=13&&(g|0)==14)if((A[$>>2]|0)<=1&&(A[$+4>>2]|0)<=1&&(A[$+8>>2]|0)<=1){g=sa($)|0,x=jr(Te,g)|0,(x|0)==127?z=0:z=gr(x)|0;t:do if(g){if(X){if(x=qn(d,p)|0,(x|0)==7){x=5;break e}if(I=A[21376+(x*28|0)+(g<<2)>>2]|0,(I|0)>0){x=g,g=0;do x=Bo(x)|0,g=g+1|0;while((g|0)!=(I|0))}else x=g;if((x|0)==1){x=9;break e}g=jr(Te,x)|0,(g|0)==127&&Mi(27648,27538,411,27678),gr(g)|0?Mi(27693,27538,412,27678):(we=g,xe=I,ce=x)}else we=x,xe=0,ce=g;if(B=A[4272+(Te*28|0)+(ce<<2)>>2]|0,(B|0)<=-1&&Mi(27724,27538,419,27678),!z){if((xe|0)<0){x=5;break e}if(xe|0){I=v,x=0,g=A[I>>2]|0,I=A[I+4>>2]|0;do g=ha(g,I)|0,I=fe()|0,st=v,A[st>>2]=g,A[st+4>>2]=I,x=x+1|0;while((x|0)<(xe|0))}if((B|0)<=0){x=we,g=58;break}for(I=v,x=0,g=A[I>>2]|0,I=A[I+4>>2]|0;;)if(g=ha(g,I)|0,I=fe()|0,st=v,A[st>>2]=g,A[st+4>>2]=I,x=x+1|0,(x|0)==(B|0)){x=we,g=58;break t}}if(R=an(we,Te)|0,(R|0)==7&&Mi(27514,27538,428,27678),x=v,g=A[x>>2]|0,x=A[x+4>>2]|0,(B|0)>0){I=0;do g=ha(g,x)|0,x=fe()|0,st=v,A[st>>2]=g,A[st+4>>2]=x,I=I+1|0;while((I|0)!=(B|0))}if(x=qn(g,x)|0,(x|0)==7&&Mi(27795,27538,440,27678),g=ir(we)|0,g=A[(g?21792:21584)+(R*28|0)+(x<<2)>>2]|0,(g|0)<0&&Mi(27795,27538,454,27678),!g)x=we,g=58;else{R=v,x=0,I=A[R>>2]|0,R=A[R+4>>2]|0;do I=Xa(I,R)|0,R=fe()|0,st=v,A[st>>2]=I,A[st+4>>2]=R,x=x+1|0;while((x|0)<(g|0));x=we,g=58}}else if((X|0)!=0&(z|0)!=0){if(g=qn(d,p)|0,I=v,I=qn(A[I>>2]|0,A[I+4>>2]|0)|0,(g|0)==7|(I|0)==7){x=5;break e}if(I=A[21376+(g*28|0)+(I<<2)>>2]|0,(I|0)<0){x=5;break e}if(!I)g=59;else{B=v,g=0,R=A[B>>2]|0,B=A[B+4>>2]|0;do R=ha(R,B)|0,B=fe()|0,st=v,A[st>>2]=R,A[st+4>>2]=B,g=g+1|0;while((g|0)<(I|0));g=58}}else g=58;while(!1);if((g|0)==58&&z&&(g=59),(g|0)==59&&(st=v,(qn(A[st>>2]|0,A[st+4>>2]|0)|0)==1)){x=9;break}st=v,gt=A[st>>2]|0,st=A[st+4>>2]&-1040385,at=qt(x|0,0,45)|0,st=st|(fe()|0),x=v,A[x>>2]=gt|at,A[x+4>>2]=st,x=0}else x=1;while(!1);return st=x,se=je,st|0}function pc(d,p,g,v,x,I){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,I=I|0;var R=0,B=0;return B=se,se=se+16|0,R=B,x?d=15:(d=ji(d,p,g,v,R)|0,d||(la(R,I),d=0)),se=B,d|0}function ou(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0;return R=se,se=se+16|0,I=R,v?g=15:(g=yl(g,I)|0,g||(g=Il(d,p,I,x)|0)),se=R,g|0}function Pl(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0;return z=se,se=se+32|0,R=z+12|0,B=z,I=ji(d,p,d,p,R)|0,I|0?(B=I,se=z,B|0):(d=ji(d,p,g,v,B)|0,d|0?(B=d,se=z,B|0):(R=Bs(R,B)|0,B=x,A[B>>2]=R,A[B+4>>2]=((R|0)<0)<<31>>31,B=0,se=z,B|0))}function Mf(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0;return z=se,se=se+32|0,R=z+12|0,B=z,I=ji(d,p,d,p,R)|0,!I&&(I=ji(d,p,g,v,B)|0,!I)?(v=Bs(R,B)|0,v=Ci(v|0,((v|0)<0)<<31>>31|0,1,0)|0,R=fe()|0,B=x,A[B>>2]=v,A[B+4>>2]=R,B=0,se=z,B|0):(B=I,se=z,B|0)}function Rf(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0;if(ai=se,se=se+48|0,Zt=ai+24|0,R=ai+12|0,yi=ai,I=ji(d,p,d,p,Zt)|0,!I&&(I=ji(d,p,g,v,R)|0,!I)){st=Bs(Zt,R)|0,qe=((st|0)<0)<<31>>31,A[Zt>>2]=0,A[Zt+4>>2]=0,A[Zt+8>>2]=0,A[R>>2]=0,A[R+4>>2]=0,A[R+8>>2]=0,ji(d,p,d,p,Zt)|0&&Mi(27795,27538,692,27747),ji(d,p,g,v,R)|0&&Mi(27795,27538,697,27747),bs(Zt),bs(R),X=(st|0)==0?0:1/+(st|0),g=A[Zt>>2]|0,je=X*+((A[R>>2]|0)-g|0),Ze=Zt+4|0,v=A[Ze>>2]|0,gt=X*+((A[R+4>>2]|0)-v|0),at=Zt+8|0,I=A[at>>2]|0,X=X*+((A[R+8>>2]|0)-I|0),A[yi>>2]=g,ce=yi+4|0,A[ce>>2]=v,Te=yi+8|0,A[Te>>2]=I;e:do if((st|0)<0)I=0;else for(xe=0,we=0;;){z=+(we>>>0)+4294967296*+(xe|0),Ni=je*z+ +(g|0),B=gt*z+ +(v|0),z=X*z+ +(I|0),g=~~+li(+Ni),R=~~+li(+B),I=~~+li(+z),Ni=+ni(+(+(g|0)-Ni)),B=+ni(+(+(R|0)-B)),z=+ni(+(+(I|0)-z));do if(Ni>B&Ni>z)g=0-(R+I)|0,v=R;else if($=0-g|0,B>z){v=$-I|0;break}else{v=R,I=$-R|0;break}while(!1);if(A[yi>>2]=g,A[ce>>2]=v,A[Te>>2]=I,ca(yi),I=Il(d,p,yi,x+(we<<3)|0)|0,I|0)break e;if(!((xe|0)<(qe|0)|(xe|0)==(qe|0)&we>>>0<st>>>0)){I=0;break e}g=Ci(we|0,xe|0,1,0)|0,v=fe()|0,xe=v,we=g,g=A[Zt>>2]|0,v=A[Ze>>2]|0,I=A[at>>2]|0}while(!1);return yi=I,se=ai,yi|0}return yi=I,se=ai,yi|0}function ho(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0;if((g|0)==0&(v|0)==0)return x=0,I=1,Di(x|0),I|0;I=d,x=p,d=1,p=0;do R=(g&1|0)==0&!0,d=Rr((R?1:I)|0,(R?0:x)|0,d|0,p|0)|0,p=fe()|0,g=ph(g|0,v|0,1)|0,v=fe()|0,I=Rr(I|0,x|0,I|0,x|0)|0,x=fe()|0;while(!((g|0)==0&(v|0)==0));return Di(p|0),d|0}function au(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0;B=se,se=se+16|0,I=B,R=Ut(d|0,p|0,52)|0,fe()|0,R=R&15;do if(R){if(x=Xn(d,p,I)|0,!x){$=+ie[I>>3],z=1/+Xi(+$),X=+ie[25968+(R<<3)>>3],ie[g>>3]=$+X,ie[g+8>>3]=$-X,$=+ie[I+8>>3],z=X*z,ie[g+16>>3]=z+$,ie[g+24>>3]=$-z;break}return R=x,se=B,R|0}else{if(x=Ut(d|0,p|0,45)|0,fe()|0,x=x&127,x>>>0>121)return R=5,se=B,R|0;I=22064+(x<<5)|0,A[g>>2]=A[I>>2],A[g+4>>2]=A[I+4>>2],A[g+8>>2]=A[I+8>>2],A[g+12>>2]=A[I+12>>2],A[g+16>>2]=A[I+16>>2],A[g+20>>2]=A[I+20>>2],A[g+24>>2]=A[I+24>>2],A[g+28>>2]=A[I+28>>2];break}while(!1);return Gl(g,v?1.4:1.1),v=26096+(R<<3)|0,(A[v>>2]|0)==(d|0)&&(A[v+4>>2]|0)==(p|0)&&(ie[g>>3]=1.5707963267948966),R=26224+(R<<3)|0,(A[R>>2]|0)==(d|0)&&(A[R+4>>2]|0)==(p|0)&&(ie[g+8>>3]=-1.5707963267948966),+ie[g>>3]!=1.5707963267948966&&+ie[g+8>>3]!=-1.5707963267948966?(R=0,se=B,R|0):(ie[g+16>>3]=3.141592653589793,ie[g+24>>3]=-3.141592653589793,R=0,se=B,R|0)}function gc(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0;$=se,se=se+48|0,R=$+32|0,I=$+40|0,B=$,Kc(R,0,0,0),z=A[R>>2]|0,R=A[R+4>>2]|0;do if(g>>>0<=15){if(x=fo(v)|0,x|0){v=B,A[v>>2]=0,A[v+4>>2]=0,A[B+8>>2]=x,A[B+12>>2]=-1,v=B+16|0,z=B+29|0,A[v>>2]=0,A[v+4>>2]=0,A[v+8>>2]=0,Tt[v+12>>0]=0,Tt[z>>0]=Tt[I>>0]|0,Tt[z+1>>0]=Tt[I+1>>0]|0,Tt[z+2>>0]=Tt[I+2>>0]|0;break}if(x=Yn((A[p+8>>2]|0)+1|0,32)|0,x){ma(p,x),X=B,A[X>>2]=z,A[X+4>>2]=R,A[B+8>>2]=0,A[B+12>>2]=g,A[B+16>>2]=v,A[B+20>>2]=p,A[B+24>>2]=x,Tt[B+28>>0]=0,z=B+29|0,Tt[z>>0]=Tt[I>>0]|0,Tt[z+1>>0]=Tt[I+1>>0]|0,Tt[z+2>>0]=Tt[I+2>>0]|0;break}else{v=B,A[v>>2]=0,A[v+4>>2]=0,A[B+8>>2]=13,A[B+12>>2]=-1,v=B+16|0,z=B+29|0,A[v>>2]=0,A[v+4>>2]=0,A[v+8>>2]=0,Tt[v+12>>0]=0,Tt[z>>0]=Tt[I>>0]|0,Tt[z+1>>0]=Tt[I+1>>0]|0,Tt[z+2>>0]=Tt[I+2>>0]|0;break}}else z=B,A[z>>2]=0,A[z+4>>2]=0,A[B+8>>2]=4,A[B+12>>2]=-1,z=B+16|0,X=B+29|0,A[z>>2]=0,A[z+4>>2]=0,A[z+8>>2]=0,Tt[z+12>>0]=0,Tt[X>>0]=Tt[I>>0]|0,Tt[X+1>>0]=Tt[I+1>>0]|0,Tt[X+2>>0]=Tt[I+2>>0]|0;while(!1);Uo(B),A[d>>2]=A[B>>2],A[d+4>>2]=A[B+4>>2],A[d+8>>2]=A[B+8>>2],A[d+12>>2]=A[B+12>>2],A[d+16>>2]=A[B+16>>2],A[d+20>>2]=A[B+20>>2],A[d+24>>2]=A[B+24>>2],A[d+28>>2]=A[B+28>>2],se=$}function Uo(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0;if(qe=se,se=se+336|0,xe=qe+168|0,we=qe,v=d,g=A[v>>2]|0,v=A[v+4>>2]|0,(g|0)==0&(v|0)==0){se=qe;return}if(p=d+28|0,Tt[p>>0]|0?(g=Ml(g,v)|0,v=fe()|0):Tt[p>>0]=1,st=d+20|0,!(A[A[st>>2]>>2]|0)){p=d+24|0,g=A[p>>2]|0,g|0&&ki(g),at=d,A[at>>2]=0,A[at+4>>2]=0,A[d+8>>2]=0,A[st>>2]=0,A[d+12>>2]=-1,A[d+16>>2]=0,A[p>>2]=0,se=qe;return}at=d+16|0,p=A[at>>2]|0,x=p&15;e:do if((g|0)==0&(v|0)==0)gt=d+24|0;else{je=d+12|0,ce=(x|0)==3,X=p&255,z=(x|1|0)==3,Te=d+24|0,$=(x+-1|0)>>>0<3,R=(x|2|0)==3,B=we+8|0;t:for(;;){if(I=Ut(g|0,v|0,52)|0,fe()|0,I=I&15,(I|0)==(A[je>>2]|0)){switch(X&15){case 0:case 2:case 3:{if(x=Xn(g,v,xe)|0,x|0){Ze=15;break t}if(Rl(A[st>>2]|0,A[Te>>2]|0,xe)|0){Ze=19;break t}break}}if(z&&(x=A[(A[st>>2]|0)+4>>2]|0,A[xe>>2]=A[x>>2],A[xe+4>>2]=A[x+4>>2],A[xe+8>>2]=A[x+8>>2],A[xe+12>>2]=A[x+12>>2],ia(26832,xe)|0)){if(xl(A[(A[st>>2]|0)+4>>2]|0,I,we)|0){Ze=25;break}if(x=we,(A[x>>2]|0)==(g|0)&&(A[x+4>>2]|0)==(v|0)){Ze=29;break}}if($){if(x=Fo(g,v,xe)|0,x|0){Ze=32;break}if(au(g,v,we,0)|0){Ze=36;break}if(R&&Ka(A[st>>2]|0,A[Te>>2]|0,xe,we)|0){Ze=42;break}if(z&&cu(A[st>>2]|0,A[Te>>2]|0,xe,we)|0){Ze=42;break}}if(ce){if(p=au(g,v,xe,1)|0,x=A[Te>>2]|0,p|0){Ze=45;break}if(mr(x,xe)|0){if(Ui(we,xe),nr(xe,A[Te>>2]|0)|0){Ze=53;break}if(Rl(A[st>>2]|0,A[Te>>2]|0,B)|0){Ze=53;break}if(cu(A[st>>2]|0,A[Te>>2]|0,we,xe)|0){Ze=53;break}}}}do if((I|0)<(A[je>>2]|0)){if(p=au(g,v,xe,1)|0,x=A[Te>>2]|0,p|0){Ze=58;break t}if(!(mr(x,xe)|0)){Ze=73;break}if(nr(A[Te>>2]|0,xe)|0&&(Ui(we,xe),Ka(A[st>>2]|0,A[Te>>2]|0,we,xe)|0)){Ze=65;break t}if(g=nc(g,v,I+1|0,we)|0,g|0){Ze=67;break t}v=we,g=A[v>>2]|0,v=A[v+4>>2]|0}else Ze=73;while(!1);if((Ze|0)==73&&(Ze=0,g=Ml(g,v)|0,v=fe()|0),(g|0)==0&(v|0)==0){gt=Te;break e}}switch(Ze|0){case 15:{p=A[Te>>2]|0,p|0&&ki(p),Ze=d,A[Ze>>2]=0,A[Ze+4>>2]=0,A[st>>2]=0,A[je>>2]=-1,A[at>>2]=0,A[Te>>2]=0,A[d+8>>2]=x,Ze=20;break}case 19:{A[d>>2]=g,A[d+4>>2]=v,Ze=20;break}case 25:{Mi(27795,27761,470,27772);break}case 29:{A[d>>2]=g,A[d+4>>2]=v,se=qe;return}case 32:{p=A[Te>>2]|0,p|0&&ki(p),gt=d,A[gt>>2]=0,A[gt+4>>2]=0,A[st>>2]=0,A[je>>2]=-1,A[at>>2]=0,A[Te>>2]=0,A[d+8>>2]=x,se=qe;return}case 36:{Mi(27795,27761,493,27772);break}case 42:{A[d>>2]=g,A[d+4>>2]=v,se=qe;return}case 45:{x|0&&ki(x),Ze=d,A[Ze>>2]=0,A[Ze+4>>2]=0,A[st>>2]=0,A[je>>2]=-1,A[at>>2]=0,A[Te>>2]=0,A[d+8>>2]=p,Ze=55;break}case 53:{A[d>>2]=g,A[d+4>>2]=v,Ze=55;break}case 58:{x|0&&ki(x),Ze=d,A[Ze>>2]=0,A[Ze+4>>2]=0,A[st>>2]=0,A[je>>2]=-1,A[at>>2]=0,A[Te>>2]=0,A[d+8>>2]=p,Ze=71;break}case 65:{A[d>>2]=g,A[d+4>>2]=v,Ze=71;break}case 67:{p=A[Te>>2]|0,p|0&&ki(p),gt=d,A[gt>>2]=0,A[gt+4>>2]=0,A[st>>2]=0,A[je>>2]=-1,A[at>>2]=0,A[Te>>2]=0,A[d+8>>2]=g,se=qe;return}}if((Ze|0)==20){se=qe;return}else if((Ze|0)==55){se=qe;return}else if((Ze|0)==71){se=qe;return}}while(!1);p=A[gt>>2]|0,p|0&&ki(p),Ze=d,A[Ze>>2]=0,A[Ze+4>>2]=0,A[d+8>>2]=0,A[st>>2]=0,A[d+12>>2]=-1,A[at>>2]=0,A[gt>>2]=0,se=qe}function Ml(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0;ce=se,se=se+16|0,X=ce,v=Ut(d|0,p|0,52)|0,fe()|0,v=v&15,g=Ut(d|0,p|0,45)|0,fe()|0;do if(v){for(;g=qt(v+4095|0,0,52)|0,x=fe()|0|p&-15728641,I=(15-v|0)*3|0,R=qt(7,0,I|0)|0,B=fe()|0,g=g|d|R,x=x|B,z=Ut(d|0,p|0,I|0)|0,fe()|0,z=z&7,v=v+-1|0,!(z>>>0<6);)if(v)p=x,d=g;else{$=4;break}if(($|0)==4){g=Ut(g|0,x|0,45)|0,fe()|0;break}return X=(z|0)==0&(Ir(g,x)|0)!=0,X=qt((X?2:1)+z|0,0,I|0)|0,$=fe()|0|p&~B,X=X|d&~R,Di($|0),se=ce,X|0}while(!1);return g=g&127,g>>>0>120?($=0,X=0,Di($|0),se=ce,X|0):(Kc(X,0,g+1|0,0),$=A[X+4>>2]|0,X=A[X>>2]|0,Di($|0),se=ce,X|0)}function lu(d,p,g,v,x,I){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0,I=I|0;var R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0;Ze=se,se=se+160|0,ce=Ze+80|0,B=Ze+64|0,Te=Ze+112|0,je=Ze,gc(ce,d,p,g),$=ce,iu(B,A[$>>2]|0,A[$+4>>2]|0,p),$=B,z=A[$>>2]|0,$=A[$+4>>2]|0,R=A[ce+8>>2]|0,xe=Te+4|0,A[xe>>2]=A[ce>>2],A[xe+4>>2]=A[ce+4>>2],A[xe+8>>2]=A[ce+8>>2],A[xe+12>>2]=A[ce+12>>2],A[xe+16>>2]=A[ce+16>>2],A[xe+20>>2]=A[ce+20>>2],A[xe+24>>2]=A[ce+24>>2],A[xe+28>>2]=A[ce+28>>2],xe=je,A[xe>>2]=z,A[xe+4>>2]=$,xe=je+8|0,A[xe>>2]=R,d=je+12|0,p=Te,g=d+36|0;do A[d>>2]=A[p>>2],d=d+4|0,p=p+4|0;while((d|0)<(g|0));if(Te=je+48|0,A[Te>>2]=A[B>>2],A[Te+4>>2]=A[B+4>>2],A[Te+8>>2]=A[B+8>>2],A[Te+12>>2]=A[B+12>>2],(z|0)==0&($|0)==0)return je=R,se=Ze,je|0;g=je+16|0,X=je+24|0,ce=je+28|0,R=0,B=0,p=z,d=$;do{if(!((R|0)<(x|0)|(R|0)==(x|0)&B>>>0<v>>>0)){we=4;break}if($=B,B=Ci(B|0,R|0,1,0)|0,R=fe()|0,$=I+($<<3)|0,A[$>>2]=p,A[$+4>>2]=d,ru(Te),d=Te,p=A[d>>2]|0,d=A[d+4>>2]|0,(p|0)==0&(d|0)==0){if(Uo(g),p=g,d=A[p>>2]|0,p=A[p+4>>2]|0,(d|0)==0&(p|0)==0){we=10;break}ah(d,p,A[ce>>2]|0,Te),d=Te,p=A[d>>2]|0,d=A[d+4>>2]|0}$=je,A[$>>2]=p,A[$+4>>2]=d}while(!((p|0)==0&(d|0)==0));return(we|0)==4?(d=je+40|0,p=A[d>>2]|0,p|0&&ki(p),we=je+16|0,A[we>>2]=0,A[we+4>>2]=0,A[X>>2]=0,A[je+36>>2]=0,A[ce>>2]=-1,A[je+32>>2]=0,A[d>>2]=0,ah(0,0,0,Te),A[je>>2]=0,A[je+4>>2]=0,A[xe>>2]=0,je=14,se=Ze,je|0):((we|0)==10&&(A[je>>2]=0,A[je+4>>2]=0,A[xe>>2]=A[X>>2]),je=A[xe>>2]|0,se=Ze,je|0)}function mc(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0;if(ce=se,se=se+48|0,z=ce+32|0,B=ce+40|0,$=ce,!(A[d>>2]|0))return X=v,A[X>>2]=0,A[X+4>>2]=0,X=0,se=ce,X|0;Kc(z,0,0,0),R=z,x=A[R>>2]|0,R=A[R+4>>2]|0;do if(p>>>0>15)X=$,A[X>>2]=0,A[X+4>>2]=0,A[$+8>>2]=4,A[$+12>>2]=-1,X=$+16|0,g=$+29|0,A[X>>2]=0,A[X+4>>2]=0,A[X+8>>2]=0,Tt[X+12>>0]=0,Tt[g>>0]=Tt[B>>0]|0,Tt[g+1>>0]=Tt[B+1>>0]|0,Tt[g+2>>0]=Tt[B+2>>0]|0,g=4,X=9;else{if(g=fo(g)|0,g|0){z=$,A[z>>2]=0,A[z+4>>2]=0,A[$+8>>2]=g,A[$+12>>2]=-1,z=$+16|0,X=$+29|0,A[z>>2]=0,A[z+4>>2]=0,A[z+8>>2]=0,Tt[z+12>>0]=0,Tt[X>>0]=Tt[B>>0]|0,Tt[X+1>>0]=Tt[B+1>>0]|0,Tt[X+2>>0]=Tt[B+2>>0]|0,X=9;break}if(g=Yn((A[d+8>>2]|0)+1|0,32)|0,!g){X=$,A[X>>2]=0,A[X+4>>2]=0,A[$+8>>2]=13,A[$+12>>2]=-1,X=$+16|0,g=$+29|0,A[X>>2]=0,A[X+4>>2]=0,A[X+8>>2]=0,Tt[X+12>>0]=0,Tt[g>>0]=Tt[B>>0]|0,Tt[g+1>>0]=Tt[B+1>>0]|0,Tt[g+2>>0]=Tt[B+2>>0]|0,g=13,X=9;break}ma(d,g),xe=$,A[xe>>2]=x,A[xe+4>>2]=R,R=$+8|0,A[R>>2]=0,A[$+12>>2]=p,A[$+20>>2]=d,A[$+24>>2]=g,Tt[$+28>>0]=0,x=$+29|0,Tt[x>>0]=Tt[B>>0]|0,Tt[x+1>>0]=Tt[B+1>>0]|0,Tt[x+2>>0]=Tt[B+2>>0]|0,A[$+16>>2]=3,Te=+as(g),Te=Te*+Zn(g),I=+ni(+ +ie[g>>3]),I=Te/+Xi(+ +ws(+I,+ +ni(+ +ie[g+8>>3])))*6371.007180918475*6371.007180918475,x=$+12|0,g=A[x>>2]|0;e:do if((g|0)>0)do{if(zo(g+-1|0,z)|0,!(I/+ie[z>>3]>10))break e;xe=A[x>>2]|0,g=xe+-1|0,A[x>>2]=g}while((xe|0)>1);while(!1);if(Uo($),x=v,A[x>>2]=0,A[x+4>>2]=0,x=$,g=A[x>>2]|0,x=A[x+4>>2]|0,!((g|0)==0&(x|0)==0))do uo(g,x,p,z)|0,B=z,d=v,B=Ci(A[d>>2]|0,A[d+4>>2]|0,A[B>>2]|0,A[B+4>>2]|0)|0,d=fe()|0,xe=v,A[xe>>2]=B,A[xe+4>>2]=d,Uo($),xe=$,g=A[xe>>2]|0,x=A[xe+4>>2]|0;while(!((g|0)==0&(x|0)==0));g=A[R>>2]|0}while(!1);return xe=g,se=ce,xe|0}function ga(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0;if(!(ia(p,g)|0)||(p=os(p)|0,v=+ie[g>>3],x=+ie[g+8>>3],x=p&x<0?x+6.283185307179586:x,Te=A[d>>2]|0,(Te|0)<=0))return Te=0,Te|0;if(ce=A[d+4>>2]|0,p){p=0,X=x,g=-1,d=0;e:for(;;){for($=d;R=+ie[ce+($<<4)>>3],x=+ie[ce+($<<4)+8>>3],d=(g+2|0)%(Te|0)|0,I=+ie[ce+(d<<4)>>3],B=+ie[ce+(d<<4)+8>>3],R>I?(z=R,R=B):(z=I,I=R,R=x,x=B),v=v==I|v==z?v+2220446049250313e-31:v,!!(v<I|v>z);)if(g=$+1|0,(g|0)>=(Te|0)){g=22;break e}else d=$,$=g,g=d;if(B=R<0?R+6.283185307179586:R,R=x<0?x+6.283185307179586:x,X=B==X|R==X?X+-2220446049250313e-31:X,z=B+(R-B)*((v-I)/(z-I)),(z<0?z+6.283185307179586:z)>X&&(p=p^1),d=$+1|0,(d|0)>=(Te|0)){g=22;break}else g=$}if((g|0)==22)return p|0}else{p=0,X=x,g=-1,d=0;e:for(;;){for($=d;R=+ie[ce+($<<4)>>3],x=+ie[ce+($<<4)+8>>3],d=(g+2|0)%(Te|0)|0,I=+ie[ce+(d<<4)>>3],B=+ie[ce+(d<<4)+8>>3],R>I?(z=R,R=B):(z=I,I=R,R=x,x=B),v=v==I|v==z?v+2220446049250313e-31:v,!!(v<I|v>z);)if(g=$+1|0,(g|0)>=(Te|0)){g=22;break e}else d=$,$=g,g=d;if(X=R==X|x==X?X+-2220446049250313e-31:X,R+(x-R)*((v-I)/(z-I))>X&&(p=p^1),d=$+1|0,(d|0)>=(Te|0)){g=22;break}else g=$}if((g|0)==22)return p|0}return 0}function Qa(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0;if(we=A[d>>2]|0,!we){A[p>>2]=0,A[p+4>>2]=0,A[p+8>>2]=0,A[p+12>>2]=0,A[p+16>>2]=0,A[p+20>>2]=0,A[p+24>>2]=0,A[p+28>>2]=0;return}if(je=p+8|0,ie[je>>3]=17976931348623157e292,Ze=p+24|0,ie[Ze>>3]=17976931348623157e292,ie[p>>3]=-17976931348623157e292,gt=p+16|0,ie[gt>>3]=-17976931348623157e292,!((we|0)<=0)){for(Te=A[d+4>>2]|0,$=17976931348623157e292,X=-17976931348623157e292,ce=0,d=-1,I=17976931348623157e292,R=17976931348623157e292,z=-17976931348623157e292,v=-17976931348623157e292,xe=0;g=+ie[Te+(xe<<4)>>3],B=+ie[Te+(xe<<4)+8>>3],d=d+2|0,x=+ie[Te+(((d|0)==(we|0)?0:d)<<4)+8>>3],g<I&&(ie[je>>3]=g,I=g),B<R&&(ie[Ze>>3]=B,R=B),g>z?ie[p>>3]=g:g=z,B>v&&(ie[gt>>3]=B,v=B),$=B>0&B<$?B:$,X=B<0&B>X?B:X,ce=ce|+ni(+(B-x))>3.141592653589793,d=xe+1|0,(d|0)!=(we|0);)at=xe,z=g,xe=d,d=at;ce&&(ie[gt>>3]=X,ie[Ze>>3]=$)}}function fo(d){return d=d|0,(d>>>0<4?0:15)|0}function ma(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0;if(we=A[d>>2]|0,we){if(je=p+8|0,ie[je>>3]=17976931348623157e292,Ze=p+24|0,ie[Ze>>3]=17976931348623157e292,ie[p>>3]=-17976931348623157e292,gt=p+16|0,ie[gt>>3]=-17976931348623157e292,(we|0)>0){for(x=A[d+4>>2]|0,Te=17976931348623157e292,xe=-17976931348623157e292,v=0,g=-1,z=17976931348623157e292,$=17976931348623157e292,ce=-17976931348623157e292,R=-17976931348623157e292,at=0;I=+ie[x+(at<<4)>>3],X=+ie[x+(at<<4)+8>>3],yi=g+2|0,B=+ie[x+(((yi|0)==(we|0)?0:yi)<<4)+8>>3],I<z&&(ie[je>>3]=I,z=I),X<$&&(ie[Ze>>3]=X,$=X),I>ce?ie[p>>3]=I:I=ce,X>R&&(ie[gt>>3]=X,R=X),Te=X>0&X<Te?X:Te,xe=X<0&X>xe?X:xe,v=v|+ni(+(X-B))>3.141592653589793,g=at+1|0,(g|0)!=(we|0);)yi=at,ce=I,at=g,g=yi;v&&(ie[gt>>3]=xe,ie[Ze>>3]=Te)}}else A[p>>2]=0,A[p+4>>2]=0,A[p+8>>2]=0,A[p+12>>2]=0,A[p+16>>2]=0,A[p+20>>2]=0,A[p+24>>2]=0,A[p+28>>2]=0;if(yi=d+8|0,g=A[yi>>2]|0,!((g|0)<=0)){Zt=d+12|0,qe=0;do if(x=A[Zt>>2]|0,v=qe,qe=qe+1|0,Ze=p+(qe<<5)|0,gt=A[x+(v<<3)>>2]|0,gt){if(at=p+(qe<<5)+8|0,ie[at>>3]=17976931348623157e292,d=p+(qe<<5)+24|0,ie[d>>3]=17976931348623157e292,ie[Ze>>3]=-17976931348623157e292,st=p+(qe<<5)+16|0,ie[st>>3]=-17976931348623157e292,(gt|0)>0){for(we=A[x+(v<<3)+4>>2]|0,Te=17976931348623157e292,xe=-17976931348623157e292,x=0,v=-1,je=0,z=17976931348623157e292,$=17976931348623157e292,X=-17976931348623157e292,R=-17976931348623157e292;I=+ie[we+(je<<4)>>3],ce=+ie[we+(je<<4)+8>>3],v=v+2|0,B=+ie[we+(((v|0)==(gt|0)?0:v)<<4)+8>>3],I<z&&(ie[at>>3]=I,z=I),ce<$&&(ie[d>>3]=ce,$=ce),I>X?ie[Ze>>3]=I:I=X,ce>R&&(ie[st>>3]=ce,R=ce),Te=ce>0&ce<Te?ce:Te,xe=ce<0&ce>xe?ce:xe,x=x|+ni(+(ce-B))>3.141592653589793,v=je+1|0,(v|0)!=(gt|0);)ai=je,je=v,X=I,v=ai;x&&(ie[st>>3]=xe,ie[d>>3]=Te)}}else A[Ze>>2]=0,A[Ze+4>>2]=0,A[Ze+8>>2]=0,A[Ze+12>>2]=0,A[Ze+16>>2]=0,A[Ze+20>>2]=0,A[Ze+24>>2]=0,A[Ze+28>>2]=0,g=A[yi>>2]|0;while((qe|0)<(g|0))}}function Rl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;if(!(ga(d,p,g)|0))return x=0,x|0;if(x=d+8|0,(A[x>>2]|0)<=0)return x=1,x|0;for(v=d+12|0,d=0;;){if(I=d,d=d+1|0,ga((A[v>>2]|0)+(I<<3)|0,p+(d<<5)|0,g)|0){d=0,v=6;break}if((d|0)>=(A[x>>2]|0)){d=1,v=6;break}}return(v|0)==6?d|0:0}function Ka(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0;if($=se,se=se+16|0,B=$,R=g+8|0,!(ga(d,p,R)|0))return z=0,se=$,z|0;z=d+8|0;e:do if((A[z>>2]|0)>0){for(I=d+12|0,x=0;;){if(X=x,x=x+1|0,ga((A[I>>2]|0)+(X<<3)|0,p+(x<<5)|0,R)|0){x=0;break}if((x|0)>=(A[z>>2]|0))break e}return se=$,x|0}while(!1);if(_a(d,p,g,v)|0)return X=0,se=$,X|0;A[B>>2]=A[g>>2],A[B+4>>2]=R,x=A[z>>2]|0;e:do if((x|0)>0)for(d=d+12|0,R=0,I=x;;){if(x=A[d>>2]|0,(A[x+(R<<3)>>2]|0)>0){if(ga(B,v,A[x+(R<<3)+4>>2]|0)|0){x=0;break e}if(x=R+1|0,_a((A[d>>2]|0)+(R<<3)|0,p+(x<<5)|0,g,v)|0){x=0;break e}I=A[z>>2]|0}else x=R+1|0;if((x|0)<(I|0))R=x;else{x=1;break}}else x=1;while(!1);return X=x,se=$,X|0}function _a(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0,yi=0,ai=0,Ni=0;if(yi=se,se=se+176|0,at=yi+172|0,x=yi+168|0,st=yi,!(mr(p,v)|0))return d=0,se=yi,d|0;if(Vr(p,v,at,x),mo(st|0,g|0,168)|0,(A[g>>2]|0)>0){p=0;do ai=st+8+(p<<4)+8|0,gt=+xs(+ie[ai>>3],A[x>>2]|0),ie[ai>>3]=gt,p=p+1|0;while((p|0)<(A[g>>2]|0))}je=+ie[v>>3],Ze=+ie[v+8>>3],gt=+xs(+ie[v+16>>3],A[x>>2]|0),xe=+xs(+ie[v+24>>3],A[x>>2]|0);e:do if((A[d>>2]|0)>0){if(v=d+4|0,x=A[st>>2]|0,(x|0)<=0){for(p=0;;)if(p=p+1|0,(p|0)>=(A[d>>2]|0)){p=0;break e}}for(g=0;;){if(p=A[v>>2]|0,Te=+ie[p+(g<<4)>>3],we=+xs(+ie[p+(g<<4)+8>>3],A[at>>2]|0),p=A[v>>2]|0,g=g+1|0,ai=(g|0)%(A[d>>2]|0)|0,I=+ie[p+(ai<<4)>>3],R=+xs(+ie[p+(ai<<4)+8>>3],A[at>>2]|0),!(Te>=je)|!(I>=je)&&!(Te<=Ze)|!(I<=Ze)&&!(we<=xe)|!(R<=xe)&&!(we>=gt)|!(R>=gt)){ce=I-Te,$=R-we,p=0;do if(Ni=p,p=p+1|0,ai=(p|0)==(x|0)?0:p,I=+ie[st+8+(Ni<<4)+8>>3],R=+ie[st+8+(ai<<4)+8>>3]-I,B=+ie[st+8+(Ni<<4)>>3],z=+ie[st+8+(ai<<4)>>3]-B,X=ce*R-$*z,X!=0&&(qe=we-I,Zt=Te-B,z=(qe*z-R*Zt)/X,!(z<0|z>1))&&(X=(ce*qe-$*Zt)/X,X>=0&X<=1)){p=1;break e}while((p|0)<(x|0))}if((g|0)>=(A[d>>2]|0)){p=0;break}}}else p=0;while(!1);return Ni=p,se=yi,Ni|0}function cu(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0;if(_a(d,p,g,v)|0)return I=1,I|0;if(I=d+8|0,(A[I>>2]|0)<=0)return I=0,I|0;for(x=d+12|0,d=0;;){if(R=d,d=d+1|0,_a((A[x>>2]|0)+(R<<3)|0,p+(d<<5)|0,g,v)|0){d=1,x=6;break}if((d|0)>=(A[I>>2]|0)){d=0,x=6;break}}return(x|0)==6?d|0:0}function _c(){return 8}function uu(){return 16}function uh(){return 168}function hh(){return 8}function yc(){return 16}function bc(){return 12}function fh(){return 8}function kl(d){return d=d|0,+(+((A[d>>2]|0)>>>0)+4294967296*+(A[d+4>>2]|0))}function $r(d){d=d|0;var p=0,g=0;return g=+ie[d>>3],p=+ie[d+8>>3],+ +Ei(+(g*g+p*p))}function Ao(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0;$=+ie[d>>3],z=+ie[p>>3]-$,B=+ie[d+8>>3],R=+ie[p+8>>3]-B,ce=+ie[g>>3],I=+ie[v>>3]-ce,Te=+ie[g+8>>3],X=+ie[v+8>>3]-Te,I=(I*(B-Te)-($-ce)*X)/(z*X-R*I),ie[x>>3]=$+z*I,ie[x+8>>3]=B+R*I}function us(d,p){return d=d|0,p=p|0,+ni(+(+ie[d>>3]-+ie[p>>3]))<11920928955078125e-23?(p=+ni(+(+ie[d+8>>3]-+ie[p+8>>3]))<11920928955078125e-23,p|0):(p=0,p|0)}function Zr(d,p){d=d|0,p=p|0;var g=0,v=0,x=0;return x=+ie[d>>3]-+ie[p>>3],v=+ie[d+8>>3]-+ie[p+8>>3],g=+ie[d+16>>3]-+ie[p+16>>3],+(x*x+v*v+g*g)}function Dl(d,p){d=d|0,p=p|0;var g=0,v=0,x=0;g=+ie[d>>3],v=+Xi(+g),g=+si(+g),ie[p+16>>3]=g,g=+ie[d+8>>3],x=v*+Xi(+g),ie[p>>3]=x,g=v*+si(+g),ie[p+8>>3]=g}function hu(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;if(I=se,se=se+16|0,x=I,v=Ir(d,p)|0,(g+-1|0)>>>0>5||(v=(v|0)!=0,(g|0)==1&v))return x=-1,se=I,x|0;do if(hs(d,p,x)|0)v=-1;else if(v){v=((A[26352+(g<<2)>>2]|0)+5-(A[x>>2]|0)|0)%5|0;break}else{v=((A[26384+(g<<2)>>2]|0)+6-(A[x>>2]|0)|0)%6|0;break}while(!1);return x=v,se=I,x|0}function hs(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0,$=0;if($=se,se=se+32|0,R=$+16|0,B=$,v=rr(d,p,R)|0,v|0)return g=v,se=$,g|0;I=Qc(d,p)|0,z=qn(d,p)|0,Va(I,B),v=ss(I,A[R>>2]|0)|0;e:do if(gr(I)|0){do switch(I|0){case 4:{d=0;break}case 14:{d=1;break}case 24:{d=2;break}case 38:{d=3;break}case 49:{d=4;break}case 58:{d=5;break}case 63:{d=6;break}case 72:{d=7;break}case 83:{d=8;break}case 97:{d=9;break}case 107:{d=10;break}case 117:{d=11;break}default:{v=1;break e}}while(!1);if(x=A[26416+(d*24|0)+8>>2]|0,p=A[26416+(d*24|0)+16>>2]|0,d=A[R>>2]|0,(d|0)!=(A[B>>2]|0)&&(B=ir(I)|0,d=A[R>>2]|0,B|(d|0)==(p|0)&&(v=(v+1|0)%6|0)),(z|0)==3&(d|0)==(p|0)){v=(v+5|0)%6|0,x=22;break}(z|0)==5&(d|0)==(x|0)&&(v=(v+1|0)%6|0),x=22}else x=22;while(!1);return(x|0)==22&&(A[g>>2]=v,v=0),g=v,se=$,g|0}function fs(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0;if(st=se,se=se+32|0,at=st+24|0,Ze=st+20|0,we=st+8|0,xe=st+16|0,Te=st,z=(Ir(d,p)|0)==0,z=z?6:5,X=Ut(d|0,p|0,52)|0,fe()|0,X=X&15,z>>>0<=g>>>0)return v=2,se=st,v|0;ce=(X|0)==0,!ce&&(je=qt(7,0,(X^15)*3|0)|0,(je&d|0)==0&((fe()|0)&p|0)==0)?x=g:I=4;e:do if((I|0)==4){if(x=(Ir(d,p)|0)!=0,((x?4:5)|0)<(g|0)||hs(d,p,at)|0||(I=(A[at>>2]|0)+g|0,x?x=26704+(((I|0)%5|0)<<2)|0:x=26736+(((I|0)%6|0)<<2)|0,je=A[x>>2]|0,(je|0)==7))return v=1,se=st,v|0;A[Ze>>2]=0,x=hn(d,p,je,Ze,we)|0;do if(!x){if(B=we,$=A[B>>2]|0,B=A[B+4>>2]|0,R=B>>>0<p>>>0|(B|0)==(p|0)&$>>>0<d>>>0,I=R?$:d,R=R?B:p,!ce&&(ce=qt(7,0,(X^15)*3|0)|0,($&ce|0)==0&(B&(fe()|0)|0)==0))x=g;else{if(B=(g+-1+z|0)%(z|0)|0,x=Ir(d,p)|0,(B|0)<0&&Mi(27795,27797,246,27806),z=(x|0)!=0,((z?4:5)|0)<(B|0)&&Mi(27795,27797,246,27806),hs(d,p,at)|0&&Mi(27795,27797,246,27806),x=(A[at>>2]|0)+B|0,z?x=26704+(((x|0)%5|0)<<2)|0:x=26736+(((x|0)%6|0)<<2)|0,B=A[x>>2]|0,(B|0)==7&&Mi(27795,27797,246,27806),A[xe>>2]=0,x=hn(d,p,B,xe,Te)|0,x|0)break;$=Te,z=A[$>>2]|0,$=A[$+4>>2]|0;do if($>>>0<R>>>0|($|0)==(R|0)&z>>>0<I>>>0){if(Ir(z,$)|0?I=ta(z,$,d,p)|0:I=A[26800+((((A[xe>>2]|0)+(A[26768+(B<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,x=Ir(z,$)|0,(I+-1|0)>>>0>5){x=-1,I=z,R=$;break}if(x=(x|0)!=0,(I|0)==1&x){x=-1,I=z,R=$;break}do if(hs(z,$,at)|0)x=-1;else if(x){x=((A[26352+(I<<2)>>2]|0)+5-(A[at>>2]|0)|0)%5|0;break}else{x=((A[26384+(I<<2)>>2]|0)+6-(A[at>>2]|0)|0)%6|0;break}while(!1);I=z,R=$}else x=g;while(!1);B=we,$=A[B>>2]|0,B=A[B+4>>2]|0}if((I|0)==($|0)&(R|0)==(B|0)){if(z=(Ir($,B)|0)!=0,z?d=ta($,B,d,p)|0:d=A[26800+((((A[Ze>>2]|0)+(A[26768+(je<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,x=Ir($,B)|0,(d+-1|0)>>>0<=5&&(gt=(x|0)!=0,!((d|0)==1&gt)))do if(hs($,B,at)|0)x=-1;else if(gt){x=((A[26352+(d<<2)>>2]|0)+5-(A[at>>2]|0)|0)%5|0;break}else{x=((A[26384+(d<<2)>>2]|0)+6-(A[at>>2]|0)|0)%6|0;break}while(!1);else x=-1;x=x+1|0,x=(x|0)==6|z&(x|0)==5?0:x}p=R,d=I;break e}while(!1);return v=x,se=st,v|0}while(!1);return gt=qt(x|0,0,56)|0,at=fe()|0|p&-2130706433|536870912,A[v>>2]=gt|d,A[v+4>>2]=at,v=0,se=st,v|0}function Bl(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;return I=(Ir(d,p)|0)==0,v=fs(d,p,0,g)|0,x=(v|0)==0,I?!x||(v=fs(d,p,1,g+8|0)|0,v|0)||(v=fs(d,p,2,g+16|0)|0,v|0)||(v=fs(d,p,3,g+24|0)|0,v|0)||(v=fs(d,p,4,g+32|0)|0,v)?(I=v,I|0):fs(d,p,5,g+40|0)|0:!x||(v=fs(d,p,1,g+8|0)|0,v|0)||(v=fs(d,p,2,g+16|0)|0,v|0)||(v=fs(d,p,3,g+24|0)|0,v|0)||(v=fs(d,p,4,g+32|0)|0,v|0)?(I=v,I|0):(I=g+40|0,A[I>>2]=0,A[I+4>>2]=0,I=0,I|0)}function fu(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0,B=0,z=0;return z=se,se=se+192|0,x=z,I=z+168|0,R=Ut(d|0,p|0,56)|0,fe()|0,R=R&7,B=p&-2130706433|134217728,v=rr(d,B,I)|0,v|0?(B=v,se=z,B|0):(p=Ut(d|0,p|0,52)|0,fe()|0,p=p&15,Ir(d,B)|0?bl(I,p,R,1,x):Za(I,p,R,1,x),B=x+8|0,A[g>>2]=A[B>>2],A[g+4>>2]=A[B+4>>2],A[g+8>>2]=A[B+8>>2],A[g+12>>2]=A[B+12>>2],B=0,se=z,B|0)}function Ah(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0;return x=se,se=se+16|0,g=x,!(!0&(p&2013265920|0)==536870912)||(v=p&-2130706433|134217728,!(ic(d,v)|0))?(v=0,se=x,v|0):(I=Ut(d|0,p|0,56)|0,fe()|0,I=(fs(d,v,I&7,g)|0)==0,v=g,v=I&((A[v>>2]|0)==(d|0)?(A[v+4>>2]|0)==(p|0):0)&1,se=x,v|0)}function Au(d,p,g){d=d|0,p=p|0,g=g|0;var v=0;(p|0)>0?(v=Yn(p,4)|0,A[d>>2]=v,v||Mi(27819,27842,40,27856)):A[d>>2]=0,A[d+4>>2]=p,A[d+8>>2]=0,A[d+12>>2]=g}function du(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0;x=d+4|0,I=d+12|0,R=d+8|0;e:for(;;){for(g=A[x>>2]|0,p=0;;){if((p|0)>=(g|0))break e;if(v=A[d>>2]|0,B=A[v+(p<<2)>>2]|0,!B)p=p+1|0;else break}p=v+(~~(+ni(+(+Tr(10,+ +(15-(A[I>>2]|0)|0))*(+ie[B>>3]+ +ie[B+8>>3])))%+(g|0))>>>0<<2)|0,g=A[p>>2]|0;t:do if(g|0){if(v=B+32|0,(g|0)==(B|0))A[p>>2]=A[v>>2];else{if(g=g+32|0,p=A[g>>2]|0,!p)break;for(;(p|0)!=(B|0);)if(g=p+32|0,p=A[g>>2]|0,!p)break t;A[g>>2]=A[v>>2]}ki(B),A[R>>2]=(A[R>>2]|0)+-1}while(!1)}ki(A[d>>2]|0)}function ya(d){d=d|0;var p=0,g=0,v=0;for(v=A[d+4>>2]|0,g=0;;){if((g|0)>=(v|0)){p=0,g=4;break}if(p=A[(A[d>>2]|0)+(g<<2)>>2]|0,!p)g=g+1|0;else{g=4;break}}return(g|0)==4?p|0:0}function ba(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0;if(g=~~(+ni(+(+Tr(10,+ +(15-(A[d+12>>2]|0)|0))*(+ie[p>>3]+ +ie[p+8>>3])))%+(A[d+4>>2]|0))>>>0,g=(A[d>>2]|0)+(g<<2)|0,v=A[g>>2]|0,!v)return I=1,I|0;I=p+32|0;do if((v|0)!=(p|0)){if(g=A[v+32>>2]|0,!g)return I=1,I|0;for(x=g;;){if((x|0)==(p|0)){x=8;break}if(g=A[x+32>>2]|0,g)v=x,x=g;else{g=1,x=10;break}}if((x|0)==8){A[v+32>>2]=A[I>>2];break}else if((x|0)==10)return g|0}else A[g>>2]=A[I>>2];while(!1);return ki(p),I=d+8|0,A[I>>2]=(A[I>>2]|0)+-1,I=0,I|0}function cn(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0;I=Gn(40)|0,I||Mi(27872,27842,98,27885),A[I>>2]=A[p>>2],A[I+4>>2]=A[p+4>>2],A[I+8>>2]=A[p+8>>2],A[I+12>>2]=A[p+12>>2],x=I+16|0,A[x>>2]=A[g>>2],A[x+4>>2]=A[g+4>>2],A[x+8>>2]=A[g+8>>2],A[x+12>>2]=A[g+12>>2],A[I+32>>2]=0,x=~~(+ni(+(+Tr(10,+ +(15-(A[d+12>>2]|0)|0))*(+ie[p>>3]+ +ie[p+8>>3])))%+(A[d+4>>2]|0))>>>0,x=(A[d>>2]|0)+(x<<2)|0,v=A[x>>2]|0;do if(!v)A[x>>2]=I;else{for(;!(Aa(v,p)|0&&Aa(v+16|0,g)|0);)if(x=A[v+32>>2]|0,v=(x|0)==0?v:x,!(A[v+32>>2]|0)){R=10;break}if((R|0)==10){A[v+32>>2]=I;break}return ki(I),R=v,R|0}while(!1);return R=d+8|0,A[R>>2]=(A[R>>2]|0)+1,R=I,R|0}function Ja(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0;if(x=~~(+ni(+(+Tr(10,+ +(15-(A[d+12>>2]|0)|0))*(+ie[p>>3]+ +ie[p+8>>3])))%+(A[d+4>>2]|0))>>>0,x=A[(A[d>>2]|0)+(x<<2)>>2]|0,!x)return g=0,g|0;if(!g){for(d=x;;){if(Aa(d,p)|0){v=10;break}if(d=A[d+32>>2]|0,!d){d=0,v=10;break}}if((v|0)==10)return d|0}for(d=x;;){if(Aa(d,p)|0&&Aa(d+16|0,g)|0){v=10;break}if(d=A[d+32>>2]|0,!d){d=0,v=10;break}}return(v|0)==10?d|0:0}function pu(d,p){d=d|0,p=p|0;var g=0;if(g=~~(+ni(+(+Tr(10,+ +(15-(A[d+12>>2]|0)|0))*(+ie[p>>3]+ +ie[p+8>>3])))%+(A[d+4>>2]|0))>>>0,d=A[(A[d>>2]|0)+(g<<2)>>2]|0,!d)return g=0,g|0;for(;;){if(Aa(d,p)|0){p=5;break}if(d=A[d+32>>2]|0,!d){d=0,p=5;break}}return(p|0)==5?d|0:0}function dh(){return 27904}function po(d){return d=+d,~~+mu(+d)|0}function Gn(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0,je=0,Ze=0,gt=0,at=0,st=0,qe=0,Zt=0;Zt=se,se=se+16|0,Te=Zt;do if(d>>>0<245){if($=d>>>0<11?16:d+11&-8,d=$>>>3,ce=A[6977]|0,g=ce>>>d,g&3|0)return p=(g&1^1)+d|0,d=27948+(p<<1<<2)|0,g=d+8|0,v=A[g>>2]|0,x=v+8|0,I=A[x>>2]|0,(I|0)==(d|0)?A[6977]=ce&~(1<<p):(A[I+12>>2]=d,A[g>>2]=I),qe=p<<3,A[v+4>>2]=qe|3,qe=v+qe+4|0,A[qe>>2]=A[qe>>2]|1,qe=x,se=Zt,qe|0;if(X=A[6979]|0,$>>>0>X>>>0){if(g|0)return p=2<<d,p=g<<d&(p|0-p),p=(p&0-p)+-1|0,B=p>>>12&16,p=p>>>B,g=p>>>5&8,p=p>>>g,I=p>>>2&4,p=p>>>I,d=p>>>1&2,p=p>>>d,v=p>>>1&1,v=(g|B|I|d|v)+(p>>>v)|0,p=27948+(v<<1<<2)|0,d=p+8|0,I=A[d>>2]|0,B=I+8|0,g=A[B>>2]|0,(g|0)==(p|0)?(d=ce&~(1<<v),A[6977]=d):(A[g+12>>2]=p,A[d>>2]=g,d=ce),qe=v<<3,R=qe-$|0,A[I+4>>2]=$|3,x=I+$|0,A[x+4>>2]=R|1,A[I+qe>>2]=R,X|0&&(v=A[6982]|0,p=X>>>3,g=27948+(p<<1<<2)|0,p=1<<p,d&p?(d=g+8|0,p=A[d>>2]|0):(A[6977]=d|p,p=g,d=g+8|0),A[d>>2]=v,A[p+12>>2]=v,A[v+8>>2]=p,A[v+12>>2]=g),A[6979]=R,A[6982]=x,qe=B,se=Zt,qe|0;if(I=A[6978]|0,I){for(g=(I&0-I)+-1|0,x=g>>>12&16,g=g>>>x,v=g>>>5&8,g=g>>>v,R=g>>>2&4,g=g>>>R,B=g>>>1&2,g=g>>>B,z=g>>>1&1,z=A[28212+((v|x|R|B|z)+(g>>>z)<<2)>>2]|0,g=z,B=z,z=(A[z+4>>2]&-8)-$|0;d=A[g+16>>2]|0,!(!d&&(d=A[g+20>>2]|0,!d));)R=(A[d+4>>2]&-8)-$|0,x=R>>>0<z>>>0,g=d,B=x?d:B,z=x?R:z;if(R=B+$|0,R>>>0>B>>>0){x=A[B+24>>2]|0,p=A[B+12>>2]|0;do if((p|0)==(B|0)){if(d=B+20|0,p=A[d>>2]|0,!p&&(d=B+16|0,p=A[d>>2]|0,!p)){g=0;break}for(;;)if(v=p+20|0,g=A[v>>2]|0,g)p=g,d=v;else if(v=p+16|0,g=A[v>>2]|0,g)p=g,d=v;else break;A[d>>2]=0,g=p}else g=A[B+8>>2]|0,A[g+12>>2]=p,A[p+8>>2]=g,g=p;while(!1);do if(x|0){if(p=A[B+28>>2]|0,d=28212+(p<<2)|0,(B|0)==(A[d>>2]|0)){if(A[d>>2]=g,!g){A[6978]=I&~(1<<p);break}}else if(qe=x+16|0,A[((A[qe>>2]|0)==(B|0)?qe:x+20|0)>>2]=g,!g)break;A[g+24>>2]=x,p=A[B+16>>2]|0,p|0&&(A[g+16>>2]=p,A[p+24>>2]=g),p=A[B+20>>2]|0,p|0&&(A[g+20>>2]=p,A[p+24>>2]=g)}while(!1);return z>>>0<16?(qe=z+$|0,A[B+4>>2]=qe|3,qe=B+qe+4|0,A[qe>>2]=A[qe>>2]|1):(A[B+4>>2]=$|3,A[R+4>>2]=z|1,A[R+z>>2]=z,X|0&&(v=A[6982]|0,p=X>>>3,g=27948+(p<<1<<2)|0,p=1<<p,p&ce?(d=g+8|0,p=A[d>>2]|0):(A[6977]=p|ce,p=g,d=g+8|0),A[d>>2]=v,A[p+12>>2]=v,A[v+8>>2]=p,A[v+12>>2]=g),A[6979]=z,A[6982]=R),qe=B+8|0,se=Zt,qe|0}else ce=$}else ce=$}else ce=$}else if(d>>>0<=4294967231)if(d=d+11|0,$=d&-8,v=A[6978]|0,v){x=0-$|0,d=d>>>8,d?$>>>0>16777215?z=31:(ce=(d+1048320|0)>>>16&8,je=d<<ce,B=(je+520192|0)>>>16&4,je=je<<B,z=(je+245760|0)>>>16&2,z=14-(B|ce|z)+(je<<z>>>15)|0,z=$>>>(z+7|0)&1|z<<1):z=0,g=A[28212+(z<<2)>>2]|0;e:do if(!g)g=0,d=0,je=61;else for(d=0,B=$<<((z|0)==31?0:25-(z>>>1)|0),I=0;;){if(R=(A[g+4>>2]&-8)-$|0,R>>>0<x>>>0)if(R)d=g,x=R;else{d=g,x=0,je=65;break e}if(je=A[g+20>>2]|0,g=A[g+16+(B>>>31<<2)>>2]|0,I=(je|0)==0|(je|0)==(g|0)?I:je,g)B=B<<1;else{g=I,je=61;break}}while(!1);if((je|0)==61){if((g|0)==0&(d|0)==0){if(d=2<<z,d=(d|0-d)&v,!d){ce=$;break}ce=(d&0-d)+-1|0,R=ce>>>12&16,ce=ce>>>R,I=ce>>>5&8,ce=ce>>>I,B=ce>>>2&4,ce=ce>>>B,z=ce>>>1&2,ce=ce>>>z,g=ce>>>1&1,d=0,g=A[28212+((I|R|B|z|g)+(ce>>>g)<<2)>>2]|0}g?je=65:(B=d,R=x)}if((je|0)==65)for(I=g;;)if(ce=(A[I+4>>2]&-8)-$|0,g=ce>>>0<x>>>0,x=g?ce:x,d=g?I:d,g=A[I+16>>2]|0,g||(g=A[I+20>>2]|0),g)I=g;else{B=d,R=x;break}if((B|0)!=0&&R>>>0<((A[6979]|0)-$|0)>>>0&&(X=B+$|0,X>>>0>B>>>0)){I=A[B+24>>2]|0,p=A[B+12>>2]|0;do if((p|0)==(B|0)){if(d=B+20|0,p=A[d>>2]|0,!p&&(d=B+16|0,p=A[d>>2]|0,!p)){p=0;break}for(;;)if(x=p+20|0,g=A[x>>2]|0,g)p=g,d=x;else if(x=p+16|0,g=A[x>>2]|0,g)p=g,d=x;else break;A[d>>2]=0}else qe=A[B+8>>2]|0,A[qe+12>>2]=p,A[p+8>>2]=qe;while(!1);do if(I){if(d=A[B+28>>2]|0,g=28212+(d<<2)|0,(B|0)==(A[g>>2]|0)){if(A[g>>2]=p,!p){v=v&~(1<<d),A[6978]=v;break}}else if(qe=I+16|0,A[((A[qe>>2]|0)==(B|0)?qe:I+20|0)>>2]=p,!p)break;A[p+24>>2]=I,d=A[B+16>>2]|0,d|0&&(A[p+16>>2]=d,A[d+24>>2]=p),d=A[B+20>>2]|0,d&&(A[p+20>>2]=d,A[d+24>>2]=p)}while(!1);e:do if(R>>>0<16)qe=R+$|0,A[B+4>>2]=qe|3,qe=B+qe+4|0,A[qe>>2]=A[qe>>2]|1;else{if(A[B+4>>2]=$|3,A[X+4>>2]=R|1,A[X+R>>2]=R,p=R>>>3,R>>>0<256){g=27948+(p<<1<<2)|0,d=A[6977]|0,p=1<<p,d&p?(d=g+8|0,p=A[d>>2]|0):(A[6977]=d|p,p=g,d=g+8|0),A[d>>2]=X,A[p+12>>2]=X,A[X+8>>2]=p,A[X+12>>2]=g;break}if(p=R>>>8,p?R>>>0>16777215?g=31:(st=(p+1048320|0)>>>16&8,qe=p<<st,at=(qe+520192|0)>>>16&4,qe=qe<<at,g=(qe+245760|0)>>>16&2,g=14-(at|st|g)+(qe<<g>>>15)|0,g=R>>>(g+7|0)&1|g<<1):g=0,p=28212+(g<<2)|0,A[X+28>>2]=g,d=X+16|0,A[d+4>>2]=0,A[d>>2]=0,d=1<<g,!(v&d)){A[6978]=v|d,A[p>>2]=X,A[X+24>>2]=p,A[X+12>>2]=X,A[X+8>>2]=X;break}p=A[p>>2]|0;t:do if((A[p+4>>2]&-8|0)!=(R|0)){for(v=R<<((g|0)==31?0:25-(g>>>1)|0);g=p+16+(v>>>31<<2)|0,d=A[g>>2]|0,!!d;)if((A[d+4>>2]&-8|0)==(R|0)){p=d;break t}else v=v<<1,p=d;A[g>>2]=X,A[X+24>>2]=p,A[X+12>>2]=X,A[X+8>>2]=X;break e}while(!1);st=p+8|0,qe=A[st>>2]|0,A[qe+12>>2]=X,A[st>>2]=X,A[X+8>>2]=qe,A[X+12>>2]=p,A[X+24>>2]=0}while(!1);return qe=B+8|0,se=Zt,qe|0}else ce=$}else ce=$;else ce=-1;while(!1);if(g=A[6979]|0,g>>>0>=ce>>>0)return p=g-ce|0,d=A[6982]|0,p>>>0>15?(qe=d+ce|0,A[6982]=qe,A[6979]=p,A[qe+4>>2]=p|1,A[d+g>>2]=p,A[d+4>>2]=ce|3):(A[6979]=0,A[6982]=0,A[d+4>>2]=g|3,qe=d+g+4|0,A[qe>>2]=A[qe>>2]|1),qe=d+8|0,se=Zt,qe|0;if(R=A[6980]|0,R>>>0>ce>>>0)return at=R-ce|0,A[6980]=at,qe=A[6983]|0,st=qe+ce|0,A[6983]=st,A[st+4>>2]=at|1,A[qe+4>>2]=ce|3,qe=qe+8|0,se=Zt,qe|0;if(A[7095]|0?d=A[7097]|0:(A[7097]=4096,A[7096]=4096,A[7098]=-1,A[7099]=-1,A[7100]=0,A[7088]=0,A[7095]=Te&-16^1431655768,d=4096),B=ce+48|0,z=ce+47|0,I=d+z|0,x=0-d|0,$=I&x,$>>>0<=ce>>>0||(d=A[7087]|0,d|0&&(X=A[7085]|0,Te=X+$|0,Te>>>0<=X>>>0|Te>>>0>d>>>0)))return qe=0,se=Zt,qe|0;e:do if(A[7088]&4)p=0,je=143;else{g=A[6983]|0;t:do if(g){for(v=28356;Te=A[v>>2]|0,!(Te>>>0<=g>>>0&&(Te+(A[v+4>>2]|0)|0)>>>0>g>>>0);)if(d=A[v+8>>2]|0,d)v=d;else{je=128;break t}if(p=I-R&x,p>>>0<2147483647)if(d=Ts(p|0)|0,(d|0)==((A[v>>2]|0)+(A[v+4>>2]|0)|0)){if((d|0)!=-1){R=p,I=d,je=145;break e}}else v=d,je=136;else p=0}else je=128;while(!1);do if((je|0)==128)if(g=Ts(0)|0,(g|0)!=-1&&(p=g,xe=A[7096]|0,we=xe+-1|0,p=((we&p|0)==0?0:(we+p&0-xe)-p|0)+$|0,xe=A[7085]|0,we=p+xe|0,p>>>0>ce>>>0&p>>>0<2147483647)){if(Te=A[7087]|0,Te|0&&we>>>0<=xe>>>0|we>>>0>Te>>>0){p=0;break}if(d=Ts(p|0)|0,(d|0)==(g|0)){R=p,I=g,je=145;break e}else v=d,je=136}else p=0;while(!1);do if((je|0)==136){if(g=0-p|0,!(B>>>0>p>>>0&(p>>>0<2147483647&(v|0)!=-1)))if((v|0)==-1){p=0;break}else{R=p,I=v,je=145;break e}if(d=A[7097]|0,d=z-p+d&0-d,d>>>0>=2147483647){R=p,I=v,je=145;break e}if((Ts(d|0)|0)==-1){Ts(g|0)|0,p=0;break}else{R=d+p|0,I=v,je=145;break e}}while(!1);A[7088]=A[7088]|4,je=143}while(!1);if((je|0)==143&&$>>>0<2147483647&&(at=Ts($|0)|0,we=Ts(0)|0,Ze=we-at|0,gt=Ze>>>0>(ce+40|0)>>>0,!((at|0)==-1|gt^1|at>>>0<we>>>0&((at|0)!=-1&(we|0)!=-1)^1))&&(R=gt?Ze:p,I=at,je=145),(je|0)==145){p=(A[7085]|0)+R|0,A[7085]=p,p>>>0>(A[7086]|0)>>>0&&(A[7086]=p),z=A[6983]|0;e:do if(z){for(p=28356;;){if(d=A[p>>2]|0,g=A[p+4>>2]|0,(I|0)==(d+g|0)){je=154;break}if(v=A[p+8>>2]|0,v)p=v;else break}if((je|0)==154&&(st=p+4|0,(A[p+12>>2]&8|0)==0)&&I>>>0>z>>>0&d>>>0<=z>>>0){A[st>>2]=g+R,qe=(A[6980]|0)+R|0,at=z+8|0,at=(at&7|0)==0?0:0-at&7,st=z+at|0,at=qe-at|0,A[6983]=st,A[6980]=at,A[st+4>>2]=at|1,A[z+qe+4>>2]=40,A[6984]=A[7099];break}for(I>>>0<(A[6981]|0)>>>0&&(A[6981]=I),g=I+R|0,p=28356;;){if((A[p>>2]|0)==(g|0)){je=162;break}if(d=A[p+8>>2]|0,d)p=d;else break}if((je|0)==162&&(A[p+12>>2]&8|0)==0){A[p>>2]=I,X=p+4|0,A[X>>2]=(A[X>>2]|0)+R,X=I+8|0,X=I+((X&7|0)==0?0:0-X&7)|0,p=g+8|0,p=g+((p&7|0)==0?0:0-p&7)|0,$=X+ce|0,B=p-X-ce|0,A[X+4>>2]=ce|3;t:do if((z|0)==(p|0))qe=(A[6980]|0)+B|0,A[6980]=qe,A[6983]=$,A[$+4>>2]=qe|1;else{if((A[6982]|0)==(p|0)){qe=(A[6979]|0)+B|0,A[6979]=qe,A[6982]=$,A[$+4>>2]=qe|1,A[$+qe>>2]=qe;break}if(d=A[p+4>>2]|0,(d&3|0)==1){R=d&-8,v=d>>>3;i:do if(d>>>0<256)if(d=A[p+8>>2]|0,g=A[p+12>>2]|0,(g|0)==(d|0)){A[6977]=A[6977]&~(1<<v);break}else{A[d+12>>2]=g,A[g+8>>2]=d;break}else{I=A[p+24>>2]|0,d=A[p+12>>2]|0;do if((d|0)==(p|0)){if(g=p+16|0,v=g+4|0,d=A[v>>2]|0,d)g=v;else if(d=A[g>>2]|0,!d){d=0;break}for(;;)if(x=d+20|0,v=A[x>>2]|0,v)d=v,g=x;else if(x=d+16|0,v=A[x>>2]|0,v)d=v,g=x;else break;A[g>>2]=0}else qe=A[p+8>>2]|0,A[qe+12>>2]=d,A[d+8>>2]=qe;while(!1);if(!I)break;g=A[p+28>>2]|0,v=28212+(g<<2)|0;do if((A[v>>2]|0)!=(p|0)){if(qe=I+16|0,A[((A[qe>>2]|0)==(p|0)?qe:I+20|0)>>2]=d,!d)break i}else{if(A[v>>2]=d,d|0)break;A[6978]=A[6978]&~(1<<g);break i}while(!1);if(A[d+24>>2]=I,g=p+16|0,v=A[g>>2]|0,v|0&&(A[d+16>>2]=v,A[v+24>>2]=d),g=A[g+4>>2]|0,!g)break;A[d+20>>2]=g,A[g+24>>2]=d}while(!1);p=p+R|0,x=R+B|0}else x=B;if(p=p+4|0,A[p>>2]=A[p>>2]&-2,A[$+4>>2]=x|1,A[$+x>>2]=x,p=x>>>3,x>>>0<256){g=27948+(p<<1<<2)|0,d=A[6977]|0,p=1<<p,d&p?(d=g+8|0,p=A[d>>2]|0):(A[6977]=d|p,p=g,d=g+8|0),A[d>>2]=$,A[p+12>>2]=$,A[$+8>>2]=p,A[$+12>>2]=g;break}p=x>>>8;do if(!p)v=0;else{if(x>>>0>16777215){v=31;break}st=(p+1048320|0)>>>16&8,qe=p<<st,at=(qe+520192|0)>>>16&4,qe=qe<<at,v=(qe+245760|0)>>>16&2,v=14-(at|st|v)+(qe<<v>>>15)|0,v=x>>>(v+7|0)&1|v<<1}while(!1);if(p=28212+(v<<2)|0,A[$+28>>2]=v,d=$+16|0,A[d+4>>2]=0,A[d>>2]=0,d=A[6978]|0,g=1<<v,!(d&g)){A[6978]=d|g,A[p>>2]=$,A[$+24>>2]=p,A[$+12>>2]=$,A[$+8>>2]=$;break}p=A[p>>2]|0;i:do if((A[p+4>>2]&-8|0)!=(x|0)){for(v=x<<((v|0)==31?0:25-(v>>>1)|0);g=p+16+(v>>>31<<2)|0,d=A[g>>2]|0,!!d;)if((A[d+4>>2]&-8|0)==(x|0)){p=d;break i}else v=v<<1,p=d;A[g>>2]=$,A[$+24>>2]=p,A[$+12>>2]=$,A[$+8>>2]=$;break t}while(!1);st=p+8|0,qe=A[st>>2]|0,A[qe+12>>2]=$,A[st>>2]=$,A[$+8>>2]=qe,A[$+12>>2]=p,A[$+24>>2]=0}while(!1);return qe=X+8|0,se=Zt,qe|0}for(p=28356;d=A[p>>2]|0,!(d>>>0<=z>>>0&&(qe=d+(A[p+4>>2]|0)|0,qe>>>0>z>>>0));)p=A[p+8>>2]|0;x=qe+-47|0,d=x+8|0,d=x+((d&7|0)==0?0:0-d&7)|0,x=z+16|0,d=d>>>0<x>>>0?z:d,p=d+8|0,g=R+-40|0,at=I+8|0,at=(at&7|0)==0?0:0-at&7,st=I+at|0,at=g-at|0,A[6983]=st,A[6980]=at,A[st+4>>2]=at|1,A[I+g+4>>2]=40,A[6984]=A[7099],g=d+4|0,A[g>>2]=27,A[p>>2]=A[7089],A[p+4>>2]=A[7090],A[p+8>>2]=A[7091],A[p+12>>2]=A[7092],A[7089]=I,A[7090]=R,A[7092]=0,A[7091]=p,p=d+24|0;do st=p,p=p+4|0,A[p>>2]=7;while((st+8|0)>>>0<qe>>>0);if((d|0)!=(z|0)){if(I=d-z|0,A[g>>2]=A[g>>2]&-2,A[z+4>>2]=I|1,A[d>>2]=I,p=I>>>3,I>>>0<256){g=27948+(p<<1<<2)|0,d=A[6977]|0,p=1<<p,d&p?(d=g+8|0,p=A[d>>2]|0):(A[6977]=d|p,p=g,d=g+8|0),A[d>>2]=z,A[p+12>>2]=z,A[z+8>>2]=p,A[z+12>>2]=g;break}if(p=I>>>8,p?I>>>0>16777215?v=31:(st=(p+1048320|0)>>>16&8,qe=p<<st,at=(qe+520192|0)>>>16&4,qe=qe<<at,v=(qe+245760|0)>>>16&2,v=14-(at|st|v)+(qe<<v>>>15)|0,v=I>>>(v+7|0)&1|v<<1):v=0,g=28212+(v<<2)|0,A[z+28>>2]=v,A[z+20>>2]=0,A[x>>2]=0,p=A[6978]|0,d=1<<v,!(p&d)){A[6978]=p|d,A[g>>2]=z,A[z+24>>2]=g,A[z+12>>2]=z,A[z+8>>2]=z;break}p=A[g>>2]|0;t:do if((A[p+4>>2]&-8|0)!=(I|0)){for(v=I<<((v|0)==31?0:25-(v>>>1)|0);g=p+16+(v>>>31<<2)|0,d=A[g>>2]|0,!!d;)if((A[d+4>>2]&-8|0)==(I|0)){p=d;break t}else v=v<<1,p=d;A[g>>2]=z,A[z+24>>2]=p,A[z+12>>2]=z,A[z+8>>2]=z;break e}while(!1);st=p+8|0,qe=A[st>>2]|0,A[qe+12>>2]=z,A[st>>2]=z,A[z+8>>2]=qe,A[z+12>>2]=p,A[z+24>>2]=0}}else qe=A[6981]|0,(qe|0)==0|I>>>0<qe>>>0&&(A[6981]=I),A[7089]=I,A[7090]=R,A[7092]=0,A[6986]=A[7095],A[6985]=-1,A[6990]=27948,A[6989]=27948,A[6992]=27956,A[6991]=27956,A[6994]=27964,A[6993]=27964,A[6996]=27972,A[6995]=27972,A[6998]=27980,A[6997]=27980,A[7e3]=27988,A[6999]=27988,A[7002]=27996,A[7001]=27996,A[7004]=28004,A[7003]=28004,A[7006]=28012,A[7005]=28012,A[7008]=28020,A[7007]=28020,A[7010]=28028,A[7009]=28028,A[7012]=28036,A[7011]=28036,A[7014]=28044,A[7013]=28044,A[7016]=28052,A[7015]=28052,A[7018]=28060,A[7017]=28060,A[7020]=28068,A[7019]=28068,A[7022]=28076,A[7021]=28076,A[7024]=28084,A[7023]=28084,A[7026]=28092,A[7025]=28092,A[7028]=28100,A[7027]=28100,A[7030]=28108,A[7029]=28108,A[7032]=28116,A[7031]=28116,A[7034]=28124,A[7033]=28124,A[7036]=28132,A[7035]=28132,A[7038]=28140,A[7037]=28140,A[7040]=28148,A[7039]=28148,A[7042]=28156,A[7041]=28156,A[7044]=28164,A[7043]=28164,A[7046]=28172,A[7045]=28172,A[7048]=28180,A[7047]=28180,A[7050]=28188,A[7049]=28188,A[7052]=28196,A[7051]=28196,qe=R+-40|0,at=I+8|0,at=(at&7|0)==0?0:0-at&7,st=I+at|0,at=qe-at|0,A[6983]=st,A[6980]=at,A[st+4>>2]=at|1,A[I+qe+4>>2]=40,A[6984]=A[7099];while(!1);if(p=A[6980]|0,p>>>0>ce>>>0)return at=p-ce|0,A[6980]=at,qe=A[6983]|0,st=qe+ce|0,A[6983]=st,A[st+4>>2]=at|1,A[qe+4>>2]=ce|3,qe=qe+8|0,se=Zt,qe|0}return qe=dh()|0,A[qe>>2]=12,qe=0,se=Zt,qe|0}function ki(d){d=d|0;var p=0,g=0,v=0,x=0,I=0,R=0,B=0,z=0;if(d){g=d+-8|0,x=A[6981]|0,d=A[d+-4>>2]|0,p=d&-8,z=g+p|0;do if(d&1)B=g,R=g;else{if(v=A[g>>2]|0,!(d&3)||(R=g+(0-v)|0,I=v+p|0,R>>>0<x>>>0))return;if((A[6982]|0)==(R|0)){if(d=z+4|0,p=A[d>>2]|0,(p&3|0)!=3){B=R,p=I;break}A[6979]=I,A[d>>2]=p&-2,A[R+4>>2]=I|1,A[R+I>>2]=I;return}if(g=v>>>3,v>>>0<256)if(d=A[R+8>>2]|0,p=A[R+12>>2]|0,(p|0)==(d|0)){A[6977]=A[6977]&~(1<<g),B=R,p=I;break}else{A[d+12>>2]=p,A[p+8>>2]=d,B=R,p=I;break}x=A[R+24>>2]|0,d=A[R+12>>2]|0;do if((d|0)==(R|0)){if(p=R+16|0,g=p+4|0,d=A[g>>2]|0,d)p=g;else if(d=A[p>>2]|0,!d){d=0;break}for(;;)if(v=d+20|0,g=A[v>>2]|0,g)d=g,p=v;else if(v=d+16|0,g=A[v>>2]|0,g)d=g,p=v;else break;A[p>>2]=0}else B=A[R+8>>2]|0,A[B+12>>2]=d,A[d+8>>2]=B;while(!1);if(x){if(p=A[R+28>>2]|0,g=28212+(p<<2)|0,(A[g>>2]|0)==(R|0)){if(A[g>>2]=d,!d){A[6978]=A[6978]&~(1<<p),B=R,p=I;break}}else if(B=x+16|0,A[((A[B>>2]|0)==(R|0)?B:x+20|0)>>2]=d,!d){B=R,p=I;break}A[d+24>>2]=x,p=R+16|0,g=A[p>>2]|0,g|0&&(A[d+16>>2]=g,A[g+24>>2]=d),p=A[p+4>>2]|0,p?(A[d+20>>2]=p,A[p+24>>2]=d,B=R,p=I):(B=R,p=I)}else B=R,p=I}while(!1);if(!(R>>>0>=z>>>0)&&(d=z+4|0,v=A[d>>2]|0,!!(v&1))){if(v&2)A[d>>2]=v&-2,A[B+4>>2]=p|1,A[R+p>>2]=p,x=p;else{if((A[6983]|0)==(z|0)){if(z=(A[6980]|0)+p|0,A[6980]=z,A[6983]=B,A[B+4>>2]=z|1,(B|0)!=(A[6982]|0))return;A[6982]=0,A[6979]=0;return}if((A[6982]|0)==(z|0)){z=(A[6979]|0)+p|0,A[6979]=z,A[6982]=R,A[B+4>>2]=z|1,A[R+z>>2]=z;return}x=(v&-8)+p|0,g=v>>>3;do if(v>>>0<256)if(p=A[z+8>>2]|0,d=A[z+12>>2]|0,(d|0)==(p|0)){A[6977]=A[6977]&~(1<<g);break}else{A[p+12>>2]=d,A[d+8>>2]=p;break}else{I=A[z+24>>2]|0,d=A[z+12>>2]|0;do if((d|0)==(z|0)){if(p=z+16|0,g=p+4|0,d=A[g>>2]|0,d)p=g;else if(d=A[p>>2]|0,!d){g=0;break}for(;;)if(v=d+20|0,g=A[v>>2]|0,g)d=g,p=v;else if(v=d+16|0,g=A[v>>2]|0,g)d=g,p=v;else break;A[p>>2]=0,g=d}else g=A[z+8>>2]|0,A[g+12>>2]=d,A[d+8>>2]=g,g=d;while(!1);if(I|0){if(d=A[z+28>>2]|0,p=28212+(d<<2)|0,(A[p>>2]|0)==(z|0)){if(A[p>>2]=g,!g){A[6978]=A[6978]&~(1<<d);break}}else if(v=I+16|0,A[((A[v>>2]|0)==(z|0)?v:I+20|0)>>2]=g,!g)break;A[g+24>>2]=I,d=z+16|0,p=A[d>>2]|0,p|0&&(A[g+16>>2]=p,A[p+24>>2]=g),d=A[d+4>>2]|0,d|0&&(A[g+20>>2]=d,A[d+24>>2]=g)}}while(!1);if(A[B+4>>2]=x|1,A[R+x>>2]=x,(B|0)==(A[6982]|0)){A[6979]=x;return}}if(d=x>>>3,x>>>0<256){g=27948+(d<<1<<2)|0,p=A[6977]|0,d=1<<d,p&d?(p=g+8|0,d=A[p>>2]|0):(A[6977]=p|d,d=g,p=g+8|0),A[p>>2]=B,A[d+12>>2]=B,A[B+8>>2]=d,A[B+12>>2]=g;return}d=x>>>8,d?x>>>0>16777215?v=31:(R=(d+1048320|0)>>>16&8,z=d<<R,I=(z+520192|0)>>>16&4,z=z<<I,v=(z+245760|0)>>>16&2,v=14-(I|R|v)+(z<<v>>>15)|0,v=x>>>(v+7|0)&1|v<<1):v=0,d=28212+(v<<2)|0,A[B+28>>2]=v,A[B+20>>2]=0,A[B+16>>2]=0,p=A[6978]|0,g=1<<v;e:do if(!(p&g))A[6978]=p|g,A[d>>2]=B,A[B+24>>2]=d,A[B+12>>2]=B,A[B+8>>2]=B;else{d=A[d>>2]|0;t:do if((A[d+4>>2]&-8|0)!=(x|0)){for(v=x<<((v|0)==31?0:25-(v>>>1)|0);g=d+16+(v>>>31<<2)|0,p=A[g>>2]|0,!!p;)if((A[p+4>>2]&-8|0)==(x|0)){d=p;break t}else v=v<<1,d=p;A[g>>2]=B,A[B+24>>2]=d,A[B+12>>2]=B,A[B+8>>2]=B;break e}while(!1);R=d+8|0,z=A[R>>2]|0,A[z+12>>2]=B,A[R>>2]=B,A[B+8>>2]=z,A[B+12>>2]=d,A[B+24>>2]=0}while(!1);if(z=(A[6985]|0)+-1|0,A[6985]=z,!(z|0)){for(d=28364;d=A[d>>2]|0,d;)d=d+8|0;A[6985]=-1}}}}function Yn(d,p){d=d|0,p=p|0;var g=0;return d?(g=Sr(p,d)|0,(p|d)>>>0>65535&&(g=((g>>>0)/(d>>>0)|0|0)==(p|0)?g:-1)):g=0,d=Gn(g)|0,!d||!(A[d+-4>>2]&3)||to(d|0,0,g|0)|0,d|0}function Ci(d,p,g,v){return d=d|0,p=p|0,g=g|0,v=v|0,g=d+g>>>0,Di(p+v+(g>>>0<d>>>0|0)>>>0|0),g|0|0}function qr(d,p,g,v){return d=d|0,p=p|0,g=g|0,v=v|0,v=p-v-(g>>>0>d>>>0|0)>>>0,Di(v|0),d-g>>>0|0|0}function gu(d){return d=d|0,(d?31-(ys(d^d-1)|0)|0:32)|0}function pn(d,p,g,v,x){d=d|0,p=p|0,g=g|0,v=v|0,x=x|0;var I=0,R=0,B=0,z=0,$=0,X=0,ce=0,Te=0,xe=0,we=0;if(X=d,z=p,$=z,R=g,Te=v,B=Te,!$)return I=(x|0)!=0,B?I?(A[x>>2]=d|0,A[x+4>>2]=p&0,Te=0,x=0,Di(Te|0),x|0):(Te=0,x=0,Di(Te|0),x|0):(I&&(A[x>>2]=(X>>>0)%(R>>>0),A[x+4>>2]=0),Te=0,x=(X>>>0)/(R>>>0)>>>0,Di(Te|0),x|0);I=(B|0)==0;do if(R){if(!I){if(I=(ys(B|0)|0)-(ys($|0)|0)|0,I>>>0<=31){ce=I+1|0,B=31-I|0,p=I-31>>31,R=ce,d=X>>>(ce>>>0)&p|$<<B,p=$>>>(ce>>>0)&p,I=0,B=X<<B;break}return x?(A[x>>2]=d|0,A[x+4>>2]=z|p&0,Te=0,x=0,Di(Te|0),x|0):(Te=0,x=0,Di(Te|0),x|0)}if(I=R-1|0,I&R|0){B=(ys(R|0)|0)+33-(ys($|0)|0)|0,we=64-B|0,ce=32-B|0,z=ce>>31,xe=B-32|0,p=xe>>31,R=B,d=ce-1>>31&$>>>(xe>>>0)|($<<ce|X>>>(B>>>0))&p,p=p&$>>>(B>>>0),I=X<<we&z,B=($<<we|X>>>(xe>>>0))&z|X<<ce&B-33>>31;break}return x|0&&(A[x>>2]=I&X,A[x+4>>2]=0),(R|0)==1?(xe=z|p&0,we=d|0|0,Di(xe|0),we|0):(we=gu(R|0)|0,xe=$>>>(we>>>0)|0,we=$<<32-we|X>>>(we>>>0)|0,Di(xe|0),we|0)}else{if(I)return x|0&&(A[x>>2]=($>>>0)%(R>>>0),A[x+4>>2]=0),xe=0,we=($>>>0)/(R>>>0)>>>0,Di(xe|0),we|0;if(!X)return x|0&&(A[x>>2]=0,A[x+4>>2]=($>>>0)%(B>>>0)),xe=0,we=($>>>0)/(B>>>0)>>>0,Di(xe|0),we|0;if(I=B-1|0,!(I&B))return x|0&&(A[x>>2]=d|0,A[x+4>>2]=I&$|p&0),xe=0,we=$>>>((gu(B|0)|0)>>>0),Di(xe|0),we|0;if(I=(ys(B|0)|0)-(ys($|0)|0)|0,I>>>0<=30){p=I+1|0,B=31-I|0,R=p,d=$<<B|X>>>(p>>>0),p=$>>>(p>>>0),I=0,B=X<<B;break}return x?(A[x>>2]=d|0,A[x+4>>2]=z|p&0,xe=0,we=0,Di(xe|0),we|0):(xe=0,we=0,Di(xe|0),we|0)}while(!1);if(!R)$=B,z=0,B=0;else{ce=g|0|0,X=Te|v&0,$=Ci(ce|0,X|0,-1,-1)|0,g=fe()|0,z=B,B=0;do v=z,z=I>>>31|z<<1,I=B|I<<1,v=d<<1|v>>>31|0,Te=d>>>31|p<<1|0,qr($|0,g|0,v|0,Te|0)|0,we=fe()|0,xe=we>>31|((we|0)<0?-1:0)<<1,B=xe&1,d=qr(v|0,Te|0,xe&ce|0,(((we|0)<0?-1:0)>>31|((we|0)<0?-1:0)<<1)&X|0)|0,p=fe()|0,R=R-1|0;while((R|0)!=0);$=z,z=0}return R=0,x|0&&(A[x>>2]=d,A[x+4>>2]=p),xe=(I|0)>>>31|($|R)<<1|(R<<1|I>>>31)&0|z,we=(I<<1|0)&-2|B,Di(xe|0),we|0}function gn(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0;return $=p>>31|((p|0)<0?-1:0)<<1,z=((p|0)<0?-1:0)>>31|((p|0)<0?-1:0)<<1,I=v>>31|((v|0)<0?-1:0)<<1,x=((v|0)<0?-1:0)>>31|((v|0)<0?-1:0)<<1,B=qr($^d|0,z^p|0,$|0,z|0)|0,R=fe()|0,d=I^$,p=x^z,qr((pn(B,R,qr(I^g|0,x^v|0,I|0,x|0)|0,fe()|0,0)|0)^d|0,(fe()|0)^p|0,d|0,p|0)|0}function el(d,p){d=d|0,p=p|0;var g=0,v=0,x=0,I=0;return I=d&65535,x=p&65535,g=Sr(x,I)|0,v=d>>>16,d=(g>>>16)+(Sr(x,v)|0)|0,x=p>>>16,p=Sr(x,I)|0,Di((d>>>16)+(Sr(x,v)|0)+(((d&65535)+p|0)>>>16)|0),d+p<<16|g&65535|0|0}function Rr(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0;return x=d,I=g,g=el(x,I)|0,d=fe()|0,Di((Sr(p,I)|0)+(Sr(v,x)|0)+d|d&0|0),g|0|0|0}function Hs(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0,R=0,B=0,z=0,$=0;return x=se,se=se+16|0,B=x|0,R=p>>31|((p|0)<0?-1:0)<<1,I=((p|0)<0?-1:0)>>31|((p|0)<0?-1:0)<<1,$=v>>31|((v|0)<0?-1:0)<<1,z=((v|0)<0?-1:0)>>31|((v|0)<0?-1:0)<<1,d=qr(R^d|0,I^p|0,R|0,I|0)|0,p=fe()|0,pn(d,p,qr($^g|0,z^v|0,$|0,z|0)|0,fe()|0,B)|0,v=qr(A[B>>2]^R|0,A[B+4>>2]^I|0,R|0,I|0)|0,g=fe()|0,se=x,Di(g|0),v|0}function go(d,p,g,v){d=d|0,p=p|0,g=g|0,v=v|0;var x=0,I=0;return I=se,se=se+16|0,x=I|0,pn(d,p,g,v,x)|0,se=I,Di(A[x+4>>2]|0),A[x>>2]|0|0}function ph(d,p,g){return d=d|0,p=p|0,g=g|0,(g|0)<32?(Di(p>>g|0),d>>>g|(p&(1<<g)-1)<<32-g):(Di(((p|0)<0?-1:0)|0),p>>g-32|0)}function Ut(d,p,g){return d=d|0,p=p|0,g=g|0,(g|0)<32?(Di(p>>>g|0),d>>>g|(p&(1<<g)-1)<<32-g):(Di(0),p>>>g-32|0)}function qt(d,p,g){return d=d|0,p=p|0,g=g|0,(g|0)<32?(Di(p<<g|(d&(1<<g)-1<<32-g)>>>32-g|0),d<<g):(Di(d<<g-32|0),0)}function vc(d,p,g){return d=d|0,p=p|0,p=ys(p)|0,(p|0)==32&&(p=p+(ys(d)|0)|0),Di(0),p|0}function va(d,p){return d=+d,p=+p,d!=d?+p:p!=p?+d:+Br(+d,+p)}function ws(d,p){return d=+d,p=+p,d!=d?+p:p!=p?+d:+Hn(+d,+p)}function li(d){return d=+d,d>=0?+ui(d+.5):+Ds(d-.5)}function mo(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0;if((g|0)>=8192)return Hc(d|0,p|0,g|0)|0,d|0;if(I=d|0,x=d+g|0,(d&3)==(p&3)){for(;d&3;){if(!g)return I|0;Tt[d>>0]=Tt[p>>0]|0,d=d+1|0,p=p+1|0,g=g-1|0}for(g=x&-4|0,v=g-64|0;(d|0)<=(v|0);)A[d>>2]=A[p>>2],A[d+4>>2]=A[p+4>>2],A[d+8>>2]=A[p+8>>2],A[d+12>>2]=A[p+12>>2],A[d+16>>2]=A[p+16>>2],A[d+20>>2]=A[p+20>>2],A[d+24>>2]=A[p+24>>2],A[d+28>>2]=A[p+28>>2],A[d+32>>2]=A[p+32>>2],A[d+36>>2]=A[p+36>>2],A[d+40>>2]=A[p+40>>2],A[d+44>>2]=A[p+44>>2],A[d+48>>2]=A[p+48>>2],A[d+52>>2]=A[p+52>>2],A[d+56>>2]=A[p+56>>2],A[d+60>>2]=A[p+60>>2],d=d+64|0,p=p+64|0;for(;(d|0)<(g|0);)A[d>>2]=A[p>>2],d=d+4|0,p=p+4|0}else for(g=x-4|0;(d|0)<(g|0);)Tt[d>>0]=Tt[p>>0]|0,Tt[d+1>>0]=Tt[p+1>>0]|0,Tt[d+2>>0]=Tt[p+2>>0]|0,Tt[d+3>>0]=Tt[p+3>>0]|0,d=d+4|0,p=p+4|0;for(;(d|0)<(x|0);)Tt[d>>0]=Tt[p>>0]|0,d=d+1|0,p=p+1|0;return I|0}function to(d,p,g){d=d|0,p=p|0,g=g|0;var v=0,x=0,I=0,R=0;if(I=d+g|0,p=p&255,(g|0)>=67){for(;d&3;)Tt[d>>0]=p,d=d+1|0;for(v=I&-4|0,R=p|p<<8|p<<16|p<<24,x=v-64|0;(d|0)<=(x|0);)A[d>>2]=R,A[d+4>>2]=R,A[d+8>>2]=R,A[d+12>>2]=R,A[d+16>>2]=R,A[d+20>>2]=R,A[d+24>>2]=R,A[d+28>>2]=R,A[d+32>>2]=R,A[d+36>>2]=R,A[d+40>>2]=R,A[d+44>>2]=R,A[d+48>>2]=R,A[d+52>>2]=R,A[d+56>>2]=R,A[d+60>>2]=R,d=d+64|0;for(;(d|0)<(v|0);)A[d>>2]=R,d=d+4|0}for(;(d|0)<(I|0);)Tt[d>>0]=p,d=d+1|0;return I-g|0}function mu(d){return d=+d,d>=0?+ui(d+.5):+Ds(d-.5)}function Ts(d){d=d|0;var p=0,g=0,v=0;return v=Ku()|0,g=A[_t>>2]|0,p=g+d|0,(d|0)>0&(p|0)<(g|0)|(p|0)<0?(za(p|0)|0,Js(12),-1):(p|0)>(v|0)&&!(Ju(p|0)|0)?(Js(12),-1):(A[_t>>2]=p,g|0)}return{___divdi3:gn,___muldi3:Rr,___remdi3:Hs,___uremdi3:go,_areNeighborCells:Ql,_bitshift64Ashr:ph,_bitshift64Lshr:Ut,_bitshift64Shl:qt,_calloc:Yn,_cellAreaKm2:da,_cellAreaM2:hc,_cellAreaRads2:Sl,_cellToBoundary:Fo,_cellToCenterChild:nc,_cellToChildPos:fa,_cellToChildren:ih,_cellToChildrenSize:uo,_cellToLatLng:Xn,_cellToLocalIj:pc,_cellToParent:rc,_cellToVertex:fs,_cellToVertexes:Bl,_cellsToDirectedEdge:Tf,_cellsToLinkedMultiPolygon:$n,_childPosToCell:tu,_compactCells:Lo,_destroyLinkedMultiPolygon:pa,_directedEdgeToBoundary:co,_directedEdgeToCells:Cf,_edgeLengthKm:El,_edgeLengthM:Ac,_edgeLengthRads:fc,_emscripten_replace_memory:vf,_free:ki,_getBaseCellNumber:Qc,_getDirectedEdgeDestination:Sf,_getDirectedEdgeOrigin:Gc,_getHexagonAreaAvgKm2:zo,_getHexagonAreaAvgM2:cc,_getHexagonEdgeLengthAvgKm:Ga,_getHexagonEdgeLengthAvgM:Os,_getIcosahedronFaces:oc,_getNumCells:uc,_getPentagons:wl,_getRes0Cells:Wa,_getResolution:ua,_greatCircleDistanceKm:No,_greatCircleDistanceM:ac,_greatCircleDistanceRads:lh,_gridDisk:Xl,_gridDiskDistances:Zc,_gridDistance:Pl,_gridPathCells:Rf,_gridPathCellsSize:Mf,_gridRingUnsafe:pl,_i64Add:Ci,_i64Subtract:qr,_isPentagon:Ir,_isResClassIII:qa,_isValidCell:ic,_isValidDirectedEdge:Ef,_isValidVertex:Ah,_latLngToCell:xl,_llvm_ctlz_i64:vc,_llvm_maxnum_f64:va,_llvm_minnum_f64:ws,_llvm_round_f64:li,_localIjToCell:ou,_malloc:Gn,_maxFaceCount:eu,_maxGridDiskSize:ea,_maxPolygonToCellsSize:qc,_maxPolygonToCellsSizeExperimental:mc,_memcpy:mo,_memset:to,_originToDirectedEdges:Kl,_pentagonCount:oh,_polygonToCells:lr,_polygonToCellsExperimental:lu,_readInt64AsDoubleFromPointer:kl,_res0CellCount:Mr,_round:mu,_sbrk:Ts,_sizeOfCellBoundary:uh,_sizeOfCoordIJ:fh,_sizeOfGeoLoop:hh,_sizeOfGeoPolygon:yc,_sizeOfH3Index:_c,_sizeOfLatLng:uu,_sizeOfLinkedGeoPolygon:bc,_uncompactCells:rh,_uncompactCellsSize:nh,_vertexToLatLng:fu,establishStackSpace:$c,stackAlloc:xf,stackRestore:eh,stackSave:wf}}(le,me,Mt);e.___divdi3=ue.___divdi3,e.___muldi3=ue.___muldi3,e.___remdi3=ue.___remdi3,e.___uremdi3=ue.___uremdi3,e._areNeighborCells=ue._areNeighborCells,e._bitshift64Ashr=ue._bitshift64Ashr,e._bitshift64Lshr=ue._bitshift64Lshr,e._bitshift64Shl=ue._bitshift64Shl,e._calloc=ue._calloc,e._cellAreaKm2=ue._cellAreaKm2,e._cellAreaM2=ue._cellAreaM2,e._cellAreaRads2=ue._cellAreaRads2,e._cellToBoundary=ue._cellToBoundary,e._cellToCenterChild=ue._cellToCenterChild,e._cellToChildPos=ue._cellToChildPos,e._cellToChildren=ue._cellToChildren,e._cellToChildrenSize=ue._cellToChildrenSize,e._cellToLatLng=ue._cellToLatLng,e._cellToLocalIj=ue._cellToLocalIj,e._cellToParent=ue._cellToParent,e._cellToVertex=ue._cellToVertex,e._cellToVertexes=ue._cellToVertexes,e._cellsToDirectedEdge=ue._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=ue._cellsToLinkedMultiPolygon,e._childPosToCell=ue._childPosToCell,e._compactCells=ue._compactCells,e._destroyLinkedMultiPolygon=ue._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=ue._directedEdgeToBoundary,e._directedEdgeToCells=ue._directedEdgeToCells,e._edgeLengthKm=ue._edgeLengthKm,e._edgeLengthM=ue._edgeLengthM,e._edgeLengthRads=ue._edgeLengthRads;var $e=e._emscripten_replace_memory=ue._emscripten_replace_memory;e._free=ue._free,e._getBaseCellNumber=ue._getBaseCellNumber,e._getDirectedEdgeDestination=ue._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=ue._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=ue._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=ue._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=ue._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=ue._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=ue._getIcosahedronFaces,e._getNumCells=ue._getNumCells,e._getPentagons=ue._getPentagons,e._getRes0Cells=ue._getRes0Cells,e._getResolution=ue._getResolution,e._greatCircleDistanceKm=ue._greatCircleDistanceKm,e._greatCircleDistanceM=ue._greatCircleDistanceM,e._greatCircleDistanceRads=ue._greatCircleDistanceRads,e._gridDisk=ue._gridDisk,e._gridDiskDistances=ue._gridDiskDistances,e._gridDistance=ue._gridDistance,e._gridPathCells=ue._gridPathCells,e._gridPathCellsSize=ue._gridPathCellsSize,e._gridRingUnsafe=ue._gridRingUnsafe,e._i64Add=ue._i64Add,e._i64Subtract=ue._i64Subtract,e._isPentagon=ue._isPentagon,e._isResClassIII=ue._isResClassIII,e._isValidCell=ue._isValidCell,e._isValidDirectedEdge=ue._isValidDirectedEdge,e._isValidVertex=ue._isValidVertex,e._latLngToCell=ue._latLngToCell,e._llvm_ctlz_i64=ue._llvm_ctlz_i64,e._llvm_maxnum_f64=ue._llvm_maxnum_f64,e._llvm_minnum_f64=ue._llvm_minnum_f64,e._llvm_round_f64=ue._llvm_round_f64,e._localIjToCell=ue._localIjToCell,e._malloc=ue._malloc,e._maxFaceCount=ue._maxFaceCount,e._maxGridDiskSize=ue._maxGridDiskSize,e._maxPolygonToCellsSize=ue._maxPolygonToCellsSize,e._maxPolygonToCellsSizeExperimental=ue._maxPolygonToCellsSizeExperimental,e._memcpy=ue._memcpy,e._memset=ue._memset,e._originToDirectedEdges=ue._originToDirectedEdges,e._pentagonCount=ue._pentagonCount,e._polygonToCells=ue._polygonToCells,e._polygonToCellsExperimental=ue._polygonToCellsExperimental,e._readInt64AsDoubleFromPointer=ue._readInt64AsDoubleFromPointer,e._res0CellCount=ue._res0CellCount,e._round=ue._round,e._sbrk=ue._sbrk,e._sizeOfCellBoundary=ue._sizeOfCellBoundary,e._sizeOfCoordIJ=ue._sizeOfCoordIJ,e._sizeOfGeoLoop=ue._sizeOfGeoLoop,e._sizeOfGeoPolygon=ue._sizeOfGeoPolygon,e._sizeOfH3Index=ue._sizeOfH3Index,e._sizeOfLatLng=ue._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=ue._sizeOfLinkedGeoPolygon,e._uncompactCells=ue._uncompactCells,e._uncompactCellsSize=ue._uncompactCellsSize,e._vertexToLatLng=ue._vertexToLatLng,e.establishStackSpace=ue.establishStackSpace;var ge=e.stackAlloc=ue.stackAlloc,ut=e.stackRestore=ue.stackRestore,Ge=e.stackSave=ue.stackSave;if(e.asm=ue,e.cwrap=Ce,e.setValue=W,e.getValue=ee,or){rs(or)||(or=c(or));{dr();var ot=function(Qe){Qe.byteLength&&(Qe=new Uint8Array(Qe)),Xt.set(Qe,V),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,tr()},pt=function(){f(or,ot,function(){throw"could not load memory initializer "+or})},nt=ae(or);if(nt)ot(nt.buffer);else if(e.memoryInitializerRequest){var Rt=function(){var Qe=e.memoryInitializerRequest,ht=Qe.response;if(Qe.status!==200&&Qe.status!==0){var We=ae(e.memoryInitializerRequestURL);if(We)ht=We.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Qe.status+", retrying "+or),pt();return}}ot(ht)};e.memoryInitializerRequest.response?setTimeout(Rt,0):e.memoryInitializerRequest.addEventListener("load",Rt)}else pt()}}var Qt;Pi=function Qe(){Qt||ii(),Qt||(Pi=Qe)};function ii(Qe){if(zt>0||(Oi(),zt>0))return;function ht(){Qt||(Qt=!0,!he&&(Li(),Ar(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Yi()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),ht()},1)):ht()}e.run=ii;function gi(Qe){throw e.onAbort&&e.onAbort(Qe),Qe+="",a(Qe),w(Qe),he=!0,"abort("+Qe+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=gi,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ii(),i}(typeof wn=="object"?wn:{}),Ji="number",Wi=Ji,uA=Ji,Qi=Ji,Ki=Ji,gs=Ji,_i=Ji,oF=[["sizeOfH3Index",Ji],["sizeOfLatLng",Ji],["sizeOfCellBoundary",Ji],["sizeOfGeoLoop",Ji],["sizeOfGeoPolygon",Ji],["sizeOfLinkedGeoPolygon",Ji],["sizeOfCoordIJ",Ji],["readInt64AsDoubleFromPointer",Ji],["isValidCell",uA,[Qi,Ki]],["latLngToCell",Wi,[Ji,Ji,gs,_i]],["cellToLatLng",Wi,[Qi,Ki,_i]],["cellToBoundary",Wi,[Qi,Ki,_i]],["maxGridDiskSize",Wi,[Ji,_i]],["gridDisk",Wi,[Qi,Ki,Ji,_i]],["gridDiskDistances",Wi,[Qi,Ki,Ji,_i,_i]],["gridRingUnsafe",Wi,[Qi,Ki,Ji,_i]],["maxPolygonToCellsSize",Wi,[_i,gs,Ji,_i]],["polygonToCells",Wi,[_i,gs,Ji,_i]],["maxPolygonToCellsSizeExperimental",Wi,[_i,gs,Ji,_i]],["polygonToCellsExperimental",Wi,[_i,gs,Ji,Ji,Ji,_i]],["cellsToLinkedMultiPolygon",Wi,[_i,Ji,_i]],["destroyLinkedMultiPolygon",null,[_i]],["compactCells",Wi,[_i,_i,Ji,Ji]],["uncompactCells",Wi,[_i,Ji,Ji,_i,Ji,gs]],["uncompactCellsSize",Wi,[_i,Ji,Ji,gs,_i]],["isPentagon",uA,[Qi,Ki]],["isResClassIII",uA,[Qi,Ki]],["getBaseCellNumber",Ji,[Qi,Ki]],["getResolution",Ji,[Qi,Ki]],["maxFaceCount",Wi,[Qi,Ki,_i]],["getIcosahedronFaces",Wi,[Qi,Ki,_i]],["cellToParent",Wi,[Qi,Ki,gs,_i]],["cellToChildren",Wi,[Qi,Ki,gs,_i]],["cellToCenterChild",Wi,[Qi,Ki,gs,_i]],["cellToChildrenSize",Wi,[Qi,Ki,gs,_i]],["cellToChildPos",Wi,[Qi,Ki,gs,_i]],["childPosToCell",Wi,[Ji,Ji,Qi,Ki,gs,_i]],["areNeighborCells",Wi,[Qi,Ki,Qi,Ki,_i]],["cellsToDirectedEdge",Wi,[Qi,Ki,Qi,Ki,_i]],["getDirectedEdgeOrigin",Wi,[Qi,Ki,_i]],["getDirectedEdgeDestination",Wi,[Qi,Ki,_i]],["isValidDirectedEdge",uA,[Qi,Ki]],["directedEdgeToCells",Wi,[Qi,Ki,_i]],["originToDirectedEdges",Wi,[Qi,Ki,_i]],["directedEdgeToBoundary",Wi,[Qi,Ki,_i]],["gridDistance",Wi,[Qi,Ki,Qi,Ki,_i]],["gridPathCells",Wi,[Qi,Ki,Qi,Ki,_i]],["gridPathCellsSize",Wi,[Qi,Ki,Qi,Ki,_i]],["cellToLocalIj",Wi,[Qi,Ki,Qi,Ki,Ji,_i]],["localIjToCell",Wi,[Qi,Ki,_i,Ji,_i]],["getHexagonAreaAvgM2",Wi,[gs,_i]],["getHexagonAreaAvgKm2",Wi,[gs,_i]],["getHexagonEdgeLengthAvgM",Wi,[gs,_i]],["getHexagonEdgeLengthAvgKm",Wi,[gs,_i]],["greatCircleDistanceM",Ji,[_i,_i]],["greatCircleDistanceKm",Ji,[_i,_i]],["greatCircleDistanceRads",Ji,[_i,_i]],["cellAreaM2",Wi,[Qi,Ki,_i]],["cellAreaKm2",Wi,[Qi,Ki,_i]],["cellAreaRads2",Wi,[Qi,Ki,_i]],["edgeLengthM",Wi,[Qi,Ki,_i]],["edgeLengthKm",Wi,[Qi,Ki,_i]],["edgeLengthRads",Wi,[Qi,Ki,_i]],["getNumCells",Wi,[gs,_i]],["getRes0Cells",Wi,[_i]],["res0CellCount",Ji],["getPentagons",Wi,[Ji,_i]],["pentagonCount",Ji],["cellToVertex",Wi,[Qi,Ki,Ji,_i]],["cellToVertexes",Wi,[Qi,Ki,_i]],["vertexToLatLng",Wi,[Qi,Ki,_i]],["isValidVertex",uA,[Qi,Ki]]],aF=0,lF=1,cF=2,uF=3,yT=4,hF=5,fF=6,AF=7,dF=8,pF=9,gF=10,mF=11,_F=12,yF=13,bF=14,vF=15,Rs={};Rs[aF]="Success";Rs[lF]="The operation failed but a more specific error is not available";Rs[cF]="Argument was outside of acceptable range";Rs[uF]="Latitude or longitude arguments were outside of acceptable range";Rs[yT]="Resolution argument was outside of acceptable range";Rs[hF]="Cell argument was not valid";Rs[fF]="Directed edge argument was not valid";Rs[AF]="Undirected edge argument was not valid";Rs[dF]="Vertex argument was not valid";Rs[pF]="Pentagon distortion was encountered";Rs[gF]="Duplicate input";Rs[mF]="Cell arguments were not neighbors";Rs[_F]="Cell arguments had incompatible resolutions";Rs[yF]="Memory allocation failed";Rs[bF]="Bounds of provided memory were insufficient";Rs[vF]="Mode or flags argument was not valid";var bT=1e3,xF=1001,vT=1002,b0={};b0[bT]="Unknown unit";b0[xF]="Array length out of bounds";b0[vT]="Got unexpected null value for H3 index";var wF="Unknown error";function xT(i,e,t){var r=t&&"value"in t,o=new Error((i[e]||wF)+" (code: "+e+(r?", value: "+t.value:"")+")");return o.code=e,o}function wT(i,e){var t=arguments.length===2?{value:e}:{};return xT(Rs,i,t)}function TT(i,e){var t=arguments.length===2?{value:e}:{};return xT(b0,i,t)}function af(i){if(i!==0)throw wT(i)}var _s={};oF.forEach(function(e){_s[e[0]]=wn.cwrap.apply(wn,e)});var Xh=16,TF=4,Xu=8,SF=8,o_=_s.sizeOfH3Index(),ST=_s.sizeOfLatLng(),EF=_s.sizeOfCellBoundary();_s.sizeOfGeoPolygon();_s.sizeOfGeoLoop();_s.sizeOfLinkedGeoPolygon();_s.sizeOfCoordIJ();var Fv={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function CF(i){if(typeof i!="number"||i<0||i>15||Math.floor(i)!==i)throw wT(yT,i);return i}function IF(i){if(!i)throw TT(vT);return i}var PF=/[^0-9a-fA-F]/;function lf(i){if(Array.isArray(i)&&i.length===2&&Number.isInteger(i[0])&&Number.isInteger(i[1]))return i;if(typeof i!="string"||PF.test(i))return[0,0];var e=parseInt(i.substring(0,i.length-8),Xh),t=parseInt(i.substring(i.length-8),Xh);return[t,e]}function Nv(i){if(i>=0)return i.toString(Xh);i=i&2147483647;var e=ET(8,i.toString(Xh)),t=(parseInt(e[0],Xh)+8).toString(Xh);return e=t+e.substring(1),e}function MF(i,e){return Nv(e)+ET(8,Nv(i))}function ET(i,e){for(var t=i-e.length,r="",o=0;o<t;o++)r+="0";return r=r+e,r}function RF(i,e){e===void 0&&(e=0);var t=wn.getValue(i+o_*e,"i32"),r=wn.getValue(i+o_*e+TF,"i32");return r?MF(t,r):null}function kF(i,e){return e===void 0&&(e=0),wn.getValue(i+Xu*e,"double")}function DF(i){return _s.readInt64AsDoubleFromPointer(i)}function Up(i){return HF(wn.getValue(i,"double"))}function BF(i){return[Up(i),Up(i+Xu)]}function OF(i){return[Up(i+Xu),Up(i)]}function LF(i,e,t){for(var r=wn.getValue(i,"i32"),o=i+Xu,c=[],f=OF,a=0;a<r*2;a+=2)c.push(f(o+Xu*a));return c.push(c[0]),c}function FF(i){var e=lf(i),t=e[0],r=e[1];return!!_s.isPentagon(t,r)}function NF(i){var e=lf(i),t=e[0],r=e[1];return _s.isValidCell(t,r)?_s.getResolution(t,r):-1}function zF(i,e,t){var r=wn._malloc(ST);wn.HEAPF64.set([i,e].map(WF),r/Xu);var o=wn._malloc(o_);try{return af(_s.latLngToCell(r,t,o)),IF(RF(o))}finally{wn._free(o),wn._free(r)}}function ay(i){var e=wn._malloc(ST),t=lf(i),r=t[0],o=t[1];try{return af(_s.cellToLatLng(r,o,e)),BF(e)}finally{wn._free(e)}}function UF(i,e){var t=wn._malloc(EF),r=lf(i),o=r[0],c=r[1];try{return af(_s.cellToBoundary(o,c,t)),LF(t,e,e)}finally{wn._free(t)}}function jF(i,e){var t=lf(i),r=t[0],o=t[1],c=lf(e),f=c[0],a=c[1],w=wn._malloc(SF);try{return af(_s.gridDistance(r,o,f,a,w)),DF(w)}finally{wn._free(w)}}function VF(i,e){CF(i);var t=wn._malloc(Xu);try{switch(e){case Fv.m:af(_s.getHexagonEdgeLengthAvgM(i,t));break;case Fv.km:af(_s.getHexagonEdgeLengthAvgKm(i,t));break;default:throw TT(bT,e)}return kF(t)}finally{wn._free(t)}}function WF(i){return i*Math.PI/180}function HF(i){return i*180/Math.PI}function CT(i,e){e=e===void 0?i[0][0]:e;for(const t of i){const r=t[0]-e;r>180?t[0]-=360:r<-180&&(t[0]+=360)}}function $F(i,e,t){const[r,o]=ay(i),c=e.length;CT(e,o);const f=e[0]===e[c-1]?c-1:c;for(let a=0;a<f;a++)e[a][0]=rf(o,e[a][0],t),e[a][1]=rf(r,e[a][1],t)}function ZF(i,e,t){const r=i(e,t),[o,c]=ay(r);return[c,o]}function zv(i,e=1){const t=UF(i,!0);return e!==1?$F(i,t,e):CT(t),t}function qF(i){const e=new Float64Array(i.length*2);let t=0;for(const r of i)e[t++]=r[0],e[t++]=r[1];return e}const XF=10;function GF(i,e){let t;return i==null?t=e:typeof i=="object"?t={...i,coverage:e}:t={getHexagon:i,coverage:e},t}const YF={..._0.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:i=>i.hexagon},extruded:!0};class bf extends yf{initializeState(){bf._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(e.highPrecision!==!0&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){const r=this._calculateH3DataProps();this.setState(r)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,r=!1;const{iterable:o,objectInfo:c}=_f(this.props.data);for(const f of o){c.index++;const a=this.props.getHexagon(f,c),w=NF(a);if(e<0){if(e=w,!this.props.highPrecision)break}else if(e!==w){r=!0;break}if(FF(a)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?VF(e,"km"):0,hasMultipleRes:r,hasPentagon:t}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:t,hasMultipleRes:r}=this.state,{viewport:o}=this.context;return!!(o!=null&&o.resolution)||r||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:r,centerHex:o}=this.state;if(t<0)return;const c=this.props.centerHexagon||zF(e.latitude,e.longitude,t);if(o===c)return;if(o)try{if(jF(o,c)*r<XF)return}catch{}const{unitsPerMeter:f}=e.distanceScales;let a=zv(c);const[w,P]=ay(c),[k,F]=e.projectFlat([P,w]);a=a.map(V=>{const W=e.projectFlat(V);return[(W[0]-k)/f[0],(W[1]-F)/f[1]]}),this.setState({centerHex:c,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:r,extruded:o,wireframe:c,stroked:f,filled:a,lineWidthUnits:w,lineWidthScale:P,lineWidthMinPixels:k,lineWidthMaxPixels:F,getFillColor:V,getElevation:W,getLineColor:ee,getLineWidth:he,transitions:Ie,updateTriggers:Ee}=this.props;return{elevationScale:e,extruded:o,coverage:r,wireframe:c,stroked:f,filled:a,lineWidthUnits:w,lineWidthScale:P,lineWidthMinPixels:k,lineWidthMaxPixels:F,material:t,getElevation:W,getFillColor:V,getLineColor:ee,getLineWidth:he,transitions:Ie,updateTriggers:{getFillColor:Ee.getFillColor,getElevation:Ee.getElevation,getLineColor:Ee.getLineColor,getLineWidth:Ee.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:r,coverage:o}=this.props,c=this.getSubLayerClass("hexagon-cell-hifi",_0),f=this._getForwardProps();return f.updateTriggers.getPolygon=GF(r.getHexagon,o),new c(f,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:f.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,w)=>{const P=t(a,w);return qF(zv(P,o))}})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:r}=this.props,o=this.getSubLayerClass("hexagon-cell",Y_),c=this._getForwardProps();return c.updateTriggers.getPosition=r.getHexagon,new o(c,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:c.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:ZF.bind(null,t)})}}bf.defaultProps=YF;bf.layerName="H3HexagonLayer";bf._checkH3Lib=()=>{};const QF={clipBounds:[0,0,1,1],clipByInstance:void 0},IT=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,KF={name:"clip",vs:IT,uniformTypes:{bounds:"vec4<f32>"}},JF={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},eN={name:"clip",fs:IT,uniformTypes:{bounds:"vec4<f32>"}},tN={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class ly extends Z_{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[KF],inject:JF}:{modules:[eN],inject:tN}}draw(){const{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{const r=this.projectPosition([e[0],e[1],0]),o=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(r[0],o[0]),Math.min(r[1],o[1]),Math.max(r[0],o[0]),Math.max(r[1],o[1])]}this.setShaderModuleProps({clip:t})}}ly.defaultProps=QF;ly.extensionName="ClipExtension";function Uv(i,e){const t=e==null?void 0:e.globalFeatureId;return t!==void 0?iN(i,t):rN(i,e==null?void 0:e.type)}function iN(i,e){const t=PT(i);for(const r of t){let o=0,c=r.featureIds.value[0];for(let f=0;f<r.featureIds.value.length;f++){const a=r.featureIds.value[f];if(a!==c){if(e===r.globalFeatureIds.value[o])return jp(r,o,f);o=f,c=a}}if(e===r.globalFeatureIds.value[o])return jp(r,o,r.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function rN(i,e){const t=PT(i);return sN(t)}function nN(i,e,t){switch(i.type){case"Point":return cN(i,e,t);case"LineString":return lN(i,e,t);case"Polygon":return MT(i,e,t);default:const r=i;throw new Error(`Unsupported geometry type: ${r==null?void 0:r.type}`)}}function PT(i,e){const t=[];return i.points&&(i.points.type="Point",t.push(i.points)),i.lines&&(i.lines.type="LineString",t.push(i.lines)),i.polygons&&(i.polygons.type="Polygon",t.push(i.polygons)),t}function sN(i){const e=[];for(const t of i){if(t.featureIds.value.length===0)continue;let r=0,o=t.featureIds.value[0];for(let c=0;c<t.featureIds.value.length;c++){const f=t.featureIds.value[c];f!==o&&(e.push(jp(t,r,c)),r=c,o=f)}e.push(jp(t,r,t.featureIds.value.length))}return e}function jp(i,e,t){const r=nN(i,e,t),o=aN(i,e),c=oN(i,e);return{type:"Feature",geometry:r,properties:o,...c}}function oN(i,e=0,t){return i.fields&&i.fields[i.featureIds.value[e]]}function aN(i,e=0,t){const r=Object.assign({},i.properties[i.featureIds.value[e]]);for(const o in i.numericProps)r[o]=i.numericProps[o].value[e];return r}function MT(i,e=-1/0,t=1/0){const{positions:r}=i,o=i.polygonIndices.value.filter(w=>w>=e&&w<=t),c=i.primitivePolygonIndices.value.filter(w=>w>=e&&w<=t);if(!(o.length>2)){const w=[];for(let P=0;P<c.length-1;P++){const k=c[P],F=c[P+1],V=Vp(r,k,F);w.push(V)}return{type:"Polygon",coordinates:w}}const a=[];for(let w=0;w<o.length-1;w++){const P=o[w],k=o[w+1],F=MT(i,P,k).coordinates;a.push(F)}return{type:"MultiPolygon",coordinates:a}}function lN(i,e=-1/0,t=1/0){const{positions:r}=i,o=i.pathIndices.value.filter(a=>a>=e&&a<=t);if(!(o.length>2))return{type:"LineString",coordinates:Vp(r,o[0],o[1])};const f=[];for(let a=0;a<o.length-1;a++){const w=Vp(r,o[a],o[a+1]);f.push(w)}return{type:"MultiLineString",coordinates:f}}function cN(i,e,t){const{positions:r}=i,o=Vp(r,e,t);return o.length>1?{type:"MultiPoint",coordinates:o}:{type:"Point",coordinates:o[0]}}function Vp(i,e,t){e=e||0,t=t||i.value.length/i.size;const r=[];for(let o=e;o<t;o++){const c=Array();for(let f=o*i.size;f<(o+1)*i.size;f++)c.push(Number(i.value[f]));r.push(c)}return r}const uN="4.3.2",RT={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:uN,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...RT});const hN={Point:kT,MultiPoint:fN,LineString:DT,MultiLineString:AN,Polygon:BT,MultiPolygon:dN};function kT([i,e],[t,r],o){const c=rf(t[0],r[0],i),f=rf(t[1],r[1],e);return o.unprojectFlat([c,f])}function cy(i,e,t){return i.map(r=>kT(r,e,t))}function fN(i,e,t){return cy(i,e,t)}function DT(i,e,t){return cy(i,e,t)}function AN(i,e,t){return i.map(r=>DT(r,e,t))}function BT(i,e,t){return i.map(r=>cy(r,e,t))}function dN(i,e,t){return i.map(r=>BT(r,e,t))}function pN(i,e,t){const r=t.projectFlat([e.west,e.north]),o=t.projectFlat([e.east,e.south]),c=[r,o];return{...i,coordinates:hN[i.type](i.coordinates,c,t)}}const gN=["points","lines","polygons"];function mN(i,e,t,r){for(const o of gN){const c=i[o]&&_N(i[o],e,t,r);if(c>=0)return c}return-1}function _N(i,e,t,r){const o=i.featureIds.value;if(!o.length)return-1;let c=0,f=o[o.length-1]+1;if(r){const w=yN(i,r);if(w)c=w[0],f=w[1]+1;else return-1}let a=-1;if(e in i.numericProps){const w=i.numericProps[e].value.findIndex((P,k)=>P===t&&o[k]>=c&&o[k]<f);return w>=0?i.globalFeatureIds.value[w]:-1}else e?a=jv(i.properties,w=>w[e]===t,c,f):i.fields&&(a=jv(i.fields,w=>w.id===t,c,f));return a>=0?bN(i,a):-1}function yN(i,e){if(!i.__layers){const t={},{properties:r}=i;for(let o=0;o<r.length;o++){const{layerName:c}=r[o];c&&(t[c]?t[c][1]=o:t[c]=[o,o])}i.__layers=t}return i.__layers[e]}function bN(i,e){if(!i.__ids){const t=[],r=i.featureIds.value,o=i.globalFeatureIds.value;for(let c=0;c<r.length;c++)t[r[c]]=o[c];i.__ids=t}return i.__ids[e]}function jv(i,e,t,r){for(let o=t;o<r;o++)if(e(i[o],o))return o;return-1}const lm=512,vN={...qu.defaultProps,data:pT,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[RT],binary:!0};class DA extends oy{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:r,changeFlags:o}){var f;o.dataChanged&&this._updateTileData(),(f=this.state)!=null&&f.data&&(super.updateState({props:e,oldProps:t,context:r,changeFlags:o}),this._setWGS84PropertyForTiles());const{highlightColor:c}=e;c!==t.highlightColor&&Array.isArray(c)&&this.setState({highlightColor:c})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!q5(e)){const{onDataLoad:r,fetch:o}=this.props;this.setState({data:null,tileJSON:null});try{t=await o(e,{propName:"data",layer:this,loaders:[]})}catch(c){this.raiseError(c,"loading TileJSON"),e=null}r&&r(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:r,maxZoom:o}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>r&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(o)||t.maxzoom<o)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:t,binary:r}=this.state,{index:o,signal:c}=e,f=mT(t,e);if(!f)return Promise.reject("Invalid URL");let a=this.getLoadOptions();const{fetch:w}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...a==null?void 0:a.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:o},gis:r?{format:"binary"}:{}},w(f,{propName:"data",layer:this,loadOptions:a,signal:c})}renderSubLayers(e){const{x:t,y:r,z:o}=e.tile.index,c=Math.pow(2,o),f=lm/c,a=-f,w=lm*t/c,P=lm*(1-r/c),k=new Eo().scale([f,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=k,e.coordinateOrigin=[w,P,0],e.coordinateSystem=Cr.CARTESIAN,e.extensions=[...e.extensions||[],new ly]);const F=super.renderSubLayers(e);return this.state.binary&&!(F instanceof qu)&&rn.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),F}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:r,hoveredFeatureLayerName:o}=this.state,c=e.object;let f=null,a=null;c&&(f=cm(c,t),a=Vv(c));let{highlightColor:w}=this.props;typeof w=="function"&&(w=w(e)),(r!==f||o!==a)&&this.setState({highlightColor:w,hoveredFeatureId:f,hoveredFeatureLayerName:a})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:r}=e.sourceLayer.props;t.object=Uv(r,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=Hv(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:r,binary:o}=this.state,{uniqueIdProperty:c,highlightedFeatureId:f}=this.props,a=e.content,w=Wv(f);if(!(Wv(t)||w))return-1;const k=w?f:t;return Array.isArray(a)?a.findIndex(F=>{const V=cm(F,c)===k,W=w||Vv(F)===r;return V&&W}):a&&o?mN(a,c,k,w?"":r):-1}_pickObjects(e){const{deck:t,viewport:r}=this.context,o=r.width,c=r.height,f=r.x,a=r.y,w=[this.id];return t.pickObjects({x:f,y:a,width:o,height:c,layerIds:w,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),r=new Set,o=[];for(const c of t){const f=cm(c.object,this.props.uniqueIdProperty);f===void 0?o.push(c.object):r.has(f)||(r.add(f),o.push(c.object))}return o}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(r=>{r.hasOwnProperty(e)||Object.defineProperty(r,e,{get:()=>{if(!r.content)return null;if(this.state.binary&&Array.isArray(r.content)&&!r.content.length)return[];const{bbox:o}=r;if(r._contentWGS84===void 0&&X5(o)){const c=this.state.binary?Uv(r.content):r.content;r._contentWGS84=c.map(f=>Hv(f,o,this.context.viewport))}return r._contentWGS84}})})}}DA.layerName="MVTLayer";DA.defaultProps=vN;function cm(i,e){if(i.properties&&e)return i.properties[e];if("id"in i)return i.id}function Vv(i){var e;return((e=i.properties)==null?void 0:e.layerName)||null}function Wv(i){return i!=null&&i!==""}function Hv(i,e,t){const r={...i,geometry:{type:i.geometry.type}};return Object.defineProperty(r.geometry,"coordinates",{get:()=>pN(i.geometry,e,t).coordinates}),r}const OT=/^[a-z0-9]+(-[a-z0-9]+)*$/,v0=(i,e,t,r="")=>{const o=i.split(":");if(i.slice(0,1)==="@"){if(o.length<2||o.length>3)return null;r=o.shift().slice(1)}if(o.length>3||!o.length)return null;if(o.length>1){const a=o.pop(),w=o.pop(),P={provider:o.length>0?o[0]:r,prefix:w,name:a};return e&&!up(P)?null:P}const c=o[0],f=c.split("-");if(f.length>1){const a={provider:r,prefix:f.shift(),name:f.join("-")};return e&&!up(a)?null:a}if(t&&r===""){const a={provider:r,prefix:"",name:c};return e&&!up(a,t)?null:a}return null},up=(i,e)=>i?!!((e&&i.prefix===""||i.prefix)&&i.name):!1,LT=Object.freeze({left:0,top:0,width:16,height:16}),Wp=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),x0=Object.freeze({...LT,...Wp}),a_=Object.freeze({...x0,body:"",hidden:!1});function xN(i,e){const t={};!i.hFlip!=!e.hFlip&&(t.hFlip=!0),!i.vFlip!=!e.vFlip&&(t.vFlip=!0);const r=((i.rotate||0)+(e.rotate||0))%4;return r&&(t.rotate=r),t}function $v(i,e){const t=xN(i,e);for(const r in a_)r in Wp?r in i&&!(r in t)&&(t[r]=Wp[r]):r in e?t[r]=e[r]:r in i&&(t[r]=i[r]);return t}function wN(i,e){const t=i.icons,r=i.aliases||Object.create(null),o=Object.create(null);function c(f){if(t[f])return o[f]=[];if(!(f in o)){o[f]=null;const a=r[f]&&r[f].parent,w=a&&c(a);w&&(o[f]=[a].concat(w))}return o[f]}return Object.keys(t).concat(Object.keys(r)).forEach(c),o}function TN(i,e,t){const r=i.icons,o=i.aliases||Object.create(null);let c={};function f(a){c=$v(r[a]||o[a],c)}return f(e),t.forEach(f),$v(i,c)}function FT(i,e){const t=[];if(typeof i!="object"||typeof i.icons!="object")return t;i.not_found instanceof Array&&i.not_found.forEach(o=>{e(o,null),t.push(o)});const r=wN(i);for(const o in r){const c=r[o];c&&(e(o,TN(i,o,c)),t.push(o))}return t}const SN={provider:"",aliases:{},not_found:{},...LT};function um(i,e){for(const t in e)if(t in i&&typeof i[t]!=typeof e[t])return!1;return!0}function NT(i){if(typeof i!="object"||i===null)return null;const e=i;if(typeof e.prefix!="string"||!i.icons||typeof i.icons!="object"||!um(i,SN))return null;const t=e.icons;for(const o in t){const c=t[o];if(!o||typeof c.body!="string"||!um(c,a_))return null}const r=e.aliases||Object.create(null);for(const o in r){const c=r[o],f=c.parent;if(!o||typeof f!="string"||!t[f]&&!r[f]||!um(c,a_))return null}return e}const Zv=Object.create(null);function EN(i,e){return{provider:i,prefix:e,icons:Object.create(null),missing:new Set}}function cf(i,e){const t=Zv[i]||(Zv[i]=Object.create(null));return t[e]||(t[e]=EN(i,e))}function zT(i,e){return NT(e)?FT(e,(t,r)=>{r?i.icons[t]=r:i.missing.add(t)}):[]}function CN(i,e,t){try{if(typeof t.body=="string")return i.icons[e]={...t},!0}catch{}return!1}let ZA=!1;function UT(i){return typeof i=="boolean"&&(ZA=i),ZA}function IN(i){const e=typeof i=="string"?v0(i,!0,ZA):i;if(e){const t=cf(e.provider,e.prefix),r=e.name;return t.icons[r]||(t.missing.has(r)?null:void 0)}}function PN(i,e){const t=v0(i,!0,ZA);if(!t)return!1;const r=cf(t.provider,t.prefix);return e?CN(r,t.name,e):(r.missing.add(t.name),!0)}function MN(i,e){if(typeof i!="object")return!1;if(typeof e!="string"&&(e=i.provider||""),ZA&&!e&&!i.prefix){let o=!1;return NT(i)&&(i.prefix="",FT(i,(c,f)=>{PN(c,f)&&(o=!0)})),o}const t=i.prefix;if(!up({prefix:t,name:"a"}))return!1;const r=cf(e,t);return!!zT(r,i)}const jT=Object.freeze({width:null,height:null}),VT=Object.freeze({...jT,...Wp}),RN=/(-?[0-9.]*[0-9]+[0-9.]*)/g,kN=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function qv(i,e,t){if(e===1)return i;if(t=t||100,typeof i=="number")return Math.ceil(i*e*t)/t;if(typeof i!="string")return i;const r=i.split(RN);if(r===null||!r.length)return i;const o=[];let c=r.shift(),f=kN.test(c);for(;;){if(f){const a=parseFloat(c);isNaN(a)?o.push(c):o.push(Math.ceil(a*e*t)/t)}else o.push(c);if(c=r.shift(),c===void 0)return o.join("");f=!f}}function DN(i,e="defs"){let t="";const r=i.indexOf("<"+e);for(;r>=0;){const o=i.indexOf(">",r),c=i.indexOf("</"+e);if(o===-1||c===-1)break;const f=i.indexOf(">",c);if(f===-1)break;t+=i.slice(o+1,c).trim(),i=i.slice(0,r).trim()+i.slice(f+1)}return{defs:t,content:i}}function BN(i,e){return i?"<defs>"+i+"</defs>"+e:e}function ON(i,e,t){const r=DN(i);return BN(r.defs,e+r.content+t)}const LN=i=>i==="unset"||i==="undefined"||i==="none";function FN(i,e){const t={...x0,...i},r={...VT,...e},o={left:t.left,top:t.top,width:t.width,height:t.height};let c=t.body;[t,r].forEach(he=>{const Ie=[],Ee=he.hFlip,Ne=he.vFlip;let Ce=he.rotate;Ee?Ne?Ce+=2:(Ie.push("translate("+(o.width+o.left).toString()+" "+(0-o.top).toString()+")"),Ie.push("scale(-1 1)"),o.top=o.left=0):Ne&&(Ie.push("translate("+(0-o.left).toString()+" "+(o.height+o.top).toString()+")"),Ie.push("scale(1 -1)"),o.top=o.left=0);let De;switch(Ce<0&&(Ce-=Math.floor(Ce/4)*4),Ce=Ce%4,Ce){case 1:De=o.height/2+o.top,Ie.unshift("rotate(90 "+De.toString()+" "+De.toString()+")");break;case 2:Ie.unshift("rotate(180 "+(o.width/2+o.left).toString()+" "+(o.height/2+o.top).toString()+")");break;case 3:De=o.width/2+o.left,Ie.unshift("rotate(-90 "+De.toString()+" "+De.toString()+")");break}Ce%2===1&&(o.left!==o.top&&(De=o.left,o.left=o.top,o.top=De),o.width!==o.height&&(De=o.width,o.width=o.height,o.height=De)),Ie.length&&(c=ON(c,'<g transform="'+Ie.join(" ")+'">',"</g>"))});const f=r.width,a=r.height,w=o.width,P=o.height;let k,F;f===null?(F=a===null?"1em":a==="auto"?P:a,k=qv(F,w/P)):(k=f==="auto"?w:f,F=a===null?qv(k,P/w):a==="auto"?P:a);const V={},W=(he,Ie)=>{LN(Ie)||(V[he]=Ie.toString())};W("width",k),W("height",F);const ee=[o.left,o.top,w,P];return V.viewBox=ee.join(" "),{attributes:V,viewBox:ee,body:c}}const NN=/\sid="(\S+)"/g,zN="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let UN=0;function jN(i,e=zN){const t=[];let r;for(;r=NN.exec(i);)t.push(r[1]);if(!t.length)return i;const o="suffix"+(Math.random()*16777216|Date.now()).toString(16);return t.forEach(c=>{const f=typeof e=="function"?e(c):e+(UN++).toString(),a=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");i=i.replace(new RegExp('([#;"])('+a+')([")]|\\.[a-z])',"g"),"$1"+f+o+"$3")}),i=i.replace(new RegExp(o,"g"),""),i}const l_=Object.create(null);function VN(i,e){l_[i]=e}function c_(i){return l_[i]||l_[""]}function uy(i){let e;if(typeof i.resources=="string")e=[i.resources];else if(e=i.resources,!(e instanceof Array)||!e.length)return null;return{resources:e,path:i.path||"/",maxURL:i.maxURL||500,rotate:i.rotate||750,timeout:i.timeout||5e3,random:i.random===!0,index:i.index||0,dataAfterTimeout:i.dataAfterTimeout!==!1}}const hy=Object.create(null),hA=["https://api.simplesvg.com","https://api.unisvg.com"],hp=[];for(;hA.length>0;)hA.length===1||Math.random()>.5?hp.push(hA.shift()):hp.push(hA.pop());hy[""]=uy({resources:["https://api.iconify.design"].concat(hp)});function WN(i,e){const t=uy(e);return t===null?!1:(hy[i]=t,!0)}function fy(i){return hy[i]}const HN=()=>{let i;try{if(i=fetch,typeof i=="function")return i}catch{}};let Xv=HN();function $N(i,e){const t=fy(i);if(!t)return 0;let r;if(!t.maxURL)r=0;else{let o=0;t.resources.forEach(f=>{o=Math.max(o,f.length)});const c=e+".json?icons=";r=t.maxURL-o-t.path.length-c.length}return r}function ZN(i){return i===404}const qN=(i,e,t)=>{const r=[],o=$N(i,e),c="icons";let f={type:c,provider:i,prefix:e,icons:[]},a=0;return t.forEach((w,P)=>{a+=w.length+1,a>=o&&P>0&&(r.push(f),f={type:c,provider:i,prefix:e,icons:[]},a=w.length),f.icons.push(w)}),r.push(f),r};function XN(i){if(typeof i=="string"){const e=fy(i);if(e)return e.path}return"/"}const GN=(i,e,t)=>{if(!Xv){t("abort",424);return}let r=XN(e.provider);switch(e.type){case"icons":{const c=e.prefix,a=e.icons.join(","),w=new URLSearchParams({icons:a});r+=c+".json?"+w.toString();break}case"custom":{const c=e.uri;r+=c.slice(0,1)==="/"?c.slice(1):c;break}default:t("abort",400);return}let o=503;Xv(i+r).then(c=>{const f=c.status;if(f!==200){setTimeout(()=>{t(ZN(f)?"abort":"next",f)});return}return o=501,c.json()}).then(c=>{if(typeof c!="object"||c===null){setTimeout(()=>{c===404?t("abort",c):t("next",o)});return}setTimeout(()=>{t("success",c)})}).catch(()=>{t("next",o)})},YN={prepare:qN,send:GN};function QN(i){const e={loaded:[],missing:[],pending:[]},t=Object.create(null);i.sort((o,c)=>o.provider!==c.provider?o.provider.localeCompare(c.provider):o.prefix!==c.prefix?o.prefix.localeCompare(c.prefix):o.name.localeCompare(c.name));let r={provider:"",prefix:"",name:""};return i.forEach(o=>{if(r.name===o.name&&r.prefix===o.prefix&&r.provider===o.provider)return;r=o;const c=o.provider,f=o.prefix,a=o.name,w=t[c]||(t[c]=Object.create(null)),P=w[f]||(w[f]=cf(c,f));let k;a in P.icons?k=e.loaded:f===""||P.missing.has(a)?k=e.missing:k=e.pending;const F={provider:c,prefix:f,name:a};k.push(F)}),e}function WT(i,e){i.forEach(t=>{const r=t.loaderCallbacks;r&&(t.loaderCallbacks=r.filter(o=>o.id!==e))})}function KN(i){i.pendingCallbacksFlag||(i.pendingCallbacksFlag=!0,setTimeout(()=>{i.pendingCallbacksFlag=!1;const e=i.loaderCallbacks?i.loaderCallbacks.slice(0):[];if(!e.length)return;let t=!1;const r=i.provider,o=i.prefix;e.forEach(c=>{const f=c.icons,a=f.pending.length;f.pending=f.pending.filter(w=>{if(w.prefix!==o)return!0;const P=w.name;if(i.icons[P])f.loaded.push({provider:r,prefix:o,name:P});else if(i.missing.has(P))f.missing.push({provider:r,prefix:o,name:P});else return t=!0,!0;return!1}),f.pending.length!==a&&(t||WT([i],c.id),c.callback(f.loaded.slice(0),f.missing.slice(0),f.pending.slice(0),c.abort))})}))}let JN=0;function ez(i,e,t){const r=JN++,o=WT.bind(null,t,r);if(!e.pending.length)return o;const c={id:r,icons:e,callback:i,abort:o};return t.forEach(f=>{(f.loaderCallbacks||(f.loaderCallbacks=[])).push(c)}),o}function tz(i,e=!0,t=!1){const r=[];return i.forEach(o=>{const c=typeof o=="string"?v0(o,e,t):o;c&&r.push(c)}),r}var iz={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function rz(i,e,t,r){const o=i.resources.length,c=i.random?Math.floor(Math.random()*o):i.index;let f;if(i.random){let Ke=i.resources.slice(0);for(f=[];Ke.length>1;){const kt=Math.floor(Math.random()*Ke.length);f.push(Ke[kt]),Ke=Ke.slice(0,kt).concat(Ke.slice(kt+1))}f=f.concat(Ke)}else f=i.resources.slice(c).concat(i.resources.slice(0,c));const a=Date.now();let w="pending",P=0,k,F=null,V=[],W=[];typeof r=="function"&&W.push(r);function ee(){F&&(clearTimeout(F),F=null)}function he(){w==="pending"&&(w="aborted"),ee(),V.forEach(Ke=>{Ke.status==="pending"&&(Ke.status="aborted")}),V=[]}function Ie(Ke,kt){kt&&(W=[]),typeof Ke=="function"&&W.push(Ke)}function Ee(){return{startTime:a,payload:e,status:w,queriesSent:P,queriesPending:V.length,subscribe:Ie,abort:he}}function Ne(){w="failed",W.forEach(Ke=>{Ke(void 0,k)})}function Ce(){V.forEach(Ke=>{Ke.status==="pending"&&(Ke.status="aborted")}),V=[]}function De(Ke,kt,It){const jt=kt!=="success";switch(V=V.filter(Lt=>Lt!==Ke),w){case"pending":break;case"failed":if(jt||!i.dataAfterTimeout)return;break;default:return}if(kt==="abort"){k=It,Ne();return}if(jt){k=It,V.length||(f.length?Ye():Ne());return}if(ee(),Ce(),!i.random){const Lt=i.resources.indexOf(Ke.resource);Lt!==-1&&Lt!==i.index&&(i.index=Lt)}w="completed",W.forEach(Lt=>{Lt(It)})}function Ye(){if(w!=="pending")return;ee();const Ke=f.shift();if(Ke===void 0){if(V.length){F=setTimeout(()=>{ee(),w==="pending"&&(Ce(),Ne())},i.timeout);return}Ne();return}const kt={status:"pending",resource:Ke,callback:(It,jt)=>{De(kt,It,jt)}};V.push(kt),P++,F=setTimeout(Ye,i.rotate),t(Ke,e,kt.callback)}return setTimeout(Ye),Ee}function HT(i){const e={...iz,...i};let t=[];function r(){t=t.filter(a=>a().status==="pending")}function o(a,w,P){const k=rz(e,a,w,(F,V)=>{r(),P&&P(F,V)});return t.push(k),k}function c(a){return t.find(w=>a(w))||null}return{query:o,find:c,setIndex:a=>{e.index=a},getIndex:()=>e.index,cleanup:r}}function Gv(){}const hm=Object.create(null);function nz(i){if(!hm[i]){const e=fy(i);if(!e)return;const t=HT(e),r={config:e,redundancy:t};hm[i]=r}return hm[i]}function sz(i,e,t){let r,o;if(typeof i=="string"){const c=c_(i);if(!c)return t(void 0,424),Gv;o=c.send;const f=nz(i);f&&(r=f.redundancy)}else{const c=uy(i);if(c){r=HT(c);const f=i.resources?i.resources[0]:"",a=c_(f);a&&(o=a.send)}}return!r||!o?(t(void 0,424),Gv):r.query(e,o,t)().abort}function Yv(){}function oz(i){i.iconsLoaderFlag||(i.iconsLoaderFlag=!0,setTimeout(()=>{i.iconsLoaderFlag=!1,KN(i)}))}function az(i){const e=[],t=[];return i.forEach(r=>{(r.match(OT)?e:t).push(r)}),{valid:e,invalid:t}}function fA(i,e,t){function r(){const o=i.pendingIcons;e.forEach(c=>{o&&o.delete(c),i.icons[c]||i.missing.add(c)})}if(t&&typeof t=="object")try{if(!zT(i,t).length){r();return}}catch(o){console.error(o)}r(),oz(i)}function Qv(i,e){i instanceof Promise?i.then(t=>{e(t)}).catch(()=>{e(null)}):e(i)}function lz(i,e){i.iconsToLoad?i.iconsToLoad=i.iconsToLoad.concat(e).sort():i.iconsToLoad=e,i.iconsQueueFlag||(i.iconsQueueFlag=!0,setTimeout(()=>{i.iconsQueueFlag=!1;const{provider:t,prefix:r}=i,o=i.iconsToLoad;if(delete i.iconsToLoad,!o||!o.length)return;const c=i.loadIcon;if(i.loadIcons&&(o.length>1||!c)){Qv(i.loadIcons(o,r,t),k=>{fA(i,o,k)});return}if(c){o.forEach(k=>{const F=c(k,r,t);Qv(F,V=>{const W=V?{prefix:r,icons:{[k]:V}}:null;fA(i,[k],W)})});return}const{valid:f,invalid:a}=az(o);if(a.length&&fA(i,a,null),!f.length)return;const w=r.match(OT)?c_(t):null;if(!w){fA(i,f,null);return}w.prepare(t,r,f).forEach(k=>{sz(t,k,F=>{fA(i,k.icons,F)})})}))}const cz=(i,e)=>{const t=tz(i,!0,UT()),r=QN(t);if(!r.pending.length){let w=!0;return e&&setTimeout(()=>{w&&e(r.loaded,r.missing,r.pending,Yv)}),()=>{w=!1}}const o=Object.create(null),c=[];let f,a;return r.pending.forEach(w=>{const{provider:P,prefix:k}=w;if(k===a&&P===f)return;f=P,a=k,c.push(cf(P,k));const F=o[P]||(o[P]=Object.create(null));F[k]||(F[k]=[])}),r.pending.forEach(w=>{const{provider:P,prefix:k,name:F}=w,V=cf(P,k),W=V.pendingIcons||(V.pendingIcons=new Set);W.has(F)||(W.add(F),o[P][k].push(F))}),c.forEach(w=>{const P=o[w.provider][w.prefix];P.length&&lz(w,P)}),e?ez(e,r,c):Yv};function uz(i,e){const t={...i};for(const r in e){const o=e[r],c=typeof o;r in jT?(o===null||o&&(c==="string"||c==="number"))&&(t[r]=o):c===typeof t[r]&&(t[r]=r==="rotate"?o%4:o)}return t}const hz=/[\s,]+/;function fz(i,e){e.split(hz).forEach(t=>{switch(t.trim()){case"horizontal":i.hFlip=!0;break;case"vertical":i.vFlip=!0;break}})}function Az(i,e=0){const t=i.replace(/^-?[0-9.]*/,"");function r(o){for(;o<0;)o+=4;return o%4}if(t===""){const o=parseInt(i);return isNaN(o)?0:r(o)}else if(t!==i){let o=0;switch(t){case"%":o=25;break;case"deg":o=90}if(o){let c=parseFloat(i.slice(0,i.length-t.length));return isNaN(c)?0:(c=c/o,c%1===0?r(c):0)}}return e}function dz(i,e){let t=i.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const r in e)t+=" "+r+'="'+e[r]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+t+">"+i+"</svg>"}function pz(i){return i.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function gz(i){return"data:image/svg+xml,"+pz(i)}function mz(i){return'url("'+gz(i)+'")'}const Kv={...VT,inline:!1},_z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},yz={display:"inline-block"},u_={"background-color":"currentColor"},$T={"background-color":"transparent"},Jv={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},ex={"-webkit-mask":u_,mask:u_,background:$T};for(const i in ex){const e=ex[i];for(const t in Jv)e[i+"-"+t]=Jv[t]}function bz(i){return i+(i.match(/^[-0-9.]+$/)?"px":"")}function vz(i,e){const t=uz(Kv,e),r=e.mode||"svg",o=r==="svg"?{..._z}:{};i.body.indexOf("xlink:")===-1&&delete o["xmlns:xlink"];let c=typeof e.style=="string"?e.style:"";for(let Ee in e){const Ne=e[Ee];if(Ne!==void 0)switch(Ee){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":t[Ee]=Ne===!0||Ne==="true"||Ne===1;break;case"flip":typeof Ne=="string"&&fz(t,Ne);break;case"color":c=c+(c.length>0&&c.trim().slice(-1)!==";"?";":"")+"color: "+Ne+"; ";break;case"rotate":typeof Ne=="string"?t[Ee]=Az(Ne):typeof Ne=="number"&&(t[Ee]=Ne);break;case"ariaHidden":case"aria-hidden":Ne!==!0&&Ne!=="true"&&delete o["aria-hidden"];break;default:if(Ee.slice(0,3)==="on:")break;Kv[Ee]===void 0&&(o[Ee]=Ne)}}const f=FN(i,t),a=f.attributes;if(t.inline&&(c="vertical-align: -0.125em; "+c),r==="svg"){Object.assign(o,a),c!==""&&(o.style=c);let Ee=0,Ne=e.id;return typeof Ne=="string"&&(Ne=Ne.replace(/-/g,"_")),{svg:!0,attributes:o,body:jN(f.body,Ne?()=>Ne+"ID"+Ee++:"iconifySvelte")}}const{body:w,width:P,height:k}=i,F=r==="mask"||(r==="bg"?!1:w.indexOf("currentColor")!==-1),V=dz(w,{...a,width:P+"",height:k+""}),ee={"--svg":mz(V)},he=Ee=>{const Ne=a[Ee];Ne&&(ee[Ee]=bz(Ne))};he("width"),he("height"),Object.assign(ee,yz,F?u_:$T);let Ie="";for(const Ee in ee)Ie+=Ee+": "+ee[Ee]+";";return o.style=Ie+c,{svg:!1,attributes:o}}UT(!0);VN("",YN);if(typeof document<"u"&&typeof window<"u"){const i=window;if(i.IconifyPreload!==void 0){const e=i.IconifyPreload,t="Invalid IconifyPreload syntax.";typeof e=="object"&&e!==null&&(e instanceof Array?e:[e]).forEach(r=>{try{(typeof r!="object"||r===null||r instanceof Array||typeof r.icons!="object"||typeof r.prefix!="string"||!MN(r))&&console.error(t)}catch{console.error(t)}})}if(i.IconifyProviders!==void 0){const e=i.IconifyProviders;if(typeof e=="object"&&e!==null)for(let t in e){const r="IconifyProviders["+t+"] is invalid.";try{const o=e[t];if(typeof o!="object"||!o||o.resources===void 0)continue;WN(t,o)||console.error(r)}catch{console.error(r)}}}}function xz(i,e,t,r,o){function c(){e.loading&&(e.loading.abort(),e.loading=null)}if(typeof i=="object"&&i!==null&&typeof i.body=="string")return e.name="",c(),{data:{...x0,...i}};let f;if(typeof i!="string"||(f=v0(i,!1,!0))===null)return c(),null;const a=IN(f);if(!a)return t&&(!e.loading||e.loading.name!==i)&&(c(),e.name="",e.loading={name:i,abort:cz([f],r)}),null;c(),e.name!==i&&(e.name=i,o&&!e.destroyed&&o(i));const w=["iconify"];return f.prefix!==""&&w.push("iconify--"+f.prefix),f.provider!==""&&w.push("iconify--"+f.provider),{data:a,classes:w}}function tx(i,e){return i?vz({...x0,...i},e):null}var wz=DE("<svg><!></svg>"),Tz=Ms("<span></span>");function Ma(i,e){const t=cC(e,["children","$$slots","$$events","$$legacy"]);Go(e,!1);const r=pA({name:"",loading:null,destroyed:!1});let o=pA(!1),c=pA(0),f=pA();const a=V=>{typeof t.onLoad=="function"&&t.onLoad(V),pC()("load",{icon:V})};function w(){oC(c)}h_(()=>{Bi(o,!0)}),Gu(()=>{_g(r,Ue(r).destroyed=!0),Ue(r).loading&&(Ue(r).loading.abort(),_g(r,Ue(r).loading=null))}),rC(()=>(Ue(c),sC(t),Ue(o),Ue(r),Ue(f),tx),()=>{Ue(c);const V=!!t.ssr||Ue(o),W=xz(t.icon,Ue(r),V,w,a);Bi(f,W?tx(W.data,t):null),Ue(f)&&W.classes&&_g(f,Ue(f).attributes.class=(typeof t.class=="string"?t.class+" ":"")+W.classes.join(" "))}),nC(),ux();var P=Vc(),k=qo(P);{var F=V=>{var W=Vc(),ee=qo(W);{var he=Ee=>{var Ne=wz();let Ce;var De=Hi(Ne);xC(De,()=>Ue(f).body,!0),Vi(Ne),so(()=>Ce=s1(Ne,Ce,{...Ue(f).attributes})),pr(Ee,Ne)},Ie=Ee=>{var Ne=Tz();let Ce;so(()=>Ce=s1(Ne,Ce,{...Ue(f).attributes})),pr(Ee,Ne)};ms(ee,Ee=>{Ue(f).svg?Ee(he):Ee(Ie,!1)})}pr(V,W)};ms(k,V=>{Ue(f)&&V(F)})}pr(i,P),Yo()}var Sz=(i,e)=>{e(!1)},Ez=Ms(`<div class="
        absolute top-0 left-0 right-0 bottom-0
        bg-black/75 z-50 pb-4
        flex items-center justify-center overflow-hidden
    "><div class="
            w-11/12 h-3/4 max-w-xl max-h-max
            bg-white rounded shadow
            px-4 py-2 flex flex-col
        "><h1 class="font-semibold text-lg">Disclaimer</h1> <div class="mt-2 p-2 rounded-sm text-sm overflow-y-auto border border-gray-200"><p>This material was prepared as an account of work sponsored by an agency of the United States Government.  Neither the United States Government nor the United States Department of Energy, nor the Contractor, nor any or their employees, nor any jurisdiction or organization that has cooperated in the development of these materials, makes any warranty, express or implied, or assumes any legal liability or responsibility for the accuracy, completeness, or usefulness or any information, apparatus, product, software, or process disclosed, or represents that its use would not infringe privately owned rights.  Reference herein to any specific commercial product, process, or service by trade name, trademark, manufacturer, or otherwise does not necessarily constitute or imply its endorsement, recommendation, or favoring by the United States Government or any agency thereof, or Battelle Memorial Institute. The views and opinions of authors expressed herein do not necessarily state or reflect those of the United States Government or any agency thereof.</p> <p class="mt-4 text-center">PACIFIC NORTHWEST NATIONAL LABORATORY<br> operated by<br> BATTELLE<br> for the<br> UNITED STATES DEPARTMENT OF ENERGY<br> under Contract DE-AC05-76RL01830</p></div> <div class="mt-4 pb-2 flex justify-center md:justify-end"><button class="
                    px-2 py-1 bg-blue-600 text-white text-sm
                    hover:border-blue-500 hover:ring hover:ring-blue-500/20
                    rounded-sm cursor-pointer
                    shadow shadow-black/25 border border-blue-600
                    active:shadow-inner active:shadow-white/25 active:border-blue-700/50
                ">Acknowledge</button></div></div></div>`);function Cz(i,e){Go(e,!0);let t=Yt(e,"show",15);var r=Ez(),o=Hi(r),c=Ti(Hi(o),4),f=Hi(c);f.__click=[Sz,t],Vi(c),Vi(o),Vi(r),pr(i,r),Yo()}ed(["click"]);const Iz=""+new URL("../assets/im3-logo.DhKhMA_4.png",import.meta.url).href,Pz=""+new URL("../assets/doe-os-logo.DWIWPUN9.jpg",import.meta.url).href;var Mz=Ms('<a target="_blank" rel="noreferrer" class="cursor-pointer text-blue-600 underline-offset-2 hover:underline"><!></a>');function ku(i,e){let t=Yt(e,"children",3,void 0);var r=Mz(),o=Hi(r);{var c=a=>{var w=Vc(),P=qo(w);hf(P,()=>t()??uf),pr(a,w)},f=a=>{var w=Al();so(()=>zh(w,e.href)),pr(a,w)};ms(o,a=>{t()?a(c):a(f,!1)})}Vi(r),so(()=>LA(r,"href",e.href)),pr(i,r)}var Rz=(i,e)=>e(1),kz=(i,e)=>e(2),Dz=(i,e)=>e(3),Bz=(i,e)=>e(4),Oz=(i,e)=>e(5),Lz=Ms('<div class="text-xs md:text-sm flex flex-col gap-4 pb-4"><p>The <!> Open Source Data Center Atlas provides locations and facility footprints (when available) of existing data centers across the United States (U.S.). In addition to data center locations, the dashboard also provides complementary information on electricity infrastructure, municipal water supply, and high-speed fiber availability. This dashboard can be used to identify areas of concentrated data center development and inform government and private sector planning strategies for future buildout of data centers and the infrastructure necessary to support it.</p> <p>Data center locations were derived from OpenStreetMap (OSM), an open crowd-sourced database available for reuse <sup class="text-blue-600"><button class="cursor-pointer">[1]</button></sup>. Data centers in the dataset are a mixture of small-scale collocated facilities that might support individual firms and hyperscale data centers that are supporting the widespread expansion of computing for Artificial Intelligence (AI). Data points from OSM have been processed to determine additional variables provided in the dataset including facility area (square feet) and associated U.S. county and U.S. state <sup class="text-blue-600"><button class="cursor-pointer">[2]</button></sup>. The post-processed dataset has been made available for reuse (see citation below).</p> <p>We include additional data layers that provide context for why data centers might be located in certain areas. Transmission line data was collected from the Homeland Infrastructure Foundation-Level Data (HIFLD) <sup class="text-blue-600"><button class="cursor-pointer">[3]</button></sup> and shows lines across a range of voltages. Public supply water service areas were collected from data provided by the U.S. Geological Survey (USGS) <sup class="text-blue-600"><button class="cursor-pointer">[4]</button></sup>. Water supply areas spatially represent where customers are served by each public water supplier. Fiber availability is derived from information in the Federal Communications Commissionâs (FCC) National Broadband Map <sup class="text-blue-600"><button class="cursor-pointer">[5]</button></sup>. This layer shows the number of fiber service providers capable of delivering greater than or equal to 1 Gbps of fiber service to customers in each area.</p> <p>If you use this data in a downstream application, please use the following citation:</p> <p class="ml-1 pl-2 border-l-3 border-l-[#d77900] rounded text-xs italic">Mongird, <span class="cursor-[url(/minesheep.png),auto]">K</span>., Thurber, T., Vernon, C., Burleyson, C., Akdemir, K. Z., & Rice, J. (2025). IM3 Open Source Data Center Atlas (Version v1) [Data set]. MSD-LIVE Data Repository. <!></p> <p>Additionally, because of the Open Database License (ODbL) license applied to the OSM dataset any derivative datasets intended for reuse should continue to apply the ODbL license.</p> <p class="font-medium">References:</p> <div class="flex flex-col gap-2 text-xs italic"><span id="ref-1" class="flex flex-row gap-2"><span>[1]</span> <span>OpenStreetMap contributors (2025). OpenStreetMap [Data set]. OpenStreetMap Foundation. Available as open data under the Open Data Commons Open Database License (ODbL) at <!>.</span></span> <span id="ref-2" class="flex flex-row gap-2"><span>[2]</span> <span>US Census Bureau (2024). TIGER/Line Shapefiles. U.S. Department of Commerce. <!>.</span></span> <span id="ref-3" class="flex flex-row gap-2"><span>[3]</span> <span>HIFLD (2025). Transmission Lines. Geospatial Management Office. Available at <!>.</span></span> <span id="ref-4" class="flex flex-row gap-2"><span>[4]</span> <span>Buchwald, C.A., Houston, N.A., Stewart, J.S., York, B.C., and Valseth, K.J., (2022). Public-supply water service areas within the conterminous United States, 2017, U.S. Geological Survey data release: <!>.</span></span> <span id="ref-5" class="flex flex-row gap-2"><span>[5]</span> <span>FCC (2025). National Broadband Map. Available at: <!>.</span></span></div> <p class="font-medium">Acknowledgements:</p> <div class="flex flex-row flex-wrap gap-2"><a class="cursor-pointer" href="https://im3.pnnl.gov" target="_blank" rel="noreferrer"><img class="h-32 object-contain" alt=""></a> <a class="cursor-pointer" href="https://www.energy.gov/science/office-science" target="_blank" rel="noreferrer"><img class="h-32 object-contain" alt=""></a></div> <p class="text-xs italic">This data was collected by the IM3 project which is supported by the U.S. Department of Energy, Office of Science, as part of research in MultiSector Dynamics.</p></div>');function Fz(i){const e=Ai=>{const oi=document==null?void 0:document.getElementById(`ref-${Ai}`);oi&&(oi.scrollIntoView({behavior:"smooth"}),oi.style.transition="none",oi.style.backgroundColor="rgba(255,222,33,0.5)",setTimeout(()=>{oi.style.transition="background 3s",oi.style.backgroundColor=""},200))};var t=Lz(),r=Hi(t),o=Ti(Hi(r));ku(o,{href:"https://im3.pnnl.gov",children:(Ai,oi)=>{jn();var Zi=Al("IM3");pr(Ai,Zi)},$$slots:{default:!0}}),jn(),Vi(r);var c=Ti(r,2),f=Ti(Hi(c)),a=Hi(f);a.__click=[Rz,e],Vi(f);var w=Ti(f,2),P=Hi(w);P.__click=[kz,e],Vi(w),jn(),Vi(c);var k=Ti(c,2),F=Ti(Hi(k)),V=Hi(F);V.__click=[Dz,e],Vi(F);var W=Ti(F,2),ee=Hi(W);ee.__click=[Bz,e],Vi(W);var he=Ti(W,2),Ie=Hi(he);Ie.__click=[Oz,e],Vi(he),jn(),Vi(k);var Ee=Ti(k,4),Ne=Ti(Hi(Ee),3);ku(Ne,{href:"https://doi.org/10.57931/2550666"}),Vi(Ee);var Ce=Ti(Ee,6),De=Hi(Ce),Ye=Ti(Hi(De),2),Ke=Ti(Hi(Ye));ku(Ke,{href:"https://openstreetmap.org"}),jn(),Vi(Ye),Vi(De);var kt=Ti(De,2),It=Ti(Hi(kt),2),jt=Ti(Hi(It));ku(jt,{href:"https://www.census.gov/cgi-bin/geo/shapefiles/index.php"}),jn(),Vi(It),Vi(kt);var Lt=Ti(kt,2),Mt=Ti(Hi(Lt),2),vi=Ti(Hi(Mt));ku(vi,{href:"https://hifld-geoplatform.hub.arcgis.com/datasets/geoplatform::transmission-lines-1/about"}),jn(),Vi(Mt),Vi(Lt);var Xt=Ti(Lt,2),Jt=Ti(Hi(Xt),2),zi=Ti(Hi(Jt));ku(zi,{href:"https://doi.org/10.5066/P9I22Z24"}),jn(),Vi(Jt),Vi(Xt);var Fe=Ti(Xt,2),tt=Ti(Hi(Fe),2),Me=Ti(Hi(tt));ku(Me,{href:"https://broadbandmap.fcc.gov/home"}),jn(),Vi(tt),Vi(Fe),Vi(Ce);var dt=Ti(Ce,4),vt=Hi(dt),Pt=Hi(vt);LA(Pt,"src",Iz),Vi(vt);var Ct=Ti(vt,2),ei=Hi(Ct);LA(ei,"src",Pz),Vi(Ct),Vi(dt),jn(2),Vi(t),pr(i,t)}ed(["click"]);var Nz=Ms(`<a href="https://doi.org/10.57931/2550666" class="
                block font-bold text-base text-gray-800 hover:text-blue-600
                px-4 py-2 cursor-pointer uppercase w-full text-start
            " target="_blank" rel="noreferrer"><!> Get the Data</a>`),zz=(i,e)=>{e(!e())},Uz=Ms(`<button class="
                font-bold text-base text-gray-800 hover:text-blue-600
                px-4 py-2 cursor-pointer uppercase w-full text-start
            "><!> </button> <div class="px-4 py-2"><!></div>`,1),jz=Ms("<div><!></div>");function fm(i,e){Go(e,!0);let t=Yt(e,"label",3,""),r=Yt(e,"children",3,void 0),o=Yt(e,"expanded",15,!0),c=Yt(e,"downloado",3,!1),f=xr(0);var a=jz();let w;var P=Hi(a);{var k=V=>{var W=Nz(),ee=Hi(W);Ma(ee,{class:"inline-block",inline:!0,icon:"ph:arrow-square-out-bold"}),jn(),Vi(W),pr(V,W)},F=V=>{var W=Uz(),ee=qo(W);ee.__click=[zz,o];var he=Hi(ee);const Ie=fr(()=>o()?"ph:caret-down-bold":"ph:caret-right-bold");Ma(he,{class:"inline-block",inline:!0,get icon(){return Ue(Ie)}});var Ee=Ti(he);Vi(ee);var Ne=Ti(ee,2),Ce=Hi(Ne);hf(Ce,()=>r()??uf),Vi(Ne),so(()=>zh(Ee,` ${t()??""}`)),PC(Ne,"clientHeight",De=>Bi(f,De)),pr(V,W)};ms(P,V=>{c()?V(k):V(F,!1)})}Vi(a),so(V=>{w=Oc(a,1,`
        border-t border-t-gray-200
        overflow-hidden transition-[height]
    `,null,w,V),A_(a,`height:${!c()&&o()?`calc(2.5rem + ${Ue(f)}px)`:""}`)},[()=>({"h-10":c()||!o()})]),pr(i,a),Yo()}ed(["click"]);var Vz=Ms('<div><span class="text-white text-[0.67rem] font-semibold"><!></span></div>');function AA(i,e){let t=Yt(e,"heightREM",3,1.25),r=Yt(e,"backgroundColorRGBA",3,"rgba(50,50,50,255)");Yt(e,"borderColorRGBA",3,"rgba(0,0,0,255)");let o=Yt(e,"children",3,void 0),c=Yt(e,"class",3,"");var f=Vz(),a=Hi(f),w=Hi(a);hf(w,()=>o()??uf),Vi(a),Vi(f),so(()=>{A_(f,`
        height: ${t()??""}rem;
        background-color: ${r()??""};
        aspect-ratio: 1/cos(30deg);
        clip-path: polygon(50% -50%, 100% 50%, 50% 150%, 0 50%);
        display: flex;
        align-items: center;
        justify-content: center;
    `),Oc(f,1,f_(c()))}),pr(i,f)}var Wz=(i,e)=>{e(!e())},Hz=(i,e)=>{e(!e())},$z=(i,e)=>{e(!e())},Zz=(i,e)=>{e(!e())},qz=Ms(`<div class="pb-2"><button class="cursor-pointer flex flex-row gap-1 md:gap-2 items-center w-full h-8"><!> <span>Existing Data Centers</span> <!> <div class="ml-auto h-4 md:h-5 w-4 md:w-5 rounded-full bg-[#54278f] border border-solid border-[#3f007d]"></div> <div class="h-4 md:h-5 w-6 md:w-8 rounded-xs bg-[#54278f] border border-solid border-[#3f007d] text-white font-semibold text-[0.5rem] md:text-[0.67rem]">Bldg</div> <div class="h-4 md:h-5 w-6 md:w-8 rounded-xs bg-[rgb(65,171,93)]/50 border border-solid border-[#41ab5d] text-white font-semibold text-[0.5rem] md:text-[0.67rem]">Land</div></button> <button class="flex flex-row gap-2 items-center w-full h-8" disabled><!> <span class="
                text-xs md:text-sm
                text-gray-500 italic
            ">Projected Data Centers <span class="hidden md:inline">(coming soon!)</span><span class="md:hidden inline">(TBD)</span></span> <div class="ml-auto h-4 md:h-5 w-4 md:w-5 rounded-full bg-[#acacac]/25 border border-solid border-[#acacac]/50"></div> <div class="h-4 md:h-5 w-12 md:w-18 rounded-xs bg-[#acacac]/25 border border-solid border-[#acacac]/50 text-white font-semibold text-[0.5rem] md:text-[0.67rem]"></div></button> <button class="cursor-pointer flex flex-row gap-2 items-center w-full h-8"><!> <span>Municipal Water <span class="hidden md:inline">Service</span> Areas</span> <!> <div class="ml-auto h-4 md:h-5 w-18 md:w-25 rounded-xs bg-[#2c7fb8]/25 border border-solid border-[#2c7fb8]/25"></div></button> <button class="cursor-pointer flex flex-row gap-2 items-center w-full h-8"><!> <span>Transmission Lines</span> <!> <div class="ml-auto h-1 w-18 md:w-25 rounded-xs bg-[rgb(254,217,118)]"></div></button> <button class="cursor-pointer flex flex-row gap-2 items-center w-full h-8"><!> <span><span class="hidden md:inline">High Speed</span> Fiber Provider Density</span> <!> <div class="ml-auto flex flex-row items-center"><!> <!> <!> <!> <!></div></button></div>`);function Xz(i,e){Go(e,!0);let t=Yt(e,"existingDataCenterOn",15,!0);Yt(e,"existingDataCenterCampusOn",11,!0),Yt(e,"projectedDataCenterOn",11,!0);let r=Yt(e,"fiberOn",15,!0),o=Yt(e,"municipalWaterOn",15,!0),c=Yt(e,"transmissionOn",15,!0),f=Yt(e,"existingDataCenterLoaded",3,!0),a=Yt(e,"fiberLoaded",3,!0),w=Yt(e,"municipalWaterLoaded",3,!0),P=Yt(e,"transmissionLoaded",3,!0);var k=qz(),F=Hi(k);F.__click=[Wz,t];var V=Hi(F);const W=fr(()=>f()&&t()?"text-blue-600":"text-gray-500"),ee=fr(()=>f()?t()?"proicons:checkbox-checked":"proicons:checkbox-unchecked":"proicons:checkbox-indeterminate");Ma(V,{inline:!0,get class(){return`
                w-4 md:w-6 h-4 md:h-6 shrink-0
                ${Ue(W)??""}
            `},get icon(){return Ue(ee)}});var he=Ti(V,2),Ie=Ti(he,2);{var Ee=Fi=>{Ma(Fi,{inline:!0,class:"text-[#d77900] shrink-0",icon:"line-md:downloading-loop"})};ms(Ie,Fi=>{f()||Fi(Ee)})}jn(6),Vi(F);var Ne=Ti(F,2),Ce=Hi(Ne);Ma(Ce,{inline:!0,class:`
                w-4 md:w-6 h-4 md:h-6 shrink-0
                text-gray-500
            `,icon:"proicons:checkbox-indeterminate"}),jn(6),Vi(Ne);var De=Ti(Ne,2);De.__click=[Hz,o];var Ye=Hi(De);const Ke=fr(()=>w()&&o()?"text-blue-600":"text-gray-500"),kt=fr(()=>w()?o()?"proicons:checkbox-checked":"proicons:checkbox-unchecked":"proicons:checkbox-indeterminate");Ma(Ye,{inline:!0,get class(){return`
                w-4 md:w-6 h-4 md:h-6 shrink-0
                ${Ue(Ke)??""}
            `},get icon(){return Ue(kt)}});var It=Ti(Ye,2),jt=Ti(It,2);{var Lt=Fi=>{Ma(Fi,{inline:!0,class:"text-[#d77900] w-4 md:w-6 h-4 md:h-6 shrink-0",icon:"line-md:downloading-loop"})};ms(jt,Fi=>{w()||Fi(Lt)})}jn(2),Vi(De);var Mt=Ti(De,2);Mt.__click=[$z,c];var vi=Hi(Mt);const Xt=fr(()=>P()&&c()?"text-blue-600":"text-gray-500"),Jt=fr(()=>P()?c()?"proicons:checkbox-checked":"proicons:checkbox-unchecked":"proicons:checkbox-indeterminate");Ma(vi,{inline:!0,get class(){return`
                w-4 md:w-6 h-4 md:h-6 shrink-0
                ${Ue(Xt)??""}
            `},get icon(){return Ue(Jt)}});var zi=Ti(vi,2),Fe=Ti(zi,2);{var tt=Fi=>{Ma(Fi,{inline:!0,class:"text-[#d77900] w-4 md:w-6 h-4 md:h-6 shrink-0",icon:"line-md:downloading-loop"})};ms(Fe,Fi=>{P()||Fi(tt)})}jn(2),Vi(Mt);var Me=Ti(Mt,2);Me.__click=[Zz,r];var dt=Hi(Me);const vt=fr(()=>a()&&r()?"text-blue-600":"text-gray-500"),Pt=fr(()=>a()?r()?"proicons:checkbox-checked":"proicons:checkbox-unchecked":"proicons:checkbox-indeterminate");Ma(dt,{inline:!0,get class(){return`
                w-4 md:w-6 h-4 md:h-6 shrink-0
                ${Ue(vt)??""}
            `},get icon(){return Ue(Pt)}});var Ct=Ti(dt,2),ei=Ti(Ct,2);{var Ai=Fi=>{Ma(Fi,{inline:!0,class:"text-[#d77900] w-4 md:w-6 h-4 md:h-6 shrink-0",icon:"line-md:downloading-loop"})};ms(ei,Fi=>{a()||Fi(Ai)})}var oi=Ti(ei,2),Zi=Hi(oi);AA(Zi,{backgroundColorRGBA:"rgba(244, 163, 168, 64)",children:(Fi,wr)=>{jn();var sr=Al("1");pr(Fi,sr)},$$slots:{default:!0}});var Oi=Ti(Zi,2);AA(Oi,{backgroundColorRGBA:"rgba(227, 129, 145, 64)",class:"mt-4 -ml-1",children:(Fi,wr)=>{jn();var sr=Al("2");pr(Fi,sr)},$$slots:{default:!0}});var Li=Ti(Oi,2);AA(Li,{backgroundColorRGBA:"rgba(204,  96, 125, 64)",class:"-ml-1",children:(Fi,wr)=>{jn();var sr=Al("5");pr(Fi,sr)},$$slots:{default:!0}});var Ar=Ti(Li,2);AA(Ar,{backgroundColorRGBA:"rgba(173,  70, 108, 64)",class:"mt-4 -ml-1",children:(Fi,wr)=>{jn();var sr=Al("10");pr(Fi,sr)},$$slots:{default:!0}});var Yi=Ti(Ar,2);AA(Yi,{backgroundColorRGBA:"rgba(139,  48,  88, 64)",class:"-ml-1",children:(Fi,wr)=>{jn();var sr=Al("25");pr(Fi,sr)},$$slots:{default:!0}}),Vi(oi),Vi(Me),Vi(k),so(()=>{F.disabled=!f(),Oc(he,1,`
                text-xs md:text-sm ml-1 md:ml-0
                ${f()&&t()?"text-black":"text-gray-500"}
            `),De.disabled=!w(),Oc(It,1,`
                text-xs md:text-sm
                ${w()&&o()?"text-black":"text-gray-500"}
            `),Mt.disabled=!P(),Oc(zi,1,`
                text-xs md:text-sm
                ${P()&&c()?"text-black":"text-gray-500"}
            `),Me.disabled=!a(),Oc(Ct,1,`
                text-xs md:text-sm
                ${a()&&r()?"text-black":"text-gray-500"}
            `)}),pr(i,k),Yo()}ed(["click"]);var Gz=Ms('<div class="sv-popup"><!></div>');function Yz(i,e){Go(e,!0);let t=Yt(e,"closeButton",3,void 0),r=Yt(e,"closeOnClickOutside",3,!0),o=Yt(e,"closeOnClickInside",3,!1),c=Yt(e,"closeOnMove",3,!1),f=Yt(e,"openOn",3,"click"),a=Yt(e,"openIfTopMost",3,!0),w=Yt(e,"focusAfterOpen",3,!0),P=Yt(e,"anchor",3,void 0),k=Yt(e,"offset",3,void 0),F=Yt(e,"popupClass",3,void 0),V=Yt(e,"maxWidth",3,void 0),W=Yt(e,"lngLat",15,void 0),ee=Yt(e,"html",3,void 0),he=Yt(e,"open",15,!1),Ie=Yt(e,"onopen",3,void 0),Ee=Yt(e,"onclose",3,void 0),Ne=Yt(e,"onhover",3,void 0),Ce=jC();const De=fr(ff),Ye=fr(()=>Ue(De).map),Ke=fr(()=>Ue(De).eventTopMost),kt=fr(()=>Ue(De).markerClickManager),It=fr(()=>Ue(De).loaded),jt=FC(),Lt=UC(),Mt=zC(),vi=["click","dblclick","contextmenu"];let Xt=xr(void 0),Jt=xr(!1),zi=xr(void 0);function Fe(){if(!Ue(Xt))return;let Vt=Ue(Xt).getElement();!Vt||Vt===Ue(zi)||(Bi(zi,Vt,!0),f()==="hover"&&(Ue(zi).style.pointerEvents="none"),Ue(zi).addEventListener("mouseenter",()=>{Bi(Jt,!0)},{passive:!0}),Ue(zi).addEventListener("mouseleave",()=>{Bi(Jt,!1)},{passive:!0}),Ue(zi).addEventListener("click",()=>{o()&&he(!1)},{passive:!0}))}h_(()=>{if(Ue(Ye))return Ue(Ye).on("click",Li),Ue(Ye).on("contextmenu",Li),Ue(kt).add(Ar),typeof(Mt==null?void 0:Mt.value)=="string"&&(Ue(Ye).on("click",Mt.value,Ct),Ue(Ye).on("dblclick",Mt.value,Ct),Ue(Ye).on("contextmenu",Mt.value,Ct),Ue(Ye).on("mousemove",Mt.value,Oi),Ue(Ye).on("mouseleave",Mt.value,Zi),Ue(Ye).on("touchstart",Mt.value,Ai),Ue(Ye).on("touchend",Mt.value,oi)),()=>{var Vt;Ue(It)&&((Vt=Ue(Xt))==null||Vt.remove(),Ue(Ye).off("click",Li),Ue(Ye).off("contextmenu",Li),Ue(kt).remove(Ar),(Mt==null?void 0:Mt.value)instanceof Wo.Marker?Mt.value.getPopup()===Ue(Xt)&&Mt.value.setPopup(void 0):typeof(Mt==null?void 0:Mt.value)=="string"&&(Ue(Ye).off("click",Mt.value,Ct),Ue(Ye).off("dblclick",Mt.value,Ct),Ue(Ye).off("contextmenu",Mt.value,Ct),Ue(Ye).off("mousemove",Mt.value,Oi),Ue(Ye).off("mouseleave",Mt.value,Zi),Ue(Ye).off("touchstart",Mt.value,Ai),Ue(Ye).off("touchend",Mt.value,oi)))}});function tt(){if(e.canOpen&&!e.canOpen(Ue(dt))){he(!1);return}he(!0)}function Me(Vt){return a()?!("marker"in Vt)&&!$C(Vt)&&Ue(Ke)(Vt)!==(jt==null?void 0:jt.value):!1}let dt=xr(void 0),vt=xr("normal");function Pt(Vt){"layerType"in Vt&&Vt.layerType==="deckgl"?(W(Vt.coordinate),Bi(dt,Vt.object?[Vt.object]:void 0,!0)):(W(Vt.lngLat),Bi(dt,Vt.features??[],!0))}function Ct(Vt){Vt.type!==f()||Me(Vt)||(Pt(Vt),setTimeout(tt))}let ei;function Ai(Vt){ei=Vt.point}function oi(Vt){var Pi;if(!ei||f()!=="hover")return;let zt=ei.dist(Vt.point);ei=void 0,zt<3&&(W(Vt.lngLat),Bi(dt,Vt.features??[],!0),(Pi=Ue(Xt))!=null&&Pi.isOpen()?Bi(vt,"justOpened"):(Bi(vt,"opening"),tt()))}function Zi(Vt){f()!=="hover"||ei||Ue(vt)!=="normal"||(he(!1),Bi(dt,void 0))}function Oi(Vt){if(!(f()!=="hover"||ei||Ue(vt)!=="normal")){if(Me(Vt)){he(!1),Bi(dt,void 0);return}Bi(dt,Vt.features??[],!0),W(Vt.lngLat),tt()}}function Li(Vt){var Pi,dr;if(Ue(vt)==="justOpened"){Bi(vt,"normal");return}if(!r())return;let zt=[Ue(zi),(Mt==null?void 0:Mt.value)instanceof Wo.Marker?(Pi=Mt.value)==null?void 0:Pi.getElement():void 0];he()&&((dr=Ue(Xt))!=null&&dr.isOpen())&&!zt.some(tr=>tr==null?void 0:tr.contains(Vt.originalEvent.target))&&(Vt.type==="contextmenu"&&f()==="contextmenu"||Vt.type!=="contextmenu")&&he(!1)}function Ar(Vt){var zt;r()&&he()&&((zt=Ue(Xt))!=null&&zt.isOpen())&&Vt.marker!==(Mt==null?void 0:Mt.value)&&he(!1)}Gu(()=>{var Vt;Ue(It)&&((Vt=Ue(Xt))!=null&&Vt.isOpen())&&Ue(Xt).remove()});let Yi=xr(void 0),Fi=fr(()=>t()??(!r()&&!o()));Vn(()=>{if(!Ue(Xt)){let Vt=F()?`${F()} sv-maplibregl-popup`:"sv-maplibregl-popup";Bi(Xt,new Wo.Popup({closeButton:Ue(Fi),closeOnClick:!1,closeOnMove:c(),focusAfterOpen:w(),maxWidth:V(),className:Vt,anchor:P(),offset:k()}),!0),Bi(zi,Ue(Xt).getElement(),!0),Ue(Xt).on("open",()=>{var zt;tt(),he()&&(Fe(),(zt=Ie())==null||zt(Ue(Xt)))}),Ue(Xt).on("close",()=>{var zt;he(!1),(zt=Ee())==null||zt(Ue(Xt))}),Ne()&&Ue(Xt).on("hover",()=>{var zt;(zt=Ne())==null||zt(Ue(Xt))})}}),Vn(()=>{Ue(Xt)&&(Mt==null?void 0:Mt.value)instanceof Wo.Marker&&(f()==="click"?Mt.value.setPopup(Ue(Xt)):Mt.value.getPopup()===Ue(Xt)&&Mt.value.setPopup(void 0))}),Vn(()=>{var Vt;vi.includes(f())&&((Vt=Lt.value)==null?void 0:Vt.type)===f()&&(Ct(Lt.value),Lt.value=void 0)});let wr=fr(()=>{var Vt,zt;return f()==="hover"&&(((Vt=Lt.value)==null?void 0:Vt.type)==="mousemove"||((zt=Lt.value)==null?void 0:zt.type)==="mouseenter")});Vn(()=>{f()==="hover"&&Lt&&(Ue(wr)&&Lt.value&&Pt(Lt.value),Ue(wr)||Ue(Jt)?tt():he(!1))}),Vn(()=>{var Vt,zt;Ue(Yi)?(Vt=Ue(Xt))==null||Vt.setDOMContent(Ue(Yi)):ee()&&((zt=Ue(Xt))==null||zt.setHTML(ee()))}),Vn(()=>{var zt;let Vt=W()??(Ce==null?void 0:Ce.value)??void 0;Vt&&((zt=Ue(Xt))==null||zt.setLngLat(Vt))}),Vn(()=>{if(Ue(Ye)&&Ue(Xt)){let Vt=Ue(Xt).isOpen();he()&&!Vt?(Ue(Xt).addTo(Ue(Ye)),Ue(vt)==="opening"&&Bi(vt,"justOpened")):!he()&&Vt&&Ue(Xt).remove()}});var sr=Vc(),ur=qo(sr);{var qi=Vt=>{var zt=Gz(),Pi=Hi(zt);{var dr=tr=>{var or=Vc(),Tn=qo(or);hf(Tn,()=>e.children??uf,()=>{var rs;return{features:Ue(dt),data:((rs=Ue(dt))==null?void 0:rs[0])??void 0,map:Ue(Ye),close:()=>he(!1)}}),pr(tr,or)};ms(Pi,tr=>{var or;((or=Ue(dt))!=null&&or.length||(Mt==null?void 0:Mt.value)instanceof Wo.Marker||!Mt&&he())&&tr(dr)})}Vi(zt),cx(zt,tr=>Bi(Yi,tr),()=>Ue(Yi)),pr(Vt,zt)};ms(ur,Vt=>{e.children&&Vt(qi)})}pr(i,sr),Yo()}var Qz=Ms('<div class="flex flex-col items-start"><p class="text-[0.67rem] whitespace-nowrap uppercase leading-none text-gray-700"> </p> <p class="text-base text-black leading-tight"><!></p></div>'),Kz=Ms('<div class="flex flex-col gap-2 w-40"></div>');function Nh(i,e){Go(e,!1);const t={name:"Name",operator:"Operator",state_abb:"State",county:"County",sqft:"Footprint sq ft",VOLT_CLASS:"Voltage Class (kV)",WSA_NAME:"Water Service Area Name",provider_count:"High Speed Fiber Providers"};ux(),Yz(i,{openOn:"click",children:(o,c)=>{let f=()=>c==null?void 0:c().data;var a=Kz();yC(a,5,()=>Object.keys(t),mC,(w,P)=>{var k=Vc(),F=qo(k);{var V=W=>{var ee=Qz(),he=Hi(ee),Ie=Hi(he,!0);Vi(he);var Ee=Ti(he,2),Ne=Hi(Ee);{var Ce=Ye=>{var Ke=Al();so(kt=>zh(Ke,kt),[()=>Math.round(f().properties[Ue(P)]).toLocaleString()],ix),pr(Ye,Ke)},De=(Ye,Ke)=>{{var kt=jt=>{var Lt=Al();so(()=>zh(Lt,f()[Ue(P)]>25?"25+":f()[Ue(P)])),pr(jt,Lt)},It=jt=>{var Lt=Al();so(()=>{var Mt;return zh(Lt,(Mt=f().properties)==null?void 0:Mt[Ue(P)])}),pr(jt,Lt)};ms(Ye,jt=>{Ue(P)==="provider_count"?jt(kt):jt(It,!1)},Ke)}};ms(Ne,Ye=>{Ue(P)==="sqft"?Ye(Ce):Ye(De,!1)})}Vi(Ee),Vi(ee),so(()=>zh(Ie,t[Ue(P)])),pr(W,ee)};ms(F,W=>{var ee;((ee=f().properties)!=null&&ee[Ue(P)]||f()[Ue(P)])&&W(V)})}pr(w,k)}),Vi(a),pr(o,a)},$$slots:{default:!0}}),Yo()}var Jz=Ms("<!> <!> <!> <!> <!> <!>",1),eU=Ms('<div class="w-screen h-screen max-h-screen overflow-hidden relative"><div class="absolute top-0 left-0 overflow-auto max-h-screen py-1 md:py-2 pl-1 md:pl-2 pr-2 md:pr-3 w-80 md:w-[31rem] z-10"><div class="bg-white rounded shadow w-full pt-1 md:pt-2 border border-gray-200"><div class="flex flex-row items-center justify-between px-2 md:px-4"><h1 class="font-semibold text-base md:text-xl text-black"><span class="font-montserrat text-lg md:text-2xl mr-0.5 md:mr-1">IM<sub>3</sub></span> Open Source Data Center Atlas</h1></div> <div class="mt-1 md:mt-2 mb-2 md:mb-4 px-2 md:px-4"><span class="text-xs md:text-base text-black"><span class="hidden md:inline">Explore data center locations and supporting infrastructure.</span> <span class="md:hidden inline">Data centers and supporting infrastructure.</span></span></div> <!> <!> <!></div></div> <div class="w-full h-full"><!></div> <!></div>');function wU(i){const e=It=>{const jt=[1,2,5,10,25],Lt=[[255,198,196,64],[244,163,168,64],[227,129,145,64],[204,96,125,64],[173,70,108,64],[139,48,88,64]],Mt=It.provider_count;let vi=Lt[Lt.length-1];return jt.some((Xt,Jt)=>Mt<Xt?(vi=Lt[Jt],!0):!1),vi};let t=xr(!0),r=xr(!1),o=xr(!0),c=xr(!0),f=!1,a=xr(!0),w=xr(!0),P=xr(!0),k=xr(!1),F=xr(!1),V=xr(!1),W=xr(!1);var ee=eU(),he=Hi(ee),Ie=Hi(he),Ee=Ti(Hi(Ie),4);fm(Ee,{label:"Layers",get expanded(){return Ue(o)},set expanded(It){Bi(o,It,!0)},children:(It,jt)=>{Xz(It,{projectedDataCenterOn:f,get existingDataCenterLoaded(){return Ue(k)},get municipalWaterLoaded(){return Ue(F)},get fiberLoaded(){return Ue(V)},get transmissionLoaded(){return Ue(W)},get existingDataCenterOn(){return Ue(c)},set existingDataCenterOn(Lt){Bi(c,Lt,!0)},get municipalWaterOn(){return Ue(a)},set municipalWaterOn(Lt){Bi(a,Lt,!0)},get fiberOn(){return Ue(w)},set fiberOn(Lt){Bi(w,Lt,!0)},get transmissionOn(){return Ue(P)},set transmissionOn(Lt){Bi(P,Lt,!0)}})},$$slots:{default:!0}});var Ne=Ti(Ee,2);fm(Ne,{label:"About",get expanded(){return Ue(r)},set expanded(It){Bi(r,It,!0)},children:(It,jt)=>{Fz(It)},$$slots:{default:!0}});var Ce=Ti(Ne,2);fm(Ce,{downloado:!0}),Vi(Ie),Vi(he);var De=Ti(he,2),Ye=Hi(De);hI(Ye,{style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",class:"w-full h-full",maxBounds:[[-170,15],[-40,60]],dragRotate:!1,pitchWithRotate:!1,standardControls:"bottom-right",children:(It,jt)=>{var Lt=Jz(),Mt=qo(Lt);Rh(Mt,{id:"transmission_lines",get visible(){return Ue(P)},type:DA,data:`${Mh}/tiles/transmission/metadata.json`,getLineColor:[254,217,118],getLineWidth:1,lineWidthUnits:"pixels",tileSize:256,minZoom:0,maxZoom:8,maxzoom:10,extent:[-159.779336,13.447581,144.823499,65.01721],parameters:{depthTest:!1},onDataLoad:()=>{Bi(W,!0)},children:(Me,dt)=>{Nh(Me,{})},$$slots:{default:!0}});var vi=Ti(Mt,2);Rh(vi,{id:"transmission_lines",get visible(){return Ue(P)},type:DA,data:`${Mh}/tiles/transmission/metadata.json`,getLineColor:[254,217,118],getLineWidth:2,lineWidthUnits:"pixels",tileSize:256,minZoom:0,maxZoom:8,minzoom:10,extent:[-159.779336,13.447581,144.823499,65.01721],parameters:{depthTest:!1},onDataLoad:()=>{Bi(W,!0)},beforeLayerType:"symbol",beforeId:"data_center_points",children:(Me,dt)=>{Nh(Me,{})},$$slots:{default:!0}});var Xt=Ti(vi,2);Rh(Xt,{id:"fiber_providers",get visible(){return Ue(w)},stroked:!1,filled:!0,extruded:!1,type:bf,data:`${Mh}/fiber_providers_commercial_h3.json`,getLineColor:e,getFillColor:e,getLineWidth:1,lineWidthUnits:"pixels",parameters:{depthTest:!1},onDataLoad:()=>{Bi(V,!0)},children:(Me,dt)=>{Nh(Me,{})},$$slots:{default:!0}});var Jt=Ti(Xt,2);Rh(Jt,{id:"water_providers",get visible(){return Ue(a)},stroked:!1,type:DA,data:`${Mh}/tiles/usgs_water_supply/metadata.json`,getFillColor:[44,127,184,64],tileSize:256,minZoom:0,maxZoom:11,extent:[-124.513131,24.544502,-66.980034,49.002403],parameters:{depthTest:!1},onDataLoad:()=>{Bi(F,!0)},children:(Me,dt)=>{Nh(Me,{})},$$slots:{default:!0}});var zi=Ti(Jt,2);{var Fe=Me=>{Rh(Me,{id:"data_center_points",get visible(){return Ue(c)},type:qu,data:`${Mh}/im3_datacenter_centroids.geojson`,getLineColor:[63,0,125],getFillColor:[84,39,143],getLineWidth:1,getPointRadius:4,lineWidthUnits:"pixels",pointRadiusUnits:"pixels",maxzoom:11,parameters:{depthTest:!1},onDataLoad:()=>{Bi(k,!0)},children:(dt,vt)=>{Nh(dt,{})},$$slots:{default:!0}})};ms(zi,Me=>{Ue(W)&&Me(Fe)})}var tt=Ti(zi,2);Rh(tt,{id:"data_center_footprints",get visible(){return Ue(c)},type:qu,data:`${Mh}/im3_datacenter_footprints.geojson`,getLineColor:Me=>{var dt;return((dt=Me==null?void 0:Me.properties)==null?void 0:dt.type)==="campus"?[35,132,67]:[63,0,125]},getFillColor:Me=>{var dt;return((dt=Me==null?void 0:Me.properties)==null?void 0:dt.type)==="campus"?[65,171,93,128]:[84,39,143]},getPointRadius:4,getLineWidth:1,lineWidthUnits:"pixels",pointRadiusUnits:"pixels",minzoom:11,parameters:{depthTest:!1},children:(Me,dt)=>{Nh(Me,{})},$$slots:{default:!0}}),pr(It,Lt)},$$slots:{default:!0}}),Vi(De);var Ke=Ti(De,2);{var kt=It=>{Cz(It,{get show(){return Ue(t)},set show(jt){Bi(t,jt,!0)}})};ms(Ke,It=>{Ue(t)&&It(kt)})}Vi(ee),pr(i,ee)}export{zm as $,v3 as A,Ou as B,Cr as C,_p as D,U_ as E,Uc as F,Vl as G,rf as H,f6 as I,Mp as J,Hu as K,yD as L,Eo as M,mU as N,I3 as O,pU as P,Nb as Q,hr as R,wm as S,Zk as T,xU as U,wi as V,gU as W,vU as X,jA as Y,_U as Z,bU as _,u1 as a,PL as a0,sf as a1,Hg as a2,wU as a3,uU as b,DM as c,rn as d,Af as e,qk as f,Xk as g,$k as h,Ex as i,AU as j,fU as k,ci as l,yU as m,f3 as n,N_ as o,O6 as p,Ho as q,hU as r,i3 as s,g3 as t,Wk as u,Dx as v,f0 as w,bm as x,To as y,rd as z};
